<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Revision: 22 $ 
$Modtime: 7/02/04 4:23p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- SearchCustomProperties.xml
-
- DESCRIPTION
-
- HISTORY 
-->

<callelement NAME="OpenMarket/Xcelerate/Scripts/FormatDate"/>
<setvar NAME="searchfields" VALUE="Variables.empty"/>
<if COND="IsVariable.searchpropertylist=true">
<then>
	<stringlist NAME="Proplist" STR="Variables.searchpropertylist" DELIM=","/>
</then>
<else>
	<if COND="IsVariable.assetmaker/propertylist=true">
	<then>
		<stringlist NAME="Proplist" STR="Variables.assetmaker/propertylist" DELIM=","/>
	</then>
	</if>
</else>
</if>

<if COND="IsList.Proplist=true">
<then>
	<loop LIST="Proplist">
		<if COND="Variables.searchfields=Variables.empty">
		<then>
			<setvar NAME="searchfields" VALUE="Proplist.ITEM"/>                    
		</then>
		<else>
			<setvar NAME="searchfields" VALUE="Variables.searchfields,Proplist.ITEM"/>
		</else>
		</if>
	
		<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/description=true">
		<then>
			<setvar NAME="formfieldtype" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/type"/>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<setvar NAME="formdescription" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/description"/>
					<TOLOWER STR="Variables.formdescription" OUTSTR="lcformdescription"/>
					<STRING.STREAM VARIABLE="formdescription"/>:
				</td>
				<td>
				</td>
				<td class="form-inset">
					<!-- Treat each search widget type differently -->
					<if COND="Variables.formfieldtype=TEXT">
					<then>
						<!--
						TYPE=TEXT
						-->
						
						<setvar NAME="fieldsize" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/width"/>
						<setvar NAME="maxlength" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/maxlength"/>
						<setvar NAME="storagetype" VALUE="Variables.assetmaker/property/Proplist.ITEM/storage/type"/>
						<if COND="Variables.storagetype=TIMESTAMP">
						<then>
							<INPUT TYPE="hidden" NAME="Proplist.ITEM" VALUE="" REPLACEALL="Proplist.ITEM"/>
							<IF COND="IsVariable.VisProplist.ITEMText=true">
							<THEN>
 		                        <STRING.ENCODE VARIABLE="VisProplist.ITEMText" VARNAME="VisProplist.ITEMTextEnc"/>
								<INPUT TYPE="TEXT" NAME="VisProplist.ITEMText"  VALUE="Variables.VisProplist.ITEMTextEnc" SIZE="Variables.fieldsize" MAXLENGTH="Variables.maxlength" 
									onChange="formatSetDate(this.form.elements['VisProplist.ITEMTextEnc'].value,  'Proplist.ITEM');" REPLACEALL="Variables.VisProplist.ITEMTextEnc, Proplist.ITEM, Variables.maxlength, Variables.fieldsize"/>
							</THEN>
							<ELSE>
								<INPUT TYPE="TEXT" NAME="VisProplist.ITEMText" SIZE="Variables.fieldsize" MAXLENGTH="Variables.maxlength" 
									onChange="formatSetDate(this.form.elements['VisProplist.ITEMText'].value,  'Proplist.ITEM');" REPLACEALL="Proplist.ITEM, Variables.maxlength, Variables.fieldsize"/>
							</ELSE>
							</IF>
						</then>
						<else>
							<IF COND="IsVariable.Proplist.ITEM=true">
							<THEN>
								<setvar NAME="tempval"  VALUE="Variables.Proplist.ITEM"/>
								 <STRING.ENCODE VARIABLE="tempval" VARNAME="tempvalEnc"/>
 		                         <INPUT TYPE="TEXT" NAME="Proplist.ITEM" SIZE="Variables.fieldsize" VALUE="Variables.tempvalEnc"  MAXLENGTH="Variables.maxlength"  REPLACEALL="Variables.tempvalEnc, Proplist.ITEM, Variables.maxlength, Variables.fieldsize"/>
							</THEN>
							<ELSE>
								<INPUT TYPE="TEXT" NAME="Proplist.ITEM" SIZE="Variables.fieldsize" MAXLENGTH="Variables.maxlength"  REPLACEALL="Proplist.ITEM, Variables.maxlength, Variables.fieldsize"/>
							</ELSE>
							</IF>
						</else>
						</if>
					</then>
					</if>
					
					<!-- No widget for fields of type 'password'!! -->
					
					<if COND="Variables.formfieldtype=TEXTAREA">
					<then>
						<!--
						TYPE=TEXTAEA
						-->
						
						<setvar NAME="numrows" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/rows"/>
						<setvar NAME="numcols" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/cols"/>
						<IF COND="IsVariable.Proplist.ITEM=true">
						<THEN>
							<TEXTAREA NAME="Proplist.ITEM" ROWS="Variables.numrows" COLS="Variables.numcols"
								WRAP="virtual" REPLACEALL="Proplist.ITEM, Variables.numrows, Variables.numcols"> 
                                <STRING.STREAM VALUE="Variables.Proplist.ITEM"/>
							</TEXTAREA>
						</THEN>
						<ELSE>
							<TEXTAREA NAME="Proplist.ITEM" ROWS="Variables.numrows" COLS="Variables.numcols"
								WRAP="virtual" REPLACEALL="Proplist.ITEM, Variables.numrows, Variables.numcols"></TEXTAREA>
						</ELSE>
						</IF>
					</then>
					</if>
					
					
					<if COND="Variables.formfieldtype=CHECKBOX">
					<then>
						<!--
						TYPE=CHECKBOX
						-->

						<setvar NAME="checksourcetype" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sourcetype"/>
						<if COND="Variables.checksourcetype=TABLE">
						<then>
							<setvar NAME="tablename" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/tablename"/>
							<setvar NAME="errno" VALUE="0"/>
							<setvar NAME="cbvaluekey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/cbvaluekey"/>
							<setvar NAME="cbdesckey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/cbdesckey"/>
							<setvar NAME="selectsql" VALUE="SELECT Variables.cbvaluekey,Variables.cbdesckey
								FROM Variables.tablename ORDER BY Variables.cbdesckey"/>
							<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/sql=true">
							<then>
								<setvar NAME="selectsql" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sql"/>
		 						<setvar NAME="selectsql" VALUE="Variables.selectsql"/>   <!-- to resolve any variables in the query -->
							</then>
							</if>
	
							<execsql LIST="CBList" SQL="Variables.selectsql"/>
							<loop LIST="CBList">
								<setvar NAME="cbvalue" VALUE="CBList.Variables.cbvaluekey"/>
								<setvar NAME="errno" VALUE="0"/>
 								<INPUT TYPE="CHECKBOX" NAME="Proplist.ITEM" VALUE="Variables.cbvalue" REPLACEALL="Proplist.ITEM,Variables.cbvalue"/><STRING.STREAM LIST="CBList" COLUMN="Variables.cbdesckey"/><BR/>
							</loop>
						</then>
						</if>
	
						<if COND="Variables.checksourcetype=STRING">
						<then>
							<setvar NAME="cbvalues" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/cbvalues"/>
							<setvar NAME="cbdescriptions" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/cbdescriptions"/>
							<stringlist NAME="cbvlist" STR="Variables.cbvalues" DELIM=","/>
							<stringlist NAME="cbdesclist" STR="Variables.cbdescriptions" DELIM=","/>
							<loop LIST="cbvlist">
								<setvar NAME="errno" VALUE="0"/>
								<INPUT TYPE="CHECKBOX" NAME="Proplist.ITEM" VALUE="cbvlist.ITEM" REPLACEALL="Proplist.ITEM, cbvlist.ITEM,cbdesclist.ITEM"/><STRING.STREAM VALUE="cbdesclist.ITEM"/><BR/>
								<setrow LIST="cbdesclist" ACTION="NEXT"/>
							</loop>
						</then>
						</if>
						<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
					</then>
					</if>
					
					
					<if COND="Variables.formfieldtype=SELECT">
					<then>
						<!--
						TYPE=SELECT
						-->

						<setvar NAME="selectsourcetype" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sourcetype"/>
						<setvar NAME="hasmultiple" VALUE="NO"/>
						<setvar NAME="multiplesize" VALUE="1"/>
						<setvar NAME="bogosity" VALUE="VERYSILLY"/>
						<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/multiple=true">
						<then>
							<setvar NAME="hasmultiple" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/multiple"/>
							<if COND="Variables.hasmultiple=YES">
							<then>
								<setvar NAME="bogosity" VALUE="MULTIPLE"/>
							</then>
							</if>
							<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/size=true">
							<then>
								<setvar NAME="multiplesize" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/size"/>
							</then>
							</if>
						</then>
						</if>
	
						<if COND="Variables.selectsourcetype=TABLE">
						<then>
							<!-- SELECT from table values -->
							
							<!-- get the LHS and RHS by running a query against the specified table -->
	
							<setvar NAME="tablename" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/tablename"/>
							<setvar NAME="errno" VALUE="0"/>
							<setvar NAME="lhskey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/optionvaluekey"/>
							<setvar NAME="rhskey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/optiondesckey"/>
							<setvar NAME="selectsql" VALUE="SELECT Variables.lhskey,Variables.rhskey
								FROM Variables.tablename ORDER BY Variables.rhskey"/>
							<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/sql=true">
							<then>
								<setvar NAME="selectsql" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sql"/>
	 							<setvar NAME="selectsql" VALUE="Variables.selectsql"/>   <!-- to resolve any variables in the query -->
							</then>
							</if>
							<execsql LIST="EditSelect" SQL="Variables.selectsql"/>
							<SELECT NAME="Proplist.ITEM" Variables.bogosity="Variables.hasmultiple" SIZE="Variables.multiplesize" REPLACEALL="Proplist.ITEM, Variables.hasmultiple, Variables.bogosity, Variables.multiplesize">
								<!-- the comparision for the field value is going to be different -->
								<IF COND="IsVariable.Proplist.ITEM=true">
								<THEN>
									<loop LIST="EditSelect">
										<setvar NAME="optionlhs" VALUE="EditSelect.Variables.lhskey"/>
										<setvar NAME="tempval"  VALUE="Variables.Proplist.ITEM"/>
										<IF COND="Variables.tempval=Variables.optionlhs">
										<THEN>
											<OPTION VALUE="Variables.optionlhs" SELECTED="" REPLACEALL="Variables.optionlhs"/><STRING.STREAM LIST="EditSelect" COLUMN="Variables.rhskey"/>
										</THEN>
										<ELSE>
											<OPTION VALUE="Variables.optionlhs" REPLACEALL="Variables.optionlhs"/><STRING.STREAM LIST="EditSelect" COLUMN="Variables.rhskey"/>
										</ELSE>
										</IF>
									</loop>
									<OPTION VALUE=""/>-- <XLAT.STREAM KEY="dvin/Assetmaker/ChooseIcformDes"/>  --
								</THEN>
								<ELSE>
									<OPTION VALUE=""/>-- <XLAT.STREAM KEY="dvin/Assetmaker/ChooseIcformDes"/>  --
									<loop LIST="EditSelect">
										<setvar NAME="optionlhs" VALUE="EditSelect.Variables.lhskey"/>
										<OPTION VALUE="Variables.optionlhs" REPLACEALL="Variables.optionlhs"/><STRING.STREAM LIST="EditSelect" COLUMN="Variables.rhskey"/>
									</loop>
								</ELSE>
								</IF>
							</SELECT>
						</then>
						</if>
	
						<if COND="Variables.selectsourcetype=STRING">
						<then>
							<!-- SELECT from string values -->
							<setvar NAME="lhs" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/optionvalues"/>
							<setvar NAME="rhs" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/optiondescriptions"/>
							<stringlist NAME="lhslist" STR="Variables.lhs" DELIM=","/>
							<stringlist NAME="rhslist" STR="Variables.rhs" DELIM=","/>    
							<SELECT NAME="Proplist.ITEM" Variables.bogosity="Variables.hasmultiple" SIZE="Variables.multiplesize" REPLACEALL="Proplist.ITEM, Variables.hasmultiple, Variables.bogosity, Variables.multiplesize">
								<IF COND="IsVariable.Proplist.ITEM=true">
								<THEN>
									<loop LIST="lhslist">
										<setvar NAME="tempvar"  VALUE="Variables.Proplist.ITEM"/>
										<IF COND="Variables.tempvar=lhslist.ITEM">
										<THEN>
     									<OPTION VALUE="lhslist.ITEM" SELECTED="" REPLACEALL="lhslist.ITEM"/><STRING.STREAM VALUE="rhslist.ITEM"/>
										</THEN>
										<ELSE>
    									<OPTION VALUE="lhslist.ITEM" REPLACEALL="lhslist.ITEM"/><STRING.STREAM VALUE="rhslist.ITEM"/>
										</ELSE>
										</IF>
										<setrow LIST="rhslist" ACTION="NEXT"/>
									</loop>
									<OPTION VALUE=""/>-- <XLAT.STREAM KEY="dvin/Assetmaker/ChooseIcformDes"/>  --
								</THEN>
								<ELSE>
									<OPTION VALUE=""/>-- <XLAT.STREAM KEY="dvin/Assetmaker/ChooseIcformDes"/>  --
									<loop LIST="lhslist">
    									<OPTION VALUE="lhslist.ITEM" REPLACEALL="lhslist.ITEM"/><STRING.STREAM VALUE="rhslist.ITEM"/>
										<setrow LIST="rhslist" ACTION="NEXT"/>
									</loop>
								</ELSE>
								</IF>
							</SELECT>
						</then>
						</if>
						<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
					</then>
					</if>
					
					
					<if COND="Variables.formfieldtype=RADIO">
					<then>
						<!--
						TYPE=RADIO
						-->

						<setvar NAME="radiosourcetype" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sourcetype"/>
						<if COND="Variables.radiosourcetype=TABLE">
						<then>
							<setvar NAME="tablename" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/tablename"/>
							<setvar NAME="errno" VALUE="0"/>
							<setvar NAME="rbvaluekey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/rbvaluekey"/>
							<setvar NAME="rbdesckey" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/rbdesckey"/>
							<setvar NAME="selectsql" VALUE="SELECT Variables.rbvaluekey,Variables.rbdesckey
															FROM Variables.tablename ORDER BY Variables.rbdesckey"/>
							<if COND="IsVariable.assetmaker/property/Proplist.ITEM/searchform/sql=true">
							<then>
								<setvar NAME="selectsql" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/sql"/>
	 							<setvar NAME="selectsql" VALUE="Variables.selectsql"/>   <!-- to resolve any variables in the query -->
							</then>
							</if>
	
							<execsql LIST="RBList" SQL="Variables.selectsql"/>
							<loop LIST="RBList">
								<setvar NAME="rbvalue" VALUE="RBList.Variables.rbvaluekey"/>
								<INPUT TYPE="RADIO" NAME="Proplist.ITEM" VALUE="Variables.rbvalue" REPLACEALL="Proplist.ITEM,Variables.rbvalue"/><STRING.STREAM LIST="RBList" COLUMN="Variables.rbdesckey"/><BR/>
							</loop>
						</then>
						</if>
	
						<if COND="Variables.radiosourcetype=STRING">
						<then>
							<!-- Source is a string -->
							<setvar NAME="rbvalues" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/rbvalues"/>
							<setvar NAME="rbdescriptions" VALUE="Variables.assetmaker/property/Proplist.ITEM/searchform/rbdescriptions"/>
							<stringlist NAME="rbvlist" STR="Variables.rbvalues" DELIM=","/>
							<stringlist NAME="rbdesclist" STR="Variables.rbdescriptions" DELIM=","/>
							<loop LIST="rbvlist">
								<INPUT TYPE="RADIO" NAME="Proplist.ITEM" VALUE="rbvlist.ITEM" REPLACEALL="Proplist.ITEM,rbvlist.ITEM,rbdesclist.ITEM"/><STRING.STREAM VALUE="rbdesclist.ITEM"/><BR/>
								<setrow LIST="rbdesclist" ACTION="NEXT"/>
							</loop>
						</then>
						</if>
						<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
					</then>
					</if>
					
					
					<if COND="Variables.formfieldtype=ELEMENT">
					<then>
						<!--
						TYPE=ELEMENT
						-->

						<if COND="IsElement.OpenMarket/Xcelerate/AssetType/Variables.AssetType/SearchForm/Proplist.ITEM=true">
						<then>
							<callelement NAME="OpenMarket/Xcelerate/AssetType/Variables.AssetType/SearchForm/Proplist.ITEM">
								<argument NAME="fieldname" VALUE="Proplist.ITEM"/>
							</callelement>
						</then>
						<else>
							<XLAT.STREAM KEY="dvin/Assetmaker/UnableFindProplistITEM"/> 
						</else>
						</if>
					</then>
					</if>

				</td>
			</tr>
		</then>
		</if>
	</loop>
</then>
</if>

<INPUT type="HIDDEN" NAME="searchfields" VALUE="Variables.searchfields" REPLACEALL="Variables.searchfields"/>

</FTCS> 
