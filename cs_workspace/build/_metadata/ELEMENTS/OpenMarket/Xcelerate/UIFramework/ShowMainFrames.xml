<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!--
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/UIFramework/ShowMainFrames.xml $
$Revision: 31 $
$Modtime: 3/02/04 4:32a $
-->

<!--
 Confidential and Proprietary Information of FutureTense Inc.
					All Rights Reserved.

 ShowMainFrames.xml

 DESCRIPTION
	Display the main frames that make up the application

 HISTORY
-->
<STRING.ENCODE VARIABLE="ThisPage" VARNAME="ThisPage"/>
<!-- we are doing this to be secure against html injection attack through the thisPage value. we encode it and if the encoded string contains a % or ; it is a bad string -->
<INDEXOF STR="Variables.ThisPage" WHAT="%" OUTSTR="_ThisPage" INDEX="0"/>
<IF COND="Variables.errno=0">
<THEN>
<INDEXOF STR="Variables.ThisPage" WHAT=";" OUTSTR="__ThisPage" INDEX="0"/>
</THEN>
</IF>
<IF COND="Variables.errno=0">
<THEN>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>
<PROPERTY.GET PARAM="wem.enabled" INIFILE="futuretense_xcel.ini" VARNAME="wemenabled"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo" />
<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetTimeZoneInSession" />
 <if cond="Variables.wemenabled=true">
	<then>		
		<if cond="IsSessionVariable.pubid=false">
			<then>				
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoginPage"/>			
			</then>
		</if>
	</then>
</if>	

<HTML>
<HEAD>
    <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>

    <!--This is just so that the timeout page will show something reasonable-->
    <CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetLocale"/>
   
	<TITLE>Oracle WebCenter Sites 11gR1</TITLE></HEAD>
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowWorkFrames" outstring="theaction">
                                          <satellite.argument name="ThisPage" value="Variables.ThisPage"/>
                                           </SATELLITE.LINK>

    <if COND="IsVariable.pubid=true">
        <then>
            <!-- Check whether user is authorized for given pubid -->
            <PROPERTY.GET PARAM="xcelelem.manageuserpub" INIFILE="futuretense_xcel.ini" VARNAME="propmanageuserpub"/>
            <USERMANAGER.GETLOGINUSER VARNAME="userid"/>
            <callelement NAME="Variables.propmanageuserpub">
                <argument NAME="upcommand" VALUE="IsUserAuthorized"/>
                <argument NAME="username" VALUE="Variables.userid"/>
                <argument NAME="pubid" VALUE="Variables.pubid"/>
            </callelement>

            <if cond="Variables.IsAuthorized=true">
                <then>
                    <!-- Set session information for this site -->
                    <setssvar NAME="pubid" VALUE="Variables.pubid"/>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Security/SetPublicationName"/>
                </then>
                <else>
                    <!-- Kill user session and show error page -->
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Security/TimeoutError">
                        <argument NAME="cs_environment" VALUE="standard"/>
                    </callelement>
                    <CATALOGMANAGER>
                        <ARGUMENT NAME="ftcmd" VALUE="logout"/>
                        <ARGUMENT NAME="killsession" VALUE="true"/>
                    </CATALOGMANAGER>
                </else>
            </if>
        </then>
    </if>  

	<if COND="IsVariable.AssetType=true">
        <then>
            <SETVAR NAME="theaction" VALUE="Variables.theaction&#38;AssetType=Variables.AssetType"/>
        </then>
	</if>
    <if COND="IsVariable.id=true">
        <then>
            <SETVAR NAME="theaction" VALUE="Variables.theaction&#38;id=Variables.id"/>
        </then>
	</if>
    <if COND="IsVariable.showSiteTree=true">
    <then>
        <callelement NAME="OpenMarket/Xcelerate/Util/validateFields">
            <ARGUMENT NAME="columnvalue" VALUE="Variables.showSiteTree"/>
	        <ARGUMENT NAME="type" VALUE="Boolean"/>
   		</callelement>
   		<if cond="Variables.validatedstatus=true">
   		<then>
   			<SETVAR NAME="theaction" VALUE="Variables.theaction&#38;showSiteTree=Variables.showSiteTree"/>
    	</then>
   		</if>
    </then>
	</if>
	
   <if COND="Variables.wem=true">
		<then>			
			<SETVAR NAME="theaction" VALUE="Variables.theaction&#38;wem=Variables.wem"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowAppToolbar" outstring="urlshowapptoolbar">
				<satellite.argument name="wem" value="true"/>		
			</SATELLITE.LINK>									
			<SETVAR NAME="frameheight" VALUE="40"/>
		</then>
		<else>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowAppToolbar" outstring="urlshowapptoolbar">		
			</SATELLITE.LINK>
			<SETVAR NAME="frameheight" VALUE="40"/>  
		</else>
	</if>
	
	<!-- BEGIN: Check current user and site in session -->
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/getSessionIdentifier"/>
    <REPLACEALL LIST="CS.Property.ft.cgipath,Variables.sessionIdentifier">
    <script type="text/javascript" src="CS.Property.ft.cgipathjs/csWindowButtons.js"></script>
    <script language="JavaScript">

		<![CDATA[
		var csPath = "CS.Property.ft.cgipathContentServer";
		var currentUserSite = "Variables.sessionIdentifier";		
		window.name=ADVANCED_SCREEN;
		advancedWin=window;		
		if( window.opener != null && window.opener.cloneWindowReferences){
		    //this page was opened up form another..need to set window references for window buttons after this page
		    // has loaded so call it now!
		    window.opener.cloneWindowReferences();
		}	
		
		]]>
	</script>
    </REPLACEALL>
		
	<script src="CS.Property.ft.cgipathjs/cs.js" REPLACEALL="CS.Property.ft.cgipath"></script>
	
	
	<script language="JavaScript">
		<![CDATA[
		window.onmouseover = checkUser;
		]]>
	</script>
	<!-- END: Check current user and site in session -->
	
	
     <FRAMESET ROWS="Variables.frameheight, *" FRAMEBORDER="0" BORDER="0" FRAMESPACING="0" ONFOCUS="checkUser()" REPLACEALL="Variables.frameheight">
        <FRAME NAME="XcelBanner" SRC="Variables.urlshowapptoolbar" MARGINWIDTH="0" MARGINHEIGHT="0" FRAMEBORDER="0" SCROLLING="no" ONFOCUS="checkUser()" REPLACEALL="Variables.urlshowapptoolbar"/>
        <FRAME NAME="XcelWorkFrames" SRC="Variables.theaction" PADDING="10" MARGINWIDTH="0" MARGINHEIGHT="0" FRAMEBORDER="0" ONFOCUS="checkUser()" REPLACEALL="Variables.theaction"/>
    </FRAMESET>
</HTML>
</THEN>
<ELSE>
<XLAT.LOOKUP KEY="UI/UC1/JS/InvalidInput" VARNAME="_XLAT_"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
	<ARGUMENT NAME="msgtext" VALUE="Variables._XLAT_"/>
	<argument NAME="name" VALUE="ThisPage"/>
	<ARGUMENT NAME="severity" VALUE="error"/>
</CALLELEMENT>
</ELSE>
</IF>
</FTCS>
