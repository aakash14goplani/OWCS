<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>
<!-- OpenMarket/Xcelerate/UIFramework/ShowAppToolbar
 Confidential and Proprietary Information of Open Market, Inc.
 All Rights Reserved.

 DESCRIPTION
 Display the Content Centre main application toolbar
 REQUIRED INPUT

 IMPORTANT: Do NOT alter ANY of the line breaks in this file as they affect the
 appearance of the toolbar in the browser.
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceleditor"/>
<if COND="Variables.errno=0">
    <then>
        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Security/NoXceleditor" outstring="noXceleditorError">
        </SATELLITE.LINK>
        <REPLACE STR="Variables.noXceleditorError">
            <script LANGUAGE="JavaScript">
                parent.parent.location="Variables.noXceleditorError";
            </script>
        </REPLACE>
        <throwexception/>
    </then>
</if>

<HTML>
<HEAD>

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/SetStylesheet"/>

<!-- 
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/SetDefaultPreviewURL" />
-->


<STRINGLIST NAME="userRoles" STR="SessionVariables.currentpubACLs" DELIM=","/>


<PROPERTY.GET PARAM="xcelerate.showSiteTree" INIFILE="futuretense_xcel.ini" VARNAME="propshowsitetree"/>

<IF COND="IsVariable.showSiteTree=true">
<THEN>
    <SETVAR NAME="togshowsitetree" VALUE="Variables.showSiteTree"/>
</THEN>
<ELSE>
    <SETVAR NAME="togshowsitetree" VALUE="Variables.propshowsitetree"/>
</ELSE>
</IF>

<!-- Check that the site plan button needs to be displayed for the current site based on tab configuration-->
<SETVAR NAME="showSitePlan" VALUE="false"/>
<TTM.GETORDEREDTABS PUBID="SessionVariables.pubid" LISTVARNAME="tabs"/>
<IF COND="IsList.tabs=false">
<THEN>
	<SETVAR NAME="showSitePlan" VALUE="false"/>
</THEN>
</IF>
<IF COND="tabs.#numRows=0">
<THEN>
	<SETVAR NAME="showSitePlan" VALUE="false"/>
</THEN>
<ELSE>
<LOOP LIST="tabs">
	<ICS.LISTGET LISTNAME="tabs" FIELDNAME="title" OUTPUT="tabName"/>
	<IF COND="Variables.tabName=Site Plan">
	<THEN>
		<SETVAR NAME="showSitePlan" VALUE="true"/>
	</THEN>
	</IF>
</LOOP>
</ELSE>
</IF>

<!-- scarey: Add toggle tree option for everyone if xcelerate.restrictSiteTree is false, or for xceladmins only if true. -->
<SETVAR NAME="toggleTreeIcon" VALUE="DONTSHOW"/>
<SETVAR NAME="enableAdminTab" VALUE="false"/>    
<IF COND="Variables.propshowsitetree=true">
<THEN>
    <SETVAR NAME="toggleTreeIcon" VALUE="HIDETREEICON"/>
</THEN>
<ELSE>
    <SETVAR NAME="errno" VALUE="0"/>
    <USERISMEMBER GROUP="xceladmin"/>
    <IF COND="Variables.errno=1">
    <THEN>
        <SETVAR NAME="toggleTreeIcon" VALUE="SHOWTREEICON"/>
        <SETVAR NAME="enableAdminTab" VALUE="true"/>
    </THEN>
    <ELSE>
        <PROPERTY.GET PARAM="xcelerate.restrictSiteTree" INIFILE="futuretense_xcel.ini" VARNAME="proprestrictsitetree"/>
        <IF COND="Variables.proprestrictsitetree=false">
        <THEN>
           <SETVAR NAME="toggleTreeIcon" VALUE="SHOWTREEICON"/>
        </THEN>
        </IF>
    </ELSE>
    </IF>
</ELSE>
</IF>  
<!-- The _enableForms property enables/disables following assettypes from the advanced ui.
	�	All Flex assets and their parent assets
	�	All basic assets
	�	Engage assets like Recommendation, Segment and Promotion
	�	Special assets like Query and Collection
	-->
<PROPERTY.GET PARAM="advancedUI.enableAssetForms" INIFILE="futuretense_xcel.ini" VARNAME="_enableForms"/>
<if cond="Variables._enableForms=true">
<then>
	<setvar name="ThisPage" value="ShowMyDesktopFront"/>
</then>
<else>
	<setvar name="ThisPage" value="ShowStartMenuItems"/>
</else>
</if>
<SCRIPT LANGUAGE="JavaScript">
var sst = "<STRING.STREAM VALUE="Variables.togshowsitetree"/>"; 
var enableAdminTab = "<STRING.STREAM VALUE="Variables.enableAdminTab"/>";

<![CDATA[
function popNewWindow(winURL)
{
    editwindow=window.open(winURL+"&showSiteTree="+parent.frames['XcelWorkFrames'].showSiteTree,"_blank");
}

function showRoles()
{
    alert("]]><USERMANAGER.GETDISPLAYABLELOGINUSERNAME VARNAME="loginusername"/><XLAT.STREAM KEY="dvin/UI/UserRolesAlertMsg" usrname="Variables.loginusername" sitename="SessionVariables.PublicationDesc" EVALALL="false" ESCAPE="true" ENCODE="false"/>\n" +
      <LOOP LIST="userRoles">
      "* <STRING.STREAM VALUE="userRoles.ITEM"/>\n" +
      </LOOP>
      "");
 }

</SCRIPT>
<SCRIPT Language="JavaScript">
<![CDATA[
	var isNew = 0;
	var isNS4 = 0;
	var isIE4 = 0;
	var isIE5 = 0;
	var isNS5 = 0;
	var isID  = 0;
	var docObj = "";
	var styleObj = "";

	// Determine browser versions
	var brow = ((navigator.appName) + (parseInt(navigator.appVersion)));
	var isat = navigator.userAgent.indexOf("MSIE");
	var ieVer = -1;
	if (isat > -1)
	{
		// IE
		isat += 5;
		var end = navigator.userAgent.indexOf(";", isat);
		if (end > isat)
			ieVer = parseInt(navigator.userAgent.substring(isat, end));
	}

	if (ieVer == 4)
	{isIE4 = 1;}
	if (ieVer == 5)
	{isIE5 = 1;}
	if (ieVer == 6)
	{isIE5 = 1;}
	if (ieVer > 6)
	{isNew = 1;}

	if (parseInt(navigator.appVersion) >= 5) { isNew=1; }
	else if (brow=="Netscape4") {isNS4=1;}

	if (brow=="Netscape5") {isNS5=1;}

	// Set docObj and styleObj
	if (isNS4 || isIE4 || isIE5 ||isNew) {
		docObj = (isNS4) ? 'document' : 'document.all';
		styleObj = (isNS4) ? '' : '.style';
		if (isIE5 || isNS5 || isNew) {isID=1;}
	}
]]>
function toggleTree()
{
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowWorkFrames" outstring="urlshowworkframes">
    </SATELLITE.LINK>
    <REPLACEALL  LIST="Variables.urlshowworkframes,Variables.ThisPage">
	<![CDATA[	
		var pURL = "Variables.urlshowworkframes";
		var thisPage = "&ThisPage=Variables.ThisPage";
		var origBase = pURL + thisPage ;
    ]]>
	</REPLACEALL >
    <![CDATA[
    ReverseContentDisplay("tab7");
    if (parent.frames['XcelWorkFrames'].showSiteTree=="true")
    {
        parent.frames['XcelWorkFrames'].showSiteTree="false";
    }
    else
    {
        parent.frames['XcelWorkFrames'].showSiteTree="true";
        clearToolbarHistory();
    }
    parent.frames['XcelWorkFrames'].location = origBase + "&showSiteTree=" + parent.frames['XcelWorkFrames'].showSiteTree;
    ]]>
}


 <![CDATA[
var hist = new Array();


function Asset(type,id,name)
{
    this.type = type;
    this.id = id;
    this.name = name;
}

function addToHistory(atype,aid,aname)
{
    var len = hist.length;
    var found = false;
    for (i=0; i < len; i++)
    {
        if (hist[i].id == aid)
        {
            for (j=i; j < len-1; j++)
            {
                hist[j].id = hist[j+1].id;
                hist[j].type = hist[j+1].type;
                hist[j].name = hist[j+1].name;
            }
            hist[len-1].type = atype;
            hist[len-1].id = aid;
            hist[len-1].name = aname;
            found = true;
        }
    }
    if (found !=true)
    {
        if (len == 100)
        {
            for (j=0; j < len-1; j++)
            {
                hist[j].id = hist[j+1].id;
                hist[j].type = hist[j+1].type;
                hist[j].name = hist[j+1].name;
            }
            hist[len-1].type = atype;
            hist[len-1].id = aid;
            hist[len-1].name = aname;
        }
        else
        {
            hist[len] = new Asset(atype,aid,aname);
        }
    }
}

function removeFromHistory(aid,atype)
{
    var len = hist.length;
    for (i=0; i < len; i++)
    {
        if (hist[i].id == aid && hist[i].type==atype)
        {
            for (j=i; j < len-1; j++)
            {
                hist[j].id = hist[j+1].id;
                hist[j].type = hist[j+1].type;
                hist[j].name = hist[j+1].name;
            }
            hist.length = len-1;
        }
    }
}

function clearToolbarHistory()
{
    hist.length = 0;
}

function displayInsiteImage( imgObj )
{
    //[2008-03-05 KGF] insite button is always clickable now.
    ]]>
    <replace STR="Variables.cs_imagedir">
    swap(imgObj,'Variables.cs_imagedir/graphics/common/toolbar/insitehover.gif');
    </replace>
    <![CDATA[
}

function showHistory()
{
    var len = hist.length;
]]>
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowRecentFront" outstring="urlshowrecentfront">
    </SATELLITE.LINK>
    <replace STR="Variables.urlshowrecentfront">
    var pURL = "Variables.urlshowrecentfront";
    var origBase = pURL;
    </replace>
    <![CDATA[
    var typearray = "";
    var historyarray = "";
    for (i=len-1; i >= 0; i--) {
    if (historyarray == "")
    {
        historyarray = ""+hist[i].id+"";
        typearray = "" + hist[i].type + "";
    }
    else
    {
        historyarray =  historyarray + "," +  hist[i].id +"";
        typearray = typearray + "," + hist[i].type +"";}
    }
    origBase = origBase + "&historyarray=" + historyarray+"&typearray="+typearray;
    parent.XcelWorkFrames.XcelAction.location = origBase;
}
]]>
</SCRIPT>
<REPLACEALL LIST="SessionVariables.locale,Variables.cs_imagedir">
<![CDATA[
<SCRIPT Language="JavaScript">
function ReverseContentDisplay(d)
{
	if(document.getElementById(d).style.display == "none") { document.getElementById(d).style.display = "inline"; }
	else { document.getElementById(d).style.display = "none"; }
}

function switchToggleIcon(iconDivFrom,iconDivTo)
{       
    if(document.getElementById(iconDivFrom).style.display != "none")
    {
        document.getElementById(iconDivFrom).style.display = "none";
        document.getElementById(iconDivTo).style.display = "inline";
		if(iconDivFrom == 'FullWindowToggleDiv') {
			document.getElementById(iconDivTo).style.left = 0;
		} else {
			document.getElementById(iconDivTo).style.left = "220px";
		}
		toggleTree();
    }

}
</SCRIPT>
]]>
</REPLACEALL>
</HEAD>
<BODY leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<SUBSTITUTE STR="SessionVariables.currentpubACLs" WHAT="," WITH=", " OUTSTR="userACLs"/>
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/LoginPost" outstring="urlLoginPost" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/LogoutFront" outstring="urlLogoutFront" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowStartMenuItems" outstring="NewURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowSearches" outstring="SearchURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/BrowseSiteFront" outstring="BrowseURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowMyDesktopFront" outstring="MyWorkURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowCheckoutsFront" outstring="MyCheckoutsURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowMyActiveListFront" outstring="MyActiveListURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowWorkflowFront" outstring="WorkflowURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowWorkListFront" outstring="MyWorkListURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PublishConsoleFront" outstring="PublishingURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/UserProfileFront" outstring="UserProfileURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AdminMenuFront" outstring="AdminURL" />
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/User/ModifyProfile" outstring="modifyURL" />

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/WemTopToolBar"/>
</BODY>
</HTML>
</FTCS>
