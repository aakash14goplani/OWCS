<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!-- OpenMarket/Xcelerate/Actions/ALPopupFront
-
- INPUT
-
- OUTPUT
-
-->

      <SETVAR NAME="errno" VALUE="0"/>
      <USERMANAGER.GETLOGINUSER VARNAME="currentUser"/>
	  <SETVAR NAME="validatedstatus" VALUE="true" />
	  <STRINGLIST NAME="stringhistory" STR="Variables.history" DELIM=","/>
	  <LOOP LIST="stringhistory">
		<IF COND="Variables.validatedstatus=true" >
		<THEN>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
				<ARGUMENT NAME="columnvalue" VALUE="stringhistory.ITEM"/>
				<ARGUMENT NAME="type" VALUE="Long"/>
			</CALLELEMENT>
		</THEN>
		</IF>
      </LOOP>

      <IF COND="IsVariable.AssetType=true">
      <THEN>
      	<ACTIVELIST.GETUSERLIST USER="Variables.currentUser" ASSETTYPE="Variables.AssetType" SITE="SessionVariables.pubid" PREFIX="AL:"/>
      	<IF COND="IsVariable.history=true">
      	<THEN>
              <ics.literal table="AssetPublication" column="assettype" string="Variables.AssetType"
                   output="literal"/>
        
       		<SETVAR NAME="errno" VALUE="0"/>
      		<SETVAR NAME="tablename" VALUE="AssetPublication"/>
			<IF COND="Variables.validatedstatus=true">
			<THEN>
				<EXECSQL LIST="theAssets" SQL="SELECT * FROM AssetPublication WHERE assettype=Variables.literal AND assetid IN (Variables.history) AND pubid=SessionVariables.pubid"/>
			</THEN>
			</IF>
      	</THEN>
      	</IF>
      </THEN>
      <ELSE>
      	<ACTIVELIST.GETUSERLIST USER="Variables.currentUser" SITE="SessionVariables.pubid" PREFIX="AL:"/>
      	<IF COND="IsVariable.history=true">
      	<THEN>
      		<SETVAR NAME="errno" VALUE="0"/>
      		<SETVAR NAME="tablename" VALUE="AssetPublication"/>
			<IF COND="Variables.validatedstatus=true">
			<THEN>
				<EXECSQL LIST="theAssets" SQL="SELECT * FROM AssetPublication WHERE assetid IN (Variables.history) AND pubid=SessionVariables.pubid"/>
			</THEN>
			</IF>
      	</THEN>
      	</IF>
      </ELSE>
      </IF>
      
      <IF COND="Variables.style=single">
      <THEN>
          <SETVAR NAME="colSpan" VALUE="6"/>
      </THEN>
      <ELSE>
          <SETVAR NAME="colSpan" VALUE="8"/>
      </ELSE>
      </IF>
      	<SCRIPT LANGUAGE="JavaScript">
      		<![CDATA[
      		function SetSelection(field,value,idfield,id)
      		{
      			var fixedValue = value.replace(/__TICK__/g,"'");
      			field.value=fixedValue;
      			idfield.value=id;
      		}
            
            function SetSelections(ourPage,target)
            {
                if (window.opener && window.opener.popupCallBack) {
                    window.opener.popupCallBack();
                }
                // need to make it look like a tree pick,
                // set the target variable and
                // post the parent form
                var selections = document.forms[0].elements['ALSelections'];
            var obj = window.opener.document.forms[0].elements[0];
                var i=0;
                var allSelections='';
            
            if (typeof(selections.length)!='undefined')
            {
                    for (i=0;i<selections.length;i++)
                    {
                        if (selections[i].checked)
                            allSelections+=selections[i].value+":";
                    }
            }
            else
            {
               if (selections.checked)
                  allSelections=selections.value;
            }
                target.value=allSelections;
                
                var basePage = "OpenMarket/Xcelerate/Actions/";
                 if(ourPage=="CopyFront")
                    ourPage="NewContentFront";
            
                var	newpage = basePage + ourPage;
                obj.form.pagename.value = newpage;
                
                if (window.opener.document.forms[0].elements['doSubmit'])
                {
                     if (window.opener.document.forms[0].elements['doSubmit'].value=="yes")
                     {
                        window.opener.document.forms[0].submit();
                     }
                } else {
                    window.opener.document.forms[0].submit();
                }
            }
      		]]>
      	</SCRIPT>
	<STRING.ENCODE VARIABLE="field" VARNAME="field"/>
	<STRING.ENCODE VARIABLE="idfield" VARNAME="idfield"/>

        <div class="subtitle-text"><XLAT.STREAM KEY="dvin/Common/ActiveList"/> / <XLAT.STREAM KEY="dvin/Common/History"/></div>
<p/>
	 <STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
     <table BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%">
     <tr>
		<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
	</tr>
	<tr>
	<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
	<td >
	<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="Variables.colSpan" class="tile-highlight" REPLACEALL="Variables.colSpan"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
		<tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
			<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></td>
			<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Type"/></DIV></td>
            <IF COND="Variables.style!=single">
            <THEN>
                <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/SelectQ"/></DIV></td>
            </THEN>
            </IF>
			<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
		</tr>
        <tr><td colspan="Variables.colSpan" class="tile-dark" REPLACEALL="Variables.colSpan"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

        <setvar NAME="rowStyle" VALUE="tile-row-normal"/>
        <SETVAR NAME="separatorLine" VALUE="0"/>
            <!-- merge and sort the activelist and history -->
            <HASH.CREATE NAME="hMergedListIDs"/>
            <HASH.CREATE NAME="hMergedListNames"/>
            <HASH.CREATE NAME="hIDType"/>
            <IF COND="Variables.AL:Total!=0">
      		<THEN>
      			<SETCOUNTER NAME="currentItem" VALUE="0"/>
      			
      			<LOOP COUNT="Variables.AL:Total">	
                    <ACTIVEITEM.GETASSETID NAME="AL:Counters.currentItem" VARNAME="ID"/>
                    <ACTIVEITEM.GETASSETTYPE NAME="AL:Counters.currentItem" VARNAME="AssetType"/>
                    <ASSET.LIST TYPE="Variables.AssetType" LIST="currentAsset" FIELD1="id" VALUE1="Variables.ID"/>
                    <HASH.ADD NAME="hMergedListIDs" KEY="currentAsset.name" VALUE="Variables.ID"/>
                    <HASH.ADD NAME="hMergedListNames" KEY="Variables.ID" VALUE="currentAsset.name"/>
                    <HASH.ADD NAME="hIDType" KEY="Variables.ID" VALUE="Variables.AssetType"/>
                    <INCCOUNTER NAME="currentItem" VALUE="1"/>
                </LOOP>
            </THEN>
            </IF>
            <IF COND="IsList.theAssets=true">
      		<THEN>
      			<LOOP LIST="theAssets">
                    <ASSET.LIST TYPE="theAssets.assettype" FIELD1="id" VALUE1="theAssets.assetid" LIST="lCurrentHistory"/>
                    <HASH.ADD NAME="hMergedListIDs" KEY="lCurrentHistory.name" VALUE="theAssets.assetid"/>
                    <HASH.ADD NAME="hMergedListNames" KEY="theAssets.assetid" VALUE="lCurrentHistory.name"/>
                    <HASH.ADD NAME="hIDType" KEY="theAssets.assetid" VALUE="theAssets.assettype"/>
                </LOOP>
            </THEN>
            </IF>
            <HASH.HASDATA NAME="hMergedListNames" VARNAME="hasit"/>
            <IF COND="Variables.hasit=true">
            <THEN>
                <HASH.TOSTRING NAME="hMergedListNames" VARNAME="cs_MergedList" DELIM=";"/>
                <STRING.SORT VALUE="Variables.cs_MergedList" VARNAME="cs_MergedList" DELIM=";"/>
                <STRINGLIST NAME="lMergedList" STR="Variables.cs_MergedList" DELIM=";"/>
                <LOOP LIST="lMergedList">
                    <IF COND="Variables.separatorLine=1">
                    <THEN>
                        <tr>
                        <!--<td colspan="Variables.colSpan" class="light-line-color" REPLACEALL="Variables.colSpan"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
                        </tr>
                    </THEN>
                    </IF>
                    <SETVAR NAME="separatorLine" VALUE="1"/>
                    <HASH.GET NAME="hMergedListIDs" VALUE="lMergedList.ITEM" VARNAME="ID"/>
                    <HASH.GET NAME="hIDType" VALUE="Variables.ID" VARNAME="AssetType"/>
                    <ASSETTYPE.LIST LIST="ThisType" FIELD1="assettype" VALUE1="Variables.AssetType"/>
                    <tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
                    <td><BR/></td><td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                        <DIV class="small-text-inset">		
                            <SUBSTITUTE STR="lMergedList.ITEM" WHAT="'" WITH="__TICK__" OUTSTR="fixedName"/>
                            <IF COND="Variables.style=single">
                            <THEN>
                                <A HREF="javascript: window.close();" ONCLICK="SetSelection(window.opener.document.forms[0].elements['Variables.field'],'Variables.fixedName',window.opener.document.forms[0].elements['Variables.idfield'],'Variables.ID');" REPLACEALL="Variables.field,Variables.fixedName,Variables.ID,Variables.idfield">
                                    <STRING.STREAM LIST="lMergedList" COLUMN="ITEM"/>
                                </A>
                            </THEN>
                            <ELSE>
                                <STRING.STREAM LIST="lMergedList" COLUMN="ITEM"/>
                            </ELSE>
                            </IF>
                        </DIV>
                        </td>
                        <td><BR/></td><td VALIGN="TOP" ALIGN="LEFT">
                            <DIV class="small-text-inset">
                                 <STRING.STREAM LIST="ThisType" COLUMN="description"/>
                            </DIV>
                            </td>
                        <td><BR/></td>
                        <IF COND="Variables.style!=single">
                        <THEN>
                            <td VALIGN="TOP" ALIGN="LEFT">
                                <DIV class="small-text-inset">
                                     <INPUT TYPE="CHECKBOX" NAME="ALSelections" VALUE="id=Variables.ID,assettype=Variables.AssetType" REPLACEALL="Variables.AssetType,Variables.ID"/>
                                </DIV>
                                </td><td><BR/></td>
                        </THEN>
                        </IF>
                    </tr>
                    <IF COND="Variables.rowStyle=tile-row-normal">
                    <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
                    </THEN>
                    <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
                    </ELSE>
                    </IF>
                </LOOP>
            </THEN>
            </IF>
      		
            <IF COND="Variables.hasit=false">
            <THEN>
                <tr class="tile-row-normal">
                    <td colspan="Variables.colSpan" REPLACEALL="Variables.colSpan">
                        <div style="padding : 4px">
                            <XLAT.STREAM KEY="dvin/UI/Noitemsinactivelistorhistory"/>
                        </div>
                    </td>
                </tr>
                <SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
            </THEN>
            </IF>        
<!-- Removed (none) for #14725
            <IF COND="Variables.style=single">
            <THEN>
                 <tr>
                    <td colspan="Variables.colSpan" class="light-line-color" REPLACEALL="Variables.colSpan"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
                 </tr>
                 <tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
                    <td><BR/></td><td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                        <DIV class="small-text-inset">
                            <A HREF="#" ONCLICK="SetSelection(window.opener.document.forms[0].elements['Variables.field'],'(none)',window.opener.document.forms[0].elements['Variables.idfield'],'');window.close();" REPLACEALL="Variables.field,currentAsset.name,Variables.ID,Variables.idfield">
                                <XLAT.STREAM KEY="dvin/Common/PnoneP"/>
                            </A>
                        </DIV>
                        </td>
                    <td><BR/></td><td VALIGN="TOP" ALIGN="LEFT">
                        <DIV class="small-text-inset">
                        </DIV>
                        </td>
                    <td><BR/></td>
                    
                        <td VALIGN="TOP" ALIGN="LEFT">
                            <DIV class="small-text-inset">
                            </DIV>
                            </td>
                        <td><BR/></td>
                 </tr>
            </THEN>
            </IF>	
  -->    				
      				
      	</table>
    </td>
		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
		</tr>
<tr>
<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
</tr>
<tr>
<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
</table>

<XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_" ESCAPE="true"/>
<A HREF="#" onclick="window.close();" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
<IF COND="Variables.style!=single">
<THEN>
	<STRING.ENCODE VARIABLE="ourPage" VARNAME="ourPage"/>
    <A HREF="javascript: window.close();" onclick="SetSelections('Variables.ourPage',window.opener.document.forms[0].elements['Variables.field']);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables.field,Variables.ourPage,Variables.idfield,Variables._XLAT_">
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Select"/></CALLELEMENT></A>
</THEN>
</IF>

</FTCS> 
