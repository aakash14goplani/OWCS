<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/ClearAssignmentFront.xml $ 
$Revision: 42 $ 
$Modtime: 4/27/04 3:12p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- ClearAssignmentFront.xml
-
- DESCRIPTION
-	Use to clear an assignment
-
- HISTORY 
-->


<setvar NAME="doproceed" VALUE="true"/>
<!--- Load script that defines function checkLength -->
<callelement NAME="OpenMarket/Xcelerate/Scripts/ValidateInput"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
<STRING.ENCODE VARIABLE="doproceed" VARNAME="doproceed"/>

<WorkflowAsset.Load ASSETTYPE="Variables.AssetType" ID="Variables.id" OBJVARNAME="workflowasset" />
<WorkflowAsset.GetObjectName OBJECT="workflowasset" VARNAME="objectname" />

<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="theAsset"/>
<ASSET.GET NAME="theAsset" FIELD="id" OUTPUT="id"/>
<ASSET.GET NAME="theAsset" FIELD="name" OUTPUT="assetname"/>

<if COND="Variables.doproceed=true">
<then>
     <!-- check to see if there is a current active assignment
	  for this user. If so, then proceed, else fail -->
     <WorkflowEngine.GetFilteredAssignments OBJECT="workflowasset" ASSIGNEDTO="SessionVariables.username" NOTSTATUS="notactive" PREFIX="assignment" EXCLUDECOMMENTS="true"/>
</then>
</if>

<if COND="Variables.assignmentTotal=0">
<then>
     <!-- no assignments to this user -->
     <setvar NAME="doproceed" VALUE="NeedsAssignment"/>
</then>
<else>
     <WorkflowAssignment.GetID NAME="assignment0" VARNAME="assignmentid"/>
	 <STRING.ENCODE VARIABLE="assignmentid" VARNAME="assignmentidEnc"/>
     <INPUT TYPE="HIDDEN" NAME="assignmentid" VALUE="Variables.assignmentidEnc" REPLACEALL="Variables.assignmentidEnc"/>
    </else>
</if>

<if COND="Variables.doproceed=true">
    <then>
        <!-- ask for a comment -->
        <TABLE>
        <TR>
           <TD>
              <!--Use description instead of name for assettype-->
              <ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType"/>
              <ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="ATdesc"/>
              <span class="title-text"><XLAT.STREAM KEY="dvin/UI/CancelMyAssignment"/></span> <span class="title-value-text"><STRING.STREAM VALUE=" Variables.ATdesc"/>: <STRING.STREAM VALUE="Variables.assetname"/></span>
          </TD>		
        </TR>
        <TR>
           <TD>
	       <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	   </TD>
	   <TD><TABLE>

               <TR>
                  <TD class="form-label-text" ALIGN="RIGHT">
                      <XLAT.STREAM KEY="dvin/Common/ActionTaken"/>:
                  </TD>
                  <TD class="form-inset" VALIGN="TOP">
                    <TEXTAREA NAME="clearcomment" ROWS="2" COLS="24" WRAP="VIRTUAL"
onChange="checkLength(this.form.elements['clearcomment'].value, 255, 'Action Taken');
setField(this.form.elements['clearcomment'].value, 255, 'clearcomment', this)"></TEXTAREA>
                  </TD>
               </TR>
               <TR>
                  <TD ALIGN="RIGHT" VALIGN="TOP">
                    <![CDATA[
                    <INPUT TYPE="CHECKBOX" NAME="donotify" CHECKED VALUE="on"/>
                    ]]>
                  </TD>
                  <TD>
                      <XLAT.STREAM KEY="dvin/UI/Notifyassignerofaction"/>
                  </TD>
               </TR>
	       <TR>
	          <TD class="form-label-text" ALIGN="RIGHT">
                      <XLAT.STREAM KEY="dvin/UI/Assignmentstatus"/>:
		  </TD>
		  <TD class="form-inset">
                     <WorkflowEngine.GetFilteredAssignments OBJECT="workflowasset" NOTASSIGNEDTO="SessionVariables.username" NOTSTATUS="notactive" PREFIX="assignedToOthers" EXCLUDECOMMENTS="true"/>
                     <if COND="Variables.assignedToOthersTotal=0">
		     <then>
		        <XLAT.STREAM KEY="dvin/UI/Assignedtoyoualone"/> 
			<BR/>
			<span class="alert-color">
			<XLAT.STREAM KEY="dvin/UI/Ifyouproceedterminatingworkflow"/>
			</span>
		     </then>
		     <else>
		        <XLAT.STREAM KEY="dvin/UI/Alsoassignedto"/> 
			<setvar NAME="comma" VALUE="Variables.empty"/>
			<setvar NAME="commalist" VALUE="Variables.empty"/>
			<setcounter NAME="count" VALUE="0"/>
			<loop FROM="0" COUNT="Variables.assignedToOthersTotal">
			    <WorkflowAssignment.GetAssignedUserID NAME="assignedToOthersCounters.count" VARNAME="userid" />
			    <UserManager.GetDisplayableUserName USER="Variables.userid" VARNAME="user_name" />
			    <setvar NAME="commalist" VALUE="Variables.commalistVariables.comma Variables.user_name"/>
			    <!--setvar NAME="commalist" VALUE="Variables.commalistVariables.comma Variables.userid"/-->
			    <setvar NAME="comma" VALUE=","/>
			</loop>
			<STRING.STREAM VALUE="Variables.commalist"/>
                     </else>
		     </if>
		  </TD>
	       </TR>
               </TABLE>
           </TD>
           <TD>
              <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
           </TD>
        </TR>
        <TR>
                    <INPUT type="hidden" name="serialClear" value="false"/>
					<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
                    <INPUT type="hidden" name="pagename" value="OpenMarket/Xcelerate/Actions/Variables.PostPage"  REPLACEALL="Variables.PostPage"/>
					<INPUT type="hidden" name="AssetType" VALUE="Variables.AssetType"  REPLACEALL="Variables.AssetType"/>
					<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
                    <INPUT type="hidden" name="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
 					
                    <TD ALIGN="RIGHT"> <XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_" ESCAPE="true"/>
                    <TD ALIGN="RIGHT"> <XLAT.LOOKUP KEY="dvin/UI/Admin/CancelClearAssignment" VARNAME="_ALT_"/>
                    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/StatusDetailsFront" outstring="urlstatusdetfront">
                        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                               <satellite.argument name="AssetType" value="Variables.AssetType"/>
                                                              <satellite.argument name="id" value="Variables.id"/>
                                                               </SATELLITE.LINK>
                    <A HREF="Variables.urlstatusdetfront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlstatusdetfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>  
                    <A HREF="javascript:void(0)" onclick="javascript:document.AppForm.submit();"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/ClearMyAssignment"/></CALLELEMENT></A>
                    </TD>
        </TR>
        </TABLE>
    </then>
    <else>
        <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
            <argument NAME="error" VALUE="Variables.doproceed"/>
        </callelement>

	<callelement NAME="OpenMarket/Xcelerate/Actions/StatusDetailsFront">
	    <argument NAME="AssetType" VALUE="Variables.AssetType"/>
	    <argument NAME="id"        VALUE="Variables.id"/>
	</callelement>
	<br/>       
    </else>
</if>

</FTCS>
