<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/RemoveFromWorkflowFront
-
- INPUT
-
- OUTPUT
-
-->
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType" />
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<WorkflowAsset.Load ASSETTYPE="Variables.AssetType" ID="Variables.id" OBJVARNAME="workflowasset" />

<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="theAsset"/>
<ASSET.GET NAME="theAsset" FIELD="id" OUTPUT="id"/>
<ASSET.GET NAME="theAsset" FIELD="name" OUTPUT="assetname"/>
<ASSET.GET NAME="theAsset" FIELD="description" OUTPUT="assetdesc" />
<ASSET.GETASSETTYPE NAME="theAsset" OUTNAME="type"/>
<ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="atDescription"/>

<setvar NAME="AbortFlag" VALUE="false"/>

<!-- if the asset is checked out by someone, abort -->
<callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
    <argument NAME="AssetType" VALUE="Variables.AssetType"/>
</callelement>
<if COND="Variables.trackingenabled=true">
<then>
    <history TABLE="Variables.AssetType" ASSET="Variables.id" LIST="ItsHistory"/>
    <if COND="ItsHistory.#numRows!=0">
    <then>
        <if COND="ItsHistory.lockedby!=Variables.empty">
        <then>
            <SETVAR NAME="AbortFlag" VALUE="true"/>
            <SETVAR NAME="ErrorName" VALUE="CantRemoveWorkflowLocked"/>
            <SETVAR NAME="lockedby" VALUE="ItsHistory.lockedby" />
            <SETVAR NAME="severity" VALUE="info"/>
        </then>
        </if>
    </then>
    </if>
</then>
</if>  


<if COND="Variables.AbortFlag!=true">
<then>
    <WorkflowEngine.isFunctionLegal OBJECT="workflowasset" FUNCTIONNAME="removefromworkflow" SITE="SessionVariables.pubid" VARNAME="isLegal" REASONVARNAME="denialreason" MUSTBEASSIGNED="false"/>
    <if COND="Variables.isLegal=false">
    <then>
         <setvar NAME="AbortFlag" VALUE="true"/>
         <setvar NAME="ErrorName" VALUE="IllegalTransition"/>
         <setvar NAME="severity" VALUE="info"/>
    </then>
    </if>
</then>
</if>

<if COND="Variables.AbortFlag!=true">
<then>
     <WorkflowEngine.GetObjectWorkflowProcess OBJECT="workflowasset" VARNAME="workflowid" />
     <if COND="IsVariable.workflowid!=true">
     <then>
          <SETVAR NAME="AbortFlag" VALUE="true"/>
          <SETVAR NAME="ErrorName" VALUE="AssetNotInWorkflow"/>
          <SETVAR NAME="severity" VALUE="info"/>
     </then>
     <else>
          <WorkflowEngine.GetProcessID ID="Variables.workflowid" OBJVARNAME="workflowobj" />
          <WorkflowProcess.GetProcessName NAME="workflowobj" VARNAME="workflowname" />
     </else>
     </if>
</then>
</if>

<if COND="Variables.AbortFlag!=true">
<then>
	<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
		<tr><td>
			<span class="title-text"><XLAT.STREAM KEY="dvin/UI/RemovefromWorkflowAssetTypeassetname"/></span>
		</td></tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>    
    <table class="width-outer-50" BORDER="0" CELLSPACING="0" CELLPADDING="0">
        <tr>
            <td class="form-label-text">
                <STRING.STREAM VALUE="Variables.atDescription "/> <XLAT.STREAM KEY="dvin/AT/Common/Name"/>:
            </td>
            <td class="form-inset">
                <STRING.STREAM VALUE="Variables.assetname" />
                <!-- Code for Alloy UI -->
               	<SETVAR NAME="assetName_for_AlloyUI" VALUE="Variables.assetname" />
                <!-- Code for Alloy UI -->
            </td>
        </tr>
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text">
                <XLAT.STREAM KEY="dvin/AT/Common/Description"/>:
            </td>
            <td class="form-inset">
	             <STRING.STREAM VALUE="Variables.assetdesc" />
	             <!-- Code for Alloy UI -->
	             <SETVAR NAME="assetDesc_for_AlloyUI" VALUE="Variables.assetdesc" />
	             <!-- Code for Alloy UI -->
            </td>
        </tr>
        
        <WorkflowEngine.GetFilteredAssignments OBJECT="workflowasset" STATUS="active,queued" PREFIX="allassigns" EXCLUDECOMMENTS="true"/>    
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text">
                <XLAT.STREAM KEY="dvin/Common/WorkflowProcess"/>:
            </td>
            <td class="form-inset">
                <WorkflowEngine.GetObjectWorkflowProcess OBJECT="workflowasset" VARNAME="workflowid" />
                <WorkflowEngine.GetProcessID ID="Variables.workflowid" OBJVARNAME="workflowobj" />
                <WorkflowProcess.GetProcessName NAME="workflowobj" VARNAME="workflowname" />
                <if COND="Variables.allassignsTotal!=0">
                <then>
                    <WorkflowAssignment.GetStateID NAME="allassigns0" VARNAME="workflow_stateid" />
                    <WorkflowEngine.GetStateID ID="Variables.workflow_stateid" OBJVARNAME="workflow_state" />
                    <WorkflowState.GetStateDescription NAME="workflow_state" VARNAME="statedesc" />
                    <STRING.STREAM VALUE="Variables.workflowname" /> - <STRING.STREAM VALUE="Variables.statedesc" />
                    <!-- Code for Alloy UI -->
              		<SETVAR NAME="workflowProcessName_for_AlloyUI" VALUE="Variables.workflowname" />
              		<SETVAR NAME="workflowStateDesc_for_AlloyUI" VALUE="Variables.statedesc" />
					<SETVAR NAME="workflowProcessID_for_AlloyUI" VALUE="Variables.workflowid" />
                    <!-- Code for Alloy UI -->
                </then>
                <else>
                    <STRING.STREAM VALUE="Variables.workflowname" />
					<!-- Code for Alloy UI -->
               		<SETVAR NAME="workflowProcessName_for_AlloyUI" VALUE="Variables.workflowname" />
               		<SETVAR NAME="workflowStateDesc_for_AlloyUI" VALUE="" />
                    <!-- Code for Alloy UI -->
                </else>
                </if>       
            </td>
        </tr>
        
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text">
                <XLAT.STREAM KEY="dvin/UI/CurrentlyAssignedto"/>:
            </td>
            <td class="form-inset">
				<!-- Code for Alloy UI, create a list for storing the rolename, username pairs, accessed by JSP page -->
	          	<LISTOBJECT.CREATE NAME="list_of_roles_and_user_pairs" COLUMNS="roleName,userName" />
				<!-- Code for Alloy UI -->

                <if COND="Variables.allassignsTotal!=0">
                <then>
                    
                    <table BORDER="0" CELLSPACING="0" CELLPADDING="0">
                    <tr>
                        <td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
                    </tr>
                    <tr>
                        <td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
                        <td >
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="6" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
                        <tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
                            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Role"/></DIV></td>
                            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/User"/></DIV></td>
                            <td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
                        </tr>
                        <tr><td colspan="6" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
                            <setvar NAME="rowStyle" VALUE="tile-row-normal"/>
                            <SETVAR NAME="separatorLine" VALUE="0"/>
                            
                            <setcounter NAME="count" VALUE="0"/>
                            <loop FROM="0" COUNT="Variables.allassignsTotal">
                                <WorkflowAssignment.GetAssignedUserID NAME="allassignsCounters.count" VARNAME="userid" />
                               <IF COND="IsVariable.userid=true">
                                	<THEN>
	                                <USERMANAGER.GETDISPLAYABLEUSERNAME USER="Variables.userid" VARNAME="username"/>
     	                           <WorkflowAssignment.GetAssignedUserRole NAME="allassignsCounters.count" VARNAME="rolename"/>
                           		</THEN>
                        		</IF>
                            
                                <IF COND="Variables.separatorLine=1">
                                <THEN>
                                    <tr>
                                        <!--<td colspan="6" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
                                    </tr>
                                </THEN>
                                </IF>
                                <SETVAR NAME="separatorLine" VALUE="1"/>
                                <tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
                                <td><BR /></td><td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                                    <DIV class="small-text-inset">
                                    <!-- no rolename for assignto Everybody assignment -->
                                    
                                    <!--Code for AlloyUI, clear the temp variables -->
	                                    <SETVAR NAME="tempRoleName_for_AlloyUI" VALUE="" />
	                                    <SETVAR NAME="tempUserName_for_AlloyUI" VALUE="" />
	                               <!--Code for AlloyUI -->
                                    
                                    <if COND="IsVariable.rolename=true">
                                    <then>
                                        <STRING.STREAM VALUE="Variables.rolename"/>
                                        <!--Code for AlloyUI -->
                                        	<SETVAR NAME="tempRoleName_for_AlloyUI" VALUE="Variables.rolename" />
                                        <!--Code for AlloyUI -->
                                    </then>
                                    </if>
                                    </DIV>
                                </td>
                                <td><BR /></td><td VALIGN="TOP" ALIGN="LEFT">
                                    <DIV class="small-text-inset">
                                    <if COND="IsVariable.username=true">
                                    <then>
                                        <STRING.STREAM VALUE="Variables.username"/>
								<!--Code for AlloyUI -->
                                        	<SETVAR NAME="tempUserName_for_AlloyUI" VALUE="Variables.username" />
                                        <!--Code for AlloyUI -->

                                    </then>
                                    <else>
                                        (<XLAT.STREAM KEY="dvin/Common/nobody"/>)
								<!--Code for AlloyUI -->
									<XLAT.LOOKUP KEY="dvin/Common/nobody" VARNAME="noUserName"/>
                                        	<SETVAR NAME="tempUserName_for_AlloyUI" VALUE="Variables.noUserName" />
                                        <!--Code for AlloyUI -->

                                    </else>
                                    </if>
                                    </DIV>
                                </td>
                                <td><BR /></td>
                                </tr>
                                <IF COND="Variables.rowStyle=tile-row-normal">
                                <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
                                </THEN>
                                <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
                                </ELSE>
                                </IF>
                                <inccounter NAME="count" VALUE="1"/>
                                <!-- Code for Alloy UI -->
                                	<LISTOBJECT.ADDROW NAME="list_of_roles_and_user_pairs" roleName="Variables.tempRoleName_for_AlloyUI" userName="Variables.tempUserName_for_AlloyUI" />
                                <!-- Code for Alloy UI -->
                            </loop>
                        </table>
                        </td>
                        <td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
                    </tr>
                    <tr>
                    <td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
                    </tr>
                    <tr>
                    <td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
                    </tr>
                    </table> 
                
                </then>
                <else>
                    <XLAT.STREAM KEY="dvin/UI/Noassignments"/>
                    <!-- Code for Alloy UI -->
                    	<SETVAR NAME="noAssignmentsForAsset" VALUE="true" />
                    <!-- Code for Alloy UI -->
                </else>
                </if>               
            </td>
        </tr> 
        
        <!-- Code for Alloy UI-->
        		<LISTOBJECT.TOLIST NAME="list_of_roles_and_user_pairs" LISTVARNAME="userRolePairList" />
        <!-- Code for Alloy UI-->
			<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
			<INPUT type="hidden" name="pagename" value="OpenMarket/Xcelerate/Actions/Variables.PostPage" REPLACEALL="Variables.PostPage"/>
			<INPUT type="hidden" name="AssetType" VALUE="Variables.AssetType" REPLACEALL="Variables.AssetType"/>
			<INPUT type="hidden" name="id" VALUE="Variables.id"  REPLACEALL="Variables.id"/>
			<INPUT type="hidden" name="workflowid" VALUE="Variables.workflowid"  REPLACEALL="Variables.workflowid"/>
			<XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_"/>
			<XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="mouseover" ESCAPE="true"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/StatusDetailsFront" outstring="urlstatusdetfront">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
			   <satellite.argument name="AssetType" value="Variables.AssetType"/>
			  <satellite.argument name="id" value="Variables.id"/>
			   </SATELLITE.LINK>	
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	 <tr><td></td><td>
    <A HREF="Variables.urlstatusdetfront" onmouseover="window.status='Variables.mouseover';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlstatusdetfront,Variables.mouseover"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>   
    
    <XLAT.LOOKUP KEY="dvin/UI/RemoveFromWorkflow" VARNAME="_XLAT_"/>
    <A HREF="javascript:void(0)" onclick="javascript:document.AppForm.submit();"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/RemoveFromWorkflow"/></CALLELEMENT></A>
    </td></tr>
    </table>

	</then>
<else>
	<div class="width-outer-70">
     <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
       	<argument NAME="elem" VALUE="Variables.ErrorName"/>
       	<argument NAME="severity" VALUE="Variables.severity"/>
     </callelement>
	</div> 
     <callelement NAME="OpenMarket/Xcelerate/Actions/StatusDetailsFront">
    	 <argument NAME="AssetType" VALUE="Variables.AssetType"/>
    	 <argument NAME="id"        VALUE="Variables.id"/>
     </callelement>
</else>
</if>

</FTCS> 
