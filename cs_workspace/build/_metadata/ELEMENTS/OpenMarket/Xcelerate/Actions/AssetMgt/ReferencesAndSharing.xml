<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/AssetMgt/ReferencesAndSharing.xml $
$Revision: 10 $
$Modtime: 2/16/04 9:23a $
-->
<!-- OpenMarket/Xcelerate/Actions/AssetMgt/ReferencesAndSharing
-
- INPUT
-    AssetType - asset type of current asset
-    id - id of current asset
-    revisionInspect - (optional) if true, this is Inspect of a previous revision and we do not display asset relations
-    AssetTypeObj:description - description of current asset type to be displayed as part of a locale string
-    ContentDetails:name - name of current asset to be displayed as part of locale string
- OUTPUT
-
-->
<!--
 [2007-10-09 KG] XSS fixes:
 * Replaced CSVARs with STRING.STREAM
-->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>
<ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType"/>
<ASSETTYPE.SCATTER NAME="type" PREFIX="AssetTypeObj"/>

<if COND="IsVariable.revisionInspect=false">
<then>
    <ASSET.LOAD NAME="theCurrentAsset" OBJECTID="Variables.id" TYPE="Variables.AssetType"/>
    <ASSET.REFERENCEDBY  NAME="theCurrentAsset" LIST="ParentList"/>

		<IF COND="IsList.ParentList=true">
		<THEN>
			<IF COND="ParentList.#numRows!=0">
			<THEN>
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>	
				<tr>
					<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/ReferencedBy"/>:</td>
					<td></td>
					<td class="form-inset">
				<SETVAR NAME="ShowLabel" VALUE="true"/>
				<table border="0" cellpadding="0" cellspacing="0">
				<TR>
					<TD COLSPAN="3">
					<XLAT.STREAM KEY="dvin/UI/AssetMgt/AssetTypeObjContentDetailsreferencedby"/>:<BR/>
					</TD>
				</TR>
				<tr>
					<td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
				</tr>
				<tr> 
				<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
				<td>
				<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
				<tr>
					<td colspan="7" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
				</tr>
				<LOOP LIST="ParentList">
					<ASSET.LOAD NAME="anAsset" TYPE="ParentList.otype" OBJECTID="ParentList.oid"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<ASSET.GET NAME="anAsset" FIELD="name"/>
						<ASSET.GET NAME="anAsset" FIELD="description"/>
			         	<ASSETTYPE.LOAD NAME="type" TYPE="ParentList.otype"/>
	        		   	<ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="parenttypedesc"/>
	
						<IF COND="Variables.ShowLabel=true">
						<THEN>							
							<tr>
								<td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/AT/Common/Name"/></DIV></td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/AT/Common/Description"/></DIV></td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Type"/></DIV></td>
								<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
							</tr>
							<SETVAR NAME="ShowLabel" VALUE="false"/>
						</THEN>
						</IF>
						<TR>
							<TD>&nbsp;</TD>
							<TD NOWRAP="NOWRAP" VALIGN="TOP">
			    			<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="_XLAT_" ESCAPE="true"/>
							<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
								<ARGUMENT NAME="assettype" VALUE="ParentList.otype"/>
								<ARGUMENT NAME="assetid" VALUE="ParentList.oid"/>
								<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
								<ARGUMENT NAME="function" VALUE="inspect"/>
							</CALLELEMENT>
							<A HREF="Variables.urlInspectItem" REPLACEALL="Variables.urlInspectItem,Variables._XLAT_" TITLE="Variables._XLAT_">
								<STRING.STREAM VARIABLE="name"/>
							</A>
							<BR/>
							</TD>
							<TD>&nbsp;</TD>
							<TD VALIGN="TOP"><STRING.STREAM VARIABLE="description"/></TD>
							<TD>&nbsp;</TD><TD VALIGN="TOP"><STRING.STREAM VARIABLE="parenttypedesc"/></TD><TD>&nbsp;</TD>
						</TR>
						<tr>
							<td colspan="7"><img src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" width="1" height="5" border="0" REPLACEALL="Variables.cs_imagedir"/></td>
						</tr>
					</then>
					</if>
				</LOOP> <!-- end LOOP ParentList -->
					<tr>
						<td colspan="7"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
					</tr>
				</table>
				</td>
				<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
				</tr>
				<tr>
					<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
				</tr>
				</table>
			</td>
			</tr>
			</THEN>
			<ELSE>
					
				<tr>
					<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/ReferencedBy"/>:</td>
					<td></td>
					<td class="form-inset"><span class="disabledText"><XLAT.STREAM KEY="UI/Forms/NotAvailable"/></span></td>
			</tr>
			</ELSE>
			</IF>
		</THEN>
	</IF>

	<!-- The beginning of Group 7 -->
	<setvar NAME="showshares" VALUE="false"/>
	<ASSET.SITES NAME="theCurrentAsset" LIST="currentPubs"/>
	<if COND="IsError.Variables.errno=false">
	<then>
		<!-- show the shares, if the asset is shared to more than 1 site or shared to 'Any'-->
		<IF COND="currentPubs.#numRows!=1">
		<THEN>
			<setvar NAME="showshares" VALUE="true"/>
		</THEN>
		<ELSE>
			<if COND="currentPubs.id=0">
			<then>
				<setvar NAME="showshares" VALUE="true"/>
			</then>
			</if>
		</ELSE>
		</IF>
	</then>
	</if>
	
	<IF COND="Variables.showshares=true">
	<THEN>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>	
		<tr>
			<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/SiteSharing"/>:</td>
			<td></td>
			<td class="form-inset" nowrap="nowrap">
				<XLAT.STREAM KEY="dvin/UI/AssetMgt/AssetTypeObjContentDetailssharedsites"/>:<BR/>
				<table>
				<LOOP LIST="currentPubs">
					<tr><td><STRING.STREAM VALUE="currentPubs.name"/></td><!-- <td><STRING.STREAM VALUE="currentPubs.description"/></td> --></tr>
				</LOOP>
				</table>
			</td>
		</tr>
	</THEN>
	</IF>
</then>
<else>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/ReferencedBy"/>:</td>
	<td></td>
	<td class="form-inset"><span class="disabledText"><XLAT.STREAM KEY="UI/Forms/NotAvailable"/></span></td>
</tr>
</else>
</if>
</FTCS>
