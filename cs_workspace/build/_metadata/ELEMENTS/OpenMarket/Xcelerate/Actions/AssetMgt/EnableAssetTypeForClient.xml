<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/AssetMgt/EnableAssetTypeForClient.xml $
$Revision: 13 $
$Modtime: 10/13/03 10:25a $
-->

<!--
- Confidential and Proprietary Information of Open Market, Inc.
-					All Rights Reserved.
-
- DESCRIPTION
-   Gets list of enabled/disabled assettypes for a given site and 
-   client app.  Also enable or disable a specific assettype
-
-   Inputs:
-     upcommand:    ListEnabledAssetTypes,ListDisabledAssetTypes,
-			  EnableAssetType,DisableAssetType
-     clientapp:    name of the clientapplication, eg., MSWord (CSDesktop)
-	pubid:        pubid of the publication
-	list:           name of the output list
- 	assetType  asset-type
-    Outputs:
-     list:   
-->

<!-- List all enabled assets -->

<IF COND="Variables.upcommand=ListEnabledAssetTypes">
<THEN>
	<setvar NAME="errno"  VALUE="0"/>
	<EXTERNALCLIENTSMANAGER.GetEnabledAssetTypesForAClient SITE="Variables.pubid" LISTVARNAME="Variables.list" CLIENTAPP="Variables.clientapp"/>
</THEN>
</IF>

<!-- List all disabled assets -->

<IF COND="Variables.upcommand=ListDisabledAssetTypes">
<THEN>
	<setvar NAME="errno"  VALUE="0"/>
	<EXTERNALCLIENTSMANAGER.GetDisabledAssetTypesForAClient SITE="Variables.pubid" LISTVARNAME="Variables.list" CLIENTAPP="Variables.clientapp"/>
</THEN>
</IF>

<!-- Enable a specific assettype  -->

<IF COND="Variables.upcommand=EnableAssetType">
<THEN>
	<EXTERNALCLIENTSMANAGER.CREATE OBJVARNAME="newRec" />
	<EXTERNALCLIENTSITEM.SETASSETTYPE NAME="newRec" VALUE="Variables.assetType"/>
	<EXTERNALCLIENTSITEM.SETCLIENTAPP NAME="newRec" VALUE="Variables.clientapp"/>
	<EXTERNALCLIENTSITEM.SETPUBID NAME="newRec" VALUE="Variables.pubid"/>
	<setvar NAME="errno"  VALUE="0"/>
	<EXTERNALCLIENTSMANAGER.SAVE OBJECT="newRec" />	
	<IF COND="IsError.Variables.errno=true">
	<THEN>
		<XLAT.STREAM KEY="dvin/UI/Error/savingdataerrno" errno="Variables.errno" EVALALL="false"/>
		<THROWEXCEPTION/>
	</THEN>
	</IF>
	<!-- setup default values for all attributes of all subtypes of this assettype for Word -->
      
	<EXTERNALCLIENTSMANAGER.LOADFROMFIELDS OBJVARNAME="aRec" ASSETTYPE="Variables.assetType" SITE="Variables.pubid" CLIENTAPP="Variables.clientapp"/>
	<EXTERNALCLIENTSITEM.GETID NAME="aRec" VARNAME="aRecId" />
	<setvar NAME="errno"  VALUE="0"/>			
	<ASSET.GETLEGALSUBTYPES TYPE="Variables.assetType" LIST="subList" PUBID="Variables.pubid"/>
	
	<IF COND="IsList.subList=true">
	<THEN>
		<SETVAR NAME="errno" VALUE="0"/>
		<IF COND="subList.#numrows!=0">
		<THEN>
		<LOOP LIST="subList">
			<IF COND="subList.subtype!=Variables.empty">
			<THEN>
				
				<SETVAR NAME="errno" VALUE="0"/>
				<SETVAR NAME="assettype" VALUE="Variables.assetType"/>
				<SELECTTO LIST="AD" FROM="AssetType" WHAT="*" WHERE="assettype"/>
				<IF COND="AD.urldescriptor!=Variables.empty">
				<THEN>
					<!-- call this class so that subsequent ASSET.DEF will work correctly -->	
					<CALLJAVA CLASS="com.openmarket.assetmaker.asset.AssetMaker">
    					<ARGUMENT NAME="command" VALUE="parseproperties"/>
    					<ARGUMENT NAME="propertytags" VALUE="storage, inputform"/>
    					<ARGUMENT NAME="assettype" VALUE="Variables.assetType"/>
					</CALLJAVA>
				</THEN>
				</IF>
				<ASSET.DEF TYPE="Variables.assetType" LIST="aTypeDef" SUBTYPE="subList.subtype" PUBID="Variables.pubid"/>
				<IF COND="IsList.aTypeDef=true">
				<THEN>
					<IF COND="aTypeDef.#numrows!=0">
					<THEN>
						<LOOP LIST="aTypeDef">
							<IF COND="aTypeDef.editable=true">
							<THEN>
								<IF COND="aTypeDef.required=true">
								<THEN>
									<SETVAR NAME="enabledVal" VALUE="true"/>
								</THEN>
								<ELSE>
									<SETVAR NAME="enabledVal" VALUE="false"/>
								</ELSE>
								</IF>
                        <IF COND="Variables.clientapp=CSDocLink">
                        <THEN>
                           <EXTERNALCLIENTSCONFIGMANAGER.CREATE OBJVARNAME="aRec" />
   								<EXTERNALCLIENTSCONFIGITEM.SETCLIENTID NAME="aRec" VALUE="Variables.aRecId"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETSUBTYPE NAME="aRec" VALUE="subList.subtype"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETACTION NAME="aRec" VALUE="enable"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETVALUE NAME="aRec" VALUE="false"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETPROPERTY NAME="aRec" VALUE="aTypeDef.name"/>
   								<EXTERNALCLIENTSCONFIGMANAGER.SAVE OBJECT="aRec"/>
   	
   								<EXTERNALCLIENTSCONFIGMANAGER.CREATE OBJVARNAME="aRec1" />
   								<EXTERNALCLIENTSCONFIGITEM.SETCLIENTID NAME="aRec1" VALUE="Variables.aRecId"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETSUBTYPE NAME="aRec1" VALUE="subList.subtype"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETACTION NAME="aRec1" VALUE="acceptdocs"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETVALUE NAME="aRec1" VALUE="No"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETPROPERTY NAME="aRec1" VALUE="aTypeDef.name"/>
   								<EXTERNALCLIENTSCONFIGMANAGER.SAVE OBJECT="aRec1"/>				
                           
                           <EXTERNALCLIENTSCONFIGMANAGER.CREATE OBJVARNAME="aRec2" />
   								<EXTERNALCLIENTSCONFIGITEM.SETCLIENTID NAME="aRec2" VALUE="Variables.aRecId"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETSUBTYPE NAME="aRec2" VALUE="subList.subtype"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETACTION NAME="aRec2" VALUE="maxfilesize"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETVALUE NAME="aRec2" VALUE="No"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETPROPERTY NAME="aRec2" VALUE="aTypeDef.name"/>
   								<EXTERNALCLIENTSCONFIGMANAGER.SAVE OBJECT="aRec2"/>				
                        </THEN>
                        <ELSE>
                           <EXTERNALCLIENTSCONFIGMANAGER.CREATE OBJVARNAME="aRec" />
   								<EXTERNALCLIENTSCONFIGITEM.SETCLIENTID NAME="aRec" VALUE="Variables.aRecId"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETSUBTYPE NAME="aRec" VALUE="subList.subtype"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETACTION NAME="aRec" VALUE="enable"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETVALUE NAME="aRec" VALUE="Variables.enabledVal"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETPROPERTY NAME="aRec" VALUE="aTypeDef.name"/>
   								<EXTERNALCLIENTSCONFIGMANAGER.SAVE OBJECT="aRec"/>
   	
   								<EXTERNALCLIENTSCONFIGMANAGER.CREATE OBJVARNAME="aRec1" />
   								<EXTERNALCLIENTSCONFIGITEM.SETCLIENTID NAME="aRec1" VALUE="Variables.aRecId"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETSUBTYPE NAME="aRec1" VALUE="subList.subtype"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETACTION NAME="aRec1" VALUE="preserveformat"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETVALUE NAME="aRec1" VALUE="false"/>
   								<EXTERNALCLIENTSCONFIGITEM.SETPROPERTY NAME="aRec1" VALUE="aTypeDef.name"/>
   								<EXTERNALCLIENTSCONFIGMANAGER.SAVE OBJECT="aRec1"/>				
                        </ELSE>
                        </IF>
							</THEN>
							</IF>
						</LOOP>
					</THEN>
					</IF>
				</THEN>
				</IF>
			</THEN>
			</IF>
		</LOOP>
		</THEN>
		</IF>
	</THEN>
	</IF>

</THEN>
</IF>

<!-- Disable a specific assettype  -->
<IF COND="Variables.upcommand=DisableAssetType">
<THEN>
	<EXTERNALCLIENTSMANAGER.LOADFROMFIELDS OBJVARNAME="aRec" ASSETTYPE="Variables.assetType" SITE="Variables.pubid" CLIENTAPP="Variables.clientapp"/>
	<EXTERNALCLIENTSITEM.GETID NAME="aRec" VARNAME="aRecId" />
	<setvar NAME="errno"  VALUE="0"/>
	<EXTERNALCLIENTSMANAGER.DELETE ID="Variables.aRecId"/>
</THEN>
</IF>

</FTCS>
