<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/RollbackFront.xml $ 
$Revision: 42 $ 
$Modtime: 9/02/04 2:55p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- RollbackFront.xml
-
- DESCRIPTION
-	Use to Rollback a record to a previous version
-
- HISTORY 
-->

<STRING.ENCODE VARIABLE="doproceed" VARNAME="doproceed" />
<if COND="Variables.doproceed=true">
<then>
	<!-- Check if the item is checked out. If not, check it out -->
      <history TABLE="Variables.AssetType" ASSET="Variables.id" LIST="ItsHistory"/>
	  <if COND="ItsHistory.#numRows!=0">
      <then>
			<SETVAR NAME="currentVersionNum" VALUE="ItsHistory.#numRows"/>
	  </then>
	  <else>
			<SETVAR NAME="currentVersionNum" VALUE="0"/>
	  </else>
	  </if>
           <!-- this is when we can roll it back! -->
           <!-- tile the versions that are available -->
		<TABLE CELLSPACING="0" CELLPADDING="0" BORDER="0" class="width-outer-70">
		<TR>
				<TD>         
                    <ASSET.GETASSETTYPE NAME="Variables.assetname" OUTNAME="atype"/>
                    <ASSETTYPE.GET NAME="atype" FIELD="description" OUTPUT="ATdesc"/>
					<span class="title-text"><XLAT.STREAM KEY="dvin/Common/Rollback"/> </span> &nbsp;<span class="title-value-text"><STRING.STREAM VALUE="Variables.ATdesc"/>: <STRING.STREAM VALUE="Variables.tempassetname"/></span>
				</TD>
		</TR>
		
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
		<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
		<TR>
			<TD>
			<TABLE class="width-inner-100">
			<TR><TD>
               <callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/ShowTrackedHistory">
                  <argument NAME="dorollback" VALUE="true"/>
              </callelement>
			</TD></TR>	
		    </TABLE>
		</TD></TR>
	     <TR>
	       <TD>
	               <XLAT.STREAM KEY="dvin/UI/Selectversionrollbackclick"/>
				<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
	            <INPUT TYPE="hidden" NAME="pagename" VALUE="OpenMarket/Xcelerate/Actions/Variables.PostPage" REPLACEALL="Variables.PostPage"/>
				<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
	            <INPUT TYPE="hidden" NAME="AssetType" VALUE="Variables.AssetType" REPLACEALL="Variables.AssetType"/>
				<STRING.ENCODE VARIABLE="alreadylocked" VARNAME="alreadylocked"/>
	            <INPUT TYPE="hidden" NAME="alreadylocked" VALUE="Variables.alreadylocked" REPLACEALL="Variables.alreadylocked"/>
				<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
				<INPUT TYPE="hidden" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
	       </TD>
	         </TR>
			        	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
				<TR>
					<TD ALIGN="RIGHT"> <XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/Common/Rollback" VARNAME="_xlat_function"/>
                      <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ContentDetailsFront" outstring="urlcontdetfront">
                          <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                               <satellite.argument name="AssetType" value="Variables.AssetType"/>
                                                              <satellite.argument name="id" value="Variables.id"/>
                                                               </SATELLITE.LINK>
					<IF COND="Variables.cs_environment=ucform">
					<THEN>
						<A HREF="javascript:void(0)" onclick="javascript:parent.SitesApp.event('active' , 'goback');" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlcontdetfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					</THEN>
					<ELSE>
						<A HREF="Variables.urlcontdetfront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlcontdetfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					</ELSE>
					</IF>                     
					 <A HREF="javascript:void(0)" onclick="javascript:if(checkforRevision()) document.AppForm.submit();"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Rollback"/></CALLELEMENT></A>
					 </TD>
				</TR>				
	      </TABLE>    
    </then>
    <else>
        <!-- Cannot rollback -->
       <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<argument NAME="elem" VALUE="Variables.doproceed"/>
			<argument NAME="severity" VALUE="error"/>
		</callelement>
		<if COND="Variables.errdetail!=0">
       <then>
	        <CALLELEMENT NAME="FutureTense/Apps/AdminForms/RevisionMgt/errors"/>
  		</then>
  		</if>           
		<callelement NAME="OpenMarket/Xcelerate/Actions/StatusDetailsFront">
			<argument NAME="AssetType" VALUE="Variables.AssetType"/>
			<argument NAME="id"        VALUE="Variables.id"/>
		</callelement>
    </else>
</if>
<REPLACEALL LIST="Variables.currentVersionNum">
<SCRIPT LANGUAGE="Javascript">
<![CDATA[    
function checkforRevision()
{    
	var obj = document.forms[0],
		versionNumberElem = dojo.query('input[name=rollbackversion]'),
		curVerNum = 'Variables.currentVersionNum'
		versionSelected = false;
	for(var i = 0; i < versionNumberElem.length ; i++)
	{
		if (versionNumberElem[i].checked && versionNumberElem[i].value == curVerNum) {
			alert(']]><XLAT.STREAM KEY="dvin/UI/RevisionTracking/CannotRollbackToCurrentVersion" ENCODE="false" ESCAPE="true"/><![CDATA[');
			return false;
		}	
		if(versionNumberElem[i].checked)
		{
			versionSelected = true;
			break;
		}
	}
	if(!versionSelected)
	{
		alert(']]><XLAT.STREAM KEY="dvin/UI/Selectversionrollbackclick" ENCODE="false" ESCAPE="true"/><![CDATA[');
		return false;
	}
	return true;
}
]]>
</SCRIPT>
</REPLACEALL>
<REMOVEVAR NAME="currentVersionNum"/>
</FTCS>
