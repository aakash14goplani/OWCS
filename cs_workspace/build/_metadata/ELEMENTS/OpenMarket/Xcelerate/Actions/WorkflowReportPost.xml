<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/WorkflowReportPost.xml $ 
$Revision: 28 $ 
$Modtime: 7/31/04 6:25p $ 
-->
<!-- OpenMarket/Xcelerate/Actions/WorkflowReportPost
-
- INPUT
-
- OUTPUT		
-
-->
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/> 
<STRING.ENCODE VARIABLE="postpage" VARNAME="postpage"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/> 
<STRING.ENCODE VARIABLE="ThisPage" VARNAME="ThisPage"/> 
<STRING.ENCODE VARIABLE="suser" VARNAME="suser"/> 

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/WorkflowReportFront" outstring="WFReportURL">
    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
</SATELLITE.LINK>

<IF COND="IsVariable.suser!=true">
<THEN>

   <USERMANAGER.GETLOGINUSER  VARNAME="cuserid"/>
   <USERMANAGER.GETLOGINUSERNAME  VARNAME="LoginuserName"/>
   <setvar NAME="suser"  VALUE="Variables.LoginuserName"/>
   
</THEN>								
</IF>
 
<input type="hidden" name="pagename"  value=""/>
<table class="width-outer-70" border="0" cellpadding="0" cellspacing="0">
   <IF COND="IsVariable.SaveSearchErrno=true">
    <THEN>
          <tr>
                 <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
        			<argument NAME="elem" VALUE="SavewfReport"/>
        			<argument NAME="severity" VALUE="error"/>
        			<argument NAME="AssetType" VALUE="Variables.AssetType"/>
        		</callelement>

          </tr>
   </THEN>
   </IF>

	<tr>
		<td class="title-text"><XLAT.STREAM KEY="dvin/UI/ResultsofWorkflowReport"/></td>
	</tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	<tr>
		<td><a href="Variables.WFReportURL" REPLACEALL="Variables.WFReportURL"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/CreateaNewWorkflowReport"/></a></td>
	</tr>
	<tr>
		<td><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	</tr>		
	<tr>
		<td valign="top" class="light-text-color" colspan="3"><IF COND="IsVariable.filterstring=true"><THEN><STRING.STREAM VALUE="Variables.filterstring"/></THEN></IF>
 				 <img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/> 
				 <SETVAR NAME="CanEditOrDelete" VALUE="false"/>
				 <PROPERTY.GET PARAM="xcelelem.manageuserpub" INIFILE="futuretense_xcel.ini" VARNAME="propmanageuserpub"/>
				 <CALLELEMENT NAME="Variables.propmanageuserpub">
					 <ARGUMENT NAME="upcommand" VALUE="IsSystemAdmin"/>
					 <ARGUMENT NAME="username"  VALUE="SessionVariables.username"/>
				 </CALLELEMENT>
				 <IF COND="Variables.IsSystemAdmin=true">
					 <THEN>
						 <SETVAR NAME="CanEditOrDelete" VALUE="true"/>
					 </THEN>
					 <ELSE>
						 <USERMANAGER.GETLOGINUSERNAME  VARNAME="LocalLoginName"/>
						 <IF COND="Variables.LocalLoginName=Variables.suser">
							 <THEN>
								 <SETVAR NAME="CanEditOrDelete" VALUE="true"/>
							 </THEN>
						 </IF>
					 </ELSE>
				 </IF>
				 <IF COND="Variables.CanEditOrDelete=true">
					 <THEN>
                  <XLAT.LOOKUP KEY="dvin/UI/EditThisWorkflowReport" VARNAME="_XLAT_"/>
                  <XLAT.LOOKUP KEY="dvin/UI/EditThisWorkflowReport" VARNAME="mouseover" ESCAPE="true"/>
                  (<A HREF="javascript:editthiswf('Variables.suser', 'Variables.ThisPage')" OnMouseOver="window.status='Variables.mouseover'; return true" OnMouseOut="return window.status='';" title="Variables._XLAT_" REPLACEALL="Variables.ThisPage, Variables.suser,Variables._XLAT_,Variables.mouseover"><XLAT.STREAM KEY="dvin/UI/EditThisWorkflowReport"/></A>)
					 </THEN>
				 </IF>
        </td>

   	</tr>
</table>

<table class="width-outer-70" border="0" cellpadding="0" cellspacing="0">
<tr>
	<td>
		<IF COND="Variables.CanEditOrDelete=true">
			<THEN>
				<XLAT.LOOKUP KEY="dvin/UI/SaveThisWorkflowReport" VARNAME="_XLAT_"/>
				<XLAT.LOOKUP KEY="dvin/UI/SaveThisWorkflowReport" VARNAME="mouseover" ESCAPE="true"/>
				(<A HREF="javascript:savethiswf('Variables.suser');" OnMouseOver="window.status='Variables.mouseover'; return true" OnMouseOut="return window.status='';" title="Variables._XLAT_" REPLACEALL="Variables.suser,Variables._XLAT_,Variables.mouseover"><XLAT.STREAM KEY="dvin/UI/SaveThisWorkflowReport"/></A>)
			</THEN>
		</IF>
 		<SETVAR NAME="isactive" VALUE="y"/>

		<IF COND="Variables.report_assignto=user">
		<THEN>
			<STRINGLIST NAME="userList" STR="Variables.users" DELIM=";"/>
		</THEN>
		</IF>
        
		<SETVAR NAME="tablename" VALUE="Assignment"/>
        <IF COND="Variables.processDueMinutes!=Variables.empty">
        <THEN>
            <SETVAR name="doProcessOverdue" VALUE="Variables.empty"/>
        </THEN>
        </IF>
		<IF COND="Variables.report_assignto=user">
		<THEN>
			<IF COND="Variables.report_state=some">
			<THEN>
                <if COND="Variables.DueMinutes=Variables.empty">
                <then>
				    <WorkflowEngine.GetFilteredAssignments OVERDUE="Variables.doOverdue" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.wfstateList" SITE="SessionVariables.pubid" ASSIGNEDTO="userList" PREFIX="allAssignments:"/>
                </then>
                <else>
                    <WorkflowEngine.GetFilteredAssignments OVERDUEMINS="Variables.DueMinutes" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.wfstateList" SITE="SessionVariables.pubid" ASSIGNEDTO="userList" PREFIX="allAssignments:"/>
                </else>
                </if>    
			</THEN>
			<ELSE>
                <if COND="Variables.DueMinutes=Variables.empty">
                <then>
				    <WorkflowEngine.GetFilteredAssignments OVERDUE="Variables.doOverdue" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  SITE="SessionVariables.pubid" ASSIGNEDTO="userList" PREFIX="allAssignments:"/>
                </then>
                <else>
				    <WorkflowEngine.GetFilteredAssignments OVERDUEMINS="Variables.DueMinutes" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  SITE="SessionVariables.pubid" ASSIGNEDTO="userList" PREFIX="allAssignments:"/>
                </else>
                </if>                     
			</ELSE>
			</IF>
		</THEN>
		<ELSE>
			<IF COND="Variables.report_state=some">
			<THEN>
                <if COND="Variables.DueMinutes=Variables.empty">
                <then>
				    <WorkflowEngine.GetFilteredAssignments OVERDUE="Variables.doOverdue" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.wfstateList" SITE="SessionVariables.pubid" PREFIX="allAssignments:"/>
                </then>
                <else>
                    <WorkflowEngine.GetFilteredAssignments OVERDUEMINS="Variables.DueMinutes" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.wfstateList" SITE="SessionVariables.pubid" PREFIX="allAssignments:"/>
                </else>
                </if>
			</THEN>
			<ELSE>
                <if COND="Variables.DueMinutes=Variables.empty">
                <then>
				    <WorkflowEngine.GetFilteredAssignments OVERDUE="Variables.doOverdue" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.empty" SITE="SessionVariables.pubid" PREFIX="allAssignments:"/>
                </then>
                <else>
                    <WorkflowEngine.GetFilteredAssignments OVERDUEMINS="Variables.DueMinutes" PROCESSOVERDUE="Variables.doProcessOverdue" PROCESSOVERDUEMINS="Variables.processDueMinutes" STATUS="Variables.status"  STATEID="Variables.empty" SITE="SessionVariables.pubid" PREFIX="allAssignments:"/>
                </else>
                </if>
			</ELSE>
			</IF>
		</ELSE>
		</IF>
</td></tr></table>

<table class="width-outer-70" border="0" cellpadding="0" cellspacing="0">
<tr>
	<td>
<IF COND="IsVariable.allAssignments:Total=true">
<THEN>
	<IF COND="Variables.allAssignments:Total=0">
	<THEN>
	<P/>		     
	<XLAT.STREAM KEY="dvin/UI/NothingFound"/><BR/>
	</THEN>
	<ELSE>
	<P/><BR/>
	<!-- We don't know how many results will be displayed, because some must be filtered out
	  -  manually during the tile.
	  -->
	<!-- <P/><STRING.STREAM VALUE="Variables.allAssignments:Total"/> items found:<BR />
	<P/> -->
	<STRING.ENCODE VARIABLE="showReportState" VARNAME="showReportState"/>
	<SETVAR NAME="TileText" VALUE="The following assets were found:"/>
	<SETVAR NAME="NoTileText" VALUE="No assets were found"/>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Workflow/TileReportAssignments">
	    <ARGUMENT NAME="showSelect" VALUE="false"/>
	    <ARGUMENT NAME="showType" VALUE="true"/>
	    <ARGUMENT NAME="showKey" VALUE="true"/>
	    <ARGUMENT NAME="showDescription" VALUE="true"/>
	    <ARGUMENT NAME="showId" VALUE="false"/>
	    <ARGUMENT NAME="showAssignedBy" VALUE="false"/>
	    <ARGUMENT NAME="showAssignedDate" VALUE="false"/>
	    <ARGUMENT NAME="showAssignedTo" VALUE="true"/>
	    <ARGUMENT NAME="showClearedBy" VALUE="false"/>
	    <ARGUMENT NAME="showClearedDate" VALUE="false"/>
	    <ARGUMENT NAME="showDueDate" VALUE="true"/>
        <ARGUMENT NAME="showProcessDeadline" VALUE="true"/>
	    <ARGUMENT NAME="showActionTaken" VALUE="false"/>
	    <ARGUMENT NAME="showActionToTake" VALUE="false"/>
	    <ARGUMENT NAME="showWorkflowStatus" VALUE="Variables.showReportState"/>
	    <ARGUMENT NAME="showIsActive" VALUE="false"/>
	    <ARGUMENT NAME="showClearAssignment" VALUE="false"/>
	    <ARGUMENT NAME="TileText" VALUE="Variables.TileText"/>
	    <ARGUMENT NAME="NoTileText" VALUE="Variables.NoTileText"/>
	</CALLELEMENT>
	<P/>

	</ELSE>
	</IF>
</THEN>
<ELSE>
    <XLAT.LOOKUP  KEY="dvin/Common/UnabletoGetaListofAssignments" VARNAME="_XLAT_"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables._XLAT_"/>
		<argument NAME="severity" VALUE="error"/>
	</callelement>	
</ELSE>
</IF>
	</td>
</tr>
</table>
<p/><p/>
</FTCS> 
