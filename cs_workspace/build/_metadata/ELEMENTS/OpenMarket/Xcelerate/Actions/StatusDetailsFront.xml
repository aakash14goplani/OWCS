<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/StatusDetailsFront.xml $ 
$Revision: 17 $ 
$Modtime: 9/17/04 2:41p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- ContentDetailsFront.xml
-
- DESCRIPTION
-	Get ContentDetails and display
-
- HISTORY 
-->
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<STRING.ENCODE VARIABLE="Id" VARNAME="Id"/>

<setvar NAME="assetname" VALUE="theCurrentAsset"/>
<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetname"/>
<if COND="IsError.Variables.errno=false">
<then>
<!-- check whether we can perform this function on this asset -->
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/AccessCheck">
		<ARGUMENT NAME="assetObjectName" VALUE="theCurrentAsset"/>
		<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
		<ARGUMENT NAME="pubid" VALUE="SessionVariables.pubid"/>
		<ARGUMENT NAME="id" VALUE="Variables.id"/>
		<ARGUMENT NAME="Function" VALUE="showstatus"/>
	</CALLELEMENT>
	<IF COND="Variables.error!=Variables.empty">
	<THEN>
		<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
			<argument NAME="error" VALUE="Variables.error"/>
		</callelement>
	</THEN>
	<ELSE>
		<ASSET.GET NAME="Variables.assetname" FIELD="id" OUTPUT="id"/>

		<WorkflowAsset.Load ASSETTYPE="Variables.AssetType" ID="Variables.id" OBJVARNAME="workflowasset" />
		<WorkflowEngine.isFunctionLegal OBJECT="workflowasset" FUNCTIONNAME="showstatus" SITE="SessionVariables.pubid" VARNAME="isLegal" REASONVARNAME="denialreason"  MUSTBEASSIGNED="false"/>
		<if COND="Variables.isLegal=false">
		<then>
            <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                <argument NAME="error" VALUE="IllegalTransition"/>
            </callelement>
	
            <!-- Display the details page -->
            <callelement NAME="OpenMarket/Xcelerate/Actions/ContentDetailsFront">
                <argument NAME="assettype" VALUE="Variables.AssetType"/>
                <argument NAME="id" VALUE="Variables.id"/>
            </callelement>
       </then>
       <else> <!-- privileges are ok -->
       <callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/GetContentDetails">
			<argument NAME="getaux" VALUE="true"/>
			<argument NAME="qryprefix" VALUE="ContentDetails"/>
			<argument NAME="assetname" VALUE="Variables.assetname"/>
		</callelement>
			<if COND="IsError.Variables.errno=true">
			<then>
				<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
					<argument NAME="error" VALUE="InvalidContentId"/>
				</callelement>
			</then>
			<else>
				<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/StatusDetails"/>
			</else>
			</if>
		</else> <!-- end privileges are ok -->
		</if>
	</ELSE>
	</IF>
</then>
<else>
	<!--
	<br/>ASSET.LOAD of <csvar NAME="Variables.id"/> failed with error: <csvar NAME="Variables.errno"/>
	-->
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
		<ARGUMENT NAME="columnvalue" VALUE="Variables.Id"/>
		<ARGUMENT NAME="type" VALUE="Long"/>
 	</CALLELEMENT>
 	<IF cond="Variables.validatedstatus=true">
	<THEN>
		<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
			<argument NAME="error" VALUE="InvalidContentId"/>
		</callelement>
	</THEN>
	</IF>
</else>
</if>
</FTCS>

