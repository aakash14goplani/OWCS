<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<!-- OpenMarket/Xcelerate/Actions/Publish/SetPubid
-
- Set publication for first page returned for a new visitor to the dynamic
- site.  This default element merely picks a publication at random with some
- constraints, so it is suitable only when there is a single publication.  
-
- This is a crisis action.  Normally all initial URLs should have a
- publication id in them (resargs "pid").
-
- INPUT
-    None.
-
- OUTPUT
-    SessionVariables.pubid		Set to a Publication table row id.
-->

<FTCS Version="1.1">

<SETVAR NAME="assettype" VALUE="Variables.c"/>
<SETVAR NAME="assetid" VALUE="Variables.cid"/>
<SETVAR NAME="errno" VALUE="0"/>
<IF COND="IsVariable.pubid=true">
<THEN>
	<SETSSVAR NAME="pubid" VALUE="Variables.pubid"/>
</THEN>
<ELSE>
	<SELECTTO LIST="SetPubidList" WHAT="*" FROM="AssetPublication" WHERE="assettype,assetid"/>
	<IF COND="IsList.SetPubidList=true">
	   <THEN>
	       <IF COND="Variables.errno!=-101">
	          <THEN>
	              <SETSSVAR NAME="pubid" VALUE="SetPubidList.pubid"/> 
	              <IF COND="SetPubidList.#numRows!=1">
	                 <THEN>
	                     <LOGMSG STR="SetPubid: There is more than one rowid to set pubid for asset Variables.c #Variables.cid"/>
	                 </THEN>
	              </IF>
	          </THEN>
	          <ELSE>
	              <LOGMSG STR="SetPubid: No rows found for asset Variables.c #Variables.cid"/>
	          </ELSE>
	       </IF>
	   </THEN>
	   <ELSE>
	        <LOGMSG STR="SetPubid: Error creating list for asset Variables.c #Variables.cid; errno=Variables.errno"/>
	   </ELSE>
	</IF>
</ELSE>
</IF>

</FTCS>
