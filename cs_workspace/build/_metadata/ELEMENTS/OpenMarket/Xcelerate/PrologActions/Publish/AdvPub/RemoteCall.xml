<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
    <!--
    $Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/PrologActions/Publish/AdvPub/RemoteCall.xml $
    $Revision: 16 $
    $Modtime: 4/12/04 4:44p $
    -->

    <!--
    - Confidential and Proprietary Information of Open Market Inc.
    -					All Rights Reserved.
    -
    - RemoteCall.xml
    -
    - DESCRIPTION
    -    This element handles calls from a remote client generated by
    -    Java method MirrorQueue.remoteExecute.  The specified element
    -    is called, but for a small margin of safety, the element must
    -    be in the same element folder as RemoteCall.
    -
    - INPUTS
    -    Variables.inifile		Used by CS.
    -    Variables.pagename		Used by CS.
    -    Variables.remoteMethod	Execute the element "./remoteMethod"
    -    Variables.*		Other variables passed as arguments to
    -    				MirrorQueue.remoteExecute.
    -
    - OUTPUT
    -    Raw text			The return is formatted as: #, #,S,U,C,C,E,S,S,#, #
    -    				or "##FAILURE## message", assuming the
    -				called element returns control.  (The message
    -				part is HTML formatted.)
    -->

    <misc.decrypt STR="Variables.password" OUTSTR="password" />

    <setvar NAME="result" VALUE="Variables.empty" />
    <setvar NAME="errno" VALUE="0" />
    <CATALOGMANAGER>
        <ARGUMENT NAME="ftcmd" VALUE="login" />
        <ARGUMENT NAME="username" VALUE="Variables.username" />
        <ARGUMENT NAME="password" VALUE="Variables.password" />
        <ARGUMENT NAME="cs.timeout" VALUE="-1" />
    </CATALOGMANAGER>

    <if COND="IsError.Variables.errno=true">
        <then>
            <!-- login unsuccessful -->
            <LOGMSG STR="ERROR: Publish target login failed." />
            <XLAT.LOOKUP KEY="dvin/UI/Error/Loginfailedfortheremoteelement" VARNAME="result" />
        </then>
        <else>
            <!-- login successful -->

            <!--<logmsg STR="calling Variables.remoteMethod"/>-->
            <setvar NAME="elementName"
                    VALUE="OpenMarket/Xcelerate/PrologActions/Publish/AdvPub/Variables.remoteMethod" />
            <callelement NAME="Variables.elementName" />
            <if COND="IsError.Variables.errno=true">
                <then>
                    <setvar NAME="result" VALUE="Error Variables.errno executing Variables.elementName" />
                </then>
            </if>

        </else>
    </if>

    <if COND="Variables.result=Variables.empty">
        <then>
            ##SUCCESS##
        </then>
        <else>
            ##FAILURE##
            <STRING.STREAM VALUE="Variables.result" />
        </else>
    </if>

</FTCS>
