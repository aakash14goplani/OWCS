<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/PrologActions/DeleteFront.xml $ 
$Revision: 19 $ 
$Modtime: 9/17/04 2:07p $ 
-->

<!--
- Confidential and Proprietary Information of Open Market Inc.
-					All Rights Reserved.
-
- DeleteFront.xml
-
- DESCRIPTION
-	
-
- HISTORY 
-->

<setvar NAME="doproceed" VALUE="true"/>
<!-- load the asset that is to be deleted -->
<setvar NAME="assetname" VALUE="theAsset"/>
<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetname"/>
<if COND="IsError.Variables.errno=true">
    <then>        
        <setvar NAME="doproceed" VALUE="InvalidContentId"/>
    </then>
</if>

<!-- check whether we can perform this function on this asset -->
<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/AccessCheck">
	<ARGUMENT NAME="assetObjectName" VALUE="Variables.assetname"/>
	<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
	<ARGUMENT NAME="pubid" VALUE="SessionVariables.pubid"/>
	<ARGUMENT NAME="id" VALUE="Variables.id"/>
	<ARGUMENT NAME="Function" VALUE="delete"/>
</CALLELEMENT>
<IF COND="Variables.error!=Variables.empty">
<THEN>
 	<!-- -12069 means allow edit but display warning, any other error means prohibit edit -->
 	<if COND="Variables.errno=-12069">
 	<then>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<argument NAME="elem" VALUE="EditNotAllowed"/>
			<argument NAME="severity" VALUE="info"/>
			<argument NAME="assettype" VALUE="Variables.AssetType"/>
			<argument NAME="id" VALUE="Variables.id"/>
		</callelement>
	</then>
	<else>
     <setvar NAME="doproceed" VALUE="Variables.error"/>
   </else>
   </if>
</THEN>
</IF>

<if COND="Variables.doproceed=true">
<then>
	<ASSET.GETASSETTYPE NAME="Variables.assetname" OUTNAME="type"/>
	<ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="atDescription"/>
	
	<ASSET.GET NAME="Variables.assetname" FIELD="id" OUTPUT="id"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="name" />
	<ASSET.GET NAME="Variables.assetname" FIELD="createdby" OUTPUT="createdby"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="createddate" OUTPUT="createddate"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="updatedby" OUTPUT="updatedby"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="updateddate" OUTPUT="updateddate"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="description" OUTPUT="description"/>
	<ASSET.GET NAME="Variables.assetname" FIELD="status" OUTPUT="statuscode"/>

</then>
</if>

<if COND="Variables.doproceed=true">
<then>
    <!-- check priviledge -->
    <WorkflowAsset.Load ASSETTYPE="Variables.AssetType" ID="Variables.id" OBJVARNAME="workflowasset" />
    <WorkflowEngine.isFunctionLegal OBJECT="workflowasset" SITE="SessionVariables.pubid" FUNCTIONNAME="delete" VARNAME="isLegal" REASONVARNAME="denialreason" MUSTBEASSIGNED="true"/>
    <if COND="Variables.isLegal=false">
    <then>
         <setvar NAME="doproceed" VALUE="IllegalTransition"/>
    </then>
    </if>
</then>
</if>

<if COND="Variables.doproceed=true">
<then>
	<!-- check whether any assets in the Asset Relation Tree refer to me -->
	<ASSET.REFERENCEDBY NAME="Variables.assetname" LIST="ParentList" EMBEDDEDREFLIST="EmbeddedRefsList"/>
	<ASSET.SITES NAME="Variables.assetname" LIST="SitesList"/>
	<IF COND="SitesList.id=0">
	<THEN>
		<!-- All sites.  Get the list of all. -->
		<PUBLICATION.LIST LIST="SitesList"/>
	</THEN>
	</IF>
</then>
</if>


</FTCS>
