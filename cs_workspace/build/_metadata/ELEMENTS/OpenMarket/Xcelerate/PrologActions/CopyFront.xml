<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/PrologActions/CopyFront.xml $ 
$Revision: 43 $ 
$Modtime: 11/24/03 11:15a $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- CopyFront.xml
-
- DESCRIPTION
-	Required input variables: id and AssetType
-->


<!-- Include the JavaScript validation functions -->

	<callelement NAME="OpenMarket/Xcelerate/Scripts/ValidateInput">
	</callelement>

<!-- Set the name of the asset object -->

	<setvar NAME="assetname" VALUE="theCurrentAsset"/> <!--This line will be removed when convertion to assetObjectName complete - jrws-->
	<setvar NAME="assetObjectName" VALUE="theCurrentAsset"/>

<!-- Attempt to load the existing asset which will be copied -->
	<!-- although the source of the copy will not be edited, set "editable" so that all data gets loaded at once -->
	<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetObjectName" EDITABLE="true"/>
	<IF COND="IsError.Variables.errno!=true">
		<THEN>

<!-- Clear out the name -->
			<ASSET.SET NAME="Variables.assetObjectName" FIELD="name" VALUE="Variables.empty"/>
<!-- prevent ApplicationPage from writing a cookie for this asset -->
			<REMOVEVAR NAME="Inid"/>
			<setvar NAME="sourceassetid" VALUE="Variables.id"/>
		
<!-- Handle setting defaults to display in asset specific form -->

			<callelement NAME="OpenMarket/Xcelerate/AssetType/Variables.AssetType/PreUpdate">
				<argument NAME="updatetype" VALUE="setformdefaults"/>
			</callelement>

<!-- Clear all of the dimension parents - a copy is not associated with any translations -->

            <ASSET.GETDIMPARENTS NAME="Variables.assetObjectName" list="sourceAssetDimParents" />
            <LOOP LIST="sourceAssetDimParents">
                <ASSET.REMOVEDIMPARENTS NAME="Variables.assetObjectName">
                    <ASSET.DIMENSIONPARENTRELATIONSHIP type="sourceAssetDimParents.TYPE" assetid="sourceAssetDimParents.OBJECTID" group="sourceAssetDimParents.GROUP"/>
                </ASSET.REMOVEDIMPARENTS>
            </LOOP>

<!-- However, do not clear the locales - copies have the same dimensions as their source but have new
     (auto-assigned) parents -->

<!-- Build variables needed for the content form -->

			<ASSET.SCATTER NAME="Variables.assetObjectName" PREFIX="ContentDetails" FIELDLIST="*"/>

<!-- Check to see if the user has create privileges for the asset type -->

			<setvar NAME="doproceed" VALUE="true"/>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Workflow/CheckPrivs">
			    <argument NAME="AssetType" VALUE="Variables.AssetType"/>
	    		<argument NAME="assetObjectName" VALUE="Variables.assetObjectName"/>
	    		<argument NAME="Function" VALUE="copy"/>
			</callelement>
			<if COND="Variables.PrivsFailed=true">
		    	<then>
		    		<REMOVEVAR NAME="updatetype"/>
        			<setvar NAME="doproceed" VALUE="Variables.PrivsFailedReason"/>
    			</then>
			</if>
		</THEN>
	</IF>
</FTCS>

