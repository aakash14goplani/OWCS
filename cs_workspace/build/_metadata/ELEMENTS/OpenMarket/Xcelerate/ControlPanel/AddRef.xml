<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Xcelerate/ControlPanel/AddRef
-
- INPUT
-
- OUTPUT
-
-->
<ASSET.LOAD TYPE="Variables.parenttype" OBJECTID="Variables.parentid" NAME="theAsset" />
<ASSET.LEGALCHILDTYPES NAME="theAsset" FIELD="Variables.parentfield" PUBID="SessionVariables.pubid" LISTVARNAME="childtypeslist" />
<if COND="IsList.childtypeslist=true">
<then>
    <if COND="childtypeslist.#numRows !=0">
    <then>
        <setvar NAME="firsttype" VALUE="true" />
        <loop LIST="childtypeslist">
            <if COND="Variables.firsttype=true">
            <then>
                <setvar NAME="childtypes" VALUE="childtypeslist.assettype" />
                <setvar NAME="firsttype" VALUE="false" />
            </then>
            <else>
                <setvar NAME="childtypes" VALUE="Variables.childtypes,childtypeslist.assettype" />
            </else>
            </if>
        </loop>

        <XLAT.LOOKUP KEY="dvin/Common/NewImage" VARNAME="_button_new_title" />
        <XLAT.LOOKUP KEY="dvin/Common/AddExisting" VARNAME="_button_addexist_title" />
<!--[2008-01-21 KGF] More appropriate fix for #15833-->
		<setvar NAME="_button_new_name" VALUE="New" />
		<setvar NAME="_button_swap_name" VALUE="swap" />
<!--[2008-01-08 KGF] for displaying button images with adequate spacing -->
        <IF COND="IsVariable.cs_imagedir=false"><THEN>
            <ICS.GETPROPERTY NAME="ft.cgipath" OUTPUT="f_cgipath" />
            <ICS.GETPROPERTY NAME="xcelerate.imageurl" FILE="futuretense_xcel.ini" OUTPUT="x_imageurl" />
            <SETVAR NAME="cs_imagedir" VALUE="Variables.f_cgipathVariables.x_imageurl" />
        </THEN></IF>
    	<asset.CanTakeAction NAME="theAsset" ACTIONS="add" FIELD="Variables.parentfield" MEMBERID="Variables.assetid" VARNAME="canAdd" />
    	<if COND="Variables.canAdd=true">
    	<then>
        <replaceall LIST="Variables.parentid,Variables.parenttype,Variables.parentfield,Variables.childtypes,Variables._button_addexist_title,Variables._button_new_title,Variables._button_new_name,Variables._button_swap_name,Variables.lockenabled,Variables.cs_imagedir,SessionVariables.locale">
        <![CDATA[
            <span id="bar_addref_Variables.parentid">
                <div style="border: none; width: 93%; background-color: #949494; margin: 0; padding: 0; text-height: 0; font-size: 0;">
        			<img src="Variables.cs_imagedir/graphics/SessionVariables.locale/controlpanel/addNew.gif" class="sb_addNew" border="0" id="add_addref_Variables.parentid" title="Variables._button_new_title" onclick="site_addref('Variables.parentid','Variables.parenttype','Variables.parentfield','Variables.childtypes','Variables.lockenabled','Variables._button_new_name');" />
					<img src="Variables.cs_imagedir/graphics/SessionVariables.locale/controlpanel/addexisting.gif" class="sb_addExisting" border="0" id="Search" title="Variables._button_addexist_title" onclick="site_addref('Variables.parentid','Variables.parenttype','Variables.parentfield','Variables.childtypes','Variables.lockenabled','Variables._button_swap_name');" />
                </div>
            </span>
        ]]>
        </replaceall>
        </then>
        </if>
    </then>
    </if>
</then>
</if>

</FTCS>
