<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateB/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Scripts/ValidateInput.xml $ 
$Revision: 12 $ 
$Modtime: 11/05/02 7:07p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- validateFields.xml
-
- DESCRIPTION
-	Utilities for validating input fields
-
- HISTORY 
-->

<SCRIPT LANGUAGE="JavaScript1.2">
		
<![CDATA[
function compareLength(str, len)
{
	strlen = str.length;
	if ( strlen <= len ) {
		return 0;
	} else {
		return -1;
	}	
}

// Show a warning if the str is longer than the specified length
function checkLength(str, len, fieldname)
{
	if (compareLength(str, len) == 0)
		return true;
	else
	{
         ]]>
         var replacestr=/\bVariables.fieldname\b/   ;
         var xlatstr= '<XLAT.STREAM KEY="dvin/AT/Common/Thetextyouhaveenteredtoolong" ESCAPE="true" ENCODE="false"/>' ;
         var newstr=xlatstr.replace(replacestr, fieldname) ;
         replacestr=/\bVariables.len\b/   ;
         newstr=newstr.replace(replacestr, len) ;
         alert(newstr);
         <![CDATA[
 	     return false;
	}
}

// Set the specified form field to the instr, truncated to the specified length
function setField(instr, len, fieldname, obj)
{
	outstr = instr.substring(0,len);
	obj.form.elements[fieldname].value = outstr;	
}

// Show a warning if the str is longer than the specified length
]]>
<PROPERTY.GET PARAM="cc.dbencoding" INIFILE="futuretense.ini" VARNAME="propDBEncoding"/>
function checkEncodedLength(str, len, fieldname)
{
  var byteLength = 0;
  <SETVAR NAME="errno" VALUE="0"/>
  <BEGINS STR="Variables.propDBEncoding" WHAT="iso8859-"/>
  <IF COND="Variables.errno=1">
  <THEN>
    <SETVAR NAME="errno" VALUE="0"/>
    byteLength = str.length();
  </THEN>
  <ELSE>
    <IF COND="Variables.propDBEncoding=Shift_JIS">
    <THEN>
      <![CDATA[
        // Shift_JIS
        for (var i = 0; i < str.length; i++)
        {
          var currentChar = str.charCodeAt(i);
                
          if (currentChar >= 0x30A0 && currentChar <= 0x30FF)
            byteLength++;
          else byteLength += 2;
        }
      ]]>
    </THEN>
    <ELSE>
      <![CDATA[
        // UTF-8
        for (var i = 0; i < str.length; i++)
        {
          var currentChar = str.charCodeAt(i);
                
          if (currentChar < 0x80)
            byteLength++;
          else if (currentChar >= 0x80 && currentChar <= 0x7FF)
            byteLength += 2;
          else if (currentChar > 0x7FF)
            byteLength += 3;
        }
      ]]>
    </ELSE>
    </IF>
  </ELSE>
  </IF>
  <![CDATA[
    if ( byteLength <= len ) {
  		return true;
  	} else {
  ]]>
      var replacestr=/\bVariables.fieldname\b/   ;
      var xlatstr= '<XLAT.STREAM KEY="dvin/AT/Common/Toomanycharactersinfield" ESCAPE="true" ENCODE="false"/>' ;
      var newstr=xlatstr.replace(replacestr, fieldname) ;
      alert(newstr);
      return false;
    }
}
</SCRIPT>

</FTCS>
