<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">


<!--
/VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/WorkflowStatusCodePost.xml
 Confidential and Proprietary Information of Oracle Corp.
					All Rights Reserved.

 WorkflowStatusCodePost.xml

 DESCRIPTION
	Admin things about a workflow status

 
-->



    <!-- process deletion of stuff -->
    <if COND="Variables.action=delete">
    <then>
		<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
			<tr><td>
				<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/DeleteProcessStateCode"/></span>
			</td></tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
		</table>
                <setvar NAME="errno" VALUE="0"/>
	  	    <WORKFLOWENGINE.GETSTATEID OBJVARNAME="deletestate" ID="Variables.id"/>
		    <WORKFLOWSTATE.GETID NAME="deletestate" VARNAME="delid"/>
		    <WORKFLOWENGINE.DELETESTATEID OBJVARNAME="deletestate" ID="Variables.delid"/>
                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="DeleteFailed"/>
                    </callelement>            
                </then>
                <else>
                    <XLAT.STREAM KEY="dvin/UI/Deletesuccessful"/>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowStatusCodeFront">                     
                        <argument NAME="action" VALUE="list"/>
                    </callelement>
                    
                </else>
                </if>
    </then>
    </if>

    <!-- process addition of stuff -->
    <if COND="Variables.action=new">
    <then>
                <if COND="IsVariable.workflowstatuscode!=true">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="NoWorkflowStatusCode"/>
                    </callelement>            
                    <throwexception/>
                </then>
                </if>
                <!-- insert the specified information
                    into the table. Report any errors.
                    Refresh the navigation -->
                <if COND="IsVariable.wfdstate:description!=true">
                <then>
                    <setvar NAME="wfdstate:description" VALUE="Variables.empty"/>
                </then>
                </if>
	          <if COND="Variables.existingstate=false">
		    <then>
		      	<WORKFLOWENGINE.CREATENEWSTATE OBJVARNAME="newstate"/>
				<WORKFLOWSTATE.SETSTATENAME NAME="newstate" VALUE="Variables.workflowstatuscode"/>
		    </then>
		    <else>
	  			<WORKFLOWENGINE.GETSTATEID OBJVARNAME="newstate" ID="Variables.id"/>
				<WORKFLOWSTATE.SETSTATENAME NAME="newstate" VALUE="Variables.workflowstatuscode"/>
		    </else>
		    </if>	
		    <setvar NAME="wfdstate:name" VALUE="Variables.workflowstatuscode"/>
		    <CALCULATOR.GO VALUE="Variables.estdays 86400000 *" VARNAME="tmp1"/>
		    <CALCULATOR.GO VALUE="Variables.esthours 3600000 *" VARNAME="tmp2"/>
		    <CALCULATOR.GO VALUE="Variables.tmp1 Variables.tmp2 +" VARNAME="wfdstate:esttime"/>
		    <removevar NAME="tmp1"/>
		    <removevar NAME="tmp2"/>

			<WORKFLOWSTATE.SETSTATEDESCRIPTION NAME="newstate" VALUE="Variables.wfdstate:description"/>

			<WORKFLOWSTATE.SETESTIMATEDSTATETIME NAME="newstate" TIME="Variables.wfdstate:esttime"/>
		
			<WORKFLOWSTATE.GETACTIONS NAME="newstate" OBJVARNAME="timedactionlistobj"/>
			<WORKFLOWTIMEDACTIONLIST.CLEARTIMEDACTIONS NAME="timedactionlistobj"/>


			<if COND="IsVariable.wfdstate:actionsactionTotal=true">
			<then>
				<if COND="Variables.wfdstate:actionsactionTotal!=0">
				<then>
					<setcounter NAME="ACTCOUNT" VALUE="0"/>
					<loop FROM="0" COUNT="Variables.wfdstate:actionsactionTotal">
						<WORKFLOWTIMEDACTIONLIST.CREATE NAME="timedactionlistobj" OBJVARNAME="timedactionobj"/>
						<WORKFLOWTIMEDACTION.SETASSIGNMENTACTION NAME="timedactionobj" VALUE="Variables.wfdstate:actionsactionCounters.ACTCOUNTaction"/>
						<WORKFLOWTIMEDACTION.SETRELATIVETIME NAME="timedactionobj" TIME="Variables.wfdstate:actionsactionCounters.ACTCOUNTtime"/>
						<WORKFLOWTIMEDACTIONLIST.ADDTIMEDACTION NAME="timedactionlistobj" OBJECT="timedactionobj"/>
						<WORKFLOWSTATE.SETACTIONS NAME="newstate" OBJECT="timedactionlistobj"/>
						<inccounter NAME="ACTCOUNT" VALUE="1"/>
					</loop>
				</then>
				</if>
			</then>
			</if>
			<WORKFLOWSTATE.SCATTER NAME="newstate" PREFIX="wfdstate:"/>
      	    	<WORKFLOWSTATE.GATHER PREFIX="wfdstate:" NAME="newstate"/>

		      <WORKFLOWENGINE.SETSTATE OBJECT="newstate"/>

                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="EnterFailed"/>
                    </callelement>            
                </then>
                <else>
                <WORKFLOWSTATE.GETID NAME="newstate" VARNAME="id" />
                    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowStatusCodeFront">
                        <argument NAME="workflowstatuscode" VALUE="Variables.workflowstatuscode"/>
                        <argument NAME="action" VALUE="details"/>
                        <argument NAME="showtitle" VALUE="false"/>
                        <argument NAME="id" VALUE="Variables.id"/>
                    </callelement>
                </else>
                </if>
    </then>
    </if>
	 
	<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
	<if COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
	<then>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
			<argument NAME="__TreeRefreshKeys__" VALUE="Self:Workflow_States"/>
		</callelement>		
	</then>
	</if>
	 
 
</FTCS>
