<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Admin/Publish/AssetDefaultTemplatePost
-
- INPUT
-	Variables.assettypes - list of assettypes
-	Variables.subtypes - corresponding list of subtypes
-	Variables.templates - corresponding list of templates to set as default, with 'none' meaning clear it
- OUTPUT
-
-->
<STRINGLIST NAME="assettypes" STR="Variables.assettype" DELIM=";"/> 
<STRINGLIST NAME="subtypes" STR="Variables.subtype" DELIM=";"/> 
<STRINGLIST NAME="templates" STR="Variables.template" DELIM=";"/> 
<IF COND="IsVariable.cs_wrapper=true">
<THEN>
	<STRINGLIST NAME="wrapperpages" STR="Variables.cs_wrapper" DELIM=";"/>
</THEN>
</IF>

<SETCOUNTER NAME="rowcount" VALUE="1"/>
<LOOP COUNT="assettypes.#numRows">
	<GOTOROW LIST="assettypes" ROWNUM="Counters.rowcount"/>
	<GOTOROW LIST="subtypes" ROWNUM="Counters.rowcount"/>
	<GOTOROW LIST="templates" ROWNUM="Counters.rowcount"/>
	
	<!-- debug <CSVAR NAME="assettypes.ITEM,subtypes.ITEM,templates.ITEM"/><br/>-->
	<ASSETTEMPLATEMANAGER.LOAD OBJVARNAME="default" TARGET="Variables.target" TYPE="assettypes.ITEM" SUBTYPE="subtypes.ITEM"/>
	<if COND="templates.ITEM=none">
	<then>
		<ASSETTEMPLATE.SETDEFAULTTEMPLATE NAME="default"/>
	</then>
	<else>
		<ASSETTEMPLATE.SETDEFAULTTEMPLATE NAME="default" TEMPLATE="templates.ITEM"/>
	</else>
	</if>
	<!-- set wrapper pages, only if there are any -->
	<IF COND="IsVariable.cs_wrapper=true">
	<THEN>
		<GOTOROW LIST="wrapperpages" ROWNUM="Counters.rowcount"/>
		<IF COND="wrapperpages.ITEM=none">
		<THEN>
			<ASSETTEMPLATE.SETWRAPPERPAGE NAME="default"/>
		</THEN>
		<ELSE>
			<ASSETTEMPLATE.SETWRAPPERPAGE NAME="default" WRAPPER="wrapperpages.ITEM"/>
		</ELSE>
		</IF>
	</THEN>
	</IF>		
	
	<ASSETTEMPLATEMANAGER.SAVE OBJECT="default"/>
	<if COND="IsError.Variables.errno=true">
	<then>
		<XLAT.STREAM KEY="dvin/UI/Admin/Error/savingdefaulttemplatITEMstypesITEM" errno="Variables.errno" assettype="assettypes.ITEM" subtype="subtypes.ITEM" EVALALL="false"/>
		<IF COND="Variables.errdetail1!=Variables.empty">
		<THEN>
			<CSVAR NAME="Variables.errdetail1"/>.<br/>
		</THEN>
		</IF>
	</then>
	</if>
	<INCCOUNTER NAME="rowcount" VALUE="1"/>
</LOOP>	

<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/Publish/AssetDefaultTemplateFront">
	<ARGUMENT NAME="target" VALUE="Variables.target"/>
	<ARGUMENT NAME="action" VALUE="details"/>
</CALLELEMENT>

</FTCS> 
