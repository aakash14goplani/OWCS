<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/WorkflowFunctionPrivs.xml $ 
$Revision: 29 $ 
$Modtime: 7/16/04 1:56p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- WorkflowFunctionPrivs.xml
-
- DESCRIPTION
-	Admin things about  workflow functionprivs
-
- HISTORY 
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<HTML>
<HEAD>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>
</HEAD>

<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceladmin"/>
<if COND="Variables.errno=0">
	<then> 
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Util/ShowError" outstring="urlshowerror">
            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                          <satellite.argument name="error" value="AdminTimeoutError"/>
                                           </SATELLITE.LINK>
		<REPLACE STR="Variables.urlshowerror">
			<script LANGUAGE="JavaScript">
				parent.parent.location="Variables.urlshowerror";
			</script>
		</REPLACE>
		<throwexception/>
	</then>
</if>

<BODY BGCOLOR="#FFFFFF">
	<SCRIPT LANGUAGE="JavaScript">
	<![CDATA[
	function checkfields(frm)
	{
		if (frm.state.options.selectedIndex=="-1")
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Error/specifystate" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			return false;
		}

		if (frm.acls.options.selectedIndex=="-1")
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Error/specifyrole" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			return false;
		}
    }
    
    function AddFunction(frm)
    {
        frm.elements['pagename'].value = "OpenMarket/Xcelerate/Admin/WorkflowFront";
        frm.elements['subaction'].value = "addprivs";
	    frm.submit();
	}
    
	function cancel(frm)
	{
	    frm.elements['pagename'].value = "OpenMarket/Xcelerate/Admin/WorkflowFront";
	    frm.elements['subaction'].value = "functions";
	    frm.submit();
	}

	]]>
	</SCRIPT>
	<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<if COND="Variables.wfp:stepsTotal!=0">
<then>
<setvar NAME="inusestates" VALUE="Variables.empty"/>
<setcounter NAME="SCOUNT" VALUE="0"/>
	<loop FROM="0" COUNT="Variables.wfp:stepsTotal">
		<removevar NAME="tmp"/>
		<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.SCOUNTstartstate"/>
		<setvar NAME="errno" VALUE="0"/>
		<begins STR="Variables.tmp" WHAT="Variables."/>
		<if COND="Variables.errno=0">
		<then>
			<setvar NAME="inusestates" VALUE="Variables.inusestates,Variables.tmp"/>
		</then>
		</if>
		<removevar NAME="tmp"/>
		<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.SCOUNTendstate"/>
		<setvar NAME="errno" VALUE="0"/>
		<begins STR="Variables.tmp" WHAT="Variables."/>
		<if COND="Variables.errno=0">
		<then>
			<setvar NAME="inusestates" VALUE="Variables.inusestates,Variables.tmp"/>
		</then>
		</if>
		<inccounter NAME="SCOUNT" VALUE="1"/>
	</loop>
</then>
</if>

<if COND="Variables.privaction=delete">
<then>
	<!-- return all hidden data back to process page via hidden variables -->
	<!-- <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
		<argument NAME="DataAction" VALUE="datafromprocesspage"/>
	</callelement>   

	<callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
		<argument NAME="DataAction" VALUE="hiddenvariables"/>
	</callelement>   -->

	<callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFront">
		<argument NAME="action" VALUE="Variables.action"/>
		<argument NAME="subaction" VALUE="deleteprivs"/>
		<argument NAME="fpfunctionid" VALUE="Variables.fpfunctionid"/>
		<argument NAME="fpstateid" VALUE="Variables.fpstateid"/>
		<argument NAME="fprole" VALUE="Variables.fprole"/>
		<argument NAME="wfp:name" VALUE="Variables.wfp:name"/>
	</callelement>

</then>
</if>
<if COND="Variables.privaction=new">
<then>

    <!-- return all hidden data back to process page via hidden variables -->
    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
		<argument NAME="DataAction" VALUE="datafromprocesspage"/>
	</callelement> 

    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
		<argument NAME="DataAction" VALUE="hiddenvariables"/>
	</callelement>

	<setcounter NAME="numsteps" VALUE="Variables.wfp:stepsTotal"/>	                                        
   
    <INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/WorkflowFront"/>
	<STRING.ENCODE VARIABLE="action" VARNAME="actionEnc"/>
    <INPUT TYPE="HIDDEN" NAME="action" VALUE="Variables.actionEnc" REPLACEALL="Variables.actionEnc"/>                                     
    <INPUT TYPE="HIDDEN" NAME="subaction" VALUE="addprivs"/>

    <table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/AddFunctionPrivilege"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>

    <!-- Table Header -->
    <table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30"> 
	    <tr><td>
			    <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
				    <!-- Item -->
				    <tr>
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/ProcessName"/>: 
					    </td>
                        <td><br/></td> 
					    <td class="form-inset">
							    <STRING.STREAM VALUE="Variables.wfp:name"/>
					    </td> 
                    </tr> 
              	    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
                    <if COND="Variables.fprole!=-1"><then>
                        <setvar NAME="rowStyle" VALUE="tile-row-highlight"/>
	      		    </then><else>
					    <setvar NAME="rowStyle" VALUE="tile-row-normal"/>
	      		    </else></if>
  			    
                        
                    <tr>
                        <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/Function"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
							<WORKFLOWENGINE.GETFUNCTIONID ID="Variables.fprole" OBJVARNAME="func"/>
							<STRING.ENCODE VARIABLE="fprole" VARNAME="fprole"/>
							<WORKFLOWFUNCTION.GETNAME NAME="func" VARNAME="funcName"/>
							<XLAT.LOOKUP KEY="dvin/UI/Security/CCFunction/Variables.funcName" VARNAME="func:description" />
							<STRING.STREAM VARIABLE="func:description"/>
							&nbsp;
                    	 	<INPUT TYPE="HIDDEN" NAME="fprole" VALUE="Variables.fprole" REPLACEALL="Variables.fprole"/>
					    </td> 
                    </tr> 
              	    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr>
					    <td class="form-label-text"> 
						    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/State"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
							    <WORKFLOWENGINE.GETALLSTATES PREFIX="wfstate:"/>
                                <select NAME="state" SIZE="6" MULTIPLE="yes">
                        	    
							    <if COND="IsVariable.wfstate:Total=true">
							    <then>
								    <if COND="Variables.wfstate:Total!=0">
								    <then>
								    	<setcounter NAME="STATECOUNT" VALUE="0"/>
									    <loop FROM="0" COUNT="Variables.wfstate:Total">
										    <setvar NAME="tmp" VALUE="wfstate:Counters.STATECOUNT"/>
										    <WORKFLOWSTATE.GETID NAME="Variables.tmp" VARNAME="stid"/>
										    <WORKFLOWSTATE.GETSTATEDESCRIPTION NAME="Variables.tmp" VARNAME="stdesc"/>
										    <setvar NAME="errno" VALUE="0"/>
										    <ISINLIST ITEM="Variables.stid" STR="Variables.inusestates"/>
										    <if COND="Variables.errno=1">
										    <then>
											<STRING.ENCODE VARIABLE="stid" VARNAME="stid"/>
                        				    <OPTION VALUE="Variables.stid" REPLACEALL="Variables.stid"/><STRING.STREAM VALUE="Variables.stdesc"/>
										    </then>
										    </if>
										    <inccounter NAME="STATECOUNT" VALUE="1"/>
									    </loop>
								    </then>
								    </if>
							    </then>
							    </if>
                    		    </select>      
					    </td> 
                    </tr> 
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
				    	<td  class="form-label-text">
					    	<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Role"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
	    						    <setvar NAME="errno" VALUE="0"/>
	    						    <setvar NAME="cs_ownerid" VALUE="Variables.wfp:id"/>
	    						    <selectto LIST="ACLList" FROM="Workflow_Roles" WHERE="cs_ownerid" WHAT="cs_rolename"/>
	   					 	        <if COND="Variables.errno=0">
	    						    <then>
	        							<setvar NAME="ALCOL" VALUE="cs_rolename"/>
	    						    </then>
	    						    <else>
								        <ROLEMANAGER.GETROLENAMES LISTVARNAME="ACLList"/>
	    							    <setvar NAME="ALCOL" VALUE="aclname"/>
	    						    </else>
	    						    </if>
                                    
	   						        <!--  make a list of roles selected in previous page -->
	   	 					        <stringlist NAME="selectedroles" STR="Variables.roles" DELIM=","/>
                     				<!--  select from a list of ACLs for the people that are allowed to fire this rule -->
                    				<SELECT NAME="acls" SIZE="6" MULTIPLE="yes">
                    				<LOOP LIST="ACLList">
		    						    <setvar NAME="ALacl" VALUE="ACLList.Variables.ALCOL"/>
										<STRING.ENCODE VARIABLE="ALacl" VARNAME="ALacl"/>
									<if COND="Variables.roles=_ALL_">
									<then>
										<OPTION VALUE="Variables.ALacl" REPLACEALL="Variables.ALacl"/><CSVAR NAME="Variables.ALacl"/>
									</then>
									<else>										
									    <setvar NAME="errno" VALUE="0"/>
									    <isinlist LIST="selectedroles" ITEM="Variables.ALacl"/>
                                        
									    <if COND="Variables.errno=1">
									    <then>
											<OPTION VALUE="Variables.ALacl" REPLACEALL="Variables.ALacl"/><CSVAR NAME="Variables.ALacl"/>
									    </then>
									    </if>
									</else>
									</if>
                   					</LOOP>
                    				</SELECT>
					    </td> 
                    </tr> 

              	    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td  class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/AllowedQ"/> 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
							    <INPUT TYPE="CHECKBOX" NAME="allowed" CHECKED="yes" VALUE="true"/>
					    </td> 
                    </tr> 
                    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
              	   	<tr>
              	   		<td></td>
              	   		<td><br/></td>
              	   		<td class="form-inset">
						    <XLAT.LOOKUP KEY="dvin/UI/CancelCreateFunction" VARNAME="_XLAT_" ESCAPE="true"/>
						    <A HREF="javascript: cancel(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
						    <XLAT.LOOKUP KEY="dvin/UI/Admin/AddNewFunction" VARNAME="_XLAT_" ESCAPE="true"/>
						    <A HREF="javascript: AddFunction(document.forms[0]);" onClick="return checkfields(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/AddNew"/></CALLELEMENT></A>
				         </td>
              	   	</tr>
		    </table>
	   </td></tr>
	  </table>
</then>
</if>

<!--************edit a functionpriv *************-->
<if COND="Variables.privaction=edit">
<then>

<XLAT.STREAM KEY="dvin/UI/Admin/TBD"/>
</then>
</if>

<if COND="Variables.privaction=details">
<then>
	<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<XLAT.STREAM KEY="dvin/UI/Admin/PrivilegedFunctions"/>:
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>

	<if COND="Variables.wfp:privsprivTotal!=0">
	<then>
		<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30">
		<tr>
			<td></td>
			<td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			<td></td>
		</tr>
		<tr>
			<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
			<td>
				<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
				<tr>
					<td colspan="20" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
				</tr>
				<tr>
					<td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<TD class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" NOWRAP="NOWRAP" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/UI/Admin/Function"/></DIV></TD>
					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<TD class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" NOWRAP="NOWRAP" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/UI/Admin/State"/></DIV></TD>
					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<TD class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" NOWRAP="NOWRAP" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Roles"/></DIV></TD>
					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<TD class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" NOWRAP="NOWRAP" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/UI/Admin/Allowed"/></DIV></TD>
					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
				 </tr>
				<tr><td colspan="20" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

				<setcounter NAME="PRIVS" VALUE="0"/>
	     			<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
	     			<loop FROM="0" COUNT="Variables.wfp:privsprivTotal">
					<TR class="Variables.rowStyle" REPLACEALL="Variables.rowStyle">
		  				<td><BR/></td>
		  				<td><BR/></td>
		  				<TD VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
		   				<DIV class="small-text-inset">
							<if COND="IsVariable.wfp:privsprivCounters.PRIVSfunction=true">
							<then>
								<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.PRIVSfunction"/>
								<WORKFLOWENGINE.GETFUNCTIONID ID="Variables.tmp" OBJVARNAME="aprvobj"/>
								<WORKFLOWFUNCTION.GETNAME NAME="aprvobj" VARNAME="ffunction"/>
				 				<STRING.STREAM VALUE="Variables.ffunction"/><br/>
							</then>
							<else>
								&nbsp;
							</else>
							</if>
		   				</DIV>
		  				</TD>
		  				<td><BR /></td>
		  				<TD VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
		   				<DIV class="small-text-inset">
							<if COND="IsVariable.wfp:privsprivCounters.PRIVSstate=true">
							<then>
								<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.PRIVSstate"/>
								<if COND="Variables.tmp!=Variables.empty">
								<then>
									<WORKFLOWENGINE.GETSTATEID ID="Variables.tmp" OBJVARNAME="aprvobj"/>
									<WORKFLOWSTATE.GETSTATENAME NAME="aprvobj" VARNAME="ststate"/>
									<STRING.STREAM VALUE="Variables.ststate"/><br/>
								</then>
								<else>
									<XLAT.STREAM KEY="dvin/UI/Admin/WorkflowNotActive"/>
								</else>
								</if>
							</then>
							<else>
								&nbsp;<br/>
							</else>
							</if>
		   				</DIV>
		  				</TD>
		  				<td><BR /></td>
		  				<TD VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
		   				<DIV class="small-text-inset">
							<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.PRIVSrole"/>
							<if COND="Variables.tmp!=Variables.empty">
							<then>
								<STRINGLIST NAME="tmplist" STR="Variables.tmp" DELIM=","/>
								<loop LIST="tmplist">
									<STRING.STREAM VALUE="tmplist.ITEM"/><br/>
								</loop>
							</then>
							<else>
								&nbsp;<br/>
							</else>
							</if>
		   				</DIV>
		 	 			</TD>
						<td><BR /></td>
		  				<TD VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
		   				<DIV class="small-text-inset">
							<if COND="IsVariable.wfp:privsprivCounters.PRIVSallowed=true">
							<then>
								<STRING.STREAM VALUE="Variables.wfp:privsprivCounters.PRIVSallowed"/><br/>
							</then>
							<else>
								&nbsp;<br/>
							</else>
							</if>
		   				</DIV>
		  				</TD>
		  				<td><BR /></td>
					</TR>

	      				<inccounter NAME="PRIVS" VALUE="1"/>
	      				<IF COND="Variables.rowStyle=tile-row-normal">
	      				<THEN>
	        					<SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
	      				</THEN>
	      				<ELSE>
						<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
	      				</ELSE>
	      				</IF>
	     			</loop>
	    			</table>
	  	 	</td>
	   		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
	  	</tr>
	  	<tr>
			<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	  	</tr>
	  	<tr>
			<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
	  	</tr>
		</table>
	 <br/>
	</then>
	<else>
		<XLAT.STREAM KEY="dvin/UI/Admin/Noprivilegedfunctionsfound"/><br/>
	</else>
	</if>

</then>
</if>

</BODY>
</HTML>
</FTCS>
