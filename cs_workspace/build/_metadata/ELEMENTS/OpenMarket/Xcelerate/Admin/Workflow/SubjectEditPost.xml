<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
    <PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/Workflow/SubjectEditPost.xml $ 
$Revision: 18 $ 
$Modtime: 2/02/04 5:35p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- SubjectEdit.xml
-
- DESCRIPTION
-	Add or edit a WorkflowSubject record.
-
- INPUT
-    action - "Save" or "Delete"
-
-    If action is Save:
-    wfrouteid - WorkflowRoute row id which owns this subject.
-    id - id to be added edited.
-    subject - subject to be added.  Must be non-empty.
-    body - body to be added.  May be empty.
-
-    If action is Delete:
-    id - id to be deleted.
-
- HISTORY 
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<body bgcolor="#FFFFFF">
<html>
<HEAD>
<PROPERTY.GET PARAM="xcelerate.domain" INIFILE="futuretense_xcel.ini" VARNAME="docDomain"/>
<IF COND="IsVariable.docDomain=true">
<THEN>
	<IF COND="Variables.docDomain!=Variables.empty">
	<THEN>
	    <SCRIPT LANGUAGE="JavaScript">
		document.domain = "<CSVAR NAME="Variables.docDomain"/>";
	    </SCRIPT>
	</THEN>
	</IF>
</THEN>
</IF>
</HEAD>
<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceladmin"/>
<if COND="Variables.errno=0">
	<then> 
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Util/ShowError" outstring="urlshowerror">
            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                          <satellite.argument name="error" value="AdminTimeoutError"/>
                                           </SATELLITE.LINK>
		<REPLACE STR="Variables.urlshowerror">
			<script LANGUAGE="JavaScript">
				parent.parent.location="Variables.urlshowerror";
			</script>
		</REPLACE>
		<throwexception/>
	</then>
</if>

<!--ul>
<IF COND="IsVariable.action=true"><THEN>
  <li/>action: <CSVAR NAME="Variables.action"/></THEN></IF>
<IF COND="IsVariable.ftcmd=true"><THEN>
  <li/>ftcmd: <CSVAR NAME="Variables.ftcmd"/></THEN></IF>
<IF COND="IsVariable.wfrouteid=true"><THEN>
  <li/>wfrouteid: <CSVAR NAME="Variables.wfrouteid"/> </THEN></IF>
<IF COND="IsVariable.id=true"><THEN>
  <li/>id: <CSVAR NAME="Variables.id"/>  </THEN></IF>
<IF COND="IsVariable.subject=true"><THEN>
  <li/>subject: <CSVAR NAME="Variables.subject"/>  </THEN></IF>
<IF COND="IsVariable.body=true"><THEN>
  <li/>body: <CSVAR NAME="Variables.body"/>  </THEN></IF>
</ul-->


<IF COND="Variables.action=Save">
  <THEN>
    <!--Disallow a blank subject-->
    <IF COND="IsVariable.subject=false">
      <THEN>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
	  <ARGUMENT NAME="error" VALUE="FieldRequired"/>
	</CALLELEMENT>
	<THROWEXCEPTION/>
      </THEN>
    </IF>
    <IF COND="Variables.subject=Variables.empty">
      <THEN>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
	  <ARGUMENT NAME="error" VALUE="FieldRequired"/>
	</CALLELEMENT>
	<THROWEXCEPTION/>
      </THEN>
    </IF>

    <!--Disallow long bodies
    <SUBSTRING STR="Variables.body" ENDINDEX="255" OUTSTR="shorter"/>
    <IF COND="Variables.shorter!=Variables.body">
      <THEN>
        <p><font face="Arial, Helvetica" size="2" color="#FF0000">
	Message body was too long.  
	It has been shortened for you to: 
	"<i><CSVAR NAME="Variables.shorter"/></i>".
	Back up your browser if you want to shorten it yourself some other way.
	</font></p>
	<SETVAR NAME="body" VALUE="Variables.shorter"/>
      </THEN>
    </IF>
    Code block breaks CS? (BP)-->

    <!--editrow or addrow (controlled by form element)-->
    <SETVAR NAME="errno" VALUE="0"/>
    <CATALOGMANAGER>
      <ARGUMENT NAME="tablename" VALUE="WorkflowSubject"/>
      <ARGUMENT NAME="tablekeyname" VALUE="id"/>
      <ARGUMENT NAME="tablekeyvalue" VALUE="Variables.id"/>
    </CATALOGMANAGER>

    <IF COND="Variables.errno=0">
      <THEN>
        <font face="Arial, Helvetica" size="2"><XLAT.STREAM KEY="dvin/Common/Done"/>.</font>
      </THEN>
      <ELSE>
        <CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
	  <ARGUMENT NAME="error" VALUE="UpdateFailed"/>
	</CALLELEMENT>
      </ELSE>
    </IF>
  </THEN>
</IF>


<IF COND="Variables.action=Delete">
  <THEN>
    <SETVAR NAME="errno" VALUE="0"/>
    <CATALOGMANAGER>
      <ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
      <ARGUMENT NAME="tablename" VALUE="WorkflowSubject"/>
      <ARGUMENT NAME="tablekeyname" VALUE="id"/>
      <ARGUMENT NAME="tablekeyvalue" VALUE="Variables.id"/>
    </CATALOGMANAGER>
    <IF COND="Variables.errno=0">
      <THEN>
        <font face="Arial, Helvetica" size="2"><XLAT.STREAM KEY="dvin/Common/Done"/>.</font>
      </THEN>
      <ELSE>
        <CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
	  <ARGUMENT NAME="error" VALUE="DeleteFailed"/>
	</CALLELEMENT>
      </ELSE>
    </IF>
  </THEN>
</IF>

</html>
</body>
</FTCS>
