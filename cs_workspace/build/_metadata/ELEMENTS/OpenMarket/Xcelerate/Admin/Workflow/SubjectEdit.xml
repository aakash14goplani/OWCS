<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
    <PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/Workflow/SubjectEdit.xml $ 
$Revision: 31 $ 
$Modtime: 2/03/04 2:43p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- SubjectEdit.xml
-
- DESCRIPTION
-	Add or edit a WorkflowSubject record.
-
- INPUT
-    action - "add" or "edit"
-
-    If action is add:
-    wfrouteid - WorkflowRoute row id which owns this subject.
-
-    If action is edit:
-    wfrouteid - WorkflowRoute row id which owns this subject.
-    id - this is the id to be edited.
-
- HISTORY 
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<html>
<HEAD>
<PROPERTY.GET PARAM="xcelerate.domain" INIFILE="futuretense_xcel.ini" VARNAME="docDomain"/>
<IF COND="IsVariable.docDomain=true">
<THEN>
	<IF COND="Variables.docDomain!=Variables.empty">
	<THEN>
	    <SCRIPT LANGUAGE="JavaScript">
		document.domain = "<CSVAR NAME="Variables.docDomain"/>";
	    </SCRIPT>
	</THEN>
	</IF>
</THEN>
</IF>
</HEAD>
<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceladmin"/>
<if COND="Variables.errno=0">
	<then> 
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Util/ShowError" outstring="urlshowerror">
            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                          <satellite.argument name="error" value="AdminTimeoutError"/>
                                           </SATELLITE.LINK>
		<REPLACE STR="Variables.urlshowerror">
			<script LANGUAGE="JavaScript">
				parent.parent.location="Variables.urlshowerror";
			</script>
		</REPLACE>
		<throwexception/>
	</then>
</if>
<body bgcolor="#FFFFFF">

<!--ul>
<IF COND="IsVariable.action=true"><THEN>
  <li/>action: <CSVAR NAME="Variables.action"/></THEN></IF>
<IF COND="IsVariable.wfrouteid=true"><THEN>
  <li/>wfrouteid: <CSVAR NAME="Variables.wfrouteid"/> </THEN></IF>
<IF COND="IsVariable.id=true"><THEN>
  <li/>id: <CSVAR NAME="Variables.id"/>  </THEN></IF>
</ul-->

<SETVAR NAME="subject" VALUE="Variables.empty"/>
<SETVAR NAME="body" VALUE="Variables.empty"/>

<SETVAR NAME="errno" VALUE="0"/>

<IF COND="Variables.action=edit">
  <THEN>
    <SELECTTO LIST="defsub" FROM="WorkflowSubject" WHERE="id"/>
    <IF COND="Variables.errno!=0">
      <THEN>
        <SETVAR NAME="action" VALUE="add"/>
        <SETVAR NAME="errno" VALUE="0"/>
      </THEN>
      <ELSE>
        <SETVAR NAME="subject" VALUE="defsub.subject"/>
        <SETVAR NAME="body" VALUE="defsub.body"/>
      </ELSE>
    </IF>
  </THEN>
</IF>
<IF COND="Variables.action=add">
  <THEN>
	<SETVAR NAME="id" VALUE="CS.UniqueID"/>
  </THEN>
</IF>

<SETVAR NAME="sid" VALUE="Variables.id"/>
<SETVAR NAME="id"  VALUE="Variables.wfrouteid"/>
<SETVAR NAME="tablename" VALUE="WorkflowRoutes"/>

<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
      <ARGUMENT NAME="error" VALUE="UnexpectedMissingKey"/>
      <ARGUMENT NAME="table" VALUE="WorkflowRoutes"/>
      <ARGUMENT NAME="key"   VALUE="Variables.id"/>
</CALLELEMENT>

<callelement NAME="OpenMarket/Xcelerate/Util/validateFields">
	<argument NAME="columnvalue" VALUE="Variables.wfrouteid"/>
	<argument NAME="type" VALUE="Long"/>
</callelement>

<IF COND="Variables.validatedstatus=true">
<THEN>
	<EXECSQL LIST="wfr" SQL="SELECT Workflow.workflow, WorkflowRoutes.workflowid, WorkflowRoutes.workflowroute FROM
						WorkflowRoutes, Workflow
						WHERE WorkflowRoutes.id='Variables.wfrouteid'
						AND Workflow.id=WorkflowRoutes.workflowid" TABLE="WorkflowRoutes,Workflow"/>
</THEN>
<ELSE>
	<SETVAR NAME="errno" VALUE="-10010"/>
</ELSE>
</IF>
<!--						
<SELECTTO LIST="wfr" FROM="WorkflowRoutes" WHERE="id" 
    WHAT="workflowid,workflowroute"/>
-->	
<IF COND="Variables.errno!=0">
  <THEN>
    <CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
      <ARGUMENT NAME="error" VALUE="UnexpectedMissingKey"/>
      <ARGUMENT NAME="table" VALUE="WorkflowRoutes"/>
      <ARGUMENT NAME="key"   VALUE="Variables.id"/>
    </CALLELEMENT>
    <THROWEXCEPTION/>
  </THEN>
</IF>
<SETVAR NAME="id"  VALUE="Variables.sid"/>
    <SATELLITE.FORM ASSEMBLER="query" METHOD="POST">
    <INPUT TYPE="HIDDEN" NAME="_charset_" VALUE="Variables.charset" REPLACEALL="Variables.charset"/>
    <INPUT TYPE="hidden"  NAME="cs_environment" VALUE="Variables.cs_environment" REPLACEALL="Variables.cs_environment"/>
    <INPUT TYPE="hidden"  NAME="cs_formmode" VALUE="Variables.cs_formmode" REPLACEALL="Variables.cs_formmode"/>
<INPUT
    NAME="pagename" 
    VALUE="OpenMarket/Xcelerate/Admin/Workflow/SubjectEditPost" 
    TYPE="HIDDEN"/>
  <INPUT NAME="wfrouteid" VALUE="Variables.wfrouteid" TYPE="hidden" REPLACEALL="Variables.wfrouteid"/>
  <INPUT NAME="id" VALUE="Variables.id" TYPE="hidden"  REPLACEALL="Variables.id"/>
<IF COND="Variables.action=edit">
  <THEN>
    <input name="ftcmd" value="editrow" type="hidden"/>
  </THEN>
  <ELSE>
    <input name="ftcmd" value="addrow" type="hidden"/>
  </ELSE>
</IF>
<table>
<tr>
  <td align="right" bgcolor="#336699"><font face="Arial, Helvetica" size="2" 
      color="#FFFFFF"><XLAT.STREAM KEY="dvin/Common/Process"/>:&nbsp;</font></td>
  <td bgcolor="#DFDFDF"><font face="Arial, Helvetica" size="2">&nbsp;<STRING.STREAM VALUE="wfr.workflow"/></font></td>
</tr>
<tr>
  <td align="right" bgcolor="#336699"><font face="Arial, Helvetica" size="2" 
      color="#FFFFFF"><XLAT.STREAM KEY="dvin/Common/Step"/>:&nbsp;</font></td>
  <td bgcolor="#DFDFDF"><font face="Arial, Helvetica" size="2">&nbsp;<STRING.STREAM VALUE="wfr.workflowroute"/></font></td>
</tr>
<tr>
  <td align="right" bgcolor="#336699"><font face="Arial, Helvetica" size="2" 
      color="#FFFFFF"><XLAT.STREAM KEY="dvin/AT/Common/ID"/>:&nbsp;</font></td>
  <td bgcolor="#DFDFDF"><font face="Arial, Helvetica" size="2">&nbsp;<STRING.STREAM VALUE="Variables.id"/></font></td>
</tr>
<tr>
  <td align="right" bgcolor="#336699"><font face="Arial, Helvetica" size="2" 
      color="#FFFFFF"><XLAT.STREAM KEY="dvin/Common/Subject"/>:&nbsp;</font></td>
  <SUBSTITUTE STR="Variables.subject" WHAT="&#34;" WITH="&#38;quot;" 
      OUTSTR="subject"/>
    <td bgcolor="#DFDFDF">&nbsp;<INPUT NAME="subject" 
        VALUE="Variables.subject" SIZE="32" MAXLENGTH="60" REPLACEALL="Variables.subject"/></td>
</tr>
<tr>
  <td align="right" bgcolor="#336699"><font face="Arial, Helvetica" size="2"
      color="#FFFFFF"><XLAT.STREAM KEY="dvin/UI/Admin/Body"/>:&nbsp;</font></td>
  <td bgcolor="#DFDFDF">&nbsp;<textarea name="body" rows="3" cols="50" wrap="yes"><STRING.STREAM VALUE="Variables.body"/></textarea></td>
</tr>
<tr>
  <td colspan="2"><input name="action" value="Save" type="SUBMIT"/>
  <IF COND="Variables.action=edit">
    <THEN>
      &nbsp;<input name="action" value="Delete" type="SUBMIT"/>
    </THEN>
  </IF>
  </td>
</tr>
</table>
</SATELLITE.FORM>

<PROPERTY.GET PARAM="xcelerate.workflowsubjectbodylen" INIFILE="futuretense_xcel.ini" VARNAME="propworkflowsubjectbodylen"/>
<if COND="Variables.propworkflowsubjectbodylen!=Variables.empty">
<then>
    <setvar NAME="workflowsubjectbodylen" VALUE="Variables.propworkflowsubjectbodylen"/>
</then>
<else>
    <setvar NAME="workflowsubjectbodylen" VALUE="255"/>    
</else>
</if>
<hr/>
<p><font face="Arial, Helvetica" size="2"><XLAT.STREAM KEY="dvin/UI/Admin/NoteBodylimitedtoworkflowsubjectbodylen"/></font></p>
</body>
</html>
</FTCS>
