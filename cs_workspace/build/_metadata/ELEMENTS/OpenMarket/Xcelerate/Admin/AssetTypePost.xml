<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/AssetTypePost.xml $

-->

<!--
 Confidential and Proprietary Information of Open Market, Inc.
					All Rights Reserved.

 AssetTypePost.xml

 DESCRIPTION
	Admin things about a AssetType
-->
<!-- HISTORY
  [2007-09-19 KGF]
 * XSS fixes (adapted from 6.3 fixes):
   * CSVAR -> STRING.STREAM
[2008-10-24 KGF #18520/3]
 * front/edit: Added new hidden field (at:couldbechild) to easily
   retrieve previous value of at:canbechild upon post
 * post/edit: Added sanity check in the case of changing canbechild
   from true to false - need to make sure that this asset type isn't
   already being used as a child somewhere, since changing this field
   to false makes this assumption and disables checks elsewhere!
-->



<!-- type is either front or post -->
<STRING.ENCODE VARIABLE="assettype" VARNAME="assettype"/>
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>

    <!-- process editing of stuff , pagetype="post", action="edit-->
   <if COND="Variables.action=edit">
    <then>
    	<ASSETTYPE.LOAD NAME="theAssetType" TYPE="Variables.assettype"/>
        <TABLE BGCOLOR="#FFFFFF" CELLSPACING="0" CELLPADDING="0">
            <TR>
                <TD BGCOLOR="#FFFFFF" COLSPAN="2">
                <h3>
                <XLAT.STREAM KEY="dvin/UI/Admin/AssetTypeassettype"/>
                </h3>
                </TD>
            </TR>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
            <TR>
                <TD BGCOLOR="#FFFFFF">
                <!--[KGF] Before gathering and saving, check if canbechild was changed T->F -->
                <ics.setvar NAME="oktosave" VALUE="T"/>
                <if COND="Variables.at:couldbechild=T"><then>
                    <if COND="Variables.at:canbechild=F"><then>
                        <!-- are assets of this type in a sane state for this change? -->
						<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
							<ARGUMENT NAME="columnvalue" VALUE="Variables.assettype"/>
							<ARGUMENT NAME="type" VALUE="String"/>
						</CALLELEMENT>
						<IF COND="Variables.validatedstatus=true">
						<THEN>
							<EXECSQL LIST="childlist" TABLE="AssetRelationTree"
							SQL="SELECT DISTINCT nparentid FROM AssetRelationTree WHERE nparentid!=0 AND otype='Variables.assettype'"/>
						</THEN>
						</IF>
                        <if COND="childlist.#numRows=0">
                        <then></then>
                        <else>
                            <!-- Not safe to set canbechild=F.
                                 list assets depending on assets of this type -->
                                <h3><XLAT.STREAM KEY="dvin/UI/Admin/Error/CannotsetCanBeaChildAssetFalse"/></h3>
                            <ics.setvar NAME="oktosave" VALUE="F"/>
                            <!-- limit number of displayed parents to prevent IN clause from growing out of control -->
                            <ICS.SETVAR NAME="nparentlimit" VALUE="100"/>
                            <ICS.SETVAR NAME="nparenttotal" VALUE="childlist.#numRows"/>
                            <ICS.SETVAR NAME="nparentidlist" VALUE=""/>
                            <!-- construct IN clause from nparentids collected from previous query, to get relevant info on referencing assets. -->
                            <LOOP LIST="childlist" COUNT="Variables.nparentlimit">
                                <ICS.LISTGET LISTNAME="childlist" FIELDNAME="nparentid" OUTPUT="npid"/>
                                <ICS.SETVAR NAME="nparentidlist" VALUE="Variables.nparentidlist,Variables.npid"/>
                            </LOOP>
                            <SUBSTRING STR="Variables.nparentidlist" OUTSTR="nparentidlist" INDEX="1"/>
							<SETVAR NAME="validatedstatus" VALUE="true" />
							<STRINGLIST NAME="stringnparentidlist" STR="Variables.nparentidlist" DELIM=","/>
							<LOOP LIST="stringnparentidlist">
								<IF COND="Variables.validatedstatus=true" >
									<THEN>
										<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
											<ARGUMENT NAME="columnvalue" VALUE="stringnparentidlist.ITEM"/>
											<ARGUMENT NAME="type" VALUE="Long"/>
										</CALLELEMENT>
									</THEN>
								</IF>
							</LOOP>
							<IF COND="Variables.validatedstatus=true">
							<THEN>
								<EXECSQL LIST="childlist" TABLE="AssetRelationTree"
								SQL="SELECT oid,otype FROM AssetRelationTree WHERE nid IN (Variables.nparentidlist) ORDER BY oid"/>
							</THEN>
							</IF>
                            
                            <!-- table structure adapted from DeleteFront -->
							<table cellpadding="0" cellspacing="0" border="0">
								<tr><td colspan="5"><span class="subtitle-text"><XLAT.STREAM KEY="dvin/UI/ReferencingAssets"/></span></td></tr>
								<tr><td colspan="5" height="10"><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr>
									<td colspan="5">
										<XLAT.STREAM KEY="dvin/UI/Admin/Error/ThefollowingrefsmustberemovedbeforeCBCFalse"/>
										<CALCULATOR.GO VALUE="Variables.nparenttotal Variables.nparentlimit GT" VARNAME="overlimit"/>
										<if COND="Variables.overlimit=1"><then>
											<ICS.SETVAR NAME="limit" VALUE="Variables.nparentlimit"/>
											<p><XLAT.STREAM KEY="dvin/UI/Publish/Mirror1ShowPublishedAssets-firstN"/></p>
										</then></if>
									</td>
								</tr>
								<tr><td colspan="5" height="10"><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="1" class="dark-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/AT/Common/Name"/></span></td>
									<td>&nbsp;&nbsp;&nbsp;</td>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/AT/Common/Description"/></span></td>
									<td>&nbsp;&nbsp;&nbsp;</td>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/Common/Type"/></span></td>
								</tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="1" class="dark-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

								<LOOP LIST="childlist">
									<ASSET.LOAD NAME="anAsset" TYPE="childlist.otype" OBJECTID="childlist.oid"/>
									<ASSET.GET NAME="anAsset" FIELD="name" OUTPUT="currname"/>
									<ASSET.GET NAME="anAsset" FIELD="description" OUTPUT="currdesc"/>
						 			<IF COND="Variables.currassettype!=childlist.otype">
										<THEN>
											<ASSET.GETASSETTYPE NAME="anAsset" OUTNAME="anAssetType"/>
											<ASSETTYPE.GET NAME="anAssetType" FIELD="description" OUTPUT="atdescription"/>
											<SETVAR NAME="currassettype" VALUE="childlist.otype"/>
										</THEN>
									</IF>
									<tr>
									<ASSET.SITES NAME="anAsset" LIST="isinPub" PUBID="SessionVariables.pubid"/>
									<if COND="IsError.Variables.errno=false">
									<then>
										<td>
											<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="_XLAT_" ESCAPE="true"/>
											<!--I can't use scoped=local for this callelement because it writes a variable back,
											    but I also need to preserve assettype for later, so I'm doing it manually.-->
											<ICS.SETVAR NAME="oldassettype" VALUE="Variables.assettype"/>
						 					<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
												<ARGUMENT NAME="assettype" VALUE="Variables.currassettype"/>
												<ARGUMENT NAME="assetid" VALUE="childlist.oid"/>
												<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
												<ARGUMENT NAME="function" VALUE="inspect"/>
											</CALLELEMENT>
											<ICS.SETVAR NAME="assettype" VALUE="Variables.oldassettype"/>
											<A HREF="Variables.urlInspectItem" OnMouseOver="window.status='Variables._XLAT_'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables._XLAT_">
										    		<STRING.STREAM VARIABLE="currname"/>
						    					</A>
						    				</td>
						    				<td></td>
										<td>
											<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="_XLAT_" ESCAPE="true"/>
											<A HREF="Variables.urlInspectItem" OnMouseOver="window.status='Variables._XLAT_'; return true" OnMouseOut="return window.status='';"  REPLACEALL="Variables.urlInspectItem,Variables._XLAT_">
												<STRING.STREAM VARIABLE="currdesc"/>
											</A>
										</td>
						    				<td></td>
									</then>
									<else>
										<ASSET.SITES NAME="anAsset" LIST="sites"/>
										<td colspan="3">
											<XLAT.STREAM KEY="dvin/UI/ReferencingAssetinAnotherSite"/>
											(<setvar NAME="needComma" VALUE="false"/>
											<LOOP LIST="sites">
												<if COND="Variables.needComma=true">
												<then>,
												</then>
												</if>
												<STRING.STREAM LIST="sites" COLUMN="description"/>
												<setvar NAME="needComma" VALUE="true"/>
											</LOOP>)
										</td><td></td>
									</else>
									</if>
									<td><STRING.STREAM VARIABLE="atdescription"/></td>
									</tr>
								</LOOP>
								<tr><td colspan="5" height="15"><img height="15" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							</table>
							<br />
							<!-- end of adaptation from DeleteFront -->
                        </else></if>
                        
                        <!-- are there any named assocs of this asset type? -->
						<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
							<ARGUMENT NAME="columnvalue" VALUE="Variables.assettype"/>
							<ARGUMENT NAME="type" VALUE="String"/>
						</CALLELEMENT>
						<IF COND="Variables.validatedstatus=true">
						<THEN>
							<EXECSQL LIST="childlist" TABLE="AssocNamed"
							SQL="SELECT id, name, description, assettype FROM AssocNamed WHERE childassettype='Variables.assettype' ORDER BY name"/>
						</THEN>
						</IF>
                        <if COND="childlist.#numRows=0">
                        <then></then>
                        <else>
                            <!-- Not safe to set canbechild=F.
                                 list asset types with named associations of this type -->
                            <if COND="Variables.oktosave=T"><then>
                                <h3><XLAT.STREAM KEY="dvin/UI/Admin/Error/CannotsetCanBeaChildAssetFalse"/></h3>
                            </then></if>
                            <ics.setvar NAME="oktosave" VALUE="F"/>
                            <!-- table structure adapted from DeleteFront -->
							<table cellpadding="0" cellspacing="0" border="0">
								<tr><td colspan="5"><span class="subtitle-text"><XLAT.STREAM KEY="dvin/UI/Admin/Associations"/></span></td></tr>
								<tr><td colspan="5" height="10"><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr>
									<td colspan="5">
										<XLAT.STREAM KEY="dvin/UI/Admin/Error/ThefollowingassocmustberemovedbeforeCBCFalse"/>
									</td>
								</tr>
								<tr><td colspan="5" height="10"><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="1" class="dark-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/AT/Common/Name"/></span></td>
									<td>&nbsp;&nbsp;&nbsp;</td>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/AT/Common/Description"/></span></td>
									<td>&nbsp;&nbsp;&nbsp;</td>
									<td><span class="table-header-text"><XLAT.STREAM KEY="dvin/Common/AT/ForAssetType"/></span></td>
								</tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="1" class="dark-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td colspan="5" height="5"><img height="5" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

								<LOOP LIST="childlist">
						 			<IF COND="Variables.currassettype!=childlist.assettype">
										<THEN>
											<ASSETTYPE.LOAD NAME="anAssetType" TYPE="childlist.assettype"/>
											<ASSETTYPE.GET NAME="anAssetType" FIELD="description" OUTPUT="atdescription"/>
											<SETVAR NAME="currassettype" VALUE="childlist.assettype"/>
										</THEN>
									</IF>

									<tr>
										<td>
											<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="_XLAT_" ESCAPE="true"/>
											<SATELLITE.LINK ASSEMBLER="query" PAGENAME="OpenMarket/Xcelerate/Admin/AssociationFront" OUTSTRING="urlInspectItem">
												<SATELLITE.ARGUMENT NAME="cs_environment" VALUE="Variables.cs_environment"/>
												<SATELLITE.ARGUMENT NAME="cs_formmode" VALUE="Variables.cs_formmode"/>
												<SATELLITE.ARGUMENT NAME="id" VALUE="childlist.id"/>
												<SATELLITE.ARGUMENT NAME="action" VALUE="details"/>
											</SATELLITE.LINK>
											<A HREF="Variables.urlInspectItem" OnMouseOver="window.status='Variables._XLAT_'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables._XLAT_">
										    		<STRING.STREAM VALUE="childlist.name"/>
						    					</A>
						    				</td>
						    				<td></td>
										<td>
											<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="_XLAT_" ESCAPE="true"/>
											<A HREF="Variables.urlInspectItem" OnMouseOver="window.status='Variables._XLAT_'; return true" OnMouseOut="return window.status='';"  REPLACEALL="Variables.urlInspectItem,Variables._XLAT_">
												<STRING.STREAM VALUE="childlist.description"/>
											</A>
										</td>
						    			<td></td>
									<td><STRING.STREAM VARIABLE="atdescription"/></td>
									</tr>
								</LOOP>
								<tr><td colspan="5" height="15"><img height="15" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							</table>
							<br/>
							<!-- end of adaptation from DeleteFront -->
                        </else></if>
                    </then></if>
                </then></if> <!-- (end if for canbechild changing T->F) -->
                <if COND="Variables.oktosave=T"><then>
                    <ASSETTYPE.GATHER NAME="theAssetType" PREFIX="at"/>
                    <ASSETTYPE.SAVE NAME="theAssetType"/>
                    <if COND="Variables.errno!=0">
                    <then>
                        <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                            <argument NAME="error" VALUE="UpdateFailed"/>
                        </callelement>
                    </then>
                    </if>
                </then></if>
                <!--[KGF] Not sure why we weren't always showing this...-->
                <callelement NAME="OpenMarket/Xcelerate/Admin/AssetTypeFront">
                    <argument NAME="assettype" VALUE="Variables.assettype"/>
                    <argument NAME="action" VALUE="details"/>
                    <argument NAME="showtitle" VALUE="false"/>
                </callelement>
                </TD>
            </TR>
        </TABLE>
    </then>
    </if>

    <!-- process deletion of stuff,  pagetype="post", action="delete" -->
    <if COND="Variables.action=delete">
    <then>
     	<ASSETTYPE.LOAD NAME="theAssetType" TYPE="Variables.assettype"/>
     	<ASSET.GetAssetTypeProperties TYPE="Variables.assettype"/>
      <TABLE BGCOLOR="#FFFFFF" CELLSPACING="0" CELLPADDING="0" class="width-inner-100">
            <TR>
                <TD BGCOLOR="#FFFFFF">
		<!-- The variable posted in selected by the radio button is deleteRelated, with values of true (for everything), or false (for just the assets
			plus the table).  Hopefully, the code here will still work, and I've guessed Sarah's original intent -->
		<IF COND="Variables.deleteRelated=false">
		<THEN>
			<CALLELEMENT NAME="OpenMarket/AssetMaker/ShowDescriptionPost">
				<ARGUMENT NAME="AssetAction" VALUE="DeleteAsset"/>
			</CALLELEMENT> 
		</THEN>
		<ELSE>
			<!-- Attempt to	delete any categories for the asset type (don't check	error because it returns -105) -->
			<CATALOGMANAGER>
				<ARGUMENT NAME="tablename" VALUE="Category"/>
				<ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
				<ARGUMENT NAME="tablekey" VALUE="assettype"/>
				<ARGUMENT NAME="tablekeyvalue" VALUE="Variables.assettype"/>
			</CATALOGMANAGER>

			<!-- Delete the asset type -->
			<ASSET.DELETEASSETTYPE TYPE="Variables.assettype"/>
			<if COND="Variables.errno!=0">
			<then>
				<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
					<argument NAME="error" VALUE="DeleteFailed"/>
				</callelement>
			</then>
			<else>
				<XLAT.LOOKUP KEY="dvin/UI/Deletesuccessful" VARNAME="msgtext"/>
				<div class="width-outer-70">
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					<ARGUMENT NAME="msgtext" VALUE="Variables.msgtext"/>
					<ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
				</div>
				<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
				<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
				<then>
					<IF COND="Variables.IsProxyAssetType=true">
						<THEN>
							<setvar NAME="refreshKeys" VALUE="Self:AssetTypes;Self:ProxyAssetMaker"/>
						</THEN>
						<ELSE>
							<setvar NAME="refreshKeys" VALUE="Self:AssetTypes;Self:AssetMaker;Self:FamilyMaker"/>
						</ELSE>
					</IF>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
						<argument NAME="__TreeRefreshKeys__" VALUE="Variables.refreshKeys"/>
					</callelement>
					<REMOVEVAR NAME="refreshKeys" />
				</then>
				</if>
				
				<!-- Delete the elements created for this asset type -->
				<callelement NAME="OpenMarket/Xcelerate/Actions/AssetTypePostDeleteCleanup">
					<argument NAME="assettype" VALUE="Variables.assettype"/>
				</callelement>
				
			</else>
			</if>
		</ELSE>
		</IF>
                </TD>
            </TR>
        </TABLE>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/AssetTypeFront">
			<ARGUMENT NAME="action" VALUE="list"/>
			<ARGUMENT NAME="showtitle" VALUE="false"/>
		</CALLELEMENT> 
		       
   </then>
    </if>

    <!-- process addition of stuff pagetype="post", action="new"  -->
    <if COND="Variables.action=new">
    <then>
    	<ASSETTYPE.CREATE NAME="theAssetType"/>
    	<if COND="Variables.errno!=0">
    	<then>
         <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
            <argument NAME="error" VALUE="EnterFailed"/>
        </callelement>
        <throwexception/>
     </then>
      </if>

      	<TABLE BGCOLOR="#FFFFFF" CELLSPACING="0" CELLPADDING="0">
            <TR>
                <TD BGCOLOR="#FFFFFF" COLSPAN="2">
                <FONT FACE="Arial, Helvetica" SIZE="2">
                <h3>
                <XLAT.STREAM KEY="dvin/UI/Admin/AddNewAssetType"/>
                </h3>
                </FONT>
                </TD>
            </TR>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
             <if COND="IsVariable.at:assettype!=true">
             <then>
                 <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                     <argument NAME="error" VALUE="NoContentCategory"/>
                 </callelement>
                 <throwexception/>
             </then>
             </if>
            <TR>
                <TD BGCOLOR="#FFFFFF">
                <FONT FACE="Arial, Helvetica" SIZE="2">
                <!-- insert the specified information
                    into the table. Report any errors.
                    Refresh the navigation -->
                <ASSETTYPE.GATHER NAME="theAssetType" PREFIX="at"/>
             	<ASSETTYPE.SAVE NAME="theAssetType"/>

                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="EnterFailed"/>
                    </callelement>
                </then>
                <else>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/AssetTypeFront">
                        <argument NAME="assettype" VALUE="Variables.assettype"/>
                        <argument NAME="action" VALUE="details"/>
                        <argument NAME="showtitle" VALUE="false"/>
                    </callelement>
                    <XLAT.STREAM KEY="dvin/UI/Admin/NewAssettypeadded"/> <br/>
			  <XLAT.STREAM KEY="dvin/UI/Admin/ensurealltblformtpldefinedregistered"/>
                    <P></P>
                    <XLAT.STREAM KEY="dvin/UI/Admin/PleasereferXcelCustGuidefordetails"/>
                </else>
                </if>
                </FONT>
                </TD>
            </TR>
        </TABLE>
    </then>
    </if>

   <!-- process install of asset pagetype="post", action="install"  -->
    <if COND="Variables.action=install">
    <then>
    	<LOGMSG STR="installing...."/>
    	<if COND="IsVariable.uploadDir=true">
    		<then>
     			<ASSET.INSTALL TYPE="Variables.assettype" CLASS="Variables.class" DIR="Variables.uploadDir"/>
     		</then>
     		<else>
 		    	<ASSET.INSTALL TYPE="Variables.assettype" CLASS="Variables.class"/>
			</else>
		</if>
       <if COND="Variables.errno!=0">
       <then>
           <XLAT.STREAM KEY="dvin/UI/Admin/Installassettypefailederrno" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false" ENCODE="false"/>
       </then>
       <else>
           <callelement NAME="OpenMarket/Xcelerate/Admin/AssetTypeFront">
               <argument NAME="assettype" VALUE="Variables.assettype"/>
               <argument NAME="action" VALUE="details"/>
               <argument NAME="showtitle" VALUE="false"/>
           </callelement>
            <XLAT.STREAM KEY="dvin/UI/Admin/InstallassettypesucceededFields"/>:<BR/>
		  		<catalogdef LIST="tbldef" FROM="Variables.assettype"/>
            <if COND="Variables.errno=0">
            <then>
		 			<FONT SIZE="-1">
		 			<loop LIST="tbldef">
		 				 <STRING.STREAM VALUE="tbldef.COLNAME"/> <BR/>

		 			</loop>
		 			</FONT>
		 		</then>
		 		</if>
		 	</else>
		 </if>

    </then>
    </if>
   <!-- process de-install of asset pagetype="post", action="deinstall"  -->
    <if COND="Variables.action=deinstall">
    <then>
    	<LOGMSG STR="de-installing...."/>
     	<ASSET.DEINSTALL TYPE="Variables.assettype"/>
       <if COND="Variables.errno!=0">
       <then>
           <XLAT.STREAM KEY="dvin/UI/Admin/Deinstallassettypefailederrno" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false"/>
       </then>
       <else>
            <XLAT.STREAM KEY="dvin/UI/Admin/Deinstallassettypesucceeded"/>
       </else>
       </if>
   </then>
    </if>
	<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
	<if COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
				<argument NAME="__TreeRefreshKeys__" VALUE="Self:AssetTypes"/>
			</callelement>
		</then>
	</if>

</FTCS>
