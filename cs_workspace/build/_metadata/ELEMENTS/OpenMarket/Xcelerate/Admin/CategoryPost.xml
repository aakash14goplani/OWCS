<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/CategoryPost.xml $ 

-->

<!--
 Confidential and Proprietary Information of FutureTense Inc.
					All Rights Reserved.

 Category.xml

 DESCRIPTION
	Admin things about a category

 HISTORY 
-->

<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<STRING.ENCODE VARIABLE="assettype" VARNAME="assettype"/>
<SETVAR NAME="redo" VALUE="false"/>
    <!-- process editing of stuff -->
    <if COND="Variables.action=edit">
    <then>
    		<if COND="Variables.origcategory!=Variables.category">
    		<then>
	            <SELECTTO LIST="AlreadyExists" WHAT="*" WHERE="assettype,category" FROM="Category"/>
    	        <if COND="Variables.errno!=-101">
        	    <then>
            	    	<SETVAR NAME="redo" VALUE="true"/>
				</then>
				</if>
			</then>
			</if>
			<if COND="Variables.redo=false">
			<then>
                <setvar NAME="errno" VALUE="0"/>
                <CATALOGMANAGER>
                    <ARGUMENT NAME="tablename" VALUE="Category"/>
                    <ARGUMENT NAME="id" VALUE="Variables.id"/>
                    <ARGUMENT NAME="assettype" VALUE="Variables.assettype"/>
                    <ARGUMENT NAME="description" VALUE="Variables.description"/>
                    <ARGUMENT NAME="category" VALUE="Variables.category"/>
                    <ARGUMENT NAME="ftcmd" VALUE="updaterow"/>
                </CATALOGMANAGER>
                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="UpdateFailed"/>
                    </callelement>            
                </then>
                <else>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/CategoryFront">
                        <argument NAME="category" VALUE="Variables.category"/>
                        <argument NAME="action" VALUE="details"/>
                        <argument NAME="showheader" VALUE="true"/>
                    </callelement>
                </else>
                </if>
			</then>
			</if>
    </then>
    </if>

    <!-- process deletion of stuff -->
    <if COND="Variables.action=delete">
    <then>

                <setvar NAME="errno" VALUE="0"/>
                <CATALOGMANAGER>
                    <ARGUMENT NAME="tablename" VALUE="Category"/>
                    <ARGUMENT NAME="id" VALUE="Variables.id"/>
                    <ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
                </CATALOGMANAGER>
                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="DeleteFailed"/>
                    </callelement>            
                </then>
                <else>
                    <XLAT.STREAM KEY="dvin/UI/Deletesuccessful"/><BR/>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/CategoryFront">
                        <argument NAME="action" VALUE="list"/>
                        <argument NAME="showheader" VALUE="true"/>
                    </callelement>
                </else>
                </if>
    </then>
    </if>

    <!-- process addition of stuff -->
    <if COND="Variables.action=new">
    <then>

                <if COND="IsVariable.category!=true">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="NoCategory"/>
                    </callelement>            
                    <throwexception/>
                </then>
                </if>
                <SELECTTO LIST="AlreadyExists" WHAT="*" WHERE="assettype,category" FROM="Category"/>
                <if COND="Variables.errno!=-101">
                <then>
                	<SETVAR NAME="redo" VALUE="true"/>
               	
                </then>
                <else>
	                <!-- insert the specified information
	                    into the table. Report any errors.
	                    Refresh the navigation -->
						<SETVAR NAME="id" VALUE="CS.UniqueID"/>
	                <setvar NAME="errno" VALUE="0"/>
	                <CATALOGMANAGER>
	                    <ARGUMENT NAME="tablename" VALUE="Category"/>
	                    <ARGUMENT NAME="id" VALUE="Variables.id"/>
	                    <ARGUMENT NAME="assettype" VALUE="Variables.assettype"/>
	                    <ARGUMENT NAME="description" VALUE="Variables.description"/>
	                    <ARGUMENT NAME="category" VALUE="Variables.category"/>
	                    <ARGUMENT NAME="ftcmd" VALUE="addrow"/>
	                </CATALOGMANAGER>
	                <if COND="Variables.errno!=0">
	                <then>
	                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
	                        <argument NAME="error" VALUE="EnterFailed"/>
	                    </callelement>            
	                </then>
	                <else>
	                    <callelement NAME="OpenMarket/Xcelerate/Admin/CategoryFront">
	                        <argument NAME="category" VALUE="Variables.category"/>
	                        <argument NAME="action" VALUE="details"/>
	                        <argument NAME="showheader" VALUE="true"/>
	                    </callelement>
	                </else>
	                </if>
	            </else>
	            </if>
    </then>
    </if>
	<IF COND="Variables.redo=true">
	<THEN>
	<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<IF COND="Variables.action=new">
			<THEN><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/AddNewCategory"/></span></THEN>
			<ELSE><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/EditCategory"/>: <STRING.STREAM VALUE="Variables.description"/></span></ELSE>
		</IF>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>
	<div class="width-outer-70">
    	<XLAT.LOOKUP KEY="dvin/UI/Admin/Error/CategoryAlreadyExistsForThisAssetType" VARNAME="_msgtxt_"/>
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<argument NAME="msgtext" VALUE="Variables._msgtxt_"/>
			<argument NAME="severity" VALUE="error"/>
		</callelement>  
     </div>   
    <table class="width-outer-30" BORDER="0" CELLSPACING="0" CELLPADDING="0">
	<tr><td>
		<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/AT/Common/Description"/>:
				</td>
				<td class="form-inset">
					<STRING.ENCODE VARIABLE="description" VARNAME="description"/>
                    <INPUT TYPE="TEXT" SIZE="32" MAXLENGTH="64" NAME="description" VALUE="Variables.description" REPLACEALL="Variables.description"/>
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/CategoryCode"/>:
				</td>
				<td class="form-inset">
				<STRING.ENCODE VARIABLE="category" VARNAME="category"/>
                    <INPUT TYPE="TEXT" SIZE="4" MAXLENGTH="4" NAME="category" VALUE="Variables.category" REPLACEALL="Variables.category"/>
					<if COND="Variables.action=edit"><then>	<STRING.ENCODE VARIABLE="origcategory" VARNAME="origcategory"/><INPUT TYPE="HIDDEN" NAME="origcategory" VALUE="Variables.origcategory" REPLACEALL="Variables.origcategory"/> </then></if>
                    <SCRIPT>document.forms[0].category.select();</SCRIPT>
				</td>
			</tr>			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>			
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/AssetType"/>:
				</td>
				<td class="form-inset">
                    <INPUT TYPE="HIDDEN" NAME="assettype" VALUE="Variables.assettype" REPLACEALL="Variables.assettype"/>
					<STRING.STREAM VALUE="Variables.at:description"/>
				</td><td><BR /></td>
			</tr>
		</table>
			</td></tr>
		</table>    

		<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/CategoryPost"/>                
		<XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_status_" ESCAPE="true"/>

        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/CategoryFront" outstring="CategoryFrontURL">
            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="list"/>
                                                         <satellite.argument name="assettype" value="Variables.assettype"/>
                                                          </SATELLITE.LINK>
		<div class="width-outer-70">
			<A HREF="Variables.CategoryFrontURL" onmouseover="window.status='Variables._status_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._status_,Variables.CategoryFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
			<XLAT.LOOKUP KEY="dvin/UI/SaveCategory" VARNAME="_XLAT_" ESCAPE="true"/>
			<IF COND="Variables.action=new">
			<THEN>
				<INPUT TYPE="HIDDEN" NAME="action" VALUE="new"/>
				<SETVAR NAME="buttonname" VALUE="AddNewCategory"/>
			</THEN>
			</IF>
			<IF COND="Variables.action=edit">
			<THEN>
				<INPUT TYPE="HIDDEN" NAME="action" VALUE="edit"/>
				<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
				<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
				<SETVAR NAME="buttonname" VALUE="Save"/>
			</THEN>
			</IF>
			<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Variables.buttonname"/></CALLELEMENT></A>
		</div>
	</THEN>
	</IF>
	<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
	<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
	<then>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
			<argument NAME="__TreeRefreshKeys__" VALUE="Self:Variables.assettype_Category"/>
		</callelement>		
	</then>
	</if>
	 
  
</FTCS>
