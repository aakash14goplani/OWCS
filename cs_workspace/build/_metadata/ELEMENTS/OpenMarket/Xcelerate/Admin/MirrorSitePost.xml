<?xml version="1.0" ?>
<!DOCTYPE ftcs SYSTEM "futuretense_cs.dtd">
<ftcs version="1.2">
<!-- OpenMarket/Xcelerate/Admin/MirrorSitePost
-
- INPUT
-	Variables.pagetype - front or post
-  Variables.pubid - site id
-  Variables. target - pubtarget id
- OUTPUT
-
-->

<!-- get the publication name -->
<PUBLICATION.LOAD NAME="publication" OBJECTID="Variables.pubid"/>
<PUBLICATION.GET NAME="publication" FIELD="name" OUTPUT="pubname"/>
<!-- get the target name -->
<PUBTARGETMANAGER.LOAD OBJVARNAME="pubtgt" ID="Variables.target"/>
<PUBTARGET.GETNAME NAME="pubtgt" VARNAME="pubtgt:name"/>




<!-- post page -->

    <setvar NAME="doproceed" VALUE="true"/>
	<PUBSESSIONMANAGER.CREATE TARGET="Variables.target" USER="SessionVariables.username" VARNAME="pubsess:id"/>
	<div class="width-outer-70">
	<if COND="IsError.Variables.errno=true">
	<then>
		<if COND="Variables.errno=-12034">
		<then>
	 		<XLAT.LOOKUP KEY="dvin/UI/publishisrunning" VARNAME="msgtext"/>
	 	</then>
	 	<else>
		 	<XLAT.LOOKUP KEY="dvin/UI/Admin/Error/notcreatepublishingsessionerrno" errno="Variables.errno" EVALALL="false" VARNAME="msgtext"/>
		</else>
		</if>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		    <ARGUMENT NAME="severity" VALUE="error"/>
		</CALLELEMENT>            
		<setvar NAME="doproceed" VALUE="false"/>            
	</then>
	<else>
		<PUBSESSIONMANAGER.LOAD ID="Variables.pubsess:id" OBJVARNAME="pubsess"/>
		<PROPERTY.GET PARAM="xcelerate.remotecall" INIFILE="futuretense_xcel.ini" VARNAME="propremotecall"/>
		<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
		<if COND="IsError.Variables.errno=true">
		<then>
	    	<XLAT.LOOKUP KEY="dvin/UI/Admin/Error/notcreatemirrorqueueerrno" errno="Variables.errno" EVALALL="false" VARNAME="msgtext"/>
			<if COND="IsVariable.errdetail1=true">
			<then>
				<SETVAR NAME="msgtext" VALUE="Variables.msgtext Variables.errdetail1"/>
				<SETVAR NAME="errdetail1" VALUE="Variables.empty"/>
			</then>
			</if>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			    <ARGUMENT NAME="severity" VALUE="error"/>
			</CALLELEMENT>            
	 		<setvar NAME="doproceed" VALUE="false"/>            
			<PUBSESSIONMANAGER.LOGMESSAGE ID="Variables.pubsess:id" VALUE="Variables.msgtext"/>
			<PUBSESSIONMANAGER.FAIL ID="Variables.pubsess:id"/>
		</then>
		</if>
	</else>
	</if>
	
	
	<!-- Mirror configuration items -->
	<if COND="Variables.doproceed=true">
	<then>
		<!-- Make sure that the publication, siteplantree and publicationtree at least exists on the target -->
        <if COND="Variables.cs_ExcludeSite!=true">
        <then>
    		<MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="Publication" FIELD1="id" VALUE1="Variables.pubid"/>
    		<MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="PublicationTree" FIELD1="oid" VALUE1="Variables.pubid"/>
    		<MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="Publication_Replicate" FIELD1="cs_ownerid" VALUE1="Variables.pubid"/>
            <XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredPublication" VARNAME="msgtext"/>
            <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
                <ARGUMENT NAME="severity" VALUE="info"/>
            </CALLELEMENT>
            <!--Trigger AddSite event on target which in turn updates the site entries for shared templates on target-->
            <MIRRORQUEUE.REMOTEEXECUTE NAME="pubMirrorQ" REMOTEMETHOD="AddSiteEventRemoteElement" pubname="Variables.pubname"/>
        </then>
        </if>
        <if COND="Variables.cs_ExcludePlan!=true">
        <then>
            <MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="SitePlanTree" FIELD1="oid" VALUE1="Variables.pubid"/>
            <XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredSitePlan" VARNAME="msgtext"/>
            <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
                <ARGUMENT NAME="severity" VALUE="info"/>
            </CALLELEMENT>
        </then>
        </if>
        <STREAM.FLUSH/>
		<!-- Asset Types -->        
        <if COND="IsVariable.assettypes=true">
		<then>
            <SUBSTITUTE STR="Variables.assettypes" WHAT=";" WITH="," OUTSTR="assettypes"/>
			<ASSETTYPE.PublishAssetTypes ASSETTYPES="Variables.assettypes" MIRRORQUEUE="pubMirrorQ" PUBID="Variables.pubid"/>
			<IF COND="IsError.Variables.errno=false">
			<THEN>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredAssets" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</THEN>
			<ELSE>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringAssets" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
			</ELSE>
			</IF>					
        <STREAM.FLUSH/>
			
			<STRINGLIST STR="Variables.assettypes" DELIM="," NAME="assettypes"/>
			<!-- Asset subtypes -->
			<if COND="IsVariable.assetsubtypes=true">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETVAR NAME="subtypeids" VALUE="Variables.empty"/>
				<LOOP LIST="assettypes">
					<SUBTYPES.GETSUBTYPES LISTVARNAME="subtypes" ASSETTYPE="assettypes.ITEM" PUBID="Variables.pubid"/>
	     			<if COND="subtypes.#numRows!=0">
	     			<then>
	     				<LOOP LIST="subtypes">
	     					<if COND="Variables.subtypeids=Variables.empty">
	     					<then>
	     						<setvar NAME="subtypeids" VALUE="subtypes.id"/>
	     					</then>
	     					<else>
	     						<setvar NAME="subtypeids" VALUE="Variables.subtypeids,subtypes.id"/>
	     					</else>
	     					</if>
	     					<INCCOUNTER NAME="num" VALUE="1"/>
			     		</LOOP>
			     	</then>
			     	</if>
			   </LOOP>
	     		<if COND="Variables.subtypeids!=Variables.empty">
	     		<then>
					<SUBTYPES.PUBLISH VALUE="Variables.subtypeids" MIRRORQUEUE="pubMirrorQ"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<setvar NAME="num" VALUE="Counters.num"/>
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredAssetSubtypes" VARNAME="msgtext"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="info"/>
						</CALLELEMENT>
					</then>
					<else>          
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringAssetSubtypes" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="error"/>
						</CALLELEMENT>
						<!-- if there is an error, mirrorqueue may be closed -->
						<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
						<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
						<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
					</else>
					</if>
	     		</then>
	     		</if>
        	<STREAM.FLUSH/>
			</then>
			</if>
			
			<!-- named associations of asset types -->
			<if COND="Variables.doproceed=true">
			<then>
				<setvar NAME="namedassociations" VALUE="Variables.empty"/>
				<if COND="IsVariable.assetassociations=true">
				<then>
					<SETCOUNTER NAME="num" VALUE="0"/>
					<LOOP LIST="assettypes">
						<ASSOCNAMEDMANAGER.FIND TYPE="assettypes.ITEM" PREFIX="assoc:"/>
						<if COND="Variables.assoc:Total!=0">
						<then>
							<SETCOUNTER NAME="nth" VALUE="0"/>
							<LOOP COUNT="Variables.assoc:Total">
								<ASSOCNAMED.GETID NAME="assoc:Counters.nth" VARNAME="assoc:id"/>
								<if COND="Variables.namedassociations=Variables.empty">
								<then>
									<setvar NAME="namedassociations" VALUE="Variables.assoc:id"/>
								</then>
								<else>
									<setvar NAME="namedassociations" VALUE="Variables.namedassociations,Variables.assoc:id"/>
								</else>
								</if>
								<INCCOUNTER NAME="num" VALUE="1"/>
								<INCCOUNTER NAME="nth" VALUE="1"/>
							</LOOP>
						</then>
						</if>
					</LOOP>
					<if COND="Variables.namedassociations!=Variables.empty">
					<then> 
						<ASSOCNAMEDMANAGER.PUBLISH VALUE="Variables.namedassociations" MIRRORQUEUE="pubMirrorQ"/>
						<if COND="IsError.Variables.errno=false">
						<then>
							<setvar NAME="num" VALUE="Counters.num"/>
							<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredAssociationItems" VARNAME="msgtext"/>
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
							    <ARGUMENT NAME="severity" VALUE="info"/>
							</CALLELEMENT>
						</then>
						<else>          
							<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringAssociationItems" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
							    <ARGUMENT NAME="severity" VALUE="error"/>
							</CALLELEMENT>
							<!-- if there is an error, mirrorqueue may be closed -->
							<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
							<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
							<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
						</else>
						</if>
					</then>
					</if>
        			<STREAM.FLUSH/>
				</then>
				</if>
			</then>
			</if>
			
			<!-- categories used by asset types -->
			<if COND="IsVariable.categories=true">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<LOOP LIST="assettypes">
					<setvar NAME="errno" VALUE="0"/>
					<setvar NAME="assettype" VALUE="assettypes.ITEM"/>
		   		<SELECTTO LIST="assetCategories" FROM="Category" WHAT="*" WHERE="assettype"/>
					<if COND="assetCategories.#numRows!=0">
					<then>
			     		<LOOP LIST="assetCategories">
				 			<MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="Category" FIELD1="id" VALUE1="assetCategories.id"/>
							<INCCOUNTER NAME="num" VALUE="1"/>
						</LOOP>
					</then>
					<else>
						<ICS.CLEARERRNO/>
					</else>						
					</if>
				</LOOP>
				<if COND="IsError.Variables.errno=false">
				<then>
					<if COND="Counters.num!=0">
					<then>
						<setvar NAME="num" VALUE="Counters.num"/>
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredCategories" VARNAME="msgtext"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="info"/>
						</CALLELEMENT>
					</then>
					</if>
				</then>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
			<!-- CS-Desktop configuration -->
			<if COND="IsVariable.cs-desktop=true">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<setvar NAME="desktopids" VALUE="Variables.empty"/>
				<LOOP LIST="assettypes">
					<EXTERNALCLIENTSMANAGER.LOADFROMFIELDS OBJVARNAME="myObj"
						SITE="Variables.pubid" ASSETTYPE="assettypes.ITEM"
						CLIENTAPP="MSWord"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<EXTERNALCLIENTSITEM.GETID NAME="myObj" VARNAME="itemid"/>
						<if COND="Variables.desktopids=Variables.empty">
						<then>
							<setvar NAME="desktopids" VALUE="Variables.itemid"/>
						</then>
						<else>
							<setvar NAME="desktopids" VALUE="Variables.desktopids,Variables.itemid"/>
						</else>
						</if>
		     			<INCCOUNTER NAME="num" VALUE="1"/>
					</then>
					</if>
				</LOOP>
	     		<if COND="Variables.desktopids!=Variables.empty">
	     		<then>
					<EXTERNALCLIENTSMANAGER.PUBLISH VALUE="Variables.desktopids" MIRRORQUEUE="pubMirrorQ"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<setvar NAME="num" VALUE="Counters.num"/>
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredCSDesktopConfig" VARNAME="msgtext"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="info"/>
						</CALLELEMENT>
					</then>
					<else>          
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringCSDesktopConfig" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="error"/>
						</CALLELEMENT>
						<!-- if there is an error, mirrorqueue may be closed -->
						<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
						<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
						<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
					</else>
					</if>
        			<STREAM.FLUSH/>
	     		</then>
	     		</if>
			</then>
			</if>
			<!-- CS-DocLink configuration -->
			<if COND="IsVariable.cs-doclink=true">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<setvar NAME="doclinkids" VALUE="Variables.empty"/>
				<LOOP LIST="assettypes">
					<EXTERNALCLIENTSMANAGER.LOADFROMFIELDS OBJVARNAME="myObj"
						SITE="Variables.pubid" ASSETTYPE="assettypes.ITEM"
						CLIENTAPP="CSDocLink"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<EXTERNALCLIENTSITEM.GETID NAME="myObj" VARNAME="itemid"/>
						<if COND="Variables.doclinkids=Variables.empty">
						<then>
							<setvar NAME="doclinkids" VALUE="Variables.itemid"/>
						</then>
						<else>
							<setvar NAME="doclinkids" VALUE="Variables.doclinkids,Variables.itemid"/>
						</else>
						</if>
		     			<INCCOUNTER NAME="num" VALUE="1"/>
					</then>
					</if>
				</LOOP>
					
	     		<if COND="Variables.doclinkids!=Variables.empty">
	     		<then>
					<EXTERNALCLIENTSMANAGER.PUBLISH VALUE="Variables.doclinkids" MIRRORQUEUE="pubMirrorQ"/>
					<if COND="IsError.Variables.errno=false">
					<then>
						<setvar NAME="num" VALUE="Counters.num"/>
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredCSDocLinkConfig" VARNAME="msgtext"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="info"/>
						</CALLELEMENT>
					</then>
					<else>          
						<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringCSDocLinkConfig" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						    <ARGUMENT NAME="severity" VALUE="error"/>
						</CALLELEMENT>
						<!-- if there is an error, mirrorqueue may be closed -->
						<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
						<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
						<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
					</else>
					</if>
        			<STREAM.FLUSH/>
	     		</then>
	     		</if>
			</then>
			</if>
			
		</then>
		</if>
	</then>
	</if>

	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.startmenus=true">
		<then>
			<SUBSTITUTE STR="Variables.startmenus" WHAT=";" WITH="," OUTSTR="startmenus"/>
			<STARTMENU.PUBLISH VALUE="Variables.startmenus" MIRRORQUEUE="pubMirrorQ"/>
			<if COND="IsError.Variables.errno=false">
			<then>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredStartMenuItems" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</then>
			<else>          
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringStartMenuItems" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
				<!-- if there is an error, mirrorqueue may be closed -->
				<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
				<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
				<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
			</else>
			</if>
        <STREAM.FLUSH/>
		</then>
		</if>
	</then>
	</if>
	
	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.workflows=true">
		<then>
			<SUBSTITUTE STR="Variables.workflows" WHAT=";" WITH="," OUTSTR="workflows"/>
			<WORKFLOWENGINE.PUBLISHPROCESSES VALUE="Variables.workflows" MIRRORQUEUE="pubMirrorQ"/>
			<if COND="IsError.Variables.errno=false">
			<then>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowProcesses" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</then>
			<else>          
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowProcesses" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
				<!-- if there is an error, mirrorqueue may be closed -->
				<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
				<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
				<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
			</else>
			</if>
         <STREAM.FLUSH/>
			<!-- Workflow states used for selected processes -->
			<if COND="Variables.doproceed=true">
			<then>
				<if COND="IsVariable.workflowstates=true">
				<then>
					<!-- duplicates are o.k., they will only get mirrored once -->
					<SETVAR NAME="wfstates" VALUE="Variables.empty"/>
					<STRINGLIST STR="Variables.workflows" DELIM="," NAME="wfprocesses"/>
					<LOOP LIST="wfprocesses">
						<WORKFLOWENGINE.GetAllStatesForProcess PROCESS="wfprocesses.ITEM" PREFIX="wfstate:"/> 
						<if COND="Variables.wfstate:Total!=0">
						<then>
							<SETCOUNTER NAME="nth" VALUE="0"/>
							<LOOP COUNT="Variables.wfstate:Total">
								<WORKFLOWSTATE.GETID NAME="wfstate:Counters.nth" VARNAME="wfstateid"/>
								<if COND="Variables.wfstates=Variables.empty">
								<then>
									<SETVAR NAME="wfstates" VALUE="Variables.wfstateid"/>
								</then>
								<else>
									<SETVAR NAME="wfstates" VALUE="Variables.wfstates,Variables.wfstateid"/>
								</else>
								</if>
								<INCCOUNTER NAME="nth" VALUE="1"/>
							</LOOP>
						</then>
						</if>
					</LOOP>
					<if COND="Variables.wfstates!=Variables.empty">
					<then>
						<WORKFLOWENGINE.PublishStates VALUE="Variables.wfstates" MIRRORQUEUE="pubMirrorQ"/>	
						<if COND="IsError.Variables.errno=false">
						<then>
							<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowStates" VARNAME="msgtext"/>
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
							    <ARGUMENT NAME="severity" VALUE="info"/>
							</CALLELEMENT>
						</then>
						<else>          
							<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowStates" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
							    <ARGUMENT NAME="severity" VALUE="error"/>
							</CALLELEMENT>
							<!-- if there is an error, mirrorqueue may be closed -->
							<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
							<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
							<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
						</else>
						</if>
        				<STREAM.FLUSH/>
					</then>
					</if>
				</then>
				</if>
			</then>
			</if>
		</then>
		</if>
	</then>
	</if>

	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.workflowconditions=true">
		<then>
			<SETVAR NAME="wfcondids" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableConditions PREFIX="wfcond:"/>
			<if COND="Variables.wfcond:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfcond:Total">
					<WORKFLOWACTION.GETID NAME="wfcond:Counters.nth" VARNAME="wfcond:id"/>
					<if COND="Variables.wfcondids=Variables.empty">
					<then>
						<SETVAR NAME="wfcondids" VALUE="Variables.wfcond:id"/>
					</then>
					<else>
						<SETVAR NAME="Variables.wfcondids" VALUE="Variables.wfcondids,Variables.wfcond:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfcondids!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PUBLISHCONDITIONS VALUE="Variables.wfcondids" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowConditions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowConditions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
 		       <STREAM.FLUSH/>
			</then>
			</if>
		</then>
		</if>
	</then>
	</if>
	

	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.workflowactions=true">
		<then>
			<SETVAR NAME="wfassignactions" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableAssignmentActions PREFIX="wfassignact:"/>
			<if COND="Variables.wfassignact:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfassignact:Total">
					<WORKFLOWACTION.GETID NAME="wfassignact:Counters.nth" VARNAME="wfassignact:id"/>
					<if COND="Variables.wfassignactions=Variables.empty">
					<then>
						<SETVAR NAME="wfassignactions" VALUE="Variables.wfassignact:id"/>
					</then>
					<else>
						<SETVAR NAME="wfassignactions" VALUE="Variables.wfassignactions,Variables.wfassignact:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfassignactions!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PublishAssignmentActions VALUE="Variables.wfassignactions" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowAssignmentActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowAssignmentActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
			<!-- workflow deadlock actions -->
			<SETVAR NAME="wfdeadlockactions" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableDeadlockActions PREFIX="wfdeadlockact:"/>
			<if COND="Variables.wfdeadlockact:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfdeadlockact:Total">
					<WORKFLOWACTION.GETID NAME="wfdeadlockact:Counters.nth" VARNAME="wfdeadlockact:id"/>
					<if COND="Variables.wfdeadlockactions=Variables.empty">
					<then>
						<SETVAR NAME="wfdeadlockactions" VALUE="Variables.wfdeadlockact:id"/>
					</then>
					<else>
						<SETVAR NAME="wfdeadlockactions" VALUE="Variables.wfdeadlockactions,Variables.wfdeadlockact:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfdeadlockactions!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PublishDeadlockActions VALUE="Variables.wfdeadlockactions" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowDeadlockActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowDeadlockActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
			<!-- workflow delegate actions -->
			<SETVAR NAME="wfdelegateactions" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableDelegateActions PREFIX="wfdelegateact:"/>
			<if COND="Variables.wfdelegateact:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfdelegateact:Total">
					<WORKFLOWACTION.GETID NAME="wfdelegateact:Counters.nth" VARNAME="wfdelegateact:id"/>
					<if COND="Variables.wfdelegateactions=Variables.empty">
					<then>
						<SETVAR NAME="wfdelegateactions" VALUE="Variables.wfdelegateact:id"/>
					</then>
					<else>
						<SETVAR NAME="wfdelegateactions" VALUE="Variables.wfdelegateactions,Variables.wfdelegateact:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfdelegateactions!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PublishDelegateActions VALUE="Variables.wfdelegateactions" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroedWorkflowDelegateActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowDelegateActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
			<!-- workflow process actions -->
			<SETVAR NAME="wfprocessactions" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableProcessActions PREFIX="wfprocessact:"/>
			<if COND="Variables.wfprocessact:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfprocessact:Total">
					<WORKFLOWACTION.GETID NAME="wfprocessact:Counters.nth" VARNAME="wfprocessact:id"/>
					<if COND="Variables.wfprocessactions=Variables.empty">
					<then>
						<SETVAR NAME="wfprocessactions" VALUE="Variables.wfprocessact:id"/>
					</then>
					<else>
						<SETVAR NAME="wfprocessactions" VALUE="Variables.wfprocessactions,Variables.wfprocessact:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfprocessactions!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PublishProcessActions VALUE="Variables.wfprocessactions" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowProcessActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowProcessActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
			<!-- workflow step actions -->
			<SETVAR NAME="wfstepactions" VALUE="Variables.empty"/>
			<WORKFLOWENGINE.GetAvailableStepActions PREFIX="wfstepact:"/>
			<if COND="Variables.wfstepact:Total!=0">
			<then>
				<SETCOUNTER NAME="num" VALUE="0"/>
				<SETCOUNTER NAME="nth" VALUE="0"/>
				<LOOP COUNT="Variables.wfstepact:Total">
					<WORKFLOWACTION.GETID NAME="wfstepact:Counters.nth" VARNAME="wfstepact:id"/>
					<if COND="Variables.wfstepactions=Variables.empty">
					<then>
						<SETVAR NAME="wfstepactions" VALUE="Variables.wfstepact:id"/>
					</then>
					<else>
						<SETVAR NAME="wfstepactions" VALUE="Variables.wfstepactions,Variables.wfstepact:id"/>
					</else>
					</if>
					<INCCOUNTER NAME="num" VALUE="1"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>
			<if COND="Variables.wfstepactions!=Variables.empty">
			<then>
				<WORKFLOWENGINE.PublishStepActions VALUE="Variables.wfstepactions" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowStepActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirringWorkflowStepActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
			</then>
			</if>
        <STREAM.FLUSH/>
		</then>
		</if>
	</then>
	</if>

	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.workflowgroups=true">
		<then>
			<SUBSTITUTE STR="Variables.workflowgroups" WHAT=";" WITH="," OUTSTR="workflowgroups"/>
			<WORKFLOWENGINE.PUBLISHGROUPS VALUE="Variables.workflowgroups" MIRRORQUEUE="pubMirrorQ"/>
			<if COND="IsError.Variables.errno=false">
			<then>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirredWorkflowGroups" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</then>
			<else>          
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowGroups" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
				<!-- if there is an error, mirrorqueue may be closed -->
				<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
				<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
				<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
			</else>
			</if>
			<if COND="IsVariable.workflowgroupactions=true">
			<then>
				<SETVAR NAME="wfgactionids" VALUE="Variables.empty"/>
				<WORKFLOWENGINE.GetAvailableGroupActions PREFIX="wfgactions:"/>
				<if COND="Variables.wfgactions:Total!=0">
				<then>
					<SETCOUNTER NAME="num" VALUE="0"/>
					<SETCOUNTER NAME="nth" VALUE="0"/>
					<LOOP COUNT="Variables.wfgactions:Total">
						<WORKFLOWACTION.GETID NAME="wfgactions:Counters.nth" VARNAME="wfgactions:id"/>
						<if COND="Variables.wfgactionids=Variables.empty">
						<then>
							<SETVAR NAME="wfgactionids" VALUE="Variables.wfgactions:id"/>
						</then>
						<else>
							<SETVAR NAME="wfgactionids" VALUE="Variables.wfgactionids,Variables.wfgactions:id"/>
						</else>
						</if>
						<INCCOUNTER NAME="num" VALUE="1"/>
						<INCCOUNTER NAME="nth" VALUE="1"/>
					</LOOP>
				</then>
				</if>
				<WORKFLOWENGINE.PublishGroupActions VALUE="Variables.wfgactionids" MIRRORQUEUE="pubMirrorQ"/>
				<if COND="IsError.Variables.errno=false">
				<then>
					<setvar NAME="num" VALUE="Counters.num"/>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredWorkflowGroupActions" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				<else>          
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringWorkflowGroupActions" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="error"/>
					</CALLELEMENT>
					<!-- if there is an error, mirrorqueue may be closed -->
					<!-- however, we want to continue mirroring what we can, so we will cancle and create the mirror queue again -->
					<MIRRORQUEUE.CANCEL NAME="pubMirrorQ"/> 
					<MIRRORQUEUE.CREATE NAME="pubMirrorQ" SESSION="pubsess" PAGENAME="Variables.propremotecall"/>
				</else>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>
		</then>
		</if>		
	</then>
	</if>


	<if COND="Variables.doproceed=true">
	<then>
		<if COND="IsVariable.treetabs=true">
		<then>
            <SUBSTITUTE STR="Variables.treetabs" WHAT=";" WITH="," OUTSTR="treetabs"/>
			<TTM.PUBLISH VALUE="Variables.treetabs" MIRRORQUEUE="pubMirrorQ"/>
			<if COND="IsError.Variables.errno=false">
			<then>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredTreeTabs" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</then>
			<else>          
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringTreeTabs" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
				<ICS.CLEARERRNO/>
			</else>
			</if>
        <STREAM.FLUSH/>
		</then>
		</if>
	</then>
	</if>

	<if COND="Variables.doproceed=true">
	<then>
  		<if COND="IsVariable.savedsearches=true">
  		<then>
			<SUBSTITUTE STR="Variables.savedsearches" WHAT=";" WITH="," OUTSTR="ssearches"/>
			<SAVESEARCHMANAGER.PUBLISH VALUE="Variables.ssearches" MIRRORQUEUE="pubMirrorQ"/>
			<if COND="IsError.Variables.errno=false">
			<then>
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroredSavedSearches" VARNAME="msgtext"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="info"/>
				</CALLELEMENT>
			</then>
			<else>          
				<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-ErrormirroringSavedSearches" VARNAME="msgtext" errno="Variables.errno" errdetail1="Variables.errdetail1" EVALALL="false"/>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				    <ARGUMENT NAME="severity" VALUE="error"/>
				</CALLELEMENT>
				<ICS.CLEARERRNO/>
			</else>
			</if>
        <STREAM.FLUSH/>

		</then>
		</if>
	</then>
	</if>	

	<if COND="Variables.doproceed=true">
	<then>
  		<if COND="IsVariable.roles=true">
  		<then>
  			<STRINGLIST NAME="CCRoles" STR="Variables.roles" DELIM=";"/>
			<if COND="CCRoles.#numRows!=0">
			<then>
	     		<LOOP LIST="CCRoles">
		 			<MIRRORQUEUE.SENDROW NAME="pubMirrorQ" TABLENAME="CCRoles" FIELD1="id" VALUE1="CCRoles.ITEM"/>
				</LOOP>
			</then>
			</if>
			<if COND="IsError.Variables.errno=false">
			<then>
				<if COND="Counters.num!=0">
				<then>
					<XLAT.LOOKUP KEY="dvin/Admin/MirrorSite-MirroringRoles" VARNAME="msgtext"/>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					    <ARGUMENT NAME="severity" VALUE="info"/>
					</CALLELEMENT>
				</then>
				</if>
        		<STREAM.FLUSH/>
			</then>
			</if>

		</then>
		</if>
	</then>
	</if>	

	<if COND="Variables.doproceed=true">
	<then>
		<MIRRORQUEUE.CLOSE NAME="pubMirrorQ"/>
		<if COND="IsError.Variables.errno=false">
		<then>
			<PUBSESSIONMANAGER.DONE ID="Variables.pubsess:id"/>
		</then>
		<else>
		 	<XLAT.LOOKUP KEY="dvin/UI/Admin/Error/duringmirroroperationerrno" errno="Variables.errno" EVALALL="false" VARNAME="msgtext"/>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			    <ARGUMENT NAME="severity" VALUE="error"/>
			</CALLELEMENT>            
			<PUBSESSIONMANAGER.LOGMESSAGE ID="Variables.pubsess:id" VALUE="Variables.msgtext"/>
			<PUBSESSIONMANAGER.FAIL ID="Variables.pubsess:id"/>
		</else>
		</if>
	</then>
	<else>
		<if COND="IsVariable.pubsess:id=true">
		<then>
			<PUBSESSIONMANAGER.FAIL ID="Variables.pubsess:id"/>
		</then>
		</if>
	</else>
	</if>
	</div>
	
	<if COND="IsVariable.pubsess:id=true">
	<then>
		<!-- only save in PubHistory if we were unsuccessful -->
		<PUBSESSIONMANAGER.STATUS ID="Variables.pubsess:id" VARNAME="status"/>
		<if COND="Variables.status=done">
		<then>
			<PUBSESSIONMANAGER.DELETE ID="Variables.pubsess:id"/>
		</then>
		</if>
	</then>
	</if>
    <if COND="Variables.cs_Verbose!=false">
    <then>
    	<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/SiteFront">
    		<ARGUMENT NAME="pubid" VALUE="Variables.pubid"/>
    		<ARGUMENT NAME="action" VALUE="details"/>
    	</CALLELEMENT>
    </then>
    </if>



</ftcs>
