<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/CSClient/ShowFlexFamily
-
- INPUT
-
- OUTPUT
-
-->
 
<EXTERNALCLIENTSMANAGER.GETENABLEDASSETTYPESFORACLIENT CLIENTAPP="CSDocLink" SITE="Variables.pubid" LISTVARNAME="lEnabledTypes"/>
		
<IF COND="Variables.op=init">
<THEN>
	<NODE NAME="AssetType_Root" ID="1">
		<COLUMNS>
			<XLAT.LOOKUP KEY="dvin/Common/Name" VARNAME="_XLAT_Name"/>
         <COLUMN NAME="Variables._XLAT_Name" REPLACEALL="Variables._XLAT_Name"/>
         <XLAT.LOOKUP KEY="dvin/Common/ID" VARNAME="_XLAT_ID"/>
         <COLUMN NAME="Variables._XLAT_ID" REPLACEALL="Variables._XLAT_ID"/>
         <XLAT.LOOKUP KEY="dvin/Common/Description" VARNAME="_XLAT_Desc"/>
         <COLUMN NAME="Variables._XLAT_Desc" REPLACEALL="Variables._XLAT_Desc"/>
		</COLUMNS>
		
		<IF COND="IsList.lEnabledTypes=true">
		<THEN>
			<IF COND="lEnabledTypes.#numRows!=0">
			<THEN>
				<CHILDREN>
               
               <LISTOBJECT.CREATE NAME="parents" COLUMNS="assetid"/>
               <LISTOBJECT.TOLIST NAME="parents" LISTVARNAME="lParentDefs"/>
					<LOOP LIST="lEnabledTypes">
                  <ASSETTYPE.LIST LIST="lCurrentAT" FIELD1="assettype" VALUE1="lEnabledTypes.assettype"/>
                  <EXTERNALCLIENTSMANAGER.LOADFROMFIELDS SITE="Variables.pubid" OBJVARNAME="oClient" ASSETTYPE="lEnabledTypes.assettype" CLIENTAPP="CSDocLink"/>
                  <EXTERNALCLIENTSITEM.GETID NAME="oClient" VARNAME="clientid"/>
				  
                  <STRING.ENCODE LIST="lCurrentAT" COLUMN="description" VARNAME="packed"/>

                  <CHILD Folder="true" ID="lCurrentAT.assettype" NAME="Variables.packed" REPLACEALL="lCurrentAT.assettype,Variables.packed">
							<ATTRIBUTES>
								<ATTRIBUTE NAME="Variables._XLAT_Name" VALUE="lCurrentAT.assettype" DataType="String" READONLY="true" REPLACEALL="lCurrentAT.assettype,Variables._XLAT_Name"/>
								<ATTRIBUTE NAME="Variables._XLAT_ID"  VALUE="lCurrentAT.id" DataType="String" READONLY="true" REPLACEALL="lCurrentAT.id,Variables._XLAT_ID"/>
								<ATTRIBUTE NAME="Variables._XLAT_Desc" VALUE="Variables.packed" DataType="String" READONLY="true" REPLACEALL="Variables.packed,Variables._XLAT_Desc"/>
							</ATTRIBUTES>
							<COMMANDS>
							<XLAT.LOOKUP KEY="dvin/CSDocLink/Open" VARNAME="_XLAT_"/>
							<IF COND="IsSessionVariable.usessoVal=true">
							  <THEN>
								<COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
							  </THEN >
							  <ELSE>
								<COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
							  </ELSE>
							</IF >    
							</COMMANDS>
                     <!-- get a list of legal subtypes and a union of their accepted doc types -->
                     <CALLELEMENT NAME="OpenMarket/CSClient/GetDropTypes">
                        <ARGUMENT NAME="pubid" VALUE="Variables.pubid"/>
                        <ARGUMENT NAME="clientid" VALUE="Variables.clientid"/>
                     </CALLELEMENT>

                     <IF COND="Variables.hasit=true">
                     <THEN>
                        <IF COND="Variables.maxFileSize=unlimited">
                        <THEN>
                           <IF COND="Variables.AllowedDocTypes=*.*">
                           <THEN>
                              <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                           </THEN>
                           <ELSE>
                              <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes"/>
                           </ELSE>
                           </IF>
                        </THEN>
                        <ELSE>
                           <IF COND="Variables.AllowedDocTypes=*.*">
                           <THEN>
                              <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.maxFileSize"/>
                           </THEN>
                           <ELSE>
                              <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes,Variables.maxFileSize"/>
                           </ELSE>
                           </IF>
                        </ELSE>
                        </IF>
                     </THEN>
                     </IF>
							<COPYACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Copy(?)(RequestType=Post)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                     <MOVEACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Move(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)" REPLACEALL="Variables.cgipathapproot"/>
                    
                     <IF COND="IsSessionVariable.usessoVal=true">
                      <THEN>
                        <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot"/>
                      </THEN>
                      <ELSE>
                        <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot"/>
                      </ELSE>
                     </IF >
              </CHILD>
					</LOOP>
				</CHILDREN>
			</THEN>
			</IF>
		</THEN>
		</IF>
	</NODE>
</THEN>
<ELSE>
    <FATM.GETGROUPTYPE ASSETTYPE="Variables.AssetType" VARNAME="parentType"/>
	<ATM.LOCATE TYPE="Variables.parentType" VARNAME="ParentManager"/>
    <ASSETTYPE.LIST LIST="lCurrentAT" FIELD1="assettype" VALUE1="Variables.AssetType"/>
    <ASSETTYPE.LIST LIST="lCurrentPT" FIELD1="assettype" VALUE1="Variables.parentType"/>
	<STRING.ENCODE LIST="lCurrentPT" COLUMN="description" VARNAME="packedParentDesc"/>

	<EXTERNALCLIENTSMANAGER.LOADFROMFIELDS SITE="Variables.pubid" OBJVARNAME="oClient" ASSETTYPE="Variables.AssetType" CLIENTAPP="CSDocLink"/>
	<EXTERNALCLIENTSITEM.GETID NAME="oClient" VARNAME="clientid"/>
   
   <FATM.GETALL ASSETTYPE="Variables.AssetType" LISTVARNAME="lFamily"/>
   <ATM.LOCATE TYPE="Variables.AssetType" VARNAME="typeManager"/>
   <FATM.GETTEMPLATETYPE ASSETTYPE="Variables.AssetType" VARNAME="defType"/>

   <SETVAR NAME="errno" VALUE="0"/>
   <SETVAR NAME="tablename" VALUE="MimeType"/>
   <EXECSQL SQL="SELECT * FROM Variables.tablename" LIST="lMimeTypes"/>
   <LOOP LIST="lMimeTypes">
      <SETVAR NAME="_MT_lMimeTypes.extension" VALUE="lMimeTypes.mimetype"/>
   </LOOP>

   <URL.UNPACK VALUE="%0D%0A" VARNAME="CRLF"/>
   <BLOBSERVICE.GETIDCOLUMN VARNAME="blobkey"/>
   <BLOBSERVICE.GETURLCOLUMN VARNAME="blobcol"/>
   <BLOBSERVICE.GETTABLENAME VARNAME="blobtable"/>


	<IF COND="Variables.op=top">
	<THEN>
		
		 <FLEXASSETS.GETROOTS SITE="Variables.pubid" NAME="typeManager" LISTVARNAME="lOrphanList"/>
		 
		 <IF COND="lOrphanList.#numRows=0">
	     <THEN>
		    <!-- If an empty list is passed load a fake asset as it is needed in the INSPECTOR.GETCOLUMNUNION -->
		   <ASSET.LOADALL TYPE="Variables.AssetType" IDS="00" IDFIELD="assetid" PREFIX="assets:" OPTION="readonly_complete" />
 		 </THEN>
		 <ELSE>
		   <ASSET.LOADALL TYPE="Variables.AssetType" LIST="lOrphanList" IDFIELD="assetid" PREFIX="assets:" OPTION="readonly_complete" />
		 </ELSE>
		 </IF>
		
         <!-- check to see if the table is tracked if so, then the current record must be locked by the current user -->
         <callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
            <argument NAME="AssetType" VALUE="Variables.AssetType"/>
         </callelement>
   
		 <INSPECTOR.GETCOLUMNUNION PREFIX="assets:" PUBID="Variables.pubid" CLIENTAPP="CSDocLink" LISTVARNAME="lColumns"/>
         <IF COND="Variables.errno=0">
         <THEN>
		  
            <NODE NAME="Variables.AssetType_Root" ID="1" REPLACEALL="Variables.AssetType">
			 
            <!-- since the client can only have 1 master column and we might have many subtypes each with a different drop attribute,
               we need to condense all drop attributes into a default drop column called 'Name' to be consistent with explorer -->
   			<COLUMNS>
               <XLAT.LOOKUP KEY="dvin/Common/Name" VARNAME="_XLAT_Name"/>
               <COLUMN NAME="name" DISPLAYNAME="Variables._XLAT_Name" REPLACEALL="Variables._XLAT_Name"/>
               <LOOP LIST="lColumns">
                  <IF COND="lColumns.value!=name">
                  <THEN>
                     <REMOVEVAR NAME="typeString"/>
                     <INSPECTOR.GETTYPESTRINGFROMASSETS PUBID="Variables.pubid" PREFIX="assets:" ATTRIBUTE="lColumns.value" VARNAME="typeString"/>
                     <IF COND="IsVariable.typeString=true">
                     <THEN>
                        <INSPECTOR.PARSETYPESTRING VALUE="Variables.typeString" ATTRIBUTE="lColumns.value" LISTVARNAME="lTypeInfo"/>
                        <STRING.ENCODE LIST="lTypeInfo" COLUMN="description" VARNAME="packedDesc"/>
                       <COLUMN NAME="lColumns.value" DISPLAYNAME="Variables.packedDesc" REPLACEALL="lColumns.value,Variables.packedDesc"/>
                     </THEN>
                     </IF>
                  </THEN>
                  </IF>
               </LOOP>
               <XLAT.LOOKUP KEY="dvin/Common/AssetType" VARNAME="_XLAT_AT"/>
   				<COLUMN NAME="Variables._XLAT_AT" REPLACEALL="Variables._XLAT_AT"/>
               <IF COND="Variables.trackingenabled=true">
               <THEN>
                  <XLAT.LOOKUP KEY="dvin/CSDocLink/CheckoutStatus" VARNAME="_XLAT_COStatus"/>
                  <COLUMN NAME="Variables._XLAT_COStatus" REPLACEALL="Variables._XLAT_COStatus"/>
               </THEN>
               </IF>
               <XLAT.LOOKUP KEY="dvin/UI/Assignments" VARNAME="_XLAT_"/>
               <COLUMN NAME="Variables._XLAT_" REPLACEALL="Variables._XLAT_"/>
   			</COLUMNS>
            <CHILDREN>
               <FLEXGROUPS.GETROOTS SITE="Variables.pubid" NAME="ParentManager" LISTVARNAME="lParentList"/>
   				<COMPLEXASSETS.GETSORTEDLIST NAME="ParentManager" LISTVARNAME="lParentList" LIST="lParentList"/>
               <IF COND="IsList.lParentList=true">
               <THEN>
			     
                   <IF COND="lParentList.#numRows!=0">
                   <THEN>
                      <LOOP LIST="lParentList">
                           <STRING.ENCODE LIST="lParentList" COLUMN="name" VARNAME="packed"/>
                           <CHILD Folder="true" ID="lParentList.assetid" NAME="Variables.packed" REPLACEALL="lParentList.assetid,Variables.packed">
                               <ATTRIBUTES>
                                   <ATTRIBUTE NAME="Variables._XLAT_Name" VALUE="Variables.packed" DataType="String" READONLY="true" REPLACEALL="Variables.packed,Variables._XLAT_Name"/>
                                   <ATTRIBUTE NAME="Variables._XLAT_AT" VALUE="Variables.packedParentDesc" DataType="String" READONLY="true" REPLACEALL="Variables.packedParentDesc,Variables._XLAT_AT"/>
                               </ATTRIBUTES>
                               <COMMANDS>
                                 <XLAT.LOOKUP KEY="dvin/CSDocLink/Open" VARNAME="_XLAT_"/>
                                 <IF COND="IsSessionVariable.usessoVal=true">
                                   <THEN>
                                     <COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
                                   </THEN >
                                   <ELSE>
                                     <COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
                                   </ELSE>
                                 </IF>
                               </COMMANDS>
                              
                              <LISTOBJECT.CREATE NAME="parents" COLUMNS="assetid"/>
                              <ASSET.LIST TYPE="Variables.parentType" FIELD1="id" VALUE1="lParentList.assetid" LIST="lListedParent"/>
                              <LISTOBJECT.ADDROW NAME="parents" assetid="lListedParent.flexgrouptemplateid"/>
                              <LISTOBJECT.TOLIST NAME="parents" LISTVARNAME="lParentDefs"/>
                               <!-- get a list of legal subtypes and a union of their accepted doc types -->
                              <CALLELEMENT NAME="OpenMarket/CSClient/GetDropTypes">
                                 <ARGUMENT NAME="pubid" VALUE="Variables.pubid"/>
                                 <ARGUMENT NAME="clientid" VALUE="Variables.clientid"/>
                              </CALLELEMENT>
                              
                              <IF COND="Variables.hasit=true">
                              <THEN>
                                 <IF COND="Variables.maxFileSize=unlimited">
                                 <THEN>
                                    <IF COND="Variables.AllowedDocTypes=*.*">
                                    <THEN>
                                       <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                                    </THEN>
                                    <ELSE>
                                       <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes"/>
                                    </ELSE>
                                    </IF>
                                 </THEN>
                                 <ELSE>
                                    <IF COND="Variables.AllowedDocTypes=*.*">
                                    <THEN>
                                       <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.maxFileSize"/>
                                    </THEN>
                                    <ELSE>
                                       <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes,Variables.maxFileSize"/>
                                    </ELSE>
                                    </IF>
                                 </ELSE>
                                 </IF>
                              </THEN>
                              </IF>
                              <COPYACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Copy(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                              <LINKACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Link(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)" REPLACEALL="Variables.cgipathapproot"/>
                              <MOVEACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Move(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)" REPLACEALL="Variables.cgipathapproot"/>

                             <IF COND="IsSessionVariable.usessoVal=true">
                               <THEN>
                                 <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=lParentList.assetid(?)AssetType=Variables.AssetType" REPLACEALL="Variables.pubid,lParentList.assetid,Variables.AssetType,Variables.cgipathapproot"/>
                               </THEN >
                               <ELSE>
                                 <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=lParentList.assetid(?)AssetType=Variables.AssetType(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lParentList.assetid,Variables.AssetType,Variables.cgipathapproot"/>
                               </ELSE>
                             </IF> 
                           </CHILD>
                       </LOOP>
                   </THEN>
                   </IF>
               </THEN>
               </IF>
                <IF COND="Variables.assets:Total!=0">
                <THEN>
                    <CALLELEMENT NAME="OpenMarket/CSClient/BuildAssignmentHash"/>
                    <SETSSVAR NAME="pubid" VALUE="Variables.pubid"/>
                    <CALLELEMENT NAME="OpenMarket/CSClient/ShowLeaves"/>
   				</THEN>
   				</IF>
   			</CHILDREN>
         </NODE>
      </THEN>
      <ELSE>
         <!-- load error -->
               <!-- this error (-100) comes when asset is disabled from the server side-->
	        <IF COND="Variables.errno=-100">
                 <THEN>
				    <!--this key has to be changed to be the proper message-->
					<!-- here you get error numner -100 -->
					<XLAT.LOOKUP KEY="dvin/CSDocLink/V1/AssetDisabledOrDeleted" VARNAME="_XLAT_DELETED_DISABLED"/>
                    <ERROR CODE="4" DESCRIPTION="Variables._XLAT_DELETED_DISABLED" SEVERITY="2" REPLACEALL="Variables._XLAT_DELETED_DISABLED"/>
	             </THEN>
				 <ELSE>
				    <XLAT.LOOKUP KEY="dvin/CSDocLink/V1/ErrorLoadingAsset" VARNAME="_XLAT_"/>
                    <ERROR CODE="4" DESCRIPTION="Variables._XLAT_" SEVERITY="2" REPLACEALL="Variables._XLAT_"/>
				 </ELSE>
           </IF>
      </ELSE>
      </IF>
		
	</THEN>
	<ELSE>
      <SETVAR NAME="errno" VALUE="0"/>
      <ASSET.LIST TYPE="Variables.parentType" LIST="lCurrentParent" FIELD1="id" VALUE1="Variables.op" EXCLUDEVOIDED="true"/>
      <IF COND="Variables.errno=0">
      <THEN>
   		<NODE NAME="Variables.AssetType_Variables.op_Root" ID="1" REPLACEALL="Variables.AssetType,Variables.op">
            
            <FLEXGROUPS.GETIMMEDIATECHILDREN NAME="ParentManager" ID="Variables.op" LISTVARNAME="lChildList" SITE="Variables.pubid"/>
            <IF COND="IsList.lChildList=true">
            <THEN>
               <IF COND="lChildList.#numRows!=0">
               <THEN>
                  <VECTOR.CREATE NAME="vChildren"/>
                  <LOOP LIST="lChildList">
                     <IF COND="lChildList.assettype=Variables.AssetType">
                     <THEN>
                        <VECTOR.ADD NAME="vChildren" VALUE="lChildList.assetid"/>
                     </THEN>
                     </IF>
                  </LOOP>
                  <VECTOR.HASDATA NAME="vChildren" VARNAME="hasData"/>
                  <SETVAR NAME="LoadError" VALUE="no"/>
                  <IF COND="Variables.hasData=true">
                  <THEN>
                     <VECTOR.TOSTRING NAME="vChildren" VARNAME="typedChildren" DELIM=";"/>
                     <ASSET.LOADALL TYPE="Variables.AssetType" IDS="Variables.typedChildren" PREFIX="assets:" OPTION="readonly_complete"/>
                     <!-- check to see if the table is tracked if so, then the current record must be locked by the current user -->
                     <callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
                        <argument NAME="AssetType" VALUE="Variables.AssetType"/>
                     </callelement>
                     <INSPECTOR.GETCOLUMNUNION PREFIX="assets:" PUBID="Variables.pubid" CLIENTAPP="CSDocLink" LISTVARNAME="lColumns"/>
                     <IF COND="Variables.errno!=0">
                     <THEN>
                        <XLAT.LOOKUP KEY="dvin/CSDocLink/V1/ErrorLoadingAsset" VARNAME="_XLAT_"/>
                        <ERROR CODE="4" DESCRIPTION="Variables._XLAT_" SEVERITY="2" REPLACEALL="Variables._XLAT_"/>
                        <SETVAR NAME="LoadError" VALUE="yes"/>
                     </THEN>
                     </IF>
                  </THEN>
                  </IF>
                  <IF COND="Variables.LoadError=no">
                  <THEN>
                     <COLUMNS>
                        <XLAT.LOOKUP KEY="dvin/Common/Name" VARNAME="_XLAT_Name"/>
                        <COLUMN NAME="name" DISPLAYNAME="Variables._XLAT_Name" REPLACEALL="Variables._XLAT_Name"/>
                        <IF COND="Variables.hasData=true">
                        <THEN>
                           <LOOP LIST="lColumns">
                              <IF COND="lColumns.value!=name">
                              <THEN>
                                 <REMOVEVAR NAME="typeString"/>
                                 
                                 <INSPECTOR.GETTYPESTRINGFROMASSETS PUBID="Variables.pubid" PREFIX="assets:" ATTRIBUTE="lColumns.value" VARNAME="typeString"/>
                                 
                                 <IF COND="IsVariable.typeString=true">
                                 <THEN>
                                    <INSPECTOR.PARSETYPESTRING VALUE="Variables.typeString" ATTRIBUTE="lColumns.value" LISTVARNAME="lTypeInfo"/>
                                    <STRING.ENCODE LIST="lTypeInfo" COLUMN="description" VARNAME="packedDesc"/>
                                    <STRING.ENCODE LIST="lColumns" COLUMN="value" VARNAME="packedCol"/>
                                    <COLUMN NAME="Variables.packedCol" DISPLAYNAME="Variables.packedDesc" REPLACEALL="Variables.packedCol,Variables.packedDesc"/>
                                 </THEN>
                                 </IF>
                              </THEN>
                              </IF>
                           </LOOP>
                        </THEN>
                        </IF>
                        <XLAT.LOOKUP KEY="dvin/Common/AssetType" VARNAME="_XLAT_AT"/>
            				<COLUMN NAME="Variables._XLAT_AT" REPLACEALL="Variables._XLAT_AT"/>
                        <IF COND="Variables.trackingenabled=true">
                        <THEN>
                           <XLAT.LOOKUP KEY="dvin/CSDocLink/CheckoutStatus" VARNAME="_XLAT_COStatus"/>
                           <COLUMN NAME="Variables._XLAT_COStatus" REPLACEALL="Variables._XLAT_COStatus"/>
                        </THEN>
                        </IF>
                        <XLAT.LOOKUP KEY="dvin/UI/Assignments" VARNAME="_XLAT_"/>
                        <COLUMN NAME="Variables._XLAT_" REPLACEALL="Variables._XLAT_"/>
            			</COLUMNS>
                     <CHILDREN>
                        <LOOP LIST="lChildList">
                           <IF COND="lChildList.assettype=Variables.parentType">
                           <THEN>
                              <ASSET.LIST TYPE="lChildList.assettype" FIELD1="id" VALUE1="lChildList.assetid" LIST="lCurrentAsset"/>
                              <STRING.ENCODE LIST="lCurrentAsset" COLUMN="name" VARNAME="packed"/>
                              <CHILD Folder="true" ID="lChildList.assetid" NAME="Variables.packed" REPLACEALL="lChildList.assetid,Variables.packed">
                                 <ATTRIBUTES>
                                    <ATTRIBUTE NAME="Variables._XLAT_Name" VALUE="Variables.packed" DataType="String" READONLY="true" REPLACEALL="Variables.packed,Variables._XLAT_Name"/>
                                    <ATTRIBUTE NAME="Variables._XLAT_AT" VALUE="Variables.packedParentDesc" DataType="String" READONLY="true" REPLACEALL="Variables.packedParentDesc,Variables._XLAT_AT"/>
                                 </ATTRIBUTES>
                                 <COMMANDS>
                                    <XLAT.LOOKUP KEY="dvin/CSDocLink/Open" VARNAME="_XLAT_"/>
                                    <IF COND="IsSessionVariable.usessoVal=true">
                                     <THEN>
                                       <COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
                                     </THEN >
                                     <ELSE>
                                       <COMMAND NAME="Variables._XLAT_" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=top(?)AssetType=lCurrentAT.assettype(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lCurrentAT.assettype,Variables.cgipathapproot,Variables._XLAT_" DEFAULT="true" TYPE="tree"/>
                                     </ELSE>
                                    </IF >
                                 </COMMANDS>
                                 
                                 <LISTOBJECT.CREATE NAME="parents" COLUMNS="assetid"/>
                                 <LISTOBJECT.ADDROW NAME="parents" assetid="lCurrentAsset.flexgrouptemplateid"/>
                                 <LISTOBJECT.TOLIST NAME="parents" LISTVARNAME="lParentDefs"/>
                                  <!-- get a list of legal subtypes and a union of their accepted doc types -->
                                 <CALLELEMENT NAME="OpenMarket/CSClient/GetDropTypes">
                                    <ARGUMENT NAME="pubid" VALUE="Variables.pubid"/>
                                    <ARGUMENT NAME="clientid" VALUE="Variables.clientid"/>
                                 </CALLELEMENT>
                                 
                                 <IF COND="Variables.hasit=true">
                                 <THEN>
                                    <IF COND="Variables.maxFileSize=unlimited">
                                    <THEN>
                                       <IF COND="Variables.AllowedDocTypes=*.*">
                                       <THEN>
                                          <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                                       </THEN>
                                       <ELSE>
                                          <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes"/>
                                       </ELSE>
                                       </IF>
                                    </THEN>
                                    <ELSE>
                                       <IF COND="Variables.AllowedDocTypes=*.*">
                                       <THEN>
                                          <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.maxFileSize"/>
                                       </THEN>
                                       <ELSE>
                                          <DROPACTION NAME="YYY" URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Drop(RequestType=Post)(?)(TargetPath;Node)(DroppedFile;TheFile)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" ALLOWED_EXTENSIONS="Variables.AllowedDocTypes" MAX_SIZE="Variables.maxFileSize" REPLACEALL="Variables.cgipathapproot,Variables.AllowedDocTypes,Variables.maxFileSize"/>
                                       </ELSE>
                                       </IF>
                                    </ELSE>
                                    </IF>
                                 </THEN>
                                 </IF>
                                 <LINKACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Link(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)" REPLACEALL="Variables.cgipathapproot"/>
                                 <COPYACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Copy(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)(?)(Attributes;new:;FromSource=true)" REPLACEALL="Variables.cgipathapproot"/>
                                 <MOVEACTION URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=Move(?)SourceID=(SourceID)(?)(SourcePath;SourcePath)(?)(TargetPath;Node)(?)DroppedOn=(TargetID)" REPLACEALL="Variables.cgipathapproot"/>
                                
                                <IF COND="IsSessionVariable.usessoVal=true">
                                  <THEN>
                                    <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=lChildList.assetid(?)AssetType=Variables.AssetType" REPLACEALL="Variables.pubid,lChildList.assetid,Variables.AssetType,Variables.cgipathapproot"/>
                                  </THEN >
                                  <ELSE>
                                    <OPENURI URI="Variables.cgipathapprootContentServer?pagename=OpenMarket/CSClient/CSClientPage(?)CSCPage=ShowFlexFamily(?)pubid=Variables.pubid(?)op=lChildList.assetid(?)AssetType=Variables.AssetType(?)username=(Username)(?)password=(Password)" REPLACEALL="Variables.pubid,lChildList.assetid,Variables.AssetType,Variables.cgipathapproot"/>   
                                  </ELSE>
                                </IF >
                              </CHILD>
                           </THEN>
                           </IF>
                        </LOOP>
      
                        <IF COND="Variables.hasData=true">
                        <THEN>
                           <IF COND="Variables.assets:Total!=0">
                           <THEN>
                               <CALLELEMENT NAME="OpenMarket/CSClient/BuildAssignmentHash"/>
                               <SETSSVAR NAME="pubid" VALUE="Variables.pubid"/>
                               <CALLELEMENT NAME="OpenMarket/CSClient/ShowLeaves"/>
                           </THEN>
                           </IF>
                        </THEN>
                        </IF>
      
            			</CHILDREN>
                  </THEN>
                  </IF>
               </THEN>
               <ELSE>
                  <COLUMNS>
         				<XLAT.LOOKUP KEY="dvin/Common/Name" VARNAME="_XLAT_Name"/>
                     <COLUMN NAME="Variables._XLAT_Name" REPLACEALL="Variables._XLAT_Name"/>
                     <XLAT.LOOKUP KEY="dvin/Common/ID" VARNAME="_XLAT_ID"/>
                     <COLUMN NAME="Variables._XLAT_ID" REPLACEALL="Variables._XLAT_ID"/>
         				<XLAT.LOOKUP KEY="dvin/Common/AssetType" VARNAME="_XLAT_"/>
                     <COLUMN NAME="Variables._XLAT_" REPLACEALL="Variables._XLAT_"/>
         			</COLUMNS>
               </ELSE>
               </IF>
            </THEN>
            </IF>
   		</NODE>
      </THEN>
      <ELSE>
         <XLAT.LOOKUP KEY="dvin/CSDocLink/V1/ParentCouldNotBeAccessed" VARNAME="_XLAT_"/>
         <ERROR CODE="4" DESCRIPTION="Variables._XLAT_" SEVERITY="2" REPLACEALL="Variables._XLAT_"/>
      </ELSE>
      </IF>
	</ELSE>
	</IF>
</ELSE>
</IF>
</FTCS> 
