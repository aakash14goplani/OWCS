<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Gator/FlexibleAssets/Common/AGRecommendations
--
-- INPUT
--
-- OUTPUT
--
-->

<!-- create relationship list from hidden inputs -->
<IF COND="IsVariable.uniqueRecids=false">
<THEN>
	<SETVAR NAME="uniqueRecids" VALUE="Variables.empty"/>
</THEN>
</IF>

<STRINGLIST STR="Variables.uniqueRecids" DELIM="," NAME="reclist"/>

<SETCOUNTER NAME="total" VALUE="0"/>
<LOOP LIST="reclist">
	<setvar NAME="count" VALUE="Variables.reclist.ITEMnumassets"/>
	<setvar NAME="errno" VALUE="0"/>
	<BEGINS STR="Variables.count" WHAT="Variables."/>
	<if COND="Variables.errno=0">
	<then>
		<SETCOUNTER NAME="assetcounter" VALUE="0"/>
		<LOOP COUNT="Variables.count">
			<setvar NAME="currentassetid" VALUE="Variables.reclist.ITEMassetidCounters.assetcounter"/>
			<setvar NAME="deleted" VALUE="Variables.dVariables.currentassetidreclist.ITEM"/>
			<IF COND="Variables.deleted!=deleted">
			<THEN>
				<setvar NAME="varassetid" VALUE="reclist.ITEMassetidCounters.assetcounter"/>
				<setvar NAME="varassettype" VALUE="reclist.ITEMassettypeCounters.assetcounter"/>
				<setvar NAME="assetid" VALUE="Variables.Variables.varassetid"/>
				<setvar NAME="assettype" VALUE="Variables.Variables.varassettype"/>
				<IF COND="IsVariable.reclist.ITEMnewconfCounters.assetcounter=true">
				<THEN>
					<!-- csvar NAME="Found confidence in reclist.ITEMnewconfCounters.assetcounter"/><br/ -->
					<setvar NAME="currentval" VALUE="Variables.reclist.ITEMnewconfCounters.assetcounter"/>
					
					<callelement NAME="OpenMarket/Gator/FlexibleAssets/Common/IntDecConversion">
						<argument NAME="OPtype" VALUE="IntToDec"/>
					</callelement>

					<setvar NAME="confidence" VALUE="Variables.newDecConfidence"/>
					<!-- csvar NAME="The decimal confidence found is Variables.newDecConfidence"/><br/ -->
				</THEN>
				<ELSE>
					<IF COND="IsVariable.reclist.ITEMconfCounters.assetcounter=true">
					<THEN>
						<!-- csvar NAME="Found confidence in reclist.ITEMconfCounters.assetcounter"/><br/ -->
						<setvar NAME="currentval"  VALUE="Variables.reclist.ITEMconfCounters.assetcounter"/>
						<setvar NAME="confidence" VALUE="Variables.currentval"/>
						<!-- csvar NAME="The decimal confidence found is Variables.currentval"/><br/ -->
					</THEN>
					<ELSE>
						<!-- csvar NAME="Did not find confidence in reclist.ITEMconfCounters.assetcounter"/><br/ -->
						<setvar NAME="confidence" VALUE="1"/>
					</ELSE>
					</IF>
				</ELSE>
				</IF>
				<SETVAR NAME="flexVariables.flextypes:Relationships:Counters.total:relid" VALUE="reclist.ITEM"/>
				<SETVAR NAME="flexVariables.flextypes:Relationships:Counters.total:asset" VALUE="Variables.assetid"/>
				<SETVAR NAME="flexVariables.flextypes:Relationships:Counters.total:asset_type" VALUE="Variables.assettype"/>
				<SETVAR NAME="flexVariables.flextypes:Relationships:Counters.total:confidence" VALUE="Variables.confidence"/>
				<INCCOUNTER NAME="total" VALUE="1"/>
			</THEN>
			</IF>
			<INCCOUNTER NAME="assetcounter" VALUE="1"/>
					
		</LOOP>
	</then>
	</if>
			
</LOOP>
<SETVAR NAME="flexVariables.flextypes:Relationships:Total" VALUE="Counters.total"/>


</FTCS> 
