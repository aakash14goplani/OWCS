<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
	<!-- OpenMarket/Gator/FlexibleAssets/Common/AssocParentDetails
	-
	- INPUT
	-
	- OUTPUT
	-
	-->

	<!-- Parent Groups, if any -->

	<ATM.LOCATE TYPE="Variables.templatetype" VARNAME="ptmgr"/>
	<ATM.LOCATE TYPE="Variables.grouptype" VARNAME="pgmgr"/>
	<IF COND="Variables.tagtype=asset">
		<THEN>
			<FLEXASSET.GETPARENTS NAME="theCurrentAsset" LISTVARNAME="ParentList"/>
			<FLEXTEMPLATE.GETFILTERS NAME="ProdTmplinst" LISTVARNAME="lFilterList"/>
			<FLEXTEMPLATES.GETDERIVEDINFO NAME="ptmgr" ID="Variables.templateid" ASSETTYPE="Variables.templatetype" GROUPTYPE="Variables.grouptype" VARNAME="oFilterInfo"/>
		</THEN>
		<ELSE>
			<FLEXGROUP.GETPARENTS NAME="theCurrentAsset" LISTVARNAME="ParentList"/>
			<FLEXGROUPTEMPLATE.GETFILTERS NAME="ProdTmplinst" LISTVARNAME="lFilterList"/>
			<FLEXGROUPTEMPLATES.GETDERIVEDINFO NAME="ptmgr" ID="Variables.templateid" ASSETTYPE="Variables.templatetype" GROUPTYPE="Variables.AssetType" VARNAME="oFilterInfo"/>
		</ELSE>
	</IF>

	<IF COND="IsList.ParentList!=true">
		<THEN>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/Parents"/>
				</td>
				<td></td>
				<td class="form-inset">
					<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/GetParentError"/><STRING.STREAM VARIABLE="errno"/>
				</td>
			</tr>
		</THEN>
		<ELSE>
			<IF COND="ParentList.#numRows!=0">
				<THEN>
					
							<COMPLEXASSETS.GETSORTEDLIST NAME="pgmgr" LIST="ParentList" LISTVARNAME="ParentList"/>
							<SETVAR NAME="separatorTag" VALUE="0"/>

							<!-- Check if the hashtable enabledParents exists-->
							<MISC.CHECKOBJECTEXISTS NAME="enabledParents" VARNAME="enabledParents"/>
							<IF COND="Variables.enabledParents=false">
								<THEN>
									<SETVAR NAME="enabled" VALUE="true"/>
								</THEN>
							</IF>

							<SETVAR NAME='previousGroupTypeId' VALUE=''/>
							<LOOP LIST="ParentList">
								<!--need name of parent-->
								<ASSET.LIST LIST="ParentFields" TYPE="Variables.grouptype" FIELD1="id" VALUE1="ParentList.assetid"/>
								<FGTM.GETTEMPLATETYPE ASSETTYPE="Variables.grouptype" VARNAME="GroupTemplateType"/>
								<ASSET.LOAD TYPE="Variables.GroupTemplateType" NAME="GroupTmplinst" OBJECTID="ParentFields.flexgrouptemplateid"/>
								<ASSET.GET NAME="GroupTmplinst" FIELD="description" OUTPUT="GroupTypeDescription"/>
								<ASSET.GET NAME="GroupTmplinst" FIELD="name" OUTPUT="GroupTypeName"/>
								<ASSET.GET NAME="GroupTmplinst" FIELD="id" OUTPUT="currentGroupTypeId"/>
								<IF COND="Variables.enabledParents=true">
									<THEN>
										<IF COND="Variables.cs_formmode!=DM">
					                                        <THEN>
					                                            <HASH.CONTAINS VARNAME="enabled" NAME="enabledParents" VALUE="Variables.GroupTypeName"/>
					                                        </THEN>
					                                        <ELSE>
					                                            <SETVAR NAME="enabled" VALUE="true"/>    
					                                        </ELSE>
					                                        </IF>
									</THEN>
								</IF>

								<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
								<tr>
								<td class="form-label-text">
									<IF COND="Variables.previousGroupTypeId!=Variables.currentGroupTypeId">
									<THEN>
										<IF COND="Variables.GroupTypeDescription=Variables.empty">
	                                 	<THEN>
	                                     	<STRING.STREAM VARIABLE="GroupTypeName"/>:  
	                                 	</THEN>
	                                 	<ELSE>
	                                 		<STRING.STREAM VARIABLE="GroupTypeDescription"/>:
	                                 	</ELSE>
	                                 	</IF>	
									</THEN>
									</IF>							
								</td>
								<td></td>
								<td class="form-inset"> 							
								
								<IF COND="Variables.enabled!=false">
									<THEN>
										<IF COND="Variables.separatorTag=1">
											<THEN>
											</THEN>
										</IF>
										<IF COND="Variables.errno=0">
											<THEN>
												<IF COND="Variables.revisionInspect=true">
												<THEN>
													<STRING.STREAM LIST="ParentFields" COLUMN="name"/>
												</THEN>
												<ELSE>
													<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="InspectThisItem" ESCAPE="true"/>
													<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
														<ARGUMENT NAME="assettype" VALUE="Variables.grouptype"/>
														<ARGUMENT NAME="assetid" VALUE="ParentList.assetid"/>
														<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
														<ARGUMENT NAME="function" VALUE="inspect"/>
													</CALLELEMENT>
													<a href="Variables.urlInspectItem" OnMouseOver="window.status='Variables.InspectThisItem'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables.InspectThisItem"><STRING.STREAM LIST="ParentFields" COLUMN="name"/></a>
												</ELSE>
												</IF>
											</THEN>
											<ELSE>
												<XLAT.STREAM KEY="dvin/Common/Error"/>:<STRING.STREAM VARIABLE="errno"/>
											</ELSE>
										</IF>
										<SETVAR NAME="separatorTag" VALUE="1"/>
									</THEN>
								</IF>
								</td>
								</tr>
								<SETVAR NAME='previousGroupTypeId' VALUE='Variables.currentGroupTypeId'/>
							</LOOP>

							<REMOVEVAR NAME="enabled"/>
							<REMOVEVAR NAME="enabledParents"/>
							<REMOVEVAR NAME='previousGroupTypeId'/>
							<REMOVEVAR NAME='currentGroupTypeId'/>
				</THEN>
			</IF>
		</ELSE>
	</IF>

	<!-- show parents from filter -->
	<!-- ContentDetails:DGroup_1025295073206Test_type = MyAsset
		  ContentDetails:DGroup_1025295073206Test = 1026235833594 -->
	<IF COND="IsList.lFilterList=true">
		<THEN>
			<IF COND="lFilterList.#numRows!=0">
				<THEN>
					<LOOP LIST="lFilterList">
						<FILTERINFO.GETGROUPINFO NAME="oFilterInfo" ID="lFilterList.assetid" LISTVARNAME="lFilteredParents"/>
						<IF COND="IsList.lFilteredParents=true">
							<THEN>
								<IF COND="lFilteredParents.#numRows!=0">
									<THEN>
										<ASSET.LIST TYPE="Variables.parentdeftype" FIELD1="id" VALUE1="lFilteredParents.assetid" LIST="lCurrentPD"/>
										<SETVAR NAME="errno" VALUE="0"/>
										<!-- ContentDetails:DGroup_1025295073206Test = 1026235833594 -->
										<ICS.RESOLVEVARIABLES NAME="$(Variables.ContentDetails:DGroup_$(lFilterList.assetid)$(lCurrentPD.name))" OUTPUT="currentVal" DELIMITED="true"/>
										<IF COND="Variables.errno=0">
											<THEN>
												<ASSET.LIST TYPE="Variables.filtertype" FIELD1="id" VALUE1="lFilterList.assetid" LIST="lCurrentFilter"/>
												<ASSET.LIST TYPE="Variables.grouptype" FIELD1="id" VALUE1="Variables.currentVal" LIST="lCurrentParent"/>
												<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="InspectThisItem" ESCAPE="true"/>
												<IF COND="Variables.separatorTag=1">
													<THEN>
														<br/>
													</THEN>
													<ELSE>
														<SETVAR NAME="separatorTag" VALUE="1"/>
													</ELSE>
												</IF>
												<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
													<ARGUMENT NAME="assettype" VALUE="Variables.grouptype"/>
													<ARGUMENT NAME="assetid" VALUE="lCurrentParent.id"/>
													<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
													<ARGUMENT NAME="function" VALUE="inspect"/>
												</CALLELEMENT>
												<a href="Variables.urlInspectItem" OnMouseOver="window.status='Variables.InspectThisItem'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables.InspectThisItem"><STRING.STREAM LIST="lCurrentParent" COLUMN="name"/></a>&nbsp;
												<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
													<ARGUMENT NAME="assettype" VALUE="Variables.grouptype"/>
													<ARGUMENT NAME="assetid" VALUE="lCurrentFilter.id"/>
													<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
													<ARGUMENT NAME="function" VALUE="inspect"/>
												</CALLELEMENT>
												(<a href="Variables.urlInspectItem" OnMouseOver="window.status='Variables.InspectThisItem'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables.InspectThisItem"><STRING.STREAM LIST="lCurrentFilter" COLUMN="name"/></a>)
											</THEN>
											<ELSE>
												<SETVAR NAME="errno" VALUE="0"/>
												<!-- ContentDetails:DGroup_1025295073206Test:Total = 2 -->
												<ICS.RESOLVEVARIABLES NAME="$(Variables.ContentDetails:DGroup_$(lFilterList.assetid)$(lCurrentPD.name):Total)" OUTPUT="currentVal" DELIMITED="true"/>
												<IF COND="Variables.errno=0">
													<THEN>
														<IF COND="Variables.currentVal!=0">
															<THEN>
																<SETCOUNTER NAME="valTotal" VALUE="0"/>
																<LOOP COUNT="Variables.currentVal">
																	<ICS.RESOLVEVARIABLES NAME="$(Variables.ContentDetails:DGroup_$(lFilterList.assetid)$(lCurrentPD.name):$(Counters.valTotal))" OUTPUT="currentVal" DELIMITED="true"/>
																	<ASSET.LIST TYPE="Variables.filtertype" FIELD1="id" VALUE1="lFilterList.assetid" LIST="lCurrentFilter"/>
																	<ASSET.LIST TYPE="Variables.grouptype" FIELD1="id" VALUE1="Variables.currentVal" LIST="lCurrentParent"/>
																	<XLAT.LOOKUP KEY="dvin/Common/InspectThisItem" VARNAME="InspectThisItem" ESCAPE="true"/>
																	<IF COND="Variables.separatorTag=1">
																		<THEN>
																			<br/>
																		</THEN>
																		<ELSE>
																			<SETVAR NAME="separatorTag" VALUE="1"/>
																		</ELSE>
																	</IF>
																	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
																		<ARGUMENT NAME="assettype" VALUE="Variables.grouptype"/>
																		<ARGUMENT NAME="assetid" VALUE="lCurrentParent.id"/>
																		<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
																		<ARGUMENT NAME="function" VALUE="inspect"/>
																	</CALLELEMENT>
																	<a href="Variables.urlInspectItem" OnMouseOver="window.status='Variables.InspectThisItem'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables.InspectThisItem"><STRING.STREAM LIST="lCurrentParent" COLUMN="name"/></a>&nbsp;
																	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
																		<ARGUMENT NAME="assettype" VALUE="Variables.grouptype"/>
																		<ARGUMENT NAME="assetid" VALUE="lCurrentFilter.id"/>
																		<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
																		<ARGUMENT NAME="function" VALUE="inspect"/>
																	</CALLELEMENT>
																	(<a href="Variables.urlInspectItem" OnMouseOver="window.status='Variables.InspectThisItem'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.urlInspectItem,Variables.InspectThisItem"><STRING.STREAM LIST="lCurrentFilter" COLUMN="name"/></a>)
																	<INCCOUNTER NAME="valTotal" VALUE="1"/>
																</LOOP>
															</THEN>
														</IF>
													</THEN>
												</IF>
											</ELSE>
										</IF>
									</THEN>
								</IF>
							</THEN>
						</IF>
					</LOOP>
				</THEN>
			</IF>
		</THEN>
	</IF>
</FTCS>
