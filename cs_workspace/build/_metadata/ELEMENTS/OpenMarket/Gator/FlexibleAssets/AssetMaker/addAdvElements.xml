<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Gator/FlexibleAssets/AssetMaker/addAdvElements
--
-- INPUT
--
-- OUTPUT
--
-->
<setvar NAME="addElementsError" VALUE="Variables.empty"/>
<setvar NAME="tablename" VALUE="ElementCatalog"/>
<setvar NAME="errno" VALUE="0"/>
<ics.literal table="Variables.tablename" column="elementname" string="OpenMarket/Gator/FlexibleAssets/AssetMaker/Variables.elementtype%"
output="literal"/>
 
<EXECSQL SQL="SELECT * FROM Variables.tablename WHERE elementname LIKE Variables.literal" LIST="elements"/>
<IF COND="Variables.errno!=0">
<THEN>
    <setvar NAME="addElementsError" VALUE="Variables.errno"/>
	<!-- <csvar NAME="Could not get elements for Variables.elementtype!"/>     -->
</THEN>
<ELSE>
	<LOOP LIST="elements">
		<SUBSTITUTE STR="elements.elementname" WHAT="Gator/FlexibleAssets/AssetMaker/Variables.elementtype" WITH="Xcelerate/AssetType/Variables.AssetType" OUTSTR="newelement"/>
		<setvar NAME="filename" VALUE="elements.url"/>
		<SUBSTITUTE STR="Variables.filename" WHAT="\" WITH="/" OUTSTR="filename"/>
		<setvar NAME="errno" VALUE="1"/>
		<setvar NAME="offset" VALUE="0"/>
		<LOOP UNTIL="Variables.errno=0">
         <INDEXOF STR="Variables.filename" WHAT="/" OUTSTR="offset" INDEX="Variables.offset"/>
			<IF COND="Variables.errno=1">
			<THEN>
				<setvar NAME="lastoffset" VALUE="Variables.offset"/>
			</THEN>
			</IF>
			<SETCOUNTER NAME="index" VALUE="Variables.offset"/>
			<INCCOUNTER NAME="index" VALUE="1"/>
			<setvar NAME="offset" VALUE="Counters.index"/>
      </LOOP>
		<CALCULATOR.GO VALUE="Variables.lastoffset 1 +" VARNAME="offset"/>
		<SUBSTRING STR="Variables.filename" OUTSTR="filename" INDEX="Variables.offset"/>
		<setvar NAME="urlelement_file" VALUE="Variables.filename"/>
		<setvar NAME="urlelement" VALUE="elements.@url"/>
		
		<CATALOGMANAGER>
			<ARGUMENT NAME="ftcmd" VALUE="replacerow"/>
			<ARGUMENT NAME="tablename" VALUE="ElementCatalog"/>
			<ARGUMENT NAME="elementname" VALUE="Variables.newelement"/>
			<ARGUMENT NAME="description" VALUE="elements.description"/>
			<ARGUMENT NAME="url_file" VALUE="Variables.urlelement_file"/>
			<ARGUMENT NAME="url_folder" VALUE="OpenMarket/Xcelerate/AssetType/Variables.AssetType"/>
			<ARGUMENT NAME="url" VALUE="Variables.urlelement"/>
		</CATALOGMANAGER>
		<IF COND="Variables.errno!=0">
		<THEN>
            <setvar NAME="addElementsError" VALUE="Variables.errno"/>
			<!-- <csvar NAME="Adding to ElementCatalog table failed with Variables.errno!"/><br/>   -->
		</THEN>
		</IF>
	</LOOP>
</ELSE>
</IF>

</FTCS> 
