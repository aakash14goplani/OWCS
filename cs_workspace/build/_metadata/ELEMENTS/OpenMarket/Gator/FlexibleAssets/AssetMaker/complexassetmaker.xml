<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- complexassetmaker
--
-- INPUT
--
-- OUTPUT
--
-->
<!-- [2007-09-18 KG]
 * XSS fixes (adapted from 6.3 fixes):
   * isCleanString function usage
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/ValidateInputForXSS" />
<SCRIPT LANGUAGE="JavaScript">
<![CDATA[

function trim(str)
{
if(str=='' || !str)
return '';

var tempStr = new String(str);
return tempStr.replace(/^\s\s*/, '').replace(/\s\s*$/, '');

}

function checkfields()
{
	var obj = document.forms[0];
	
	if (obj.elements['NewAttribute'].value=='') {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/MustselectFlexAttribute" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	if (!isCleanString(obj.elements['NewAttribute'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAttribute'].focus();
		return false;
	}
    if (!IsAllowedInTablename(obj.elements['NewAttribute'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexAttribute" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAttribute'].focus();
		return false;
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewAttribute'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAttribute'].focus();
		return false;
	}
	if (obj.elements['NewGroupTemplate'].value=='') {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/MustselectFlexParentDef" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	if (!isCleanString(obj.elements['NewGroupTemplate'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroupTemplate'].focus();
		return false;
	}
    if (!IsAllowedInTablename(obj.elements['NewGroupTemplate'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexParentDef" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroupTemplate'].focus();
		return false;
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewGroupTemplate'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroupTemplate'].focus();
		return false;
	}
	if (obj.elements['NewAssetTemplate'].value=='') {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/MustselectFlexDef" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	if (!isCleanString(obj.elements['NewAssetTemplate'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAssetTemplate'].focus();
		return false;
	}
    if (!IsAllowedInTablename(obj.elements['NewAssetTemplate'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexDef" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAssetTemplate'].focus();
		return false;
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewAssetTemplate'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewAssetTemplate'].focus();
		return false;
	}
	if (obj.elements['NewGroup'].value=='') {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/MustselectFlexParent" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	if (!isCleanString(obj.elements['NewGroup'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroup'].focus();
		return false;
	}
    if (!IsAllowedInTablename(obj.elements['NewGroup'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexParent" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroup'].focus();
		return false;
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewGroup'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewGroup'].focus();
		return false;
	}
	if (obj.elements['NewProdAsset'].value=='') {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/MustselectFlexAsset" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	if (!isCleanString(obj.elements['NewProdAsset'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewProdAsset'].focus();
		return false;
	}
    if (!IsAllowedInTablename(obj.elements['NewProdAsset'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexAsset" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewProdAsset'].focus();
		return false;
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewProdAsset'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewProdAsset'].focus();
		return false;
	}
	if (!isCleanString(obj.elements['NewFilter'].value)) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewFilter'].focus();
		return false;
	}
    if (obj.elements['NewFilter'] && trim(obj.elements['NewFilter'].value) !='' && !IsAllowedInTablename(obj.elements['NewFilter'].value))
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NotAllowedInNameFlexFilter" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewFilter'].focus();
		return false;
	}
	if(obj.elements['NewFilter'] && trim(obj.elements['NewFilter'].value) =='')
	{
		obj.elements['NewFilter'].value= '';
	}
    if (obj.elements['tablenamesizelimit'] && obj.elements['NewFilter'].value.length>20)
	{
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/NameTooLong" ESCAPE="true" ENCODE="false"/><![CDATA[");
        obj.elements['NewFilter'].focus();
		return false;
	}
	
	// check whether the values entered by the user for the different flex asset types are not same
	var flexObjRefArray = new Array();
	var flexNamesArray = new Array();
	
	flexObjRefArray[0] = obj.elements['NewAttribute'];
	flexObjRefArray[1] = obj.elements['NewGroupTemplate'];
    flexObjRefArray[2] = obj.elements['NewAssetTemplate'];
    flexObjRefArray[3] = obj.elements['NewGroup'];
    flexObjRefArray[4] = obj.elements['NewProdAsset'];
    flexObjRefArray[5] = obj.elements['NewFilter'];

	]]>    
      flexNamesArray[0] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexAttribute" ESCAPE="true" ENCODE="false"/>";
	  flexNamesArray[1] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexParentDefinition" ESCAPE="true" ENCODE="false"/>";
	  flexNamesArray[2] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexDefinition" ESCAPE="true" ENCODE="false"/>";
	  flexNamesArray[3] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexParent" ESCAPE="true" ENCODE="false"/>";
	  flexNamesArray[4] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexAsset" ESCAPE="true" ENCODE="false"/>";
	  flexNamesArray[5] = "<XLAT.STREAM KEY="dvin/FlexibleAssets/Common/FlexFilter" ESCAPE="true" ENCODE="false"/>";
	  var message = "<XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/ValueCannotBeSame" ESCAPE="true" ENCODE="false"/>";	
<![CDATA[	

     var match=false;
     for (var i=0; i < flexObjRefArray.length -1; i++)
     {
		
		for (var j=i+1; j < flexObjRefArray.length; j++)
		{
		
	         if (flexObjRefArray[i].value.toLowerCase() == flexObjRefArray[j].value.toLowerCase())
	         {
	            match = true;
	            break;
	         }
	    }
         
         if (match == true )
         {
            break;
         }
     }
     
     if (match == true)
     {
        message = message.replace(/Variables.FlexAssetType1/, flexNamesArray[i]);
		message = message.replace(/Variables.FlexAssetType2/, flexNamesArray[j]);
		alert (message);
		
		
		flexObjRefArray[j].focus();
		
		return false;
     }   	    
return true;	 
}
]]>
<!-- to check if the string includes things NOT allowed in table names ! -->
<![CDATA[
function IsAllowedInTablename(StrVar)
{
 return /^[a-zA-Z\_]([0-9a-zA-Z\_])*$/.test(StrVar);
}

]]>
</SCRIPT>         

<input TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/FlexAssetMakerFront"/>
<input TYPE="HIDDEN" NAME="action" VALUE="confirmmakeasset"/>

<!-- check dbtype and set max table name size   
     assettype name size in flex asset tables limited to 32
     Oracle has a 30 char table name limit. with "-Extention" tables
     for flex assets .. the table name size is 20 -->
<ics.getproperty name="cs.dbtype" file="futuretense.ini" output="dbtype"/>
<IF COND="Variables.dbtype=Oracle">
    <THEN>
        <input TYPE="HIDDEN" NAME="tablenamesizelimit" VALUE="20"/>
    </THEN>
</IF>
	<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
		<tr><td>
			<span class="title-text"><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/AddNewFlexFamily"/></span>
		</td></tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>		
	<table class="width-outer-30" BORDER="0" CELLSPACING="0" CELLPADDING="0">
	<tr>
		<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
	</tr>
	<tr>
		<td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr>
				<td class="form-label-text"><span class="alert-color">*</span><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexAttr"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewAttribute" SIZE="32" MAXLENGTH="22"/></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr>
				<td class="form-label-text"><span class="alert-color">*</span><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexParentDef"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewGroupTemplate" SIZE="32" MAXLENGTH="22"/></td>
			</tr>

			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr><td class="form-label-text"><span class="alert-color">*</span><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexDef"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewAssetTemplate" SIZE="32" MAXLENGTH="22"/></td>
			</tr>

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr><td class="form-label-text"><span class="alert-color">*</span><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexParent"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewGroup" SIZE="32" MAXLENGTH="22"/></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr><td class="form-label-text"><span class="alert-color">*</span><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexAsset"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewProdAsset" SIZE="32" MAXLENGTH="22"/></td>
			</tr>

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/> 
			<tr><td class="form-label-text"><XLAT.STREAM KEY="dvin/FlexibleAssets/AssetMakers/FlexFilter"/></td>
				<td class="form-inset"><INPUT TYPE="text" NAME="NewFilter" SIZE="32" MAXLENGTH="22"/></td>
			</tr>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/FlexAssetMakerFront" outstring="AssetFrontURL">
			<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
			<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
			<satellite.argument name="action" value="list"/>
			</SATELLITE.LINK>
	
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
					
					<XLAT.LOOKUP KEY="dvin/UI/Cancel" ESCAPE="true" VARNAME="_XLAT_"/>
					<A HREF="Variables.AssetFrontURL" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_,Variables.AssetFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					<XLAT.LOOKUP KEY="dvin/AT/Common/Continue" ESCAPE="true" VARNAME="_XLAT_"/>
					<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit();return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Continue"/></CALLELEMENT></A>
				</TD>
			</TR>
		</table>

	</td>
	
	</tr>
	

</table>
</FTCS> 
