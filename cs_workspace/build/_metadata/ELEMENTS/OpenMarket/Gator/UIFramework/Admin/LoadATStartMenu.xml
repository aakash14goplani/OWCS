<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/Admin/LoadATStartMenu
-
- INPUT
-
- OUTPUT
-
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- This element handles all children of the StartMenu root node -->
<!-- All we need to do is 'Add New' and any StartMenu Items -->
<XLAT.LOOKUP KEY="dvin/TreeApplet/AddNew" ENCODE="false" VARNAME="_AddNew_"/> 
	<REMOVEVAR NAME="Description"/>
	
	<!-- display Add New, CS Direct and CS Desktop dummy nodes -->
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
		<ARGUMENT NAME="AdHoc" VALUE="StartMenu:New"/>
		<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="LoadURL"/>
	<REMOVEVAR NAME="OKActions"/>
    <XLAT.LOOKUP KEY="dvin/TreeApplet/AddNew" ENCODE="false" VARNAME="_XLAT_"/>
	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/StartMenuFront" outstring="ExecuteURL">
		<satellite.argument name="op" value="new"/>
		<satellite.argument name="AssetType" value="Variables.ATFilter"/>
	</SATELLITE.LINK>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
		<satellite.argument name="AssetType" value="Variables.AssetType"/>
	</SATELLITE.LINK>
	<XLAT.LOOKUP KEY="dvin/UI/AddNewStartMenu" ENCODE="false" VARNAME="_XLAT_"/>
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode"> 
		<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/> 
		<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
		<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
		<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
		<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
		<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="ExecuteURL"/>
	
	<STARTMENU.GETALLSTARTITEMS ASSETTYPE="Variables.ATFilter" LISTVARNAME="menuitems"/>
	<IF COND="Variables.errno=0">
	<THEN>
		<IF COND="IsList.menuitems=true">
		<THEN>
			<IF COND="menuitems.#numRows!=0">
			<THEN>
				<LOOP LIST="menuitems">
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
						<ARGUMENT NAME="AdHoc" VALUE="StartMenu:Existing:menuitems.id"/>
						<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>

					</CALLELEMENT>
					
					<REMOVEVAR NAME="LoadURL"/>
					<REMOVEVAR NAME="OKActions"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/StartMenuFront" outstring="ExecuteURL">
						<satellite.argument name="op" value="view"/>
						<satellite.argument name="startitem" value="menuitems.id"/>
					</SATELLITE.LINK>

					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
						<satellite.argument name="AssetType" value="Variables.AssetType"/>
					</SATELLITE.LINK>
					
					<!-- If description, which is an optional field, is empty, show its name as tool-tip.-->
					<IF COND="menuitems.description=Variables.empty">
					<THEN>
					<SETVAR NAME="desc" VALUE="menuitems.name" />
					</THEN>
					<ELSE>
					<SETVAR NAME="desc" VALUE="menuitems.description" />
					</ELSE>
					</IF>
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
						<ARGUMENT NAME="Label" VALUE="menuitems.name"/>
						<ARGUMENT NAME="Description" VALUE="Variables.desc"/> 
						<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
						<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
						<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
						<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/SMmenuitems.itemtype.png"/>
					</CALLELEMENT>
				</LOOP>
			</THEN>
			</IF>
		</THEN>
		</IF>
	</THEN>
	</IF>

</FTCS> 
