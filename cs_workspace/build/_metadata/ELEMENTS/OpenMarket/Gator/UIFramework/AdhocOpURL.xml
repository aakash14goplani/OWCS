<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Gator/UIFramework/AdhocOpURL
-
- INPUT
-
- OUTPUT
-
-->

<!-- first check to see if the user is logged in or not -->
<SETVAR NAME='_IS_TREE_ELEMENT_' VALUE='true'/>
<ICS.CLEARERRNO/>
<USERISMEMBER GROUP="xceleditor"/>
<IF COND="Variables.errno=0">
<THEN>

    <SATELLITE.LINK ASSEMBLER="query" PAGENAME="OpenMarket/Xcelerate/Actions/Security/TimeoutError" OUTSTRING="urlstring">
    </SATELLITE.LINK>
	<REPLACE STR="Variables.urlstring">
		<SCRIPT LANGUAGE="JavaScript">
			parent.parent.location="Variables.urlstring";
		</SCRIPT>
	</REPLACE>
	<THROWEXCEPTION/>
</THEN>
</IF>

<!-- parse out node data -->
<SETCOUNTER NAME="myoutercounter" VALUE="0"/>
<SETVAR NAME="outertermvar" VALUE="false"/>
<SETCOUNTER NAME="missingTermTot" VALUE="0"/>
<REMOVEVAR NAME="TreeNodePath"/>
<REMOVEVAR NAME="TreeNodeParentPath"/>
<REMOVEVAR NAME="TreeNodeOldParentPath"/>

<SETVAR NAME="pathKey" VALUE="nCounters.myoutercounter_"/>
<ICS.CLEARERRNO/>
<SETVAR NAME="testPathValue" VALUE="Variables.Variables.pathKey"/>
<BEGINS STR="Variables.testPathValue" WHAT="Variables."/>
<IF COND="Variables.errno=0">
	<THEN>
		<SETVAR NAME="TreeNodePath" VALUE="Variables.Variables.pathKey"/>
	</THEN>
	<ELSE>
		<INCCOUNTER NAME="missingTermTot" VALUE="1"/>
	</ELSE>
</IF>

<IF COND="Counters.missingTermTot!=1">
	<THEN>

<!-- handle the opcode -->
		<IF COND="IsVariable.op=true">
			<THEN>
				 <!-- need to match op to the translation -->
				 <STRINGLIST NAME="lCommandList" STR="Delete;Edit;Inspect" DELIM=";"/>
				 <SETVAR NAME="foundOp" VALUE="no"/>
				 <LOOP LIST="lCommandList">
						<XLAT.LOOKUP KEY="dvin/TreeApplet/Commands/lCommandList.ITEM" ENCODE="false" VARNAME="currentTranslation"/>
						<IF COND="Variables.currentTranslation=Variables.op">
							<THEN>
								 <SETVAR NAME="foundOp" VALUE="yes"/>
								 <SETVAR NAME="op" VALUE="lCommandList.ITEM"/>
								 <SETROW LIST="lCommandList" ACTION="LAST"/>
							</THEN>
						</IF>
				 </LOOP>
				 <ICS.CLEARERRNO/>
		
				<IF COND="Variables.type=WFG"> <!--Workflow Group-->
					<THEN>
						
						<IF COND="Variables.op=Edit">
							<THEN>
								<SETVAR NAME="op" VALUE="editNode"/>
							</THEN>
							<ELSE>
								<IF COND="Variables.op=Delete">
									<THEN>
										<SETVAR NAME="op" VALUE="deleteNode"/>
									</THEN>
									<ELSE>
										<IF COND="Variables.op=Inspect">
											<THEN>
												<SETVAR NAME="op" VALUE="displayNode"/>
											</THEN>
										</IF>
									</ELSE>
								</IF>
							</ELSE>
						</IF>

						<!--common code for all opcodes-->
						<STRINGLIST DELIM="&#38;" NAME="treelist" STR="Variables.TreeNodePath"/>
						<SETROW LIST="treelist" ACTION="LAST"/>
						<SETVAR NAME="id" VALUE="treelist.ITEM"/>
		 
						<IF COND="Variables.op=deleteNode">
							<THEN>
								<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
									<ARGUMENT NAME="ThisPage" VALUE="DeleteGroupFront"/>
									<ARGUMENT NAME="PostPage" VALUE="DeleteGroupPost"/>
									<ARGUMENT NAME="contentfunctions" VALUE="true"/>
									<ARGUMENT NAME="TreeNodePath"  VALUE="Variables.TreeNodePath"/>
									<ARGUMENT NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
								</CALLELEMENT>
							</THEN>
							<ELSE>
								<IF COND="Variables.op=displayNode">
									<THEN>
										<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
											<ARGUMENT NAME="ThisPage"  VALUE="WorkflowGroupDetailsFront"/>
											<ARGUMENT NAME="contentfunctions" VALUE="true"/>
										</CALLELEMENT>
									</THEN>
									<ELSE>
										<IF COND="Variables.op=editNode">
											<THEN>
												<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
													<ARGUMENT NAME="ThisPage" VALUE="EditWorkflowGroupFront"/>
													<ARGUMENT NAME="PostPage" VALUE="EditWorkflowGroupPost"/>
													<ARGUMENT NAME="contentfunctions" VALUE="true"/>
													<ARGUMENT NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
												</CALLELEMENT>
											</THEN>
										</IF>
									</ELSE>
								</IF>
							</ELSE>
						</IF>
					</THEN>
				</IF>
			</THEN>
		</IF>
	</THEN>
</IF>
<REMOVEVAR NAME='_IS_TREE_ELEMENT_'/>
</FTCS> 