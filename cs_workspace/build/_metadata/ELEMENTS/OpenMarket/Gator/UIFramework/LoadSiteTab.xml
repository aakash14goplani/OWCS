<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/LoadSiteTab
-
- INPUT
-
- OUTPUT
-
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- Site tab loads come through this page.  On tab initialization, op=init
  -- and each assettype in this tab will have its LoadSiteTree element called.
  --
  -- If op=load, only the LoadSiteTree for the specified assettype will be
  -- called.
  -->

   <SATELLITE.LINK ASSEMBLER="query" OUTSTRING="url" PAGENAME="OpenMarket/Xcelerate/Actions/Security/TimeoutError">
   </SATELLITE.LINK>

<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceleditor"/>
<if COND="Variables.errno=0">
<then> 
	Status:4:fail:
	<STRING.LENGTH VALUE="Variables.url" VARNAME="count"/>
	FailURL:<CSVAR NAME="Variables.count:Variables.url"/>:
	END:3:END:
	<throwexception/>
</then>
</if>

<IF COND="Variables.op=load">
<THEN>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/AssetType/Variables.AssetType/LoadSiteTree"/>
</THEN>
<ELSE>
	<!-- Get data for tab to load -->
	<IF COND="IsVariable.tabid=true">
	<THEN>
      <TTM.GETORDEREDSECTIONS ID="Variables.tabid" PUBID="SessionVariables.pubid" LISTVARNAME="sections"/>
		
		<IF COND="Variables.errno=0">
		<THEN>
			<LOOP LIST="sections">
				<IF COND="sections.containername=AssetTypes">
				<THEN>
					<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/EnableAssetTypePub">
						<argument NAME="upcommand" VALUE="IsAssetTypeEnabled"/>
						<argument NAME="assettype" VALUE="sections.name"/>
						<argument NAME="pubid" VALUE="SessionVariables.pubid"/>
					</callelement>
					<if COND="Variables.IsAuthorized=true">
					<then>
						<CALLELEMENT NAME="OpenMarket/Xcelerate/AssetType/sections.name/LoadSiteTree">
							<ARGUMENT NAME="AssetType" VALUE="sections.name"/>
							<ARGUMENT NAME="op" VALUE="init"/>
						</CALLELEMENT>
					</then>
					</if>
				</THEN>
				</IF>
			</LOOP>
		</THEN>
		</IF>
	</THEN>
	</IF>
</ELSE>
</IF>

</FTCS> 
