<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/LoadTab
-
- INPUT
-
- OUTPUT
-
-->
<SETVAR NAME='_IS_TREE_ELEMENT_' VALUE='true'/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- All tree loads come through this page.  On tab initialization, op=init
  -- and each assettype in this tab will have its TreeLoad element called.
  --
  -- If op=load, only the TreeLoad for the specified assettype will be
  -- called.
  -->

<SATELLITE.LINK ASSEMBLER="query" OUTSTRING="url" PAGENAME="OpenMarket/Xcelerate/Actions/Security/TimeoutError">
</SATELLITE.LINK>
<SETVAR NAME="errno" VALUE="0"/>

<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceleditor"/>
<if COND="Variables.errno=0">
<then> 
	Status:4:fail:
	<STRING.LENGTH VALUE="Variables.url" VARNAME="count"/>
	FailURL:<CSVAR NAME="Variables.count:Variables.url"/>:
	END:3:END:
	<throwexception/>
</then>
</if>

<SETVAR NAME="madeANode" VALUE="no"/>

<IF COND="Variables.op=load">
<THEN>
	<CALLELEMENT NAME="Variables.populate"/>
</THEN>
<ELSE>
   <!-- Get data for tab to load -->
	<IF COND="IsVariable.tabid=true">
	<THEN>
		<TTM.GETORDEREDSECTIONS ID="Variables.tabid" PUBID="SessionVariables.pubid" LISTVARNAME="sections"/>
		<IF COND="Variables.errno=0">
		<THEN>
			<LOOP LIST="sections">
                <IF COND="IsElement.sections.populateurl=true">
                <THEN>
    				<CALLELEMENT NAME="sections.populateurl">
    					<ARGUMENT NAME="AssetType" VALUE="sections.name"/>
    					<ARGUMENT NAME="op" VALUE="init"/>
    				</CALLELEMENT>
                </THEN>
                </IF>
			</LOOP>
		</THEN>
		</IF>
	</THEN>
	</IF>
</ELSE>
</IF>

<IF COND="Variables.madeANode=no">
<THEN>
	<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID">
		<argument NAME="ID" VALUE="CS.UniqueID"/>
	</callelement>
	
	<REMOVEVAR NAME="Description"/>
	<REMOVEVAR NAME="LoadURL"/>
	<REMOVEVAR NAME="ExecuteURL"/>
	<REMOVEVAR NAME="Image"/>
	<REMOVEVAR NAME="OpURL"/>
<!-- 
   Added a Variable  HasNochildren Found indicator / flag 
   to be consulted when no result set nodes
   No Items to Display is meaningless in UC1 
   
 -->
   <XLAT.LOOKUP KEY="dvin/TreeApplet/NoItemsToDisplay" ENCODE="false" VARNAME="_XLAT_"/>
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
		<ARGUMENT NAME="Label" VALUE="[Variables._XLAT_]"/>
	    <ARGUMENT NAME="hasChildren" VALUE="No"/>	
		<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
		<ARGUMENT NAME="OKActions" VALUE="refresh"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="hasChildren"/>
</THEN>
</IF>
<REMOVEVAR NAME='_IS_TREE_ELEMENT_'/>
</FTCS> 
