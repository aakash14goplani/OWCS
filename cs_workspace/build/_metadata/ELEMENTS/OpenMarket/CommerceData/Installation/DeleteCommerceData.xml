<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Installation/DeleteCommerceData
-
- INPUT
-
- OUTPUT
-
-->


<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- DESCRIPTION
-    Root element used to delete all CommerceData elements.  
-
- INPUT
-    None.
-
-->


<setvar NAME="result" VALUE="Variables.empty"/>

<setvar NAME="errno" VALUE="0"/>
<setvar NAME="tablename" VALUE="SystemSQL"/>
<execsql LIST="Systemdata" SQL="SELECT qryname FROM SystemSQL WHERE qryname LIKE 'OpenMarket/CommerceData/%'"/>
<if COND="IsError.Variables.errno=true">
<then>
    <setvar NAME="result" VALUE="No SystemSQL CommerceData entries found, errno=Variables.errno"/>
</then>
<else>
    <loop LIST="Systemdata">
	<CATALOGMANAGER SCOPED="stacked">
	    <ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
	    <ARGUMENT NAME="tablename" VALUE="SystemSQL"/>
	    <ARGUMENT NAME="qryname" VALUE="Systemdata.qryname"/>
	    <ARGUMENT NAME="Delete uploaded file(s)" VALUE="yes"/>
	    <ARGUMENT NAME="errno" VALUE="0"/>
	</CATALOGMANAGER>
	<if COND="IsError.Variables.errno=true">
	<then>
	    <setvar NAME="result" VALUE="Could not delete SystemSQL row elements.elementname, errno=Variables.errno"/>
	</then>
	</if>
    </loop>
</else>
</if>

<setvar NAME="errno" VALUE="0"/>
<setvar NAME="tablename" VALUE="SiteCatalog"/>
<execsql LIST="pages" SQL="SELECT pagename FROM SiteCatalog WHERE pagename LIKE 'OpenMarket/CommerceData/%'"/>
<if COND="IsError.Variables.errno=true">
<then>
    <setvar NAME="result" VALUE="No SiteCatalog/CommerceData entries found, errno=Variables.errno"/>
</then>
<else>
    <loop LIST="pages">
	<CATALOGMANAGER SCOPED="stacked">
	    <ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
	    <ARGUMENT NAME="tablename" VALUE="SiteCatalog"/>
	    <ARGUMENT NAME="pagename" VALUE="pages.pagename"/>
	    <ARGUMENT NAME="errno" VALUE="0"/>
	</CATALOGMANAGER>
	<if COND="IsError.Variables.errno=true">
	<then>
	    <setvar NAME="result" VALUE="Could not delete SiteCatalog row pages.pagename, errno=Variables.errno"/>
	</then>
	</if>
    </loop>
</else>
</if>

<setvar NAME="errno" VALUE="0"/>
<setvar NAME="tablename" VALUE="ElementCatalog"/>
<execsql LIST="elements" SQL="SELECT elementname FROM ElementCatalog WHERE elementname LIKE 'OpenMarket/CommerceData/%'"/>
<if COND="IsError.Variables.errno=true">
<then>
    <setvar NAME="result" VALUE="No ElementCatalog CommerceData entries found, errno=Variables.errno"/>
</then>
<else>
    <loop LIST="elements">
	<CATALOGMANAGER SCOPED="stacked">
	    <ARGUMENT NAME="ftcmd" VALUE="deleterow"/>
	    <ARGUMENT NAME="tablename" VALUE="ElementCatalog"/>
	    <ARGUMENT NAME="elementname" VALUE="elements.elementname"/>
	    <ARGUMENT NAME="Delete uploaded file(s)" VALUE="yes"/>
	    <ARGUMENT NAME="errno" VALUE="0"/>
	</CATALOGMANAGER>
	<if COND="IsError.Variables.errno=true">
	<then>
	    <setvar NAME="result" VALUE="Could not delete ElementCatalog row elements.elementname, errno=Variables.errno"/>
	</then>
	</if>
    </loop>
</else>
</if>


<if COND="Variables.result!=Variables.empty">
<then>
    <logmsg STR="Xcelerate Installation Error in DeleteInstallation: Variables.result"/>
    ##ERROR## <csvar NAME="Variables.result"/><BR/>
</then>
<else>
    ##SUCCESS## <csvar NAME="Variables.result"/><BR/>
</else>
</if>

</FTCS> 
