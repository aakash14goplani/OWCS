<?XML VERSION="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.0">

<SCRIPT LANGUAGE="JavaScript">
    <![CDATA[
    
function isKeyEntered(form)
{
	return true;
}

function isUsernameEntered(form)
{
    if (form.username.value == "")
	{
		window.alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustEnterUserName" ENCODE="false" ESCAPE="true"/> <![CDATA[');

        return false;
    }
	return true;
}

function isUsernameValid(form)
{  
	var iChars = "~!@#$%^&*()+-={}|[]\\:\";'<>?,/";     
	var whitespace = " \t\n\r";

	var i = 0;
	for (i = 0; i < form.username.value.length; i++) 
	{
		var c= form.username.value.charAt(i);
		if (iChars.indexOf(c) != -1 ) 
		{
			window.alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/UserNameInvalid" ENCODE="false" ESCAPE="true"/> <![CDATA[');
			return false;
		}
		if(whitespace.indexOf(c) != -1 )
		{
			window.alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/UserNameContainSpace" ENCODE="false" ESCAPE="true"/> <![CDATA[');
			return false;
		}

	}
	
	return true;
}
  
function checkCreateInput(form)
{
	if (!isUsernameEntered(form))
		return false;
	
	if (!isUsernameValid(form))
		return false;
		
	if (!setupACLParam(form))
		return false;

	if (!setupPasswordParam(form,true))
		return false;

	return true;
}

function checkModifyInput(form)
{
      	var selectedUser = form.username.value;
      	if ( isSystemUser(selectedUser) )
    	{
    		]]> var replacestr=/\bVariables.selectedUser\b/   ;
            var xlatstr= '<XLAT.STREAM KEY="dvin/UI/CSAdminForms/ModifySystemUserConfirmationQ" ENCODE="false" ESCAPE="true"/>' ;
            var newstr=xlatstr.replace(replacestr, selectedUser) ;
            if (!confirm(newstr)) <![CDATA[
               return false;
    	}
   
	if (!setupACLParam(form))
		return false;

	var validatePassword = false;
	if (form.modifyPassword.checked)
		validatePassword = true;

	if (!setupPasswordParam(form,validatePassword))
		return false;

	return true;
}

function setupDeleteParams(form)
{
	var selectedUser = "";
	for(i=0 ; i < form.username.length ; i++)
	{
		if (form.username[i].checked)
		{
			selectedUser = form.username[i].value;
			break;
		}
	}
	if ( (form.username.length == null) && (form.username.checked) )
		selectedUser = form.username.value;

	if (selectedUser == "")
	{
		alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustSelectUserToDelete" ENCODE="false" ESCAPE="true"/><![CDATA[');
		return false;
	}

   if ( isSystemUser(selectedUser) )
	{
         ]]> var replacestr=/\bVariables.selectedUser\b/   ;
        var xlatstr= '<XLAT.STREAM KEY="dvin/UI/CSAdminForms/ModifySystemUserConfirmationQ" ENCODE="false" ESCAPE="true"/>' ;
        var newstr=xlatstr.replace(replacestr, selectedUser) ;
        if (!confirm(newstr)) <![CDATA[
 		return false;
	}

	return true;
}

function getACLParam(ACLSelect)
{
	var selectedACL = "";
	var numACLs = 0;
	for (j=0; j < ACLSelect.options.length; j++)
	{
		if (ACLSelect.options[j].selected)
		{
			if (numACLs++ > 0)
				selectedACL += ',';
			selectedACL += ACLSelect.options[j].value;
		}
	}
	return selectedACL;
}

function getACLParam(ACLSelect)
{
	var selectedACL = "";
	var numACLs = 0;
	for (j=0; j < ACLSelect.options.length; j++)
	{
		if (ACLSelect.options[j].selected)
		{
			if (numACLs++ > 0)
				selectedACL += ',';
			selectedACL += ACLSelect.options[j].value;
		}
	}
	return selectedACL;
}

function setupACLParam(form)
{
	var selectedACL = null;

	for(i=0; i < form.elements.length; i++)
	{
		obj = form.elements[i];
		if (obj.name == "ACLList")
		{
			selectedACL = getACLParam(obj);

			if (selectedACL == "")
			{
				alert(']]> <XLAT.STREAM KEY="dvin/UI/CSAdminForms/SelectAtleastOneAcl" ENCODE="false" ESCAPE="true"/>  <![CDATA[');
              				return false;
			}

			hidden = form.elements[i-1];
			hidden.value = selectedACL;
			return true;
		}
	}
	return false;
}

function setupPasswordParam(form,passwordRequired)
{
	if ( (form.password.value == "") && (passwordRequired) )
	{
		window.alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustEnterAPassword" ENCODE="false" ESCAPE="true"/>' <![CDATA[);
		return false;
	}

	if (!passwordRequired)
	{
		if (form.oldpassword)
			form.oldpassword.value = "";
		form.password.value = "";
		form.password2.value = "";
	}

	if (form.password.value != form.password2.value)
	{
		window.alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/SecondPasswordDoesntMatchOriginal" ENCODE="false" ESCAPE="true"/> <![CDATA[');

		return false;
	}
	else if (form.oldpassword && form.password.value.length > 0 && form.oldpassword.value.length === 0)
	{
		window.alert('The old password must be entered.');
		
		return false;
	}

	return true;
}

function isSystemUser(user)
{
	if (
		(user == "Quick") ||
		(user == "ContentServer") ||
		(user == "DefaultReader")
	   )
	   return true;
	return false;
}

function shouldSelectInList(item,list)
{
	var lowerItem = item.toLowerCase();
	var lowerList = list.toLowerCase();

	for (var index = lowerList.indexOf(","); index != -1;)
	{
		var listItem = lowerList.substring(0,index);
		lowerList = lowerList.substring(index+1,lowerList.length);
		if (listItem == lowerItem)
			return "SELECTED";
		index = lowerList.indexOf(",");
	}

	if (lowerItem == lowerList)
		return "SELECTED";
	return "";
}

function noMatches(query)
{
	alert("]]> <XLAT.STREAM KEY="dvin/UI/CSAdminForms/NoUsersMatch" ENCODE="false" ESCAPE="true"/><![CDATA[+ query");
    
}
 ]]>
</SCRIPT>
</FTCS>
