<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.0">


<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
function isKeyEntered(form)
{
	if ( (form.key.value == "") && (!form.form[1].checked) )
		form.key.value = "%";
	if ( (form.key.value == "%") && (form.form[1].checked) )
		form.key.value = "";

	return true;
}

function isCatalogNameEntered(form)
{
    if (form.tablename.value == "")
	{
	]]>
        window.alert('<XLAT.STREAM KEY="dvin/AdminForms/YouMustEnterACatalogName" ENCODE="false" ESCAPE="true"/>');
	<![CDATA[
        return false;
    }

	return true;
}

function isUploadNameEntered(form)
{
    if (form.uploadDir.value == "")
	{
	]]>
        window.alert('<XLAT.STREAM KEY="dvin/AdminForms/YouMustEnterAFileStorageDirectory" ENCODE="false" ESCAPE="true"/>');
	<![CDATA[
        return false;
    }

	trimTrailing(form.uploadDir);
	return true;
}

function trimTrailing(input)
{
	var inputString = input.value;
	for (trailing = inputString.charAt(inputString.length-1);
		 ((trailing == "/") || (trailing == "\\"));
		 (trailing = inputString.charAt(inputString.length-1))
		)
	{
		inputString = inputString.substring(0,inputString.length-1);
	}
	input.value = inputString;
}

function isDefdirEntered(form)
{
    if (form.defdir.value == "")
	{
	]]>
        window.alert('<XLAT.STREAM KEY="dvin/AdminForms/YouMustEnterAFileStorageDirectory" ENCODE="false" ESCAPE="true"/>');
	<![CDATA[
        return false;
    }

	trimTrailing(form.defdir);
	return true;
}

function checkAddInput(form)
{
	if (!isCatalogNameEntered(form))
		return false;

	if (!isUploadNameEntered(form))
		return false;

	if (!setupACLParam(form))
		return false;

	return setupCatalogParams(form);
}

function checkModifyInput(form)
{
	var selectedCatalog = form.tblname.value;
	if ( isSystemCatalog(selectedCatalog) )
	{
		]]>
		var replacestr=/\bVariables.item\b/;
		var xlatstr='<XLAT.STREAM KEY="dvin/AdminForms/ModifyingMayCauseMalfunction" ENCODE="false" ESCAPE="true"/>';
		var newstr=xlatstr.replace(replacestr, selectedCatalog);
		if (!confirm(newstr))
		<![CDATA[
			return false;
	}

	if (!isDefdirEntered(form))
		return false;

	return setupACLParam(form);
}

function checkMirrorPage(form)
{
	if (form.mirrortarget.value == "")
	{
		]]>
		alert('<XLAT.STREAM KEY="dvin/AdminForms/YouMustSpecifyATargetServer" ENCODE="false" ESCAPE="true"/>');
		<![CDATA[
		return false;
	}
	]]>
	<XLAT.LOOKUP KEY="dvin/Common/Yes" VARNAME="_XLAT_" ENCODE="false" ESCAPE="true"/>
	<![CDATA[
	if ( (form.createtable.options[form.createtable.selectedIndex].value == "Variables._XLAT_")
			&& (form.uploadDir.value == "") )
	{
		]]>
		alert('<XLAT.STREAM KEY="dvin/AdminForms/MustSpecifyAFileStorDirToCreateATable" ENCODE="false" ESCAPE="true"/>');
		return false;
	}
	<XLAT.LOOKUP KEY="dvin/Common/No" VARNAME="_XLAT_"  ENCODE="false" ESCAPE="true"/>
	<![CDATA[
	if ( (form.createtable.options[form.createtable.selectedIndex].value == "Variables._XLAT_")
			&& (form.uploadDir.value != "") )
	{
		]]>
		alert('<XLAT.STREAM KEY="dvin/AdminForms/MustNotSpecifyAFileStorDirIfNotCreatingTable" ENCODE="false" ESCAPE="true"/>');
		<![CDATA[
		return false;
	}

	if (form.uploadDir.value != "")
		trimTrailing(form.uploadDir);

	if (form.tablekeyvalue.value == "")
	{
		form.tablekeyvalue.value = "%";
	}

	return true;
}

function setupDeleteParams(form)
{
	var selectedCatalog = "";
	for(i=0 ; i < form.tablename.length ; i++)
	{
		if (form.tablename[i].checked)
		{
			selectedCatalog = form.tablename[i].value;
			break;
		}
	}
	if ( (form.tablename.length == null) && (form.tablename.checked) )
		selectedCatalog = form.tablename.value;

	if (selectedCatalog == "")
	{
		]]>
		alert('<XLAT.STREAM KEY="dvin/AdminForms/YouMustSelectACatalogToDelete" ENCODE="false" ESCAPE="true"/>');
		return false;
	}
	if (!confirm('<XLAT.STREAM KEY="dvin/AdminForms/AreYouSureYouWantToDeleteTheCatalog" ENCODE="false" ESCAPE="true"/>" ' + selectedCatalog + '"?'))
		return false;

	if ( isSystemCatalog(selectedCatalog) )
	{
		var replacestr=/\bVariables.item\b/;
		var xlatstr='<XLAT.STREAM KEY="dvin/AdminForms/ModifyingMayCauseMalfunction" ENCODE="false" ESCAPE="true"/>';
		var newstr=xlatstr.replace(replacestr, selectedCatalog);
		if (!confirm(newstr))
			return false;
<![CDATA[
	}

	return true;
}

function getACLParam(ACLSelect)
{
	var selectedACL = "";
	var numACLs = 0;
	for (j=0; j < ACLSelect.options.length; j++)
	{
		if (ACLSelect.options[j].selected)
		{
			if (numACLs++ > 0)
				selectedACL += ',';
			selectedACL += ACLSelect.options[j].value;
		}
	}
	if (selectedACL == "")
		selectedACL = " ";
	return selectedACL;
}

function setupACLParam(form)
{
	var selectedACL = null;

    for(i=0 ; i < form.elements.length ; i++)
	{
		obj = form.elements[i];
		if (obj.name == "ACLList")
		{
			selectedACL = getACLParam(obj);

			hidden = form.elements[i-1];
			hidden.value = selectedACL;
			return true;
		}
	}
	return false;
}

function setupCatalogParams(form)
{
	for (var i=0; i < form.elements.length; i++)
	{
		colName = form.elements[i];
		if (colName.name == "colname0")
		{
			for (var j=0; j < numUserFields; j++)
			{
				setupUserField(form,i);
				i += 4;
			}
			return true;
		}
	}
	return false;
}

function isSystemCatalog(catalog)
{
    if (catalog == "adminformimages")
        return true;

    return false;
}

function shouldSelectInList(item,list)
{
	var lowerItem = item.toLowerCase();
	var lowerList = list.toLowerCase();

	for (var index = lowerList.indexOf(","); index != -1;)
	{
		var listItem = lowerList.substring(0,index);
		lowerList = lowerList.substring(index+1,lowerList.length);
		if (listItem == lowerItem)
			return "SELECTED";
		index = lowerList.indexOf(",");
	}

	if (lowerItem == lowerList)
		return "SELECTED";
	return "";
}

var numUserFields = 15;

function generateUserFields()
{
	for (var i=0; i < numUserFields; i++)
	{
		document.writeln('<TR>');
			document.writeln('<TD>');
				document.writeln('<INPUT TYPE="TEXT" NAME="colname' + i + '" SIZE="32" VALUE="">');
			document.writeln('</TD>');
			document.writeln('<TD>');
				document.writeln('<INPUT TYPE="TEXT" NAME="colvalue' + i + '" SIZE="32" VALUE="">');
			document.writeln('</TD>');
		document.writeln('</TR>');
	}
}

function setupUserField(form,index)
{
	if (form.elements[index].value == "")
		return;

	colValue = form.elements[index+1];
	colSize = form.elements[index+2];
	colReq = form.elements[index+3];
	colValue.value = colSize.options[colSize.selectedIndex].value;
	if (colReq.checked)
		colValue.value += colReq.value;
}

function noMatches(query)
{
	alert('No catalogs match "' + query + '"');
}
]]>
</SCRIPT>

</FTCS>

