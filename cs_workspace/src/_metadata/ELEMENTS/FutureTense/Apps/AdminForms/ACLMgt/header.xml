<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.0">

<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
function checkACLInput(form)
{

<!-- Check for an add acl request -->

	if (form.form[1].checked)
		return true;

<!-- Get the name of the selected acl -->

	var index = form.ACLList.selectedIndex;
	var selectedACL = form.ACLList.options[index].value;

<!-- Check for a modify acl request -->

	var replacestr =/\bVariables.selectedACL\b/;
 	if (form.form[0].checked)
	{
		if ( isSystemACL(selectedACL) )
		{
         var xlatstr = ']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/ModifySystemACLQ" ENCODE="false" ESCAPE="true"/><![CDATA[';
         var newstr = xlatstr.replace( replacestr, selectedACL );
			if (!confirm(newstr))
				return false;
		}
		form.key.value = selectedACL;
		return true;
	}

<!-- Otherwise, it must be a delete acl request -->
	
	var xlatstr = ']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/DeleteACLQ" ESCAPE="true" ENCODE="false"/><![CDATA[';
   var newstr = xlatstr.replace( replacestr, selectedACL );
	if (!confirm(newstr))
		return false;

	if ( isSystemACL(selectedACL) )
	{
      xlatstr = ']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/ModifySystemACLQ" ENCODE="false" ESCAPE="true"/><![CDATA[';
      newstr = xlatstr.replace( replacestr, selectedACL );
		if (!confirm(newstr))
			return false;
	}

	form.key.value = selectedACL;
	return true;
}

function checkAddInput(form)
{
	
	if ( form.aclname.value.match(/^\s+|\s+$/) != null ) {
		]]>
		alert("<XLAT.STREAM KEY="dvin/UI/CSAdminForms/CannotStartEndWithSpaces" ESCAPE="true" ENCODE="false"/> ");
		<![CDATA[
		return false;
	}
	
	if ( form.aclname.value.match(/,/) != null ) {
		]]>
		alert("<XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustNotHaveComma" ESCAPE="true" ENCODE="false"/> ");
		<![CDATA[
		return false;
	}
	if (form.aclname.value == "")
	{
		alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustEnterACLName" ESCAPE="true" ENCODE="false"/><![CDATA[');
		return false;
	}]]>
	
	<acl.list list="ACLs"/>

	<TEXTFORMAT.TOSTRING
      LIST="ACLs" 
      FIELD="aclname" 
      VARNAME="StringOutput" MAXCOUNT="ACLs.#numRows"/> 

	  <![CDATA[
	var listOfACLS = "]]><STRING.STREAM VARIABLE="StringOutput"/><![CDATA[" ;
	var arrayOfACLs = listOfACLS.split(',');
	
	for(var i=0; i<arrayOfACLs.length; i++) {
		var currACL = arrayOfACLs[i];
		
		if(currACL.replace(/^\s+/, '').replace(/\s+$/, '') == form.aclname.value){
			alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/NameAlreadyExists" ESCAPE="true" ENCODE="false"/><![CDATA[');
			return false;
		}
	}
	if (!setupACLInput(form))
		return false;

	return true;
}

function checkModifyInput(form)
{
	var selectedACL = form.aclname.value;
	var replacestr =/\bVariables.selectedACL\b/;
	if ( isSystemACL(selectedACL) )
	{
		xlatstr = ']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/ModifySystemACLQ" ENCODE="false" ESCAPE="true"/><![CDATA[';
      	newstr = xlatstr.replace( replacestr, selectedACL );
		if (!confirm(newstr))
			return false;
	}
	return setupACLInput(form);
}

function setupACLInput(form)
{
	var value = 0;
	if (form.FTcheckboxRead.checked)
		value |= 1;
	if (form.FTcheckboxRetrieve.checked)
		value |= 16;
	if (form.FTcheckboxWrite.checked)
		value |= 2;
	if (form.FTcheckboxCreate.checked)
		value |= 4;
	if (form.FTcheckboxDelete.checked)
		value |= 8;
	if (form.FTcheckboxAudit.checked)
		value |= 32;
	if (form.FTcheckboxAdmin.checked)
		value |= 64;

	if (value == 0)
	{
		alert(']]><XLAT.STREAM KEY="dvin/UI/CSAdminForms/MustSelectPrivileges" ENCODE="false" ESCAPE="true"/><![CDATA[') ;
		return false;
	}

	form.cataccess.value = value;
	return true;
}

function isSystemACL(acl)
{
	if (
		(acl == "SiteGod") ||
		(acl == "Browser") ||
		(acl == "ElementEditor") ||
		(acl == "ContentEditor") ||
		(acl == "ElementReader") ||
		(acl == "PageEditor") ||
		(acl == "PageReader") ||
		(acl == "RemoteClient") ||
		(acl == "TableEditor") ||
		(acl == "UserEditor") ||
		(acl == "UserReader") ||
		(acl == "Visitor") ||
		(acl == "VisitorAdmin") ||
		(acl == "WSAdmin") ||
		(acl == "WSEditor") ||
		(acl == "WSUser") ||
		(acl == "xceladmin") ||
		(acl == "xceleditor") ||
		(acl == "xcelpublish")
	   )
	   return true;
	return false;
}

function shouldCheck(value,mask)
{
	if (value & mask)
		return "CHECKED ";
	else
		return " ";
}

function submitForm()
{
	var bool =  checkACLInput(document.forms[0]);
	if(bool)	
		document.forms[0].submit();
}
]]>
</SCRIPT>
</FTCS>

