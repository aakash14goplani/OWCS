<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- FutureTense/Apps/AdminForms/UserMgt/DoDelete
-
- INPUT
-
- OUTPUT
-
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardVariables"/>
<HTML>
<HEAD>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/SetStylesheet"/>
<TITLE><XLAT.STREAM KEY="dvin/AdminForms/DeleteUser"/></TITLE>
<STRING.ENCODE VARIABLE="username" VARNAME="username"/>
<SCRIPT LANGUAGE="JavaScript">
<![CDATA[

function submitForm(formVal)
{
	var obj = document.forms[0];
	obj.elements['form'].value = formVal;
]]>
	var message= '<XLAT.STREAM KEY="dvin/UI/CSAdminForms/DeleteUserConfirmationQ" ENCODE="false" ESCAPE="true"/>';
<![CDATA[
	if (formVal=="DoDelete")
	{
    	if (confirm(message)) 
			obj.submit();
	}
	else
	{
		obj.submit();
	}
}
]]>
</SCRIPT>
</HEAD>
<BODY>



<ics.getproperty name="peopleparent" file="dir.ini" output="namebase"/>
<ics.getproperty name="username" file="dir.ini" output="usernameattr"/>

<name.makechild context="Variables.namebase" output="userid">
	<name.argument name="Variables.usernameattr" value="Variables.username"/>
</name.makechild>

<!-- first check to see if the user is logged in or not
     logged in user can not be deleted  -->

<USERMANAGER.GETLOGINUSER VARNAME="loginuser"/>
<USERMANAGER.GETUSER USER="Variables.userid" OBJVARNAME="u"/>
<CCUSER.GETNAME NAME="u" VARNAME="uname"/>

<div class="width-outer-70">
<SATELLITE.FORM ASSEMBLER="query" METHOD="POST">
	<STRING.ENCODE VARIABLE="charset" VARNAME="OutputQString"/>
	<INPUT TYPE="HIDDEN" NAME="_charset_" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
	<STRING.ENCODE VARIABLE="cs_environment" VARNAME="OutputQString"/>
	<INPUT TYPE="hidden"  NAME="cs_environment" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
	<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="OutputQString"/>
	<INPUT TYPE="hidden"  NAME="cs_formmode" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
            
<!-- Check whether user has some assignments before deleting -->
<setvar NAME="AssignmentsFound" VALUE="no"/>
<LISTOBJECT.CREATE NAME="listobj" COLUMNS="ITEM" />
<LISTOBJECT.ADDROW NAME="listobj" ITEM="Variables.userid" />
<LISTOBJECT.TOLIST NAME="listobj" LISTVARNAME="assignlist" />
<WorkflowEngine.GetFilteredAssignments ASSIGNEDTO="assignlist" NOTSTATUS="notactive" PREFIX="allAssignments:" />
<if COND="Variables.allAssignments:Total!=0">
  <then>
      <setvar NAME="AssignmentsFound" VALUE="yes"/>
  </then>
</if>
	
<!-- Check whether user has done some check outs or not before deleting -->
<ASSETTYPE.LIST LIST="TheAssetType" ORDER="assettype"/>
<setvar NAME="CheckoutFound" VALUE="no"/>
<setvar NAME="TrackedAssets" VALUE="Variables.empty"/>
<loop LIST="TheAssetType">
	<if COND="IsTracked.TheAssetType.assettype=true">
	<then>
		<history TABLE="TheAssetType.assettype" LIST="mylist" LOCKER="Variables.username"/>
		<if COND="mylist.#numRows!=0">
		<then>
			<setvar NAME="CheckoutFound" VALUE="yes"/>
				<loop LIST="mylist">
					<setvar NAME="TrackedAssets" VALUE="Variables.TrackedAssets,mylist.asset;TheAssetType.assettype"/>
				</loop>
			<flush LIST="mylist"/>
		</then>
		</if>
	</then>
	</if>
</loop>

<if COND="Variables.action!=delete">
<then>
<XLAT.LOOKUP KEY="dvin/AdminForms/deleteusermessage" VARNAME="deleteusermsg"/>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
 <argument NAME="msgtext" VALUE="Variables.deleteusermsg"/>
<argument NAME="severity" VALUE="info"/>
</callelement>

<!-- Displaying the checkout list -->
<XLAT.STREAM KEY="dvin/UI/Checkouts"/>:
<if COND="Variables.CheckoutFound=yes">
<then>
<table BORDER="0" CELLSPACING="0" CELLPADDING="0">
<tr>
</tr>
<tr>
	<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
<tr>
<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
<td >
	 <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="10"class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
	 	<tr>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Type"/></DIV></td>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></td>
		<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
		</tr>
		<stringlist NAME="templist" STR="Variables.TrackedAssets" DELIM=","/>
				<loop LIST="templist">
				<tr>
					<stringlist NAME="newtemplist" STR="templist.ITEM" DELIM=";"/>
					<setvar NAME="id" VALUE="newtemplist.ITEM"/>
					<GOTOROW LIST="newtemplist" ROWNUM="2"/>
					<setvar NAME="Category" VALUE="newtemplist.ITEM"/>
					<ASSET.LOAD NAME="asset" TYPE="Variables.Category" OBJECTID="Variables.id"/>
					<IF COND="IsError.Variables.errno=false">
						<THEN>
							<ASSET.GET NAME="asset" FIELD="name"/>
						</THEN>
					</IF>
				        <XLAT.LOOKUP KEY="dvin/UI/ShowContent" VARNAME="_XLAT_" ESCAPE="true"/>
                        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ContentDetailsFront" outstring="urlcontdetfront">
                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="Variables.id"/>
                                                         <satellite.argument name="AssetType" value="Variables.Category"/>
                                                          </SATELLITE.LINK>
                       <td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                       	<DIV class="small-text-inset">
                        	<STRING.STREAM VALUE="Variables.Category"/>
                        	<BR/>
                        </DIV>
                       </td>
                       <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                       <td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                        <DIV class="small-text-inset">
                        <A HREF="Variables.urlcontdetfront"
                             OnMouseOver="window.status='Variables._XLAT_'; return true"
                             OnMouseOut="return window.status='';"  REPLACEALL="Variables.urlcontdetfront,Variables._XLAT_">
                            <STRING.STREAM VALUE="Variables.name"/>
                        </A>
                        <BR/>
                        </DIV>
                       </td>
             </tr>
             <tr>
				<!--<td colspan="10" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
			 </tr>
            </loop>
	</table>
</td>
		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
		</tr>
<tr>
<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
</tr>
<tr>
<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
</table>
</then>
<else>
	<BR/>
	<XLAT.LOOKUP KEY="dvin/UI/NoCheckouts" VARNAME="nocheckouts"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables.nocheckouts"/>
		<argument NAME="severity" VALUE="info"/>
	</callelement>
</else>
</if>

<!-- Displaying the assignment list assigned to the user -->
<XLAT.STREAM KEY="dvin/UI/Common/Assignments"/>:
<if COND="Variables.AssignmentsFound=yes">
<then>
<SETCOUNTER NAME="count" VALUE="0"/>
<table BORDER="0" CELLSPACING="0" CELLPADDING="0">
<tr>
</tr>
<tr>
	<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
<tr>
<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
<td >
<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="10"class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
	 	<tr>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Type"/></DIV></td>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></td>
		<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
		</tr>
		<LOOP FROM="0" COUNT="Variables.allAssignments:Total">
        <tr>
        	<WorkflowAssignment.GetAssignedObject NAME="allAssignments:Counters.count" OBJVARNAME="workflowObject"/>
        	<WorkflowAsset.GetAssetType OBJECT="workflowObject" VARNAME="workflow_assettype" />
        	<WorkflowAsset.GetAssetId OBJECT="workflowObject" VARNAME="workflow_assetid" />
        	<td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
            	<DIV class="small-text-inset">
                	<STRING.STREAM VALUE="Variables.workflow_assettype"/>
                	<BR/>
                </DIV>
            </td>
        	
        	<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
             <td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
              <DIV class="small-text-inset">
            	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GenerateLink">
				<ARGUMENT NAME="assettype" VALUE="Variables.workflow_assettype"/>
				<ARGUMENT NAME="assetid" VALUE="Variables.workflow_assetid"/>
				<ARGUMENT NAME="varname" VALUE="urlInspectItem"/>
				<ARGUMENT NAME="function" VALUE="inspect"/>
				</CALLELEMENT>
			
				<A HREF="Variables.urlInspectItem" REPLACEALL="Variables.urlInspectItem,Variables._XLAT_">
				<ASSET.LOAD NAME="asset" TYPE="Variables.workflow_assettype" OBJECTID="Variables.workflow_assetid"/>
				<ASSET.GET NAME="asset" FIELD="name" OUTPUT="workflow_assetname"/>
				<STRING.STREAM VARIABLE="workflow_assetname"/>
				</A>            
              	<BR/>
              </DIV>
            </td>
        	<INCCOUNTER NAME="count" VALUE="1"/>
        </tr>
        <tr>
			<!--<td colspan="10" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
		</tr>
        </LOOP>
		
</table>

</td>
		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
		</tr>
<tr>
<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
</tr>
<tr>
<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
</table>
</then>
<else>
	<XLAT.LOOKUP KEY="dvin/UI/Noassignments" VARNAME="noassignmentfound"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables.noassignmentfound"/>
		<argument NAME="severity" VALUE="info"/>
	</callelement>
</else>
</if>
<!-- Displaying the site's on which the user is enabled. -->
<USERMANAGER.GETUSER OBJVARNAME="myUserObj" USER="Variables.userid"/>
<CCUSER.GETSITES NAME="myUserObj" OBJVARNAME="siteList"/>	 	
<SITELIST.GETALL NAME="siteList" VARNAME="pubidList"/>
<XLAT.STREAM KEY="dvin/UI/SiteName"/>:

<IF COND="Variables.pubidList!=Variables.empty">
<then>
<IF COND="pubidList.#numRows!=0">
<then>
<SETVAR NAME="validatedstatus" VALUE="true" />
<STRINGLIST NAME="stringpubidList" STR="Variables.pubidList" DELIM=","/>
<LOOP LIST="stringpubidList">
	<IF COND="Variables.validatedstatus=true" >
		<THEN>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
				<ARGUMENT NAME="columnvalue" VALUE="stringpubidList.ITEM"/>
				<ARGUMENT NAME="type" VALUE="Long"/>
			</CALLELEMENT>
		</THEN>
	</IF>
</LOOP>
<IF COND="Variables.validatedstatus=true">
<THEN>
	<execsql LIST="sitelist" SQL="SELECT id, name, description
        FROM Publication WHERE id IN (Variables.pubidList)
		ORDER BY Publication.name"/>
</THEN>
</IF>
<IF COND="sitelist.#numRows!=0">
<then>
<table BORDER="0" CELLSPACING="0" CELLPADDING="0">
<tr>
</tr>
<tr>
	<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
<tr>
<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
<td>
<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="10"class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
	 	<tr>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></td>
		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Description"/></DIV></td>
		<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
		</tr>
		<LOOP LIST="sitelist">
			<tr>
				<td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                	<DIV class="small-text-inset">
                      	<STRING.STREAM VALUE="sitelist.name"/>
                       	<BR/>
                  	</DIV>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                	<DIV class="small-text-inset">
                      	<STRING.STREAM VALUE="sitelist.description"/>
                       	<BR/>
                  	</DIV>
                </td>
			</tr>
			<tr>
				<!--<td colspan="10" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
			</tr>
		</LOOP>		
</table>
</td>
		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
		</tr>
<tr>
<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
</tr>
<tr>
<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
</tr>
</table>
</then>
</IF>
</then>
</IF>
</then>
<else>
	<BR/>
	<XLAT.LOOKUP KEY="dvin/UI/Admin/NoSitesfound" VARNAME="nositefound"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables.nositefound"/>
		<argument NAME="severity" VALUE="info"/>
	</callelement>
</else>
</IF>


<INPUT TYPE="hidden" NAME="form" VALUE=""/>
<INPUT TYPE="hidden" NAME="pagename" VALUE="FutureTense/Apps/AdminForms/AdminForm"/>
<INPUT TYPE="hidden" NAME="tool" VALUE="UserMgt"/>
<p>
<TABLE BGCOLOR="#FFFFFF" BORDER="0" CELLPADDING="2" CELLSPACING="1">
		<TR>
		<TD>
			<FONT FACE="Arial, Helvetica" SIZE="-1"><B>
			<XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_"/>
    		<A onClick="submitForm('main');" HREF="#" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="dvin/UI/Cancel"/></CALLELEMENT></A>
    		</B></FONT>
		</TD>
		<TD>
			<FONT FACE="Arial, Helvetica" SIZE="-1"><B>
			
    		<INPUT TYPE="hidden" NAME="action" VALUE="delete"/>
			<INPUT TYPE="hidden" NAME="userid" VALUE=""/>
			<STRING.ENCODE VARIABLE="username" VARNAME="username"/>
			<INPUT TYPE="HIDDEN" NAME="username" VALUE="Variables.username" REPLACEALL="Variables.username"/>
			<STRING.ENCODE VARIABLE="TrackedAssets" VARNAME="TrackedAssets"/>
			<INPUT TYPE="HIDDEN" NAME="TrackedAssets" VALUE="Variables.TrackedAssets" REPLACEALL="Variables.TrackedAssets"/>
			<XLAT.LOOKUP KEY="dvin/Common/Delete" VARNAME="_XLAT_"/>
    		<A onClick="submitForm('DoDelete');" HREF="#" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="dvin/Common/Delete"/></CALLELEMENT></A>
    		</B></FONT>
		</TD>
		</TR>
</TABLE>
</p>
</then>
</if>
</SATELLITE.FORM>

<if COND="Variables.action=delete">
<then>
<if COND="Variables.userid!=Variables.loginuser">
<then>
<!--XLAT.STREAM KEY="dvin/Util/StoreID"/-->
<BR/>
<BR/>
<SETVAR NAME="checkouterr" VALUE="0"/>
<SETVAR NAME="assignmenterr" VALUE="0"/>
<!-- Clear the checkouts -->
<IF COND="Variables.TrackedAssets!=Variables.empty">
<THEN>
	<stringlist NAME="templist" STR="Variables.TrackedAssets" DELIM=","/>
	<IF COND="templist.#numRows!=0">
	<THEN>
		<loop LIST="templist">
			<stringlist NAME="newtemplist" STR="templist.ITEM" DELIM=";"/>
			<setvar NAME="id" VALUE="newtemplist.ITEM"/>
			<GOTOROW LIST="newtemplist" ROWNUM="2"/>
			<setvar NAME="Category" VALUE="newtemplist.ITEM"/>
			<setvar NAME="errno" VALUE="0"/>
			<ASSET.LOAD NAME="asset" TYPE="Variables.Category" OBJECTID="Variables.id"/>
			<ASSET.UNDOCHECKOUT NAME="asset" REVERT="false"/>
			<ASSET.CHECKOUT OBJECTTYPE="Variables.Category" OBJECTID="Variables.id"/>
			<ASSET.UNDOCHECKOUT NAME="asset"/>
			<if COND="Variables.errno!=0">
    		<then>
    			<SETVAR NAME="checkouterr" VALUE="Variables.errno"/>
    		</then>
    		</if>
		</loop>
	</THEN>
	</IF>
</THEN>
</IF>

<!-- Clear all the assignments for the user who is going to be deleted -->
<if COND="Variables.allAssignments:Total!=0">
<then>
  	  <SETCOUNTER NAME="count" VALUE="0"/>
  	  <LOOP FROM="0" COUNT="Variables.allAssignments:Total">
      	 <WorkflowAssignment.GetID NAME="allAssignments:Counters.count" VARNAME="assignmentid" />
      	 <setvar NAME="errno" VALUE="0"/>
      	<WorkflowEngine.CancelAssignment ID="Variables.assignmentid" SITE="SessionVariables.pubid"/>
      	<if COND="Variables.errno!=0">
            <then>
                <if COND="Variables.errno=-12027">
                <then>
                	<setvar NAME="errno" VALUE="0"/>
                	<WorkflowAssignment.GetAssignedObject NAME="allAssignments:Counters.count" OBJVARNAME="workflowasset"/>
                	<WorkflowEngine.CloseAssignments OBJECT="workflowasset" COMMENT="Variables.clearcomment" SITE="SessionVariables.pubid" />
                	<if COND="Variables.errno!=0">
                	<then>
                		<SETVAR NAME="assignmenterr" VALUE="Variables.errno"/>
                	</then>
                	</if>
                </then>
                <else>
                	 <SETVAR NAME="assignmenterr" VALUE="Variables.errno"/>
                </else>
                </if>
            </then>
        </if>
      	<INCCOUNTER NAME="count" VALUE="1"/>
      </LOOP>
</then>
</if>

<if COND="Variables.checkouterr!=0">
<then>
   	<XLAT.LOOKUP KEY="dvin/AdminForms/cannotdeleteuser_checkout" VARNAME="errorMessage"/>
   	 <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables.errorMessage"/>
		<argument NAME="severity" VALUE="error"/>
	 </callelement>
</then>
<else>
	<if COND="Variables.assignmenterr!=0">
	<then>
   		<XLAT.LOOKUP KEY="dvin/AdminForms/cannotdeleteuser_assignment" VARNAME="errorMessage"/>
   	 	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<argument NAME="msgtext" VALUE="Variables.errorMessage"/>
			<argument NAME="severity" VALUE="error"/>
	 	</callelement>
	</then>
	<else>
		<dir.groupmemberships name="Variables.userid" list="usergroups"/>
		<IF COND="IsList.usergroups=true"><THEN>
		<!-- <XLAT.STREAM KEY="dvin/Util/StoreID"/><XLAT.STREAM KEY="dvin/AdminForms/Removingusergroups"/><BR/> -->
			<UL>
			<ics.getproperty name="groupparent" file="dir.ini" output="groupparentattr"/>
			<ics.getproperty name="cn" file="dir.ini" output="groupnameattr"/>
			<LOOP LIST="usergroups">
				<SETVAR NAME="errno" VALUE="0"/>
				<dir.removegroupmember name="usergroups.NAME" member="Variables.userid"/>
				<dir.getattrs list="groupatts" name="usergroups.NAME" attrs="Variables.groupnameattr"/>
				<SETROW LIST="groupatts" ACTION="FIRST"/>
				<!-- <LI><STRING.STREAM VALUE="groupatts.VALUE"/>: <IF COND="Variables.errno=0"><THEN><XLAT.STREAM KEY="dvin/Common/Success"/> !</THEN><ELSE><XLAT.STREAM KEY="dvin/AdminForms/ErrorNo"/> </ELSE></IF></LI> -->
			</LOOP>
			</UL>
		</THEN></IF>
		<SETVAR NAME="errno" VALUE="0"/>
		<dir.delete name="Variables.userid"/>

		<IF COND="Variables.errno=0">
		<THEN>
		<!--  Delete this user from user group  security configurations -->
		<USERMANAGER.DELETEUSERSECURITYGROUPS USER="Variables.uname"/>
		<IF COND="Variables.errno=0">
		<THEN>
			<!--  Delete this user from user publication table for all sites, this will be ignored in case of LDAP User Managers. -->
			<USERMANAGER.DELETEUSER USER="Variables.userid"/>
			<IF COND="Variables.errno=0">
				<THEN>
					<XLAT.LOOKUP KEY="dvin/AdminForms/userdeletionsucessful" VARNAME="userdeletion"/>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						<argument NAME="msgtext" VALUE="Variables.userdeletion"/>
						<argument NAME="severity" VALUE="info"/>
	 				</callelement>
				</THEN>
				<ELSE>
					<XLAT.STREAM KEY="dvin/AdminForms/ErrorNo"/> 
				</ELSE> 
			</IF>
		</THEN> 
		<ELSE>
			<XLAT.STREAM KEY="dvin/AdminForms/ErrorNo"/> 
		</ELSE>
		</IF>
	</THEN> 
	<ELSE>
		<XLAT.STREAM KEY="dvin/AdminForms/ErrorNo"/> 
	</ELSE>
</IF>
</else>
</if>
</else>
</if>
</then>
<else>
	<XLAT.LOOKUP KEY="dvin/AdminForms/cannotdeleteloggedinuser" VARNAME="faileduserdeletion"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="msgtext" VALUE="Variables.faileduserdeletion"/>
		<argument NAME="severity" VALUE="error"/>
	 </callelement>
</else>
</if>
</then>
</if>
</div>
</BODY>
</HTML>

</FTCS> 
