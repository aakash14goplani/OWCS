<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Gator/AttributeTypes/DATEPICKER
-
- INPUT
-
- OUTPUT
-
-->


<!-- Note well.  The implementation of attribute editors is broken vs. the original specification.  Specifically,
     if the attribute is a single-value entity, a RequireInfo entry is generated for it by the infrastructure.  This
     forces single-value entities to use cs_SingleInputName as the field they fill in, while otherwise cs_MultipleInputName
     would have been fine.  If attribute editors ever get reworked, this problem should be corrected by requiring even
     single-value entities to set appropriate RequireInfo strings. -->
     
<!-- No conditionalization is needed as long as we make the widget have the name cs_MultipleInputName -->

<ICS.GETPROPERTY NAME="form.defaultMaxValues" FILE="futuretense_xcel.ini" OUTPUT="MAXVALUES"/>

<IF COND="Variables.overWriteDefaultDisplay!=true">
<THEN>
	<setvar NAME="doDefaultDisplay" VALUE="no"/>
	<presentation.getmaxvalues NAME="Variables.PresInst" VARNAME="MAXVALUES"/>	
	<if COND="IsVariable.MAXVALUES!=true">
	<then>
		<setvar NAME="MAXVALUES" VALUE="-1"/>
	</then>
	<else>
		<IF COND="Variables.MAXVALUES=0">
		<THEN>
			<setvar NAME="MAXVALUES" VALUE="-1"/>	
		</THEN>
		</IF>
	</else>
	</if>
</THEN>
</IF>	

<callelement NAME="OpenMarket/Xcelerate/Scripts/MoveMulFields"/>

<ics.getproperty name="ft.cgipath" output="cgipath"/>

<XLAT.LOOKUP KEY="fatwire/Alloy/UI/PickADate" VARNAME="pickADateString" />
<XLAT.LOOKUP KEY="fatwire/Alloy/UI/DatePicker" VARNAME="datePickerString" />

<!-- We want only multiple single-valued widgets, so only handle the case of MultiValueEntry=no -->
<IF COND="Variables.MultiValueEntry=no">
<THEN>
	<setvar NAME="errno"  VALUE="0"/>
	<setvar NAME="fillInDate"  VALUE=""/>

	<IF COND="Variables.MyAttrVal!=Variables.empty">
	<THEN>
		<setvar NAME="fillInDate"  VALUE="Variables.MyAttrVal"/>
	</THEN>
	</IF>
	
	<!--<presentation.getprimaryattributevalue NAME="Variables.PresInst" ATTRIBUTE="COMPARETOFIELD" VARNAME="OTHERDATEFIELD"/>-->

	<setvar NAME="inputname" VALUE="Variables.cs_SingleInputName"/>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/ConvertJDBCDateTimeZone">
		<ARGUMENT NAME="inputDate" VALUE="Variables.fillInDate" />
		<ARGUMENT NAME="fromTimeZone" VALUE="server"/>
		<ARGUMENT NAME="toTimeZone" VALUE="client"/>
	</CALLELEMENT>
		
	  <CALLELEMENT NAME="OpenMarket/Xcelerate/Util/GetLocalizedDate">
		<ARGUMENT NAME="inputDate" VALUE="Variables.outputDate" />
			<ARGUMENT NAME="outputVar" VALUE="convertedDate" />
	</CALLELEMENT>
	
	<tr>
		<callelement NAME="OpenMarket/Gator/FlexibleAssets/Common/DisplayAttributeName"/>				
		<td>&nbsp;</td>
		<td nowrap="nowrap">
			<div style="display: table;">
				<div id="Variables.inputname" size="25" dojoType="fw.dijit.UIInput"  clearButton="true" readonly="true" name="Variables.inputname" value="Variables.convertedDate" replaceall="Variables.convertedDate,Variables.inputname">
					<if COND="Variables.defaultFormStyle=true">
					<then>
						<script event='startup' type='dojo/connect'><![CDATA[
							dojo.addClass(this.domNode, "defaultFormStyle");
						]]></script>
					</then>
					</if>
				</div>
				
				<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/DateTimeWidget">
					<ARGUMENT name="inputFieldId" value="Variables.inputname"/>
				</CALLELEMENT>
			</div>
		</td>
	</tr>
      
</THEN>
<ELSE>
	
	<setvar NAME="inputname" VALUE="Variables.cs_MultipleInputName"/>
			
	
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/MultiValuedCalendarWidget">
		<ARGUMENT name="inputFieldId" value="Variables.inputname"/>
		<ARGUMENT name="maxValsSetting" value="Variables.MAXVALUES"/>
	</CALLELEMENT>	
	
</ELSE>
</IF>
<REMOVEVAR NAME="overWriteDefaultDisplay"/>
<REMOVEVAR NAME="MAXVALUES"/>
</FTCS>