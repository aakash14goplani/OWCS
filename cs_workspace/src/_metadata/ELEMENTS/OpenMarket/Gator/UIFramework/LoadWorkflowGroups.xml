<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/LoadWorkflowGroups

- get the workflow groups or the members of a workflow group for the tree.
-
- INPUT
-
- OUTPUT
-
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<IF COND="Variables.command=GetTypes">
	<THEN>
		<SETVAR NAME="Variables.popupVar" VALUE="false"/>
	</THEN>
	<ELSE>
		<IF COND="Variables.op=load">
			<THEN>
				<SETCOUNTER NAME="count" VALUE="0"/>
				<WORKFLOWENGINE.GETGROUPMEMBERS GROUPID="Variables.groupid" PREFIX="another:" />
				<LOOP FROM="0" COUNT="Variables.another:Total">
					<WorkflowAsset.GetAssetId OBJECT="another:Counters.count" VARNAME="workflow_assetid" />
					<WorkflowAsset.GetAssetType OBJECT="another:Counters.count" VARNAME="workflow_assettype" />
					<ASSET.LIST TYPE="Variables.workflow_assettype" LIST="ListofAsset" FIELD1="id" VALUE1="Variables.workflow_assetid"/>
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
						<ARGUMENT NAME="ID" VALUE="Variables.workflow_assetid"/>
						<ARGUMENT NAME="AssetType" VALUE="Variables.workflow_assettype"/>
						<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
					</CALLELEMENT>
					<REMOVEVAR NAME="LoadURL"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ExecuteURL">
						<satellite.argument name="AssetType" value="Variables.AssetType"/>
						<satellite.argument name="n0_" value="Variables.TreeNodeID"/>
						<satellite.argument name="op" value="displayNode"/>
					</SATELLITE.LINK>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
						<satellite.argument name="AssetType" value="Variables.AssetType"/>
					</SATELLITE.LINK>
					
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
						<ARGUMENT NAME="Label" VALUE="ListofAsset.name"/>
						<ARGUMENT NAME="Description" VALUE="ListofAsset.description"/>
						<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
						<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
						<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
						<ARGUMENT NAME="OKActions" VALUE="Status;Inspect;Edit;Delete;refresh"/>
						<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/Variables.AssetType.png"/>
						<ARGUMENT NAME="RefreshKeys" VALUE="ListofAsset.id"/>
					</CALLELEMENT> 
					<INCCOUNTER NAME="count" VALUE="1"/>
				</LOOP>
				-->
			</THEN>
			<ELSE>
				<!--Handle root nodes-->
				<SETVAR NAME="tablename" VALUE="WorkflowGroups,WorkflowGroups_Sites"/>
				<SETVAR NAME="SQL_COMMAND" VALUE="Select w1.id as id,w1.description as description, w1.name as name from WorkflowGroups w1,WorkflowGroups_Sites w2 WHERE w1.id=w2.ownerid AND w2.pubid=SessionVariables.pubid ORDER BY name"/>
				<ICS.CLEARERRNO/>
				<EXECSQL SQL="Variables.SQL_COMMAND" LIST="grps" TABLE="Variables.tablename"/>
				<IF COND="IsList.grps=true">
					<THEN>
						<LOOP LIST="grps">
							<REMOVEVAR NAME="LoadURL"/>
							<WORKFLOWENGINE.GETGROUPMEMBERS GROUPID="grps.id" PREFIX="another:" />
							<IF COND="Variables.another:Total!=0">
								<THEN>
									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
										<satellite.argument name="op" value="load"/>
										<satellite.argument name="populate" value="OpenMarket/Gator/UIFramework/LoadWorkflowGroups"/>
										<satellite.argument name="groupid" value="grps.id"/>
									</SATELLITE.LINK>
								</THEN>
							</IF>
							<REMOVEVAR NAME="ExecuteURL"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/AdhocOpURL" outstring="ExecuteURL">
								<satellite.argument name="type" value="WFG"/>
								<satellite.argument name="n0_" value="grps.id"/>
								<satellite.argument name="op" value="displayNode"/>
							</SATELLITE.LINK>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/AdhocOpURL" outstring="OpURL">
								<satellite.argument name="type" value="WFG"/>
							</SATELLITE.LINK>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="grps.name"/>
								<ARGUMENT NAME="Description" VALUE="grps.description"/>
								<ARGUMENT NAME="ID" VALUE="grps.id"/>
								<!-- LoadURL implicitly passed in -->
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/folder.png"/>
								<ARGUMENT NAME="OKActions" VALUE="Inspect;Edit;Delete;refresh"/>
								<ARGUMENT NAME="RefreshKeys" VALUE="grps.id"/>
							</CALLELEMENT>
						</LOOP>
					</THEN>
					<ELSE>
						<!--Handle no groups-->
						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
							<ARGUMENT NAME="AdHoc" VALUE="CS.UniqueID"/>
							<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
						</CALLELEMENT>
						
						<REMOVEVAR NAME="Description"/>
						<REMOVEVAR NAME="LoadURL"/>
						<REMOVEVAR NAME="ExecuteURL"/>
						<REMOVEVAR NAME="Image"/>
						<REMOVEVAR NAME="OpURL"/>
						
						<XLAT.LOOKUP KEY="dvin/TreeApplet/NoItemsToDisplay" ENCODE="false" VARNAME="_XLAT_"/>
						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
							<ARGUMENT NAME="Label" VALUE="[Variables._XLAT_]"/>
							<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
							<ARGUMENT NAME="OKActions" VALUE="refresh"/>
						</CALLELEMENT>
					</ELSE>
				</IF>
			</ELSE>
		</IF>
	</ELSE>
</IF>
</FTCS>