<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/LoadGlobalPopup
-
- INPUT
-
- OUTPUT
-
-->
<SETVAR NAME='_IS_TREE_ELEMENT_' VALUE='true'/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- This element takes a tabid and determines what items should appear
     in the global popup menu for the tab.  -->

<SETVAR NAME="errno" VALUE="0"/>
<SETVAR NAME="ATList" VALUE="Variables.empty"/>
<TTM.GETORDEREDSECTIONS ID="Variables.tabid" PUBID="SessionVariables.pubid" LISTVARNAME="sections"/>
<IF COND="Variables.errno=0">
<THEN>
	<SETVAR NAME="theItems" VALUE="Variables.empty"/>
	<LOOP LIST="sections">
        <IF COND="IsElement.sections.populateurl=true">
        <THEN>
    		<SETVAR NAME="addToPopup" VALUE="true"/>
    		<CALLELEMENT NAME="sections.populateurl">
    			<ARGUMENT NAME="command" VALUE="GetTypes"/>
    			<ARGUMENT NAME="AssetType" VALUE="sections.name"/>
    			<ARGUMENT NAME="varname" VALUE="currentType"/>
    			<ARGUMENT NAME="popupVar" VALUE="addToPopup"/>
    		</CALLELEMENT>
    		<STRING.UTF8LENGTH VALUE="sections.name" VARNAME="currentLen"/>
    		<IF COND="Variables.addToPopup=true">
    		<THEN>
    			<SETVAR NAME="ATList" VALUE="Variables.ATListVariables.currentType,"/>
    		</THEN>
    		</IF>
    		<SETVAR NAME="theItems" VALUE="Variables.theItemsSection:Variables.currentLen:sections.name:Spacer:1:X:"/>
        </THEN>
        </IF>
	</LOOP>

	<IF COND="Variables.ATList!=Variables.empty">
	<THEN>
		<STRINGLIST NAME="allTypes" STR="Variables.ATList" DELIM=","/>

		<LOOP LIST="allTypes">
			<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" ASSETTYPE="allTypes.ITEM" PUBID="SessionVariables.pubid" LISTVARNAME="currentItems"/>
			<LOOP LIST="currentItems">
				<SETVAR NAME="NameOrDesc" VALUE="currentItems.description" />
				<IF COND="currentItems.description=Variables.empty">
				<THEN>
					<SETVAR NAME="NameOrDesc" VALUE="currentItems.name" />
				</THEN>
				</IF>
				<STRING.UTF8LENGTH VALUE="Variables.NameOrDesc" VARNAME="currentLen"/>
				<STRING.UTF8LENGTH VALUE="__GENERICSTARTMENU__,allTypes.ITEM,currentItems.id" VARNAME="currentIDLen"/>
				<SETVAR NAME="theItems" VALUE="Variables.theItemsItem:Variables.currentLen:Variables.NameOrDesc:ID:Variables.currentIDLen:__GENERICSTARTMENU__,allTypes.ITEM,currentItems.id:"/>
			</LOOP>
		</LOOP>
	</THEN>
	</IF>
	<ics.resolvevariables NAME="$(Variables.theItems)END:3:END:" DELIMITED="true"/>
</THEN>
</IF>

</FTCS>
