<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/Admin/LoadPublishing
-
- INPUT
-
- OUTPUT
-
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- This element handles all children of the Publishing root node -->
<!-- Variables.Depth=1 means 'Destinations' and 'Delivery Types' -->
<!-- Variables.Depth=2 means 'Add New' and any destinations for
	  Variables.Node=Destinations or 'Add New' and any delivery
	  types for Variables.Node=Delivery -->

<IF COND="Variables.Depth=1">
<THEN>
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
		<ARGUMENT NAME="AdHoc" VALUE="Destinations"/>
		<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="Description"/>
	<REMOVEVAR NAME="ExecuteURL"/>
	<REMOVEVAR NAME="OKActions"/>
    <XLAT.LOOKUP KEY="dvin/TreeApplet/Destinations" ENCODE="false" VARNAME="_XLAT_"/>
	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="ExecuteURL">
		<satellite.argument name="action" value="list"/>
	</SATELLITE.LINK>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
		<satellite.argument name="op" value="load"/>
		<satellite.argument name="NodeType" value="Publishing"/>
		<satellite.argument name="Node" value="Destinations"/>
		<satellite.argument name="Depth" value="2"/>
	</SATELLITE.LINK>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
		<satellite.argument name="AssetType" value="Variables.AssetType"/>
	</SATELLITE.LINK>

	<XLAT.LOOKUP KEY="dvin/UI/Admin/PublishDestinations" ENCODE="false" VARNAME="DestinationDesc"/>
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
		<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
		<ARGUMENT NAME="Description" VALUE="Variables.DestinationDesc"/> 
		<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
		<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
		<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
		<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
		<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
		<ARGUMENT NAME="RefreshKeys" VALUE="PublishDestinations"/>
	</CALLELEMENT>
	
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
		<ARGUMENT NAME="AdHoc" VALUE="DeliveryTypes"/>
		<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="Description"/>
	<REMOVEVAR NAME="ExecuteURL"/>
	<REMOVEVAR NAME="OKActions"/>
    <XLAT.LOOKUP KEY="dvin/TreeApplet/DeliveryTypes" ENCODE="false" VARNAME="_XLAT_"/>
	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DelivTypeEdit" outstring="ExecuteURL">
		<satellite.argument name="action" value="list"/>
	</SATELLITE.LINK>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
		<satellite.argument name="op" value="load"/>
		<satellite.argument name="NodeType" value="Publishing"/>
		<satellite.argument name="Node" value="Delivery"/>
		<satellite.argument name="Depth" value="2"/>
	</SATELLITE.LINK>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
		<satellite.argument name="AssetType" value="Variables.AssetType"/>
	</SATELLITE.LINK>

	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
		<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
		<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/> 
		<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
		<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
		<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
		<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
		<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/PonyExpress.png"/>
		<ARGUMENT NAME="RefreshKeys" VALUE="PublishDelivery"/>
	</CALLELEMENT>
	
	<REMOVEVAR NAME="RefreshKeys"/>
	
</THEN>
<ELSE>
	<IF COND="Variables.Depth=2">
	<THEN>
		<IF COND="Variables.Node=Destinations">
		<THEN>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="Destinations:New"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>
			
			<REMOVEVAR NAME="Description"/>
			<REMOVEVAR NAME="LoadURL"/>
			<REMOVEVAR NAME="OKActions"/>
            <XLAT.LOOKUP KEY="dvin/TreeApplet/AddNew" ENCODE="false" VARNAME="_XLAT_"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="ExecuteURL">
				<satellite.argument name="action" value="new"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
				<satellite.argument name="AssetType" value="Variables.AssetType"/>
			</SATELLITE.LINK>

			
			<XLAT.LOOKUP KEY="dvin/UI/Admin/AddNewDestination" ENCODE="false" VARNAME="addNewDestDesc"/> 
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables.addNewDestDesc"/> 
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
			</CALLELEMENT>
			
			<selectto LIST="dtype" WHAT="id,name,description,type" FROM="PubTarget" ORDERBY="name"/> 
			<if COND="IsList.dtype=true">
			<then>
				<loop LIST="dtype">
						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
							<satellite.argument name="op" value="load"/>
							<satellite.argument name="NodeType" value="Publishing"/>
							<satellite.argument name="NodeID" value="dtype.id"/>
							<satellite.argument name="Depth" value="3"/>
						</SATELLITE.LINK>
						
						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
							<ARGUMENT NAME="AdHoc" VALUE="Destinations:Existing:dtype.name"/>
							<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
						</CALLELEMENT>
						
						<REMOVEVAR NAME="Description"/>
						<REMOVEVAR NAME="OKActions"/>
						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="ExecuteURL">
							<satellite.argument name="action" value="details"/>
							<satellite.argument name="id" value="dtype.id"/>
						</SATELLITE.LINK>
	
						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
							<satellite.argument name="AssetType" value="Variables.AssetType"/>
						</SATELLITE.LINK>

						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
							<ARGUMENT NAME="Label" VALUE="dtype.name"/> 
							<ARGUMENT NAME="Description" VALUE="dtype.description"/> 
							<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
							<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
							<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
							<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
						</CALLELEMENT>
				</loop>
			</then>
			</if>
		</THEN>
		<ELSE>
			<IF COND="Variables.Node=Delivery">
			<THEN>
								
				<selectto LIST="dtype" WHAT="id,name,description" FROM="DeliveryType"/>
				<if COND="IsList.dtype=true">
				<then>
					<loop LIST="dtype">
						<IF COND="dtype.name!=VOID">
						<THEN>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="AdHoc" VALUE="Delivery:Existing:dtype.name"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>
							
							<REMOVEVAR NAME="Description"/>
							<REMOVEVAR NAME="LoadURL"/>
							<REMOVEVAR NAME="OKActions"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DelivTypeEdit" outstring="ExecuteURL">
								<satellite.argument name="action" value="details"/>
								<satellite.argument name="id" value="dtype.id"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.AssetType"/>
							</SATELLITE.LINK>

							<!-- If description, which is an optional field, is empty, show its name as tool-tip.-->
							<IF COND="dtype.description=Variables.empty">
							<THEN>
							<SETVAR NAME="desc" VALUE="dtype.name" />
							</THEN>
							<ELSE>
							<SETVAR NAME="desc" VALUE="dtype.description" />
							</ELSE>
							</IF>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="dtype.name"/>
								<ARGUMENT NAME="Description" VALUE="Variables.desc"/> 
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/PonyExpress.png"/>
							</CALLELEMENT>
						</THEN>
						</IF>
					</loop>
				</then>
				</if>
			</THEN>
			</IF>
		</ELSE>
		</IF>
	</THEN>
	<ELSE>
		<!-- Depth = 3 -->
		
		<REMOVEVAR NAME="Description"/>
		<REMOVEVAR NAME="LoadURL"/>
		<REMOVEVAR NAME="OKActions"/>
		
		<PUBTARGETMANAGER.LOAD ID="Variables.NodeID" OBJVARNAME="pubtgt"/>
		<PUBTARGET.GETTYPE NAME="pubtgt" VARNAME="pubtgt:type"/>
		<DELIVERYTYPE.LOAD NAME="pubdt" OBJECTID="Variables.pubtgt:type"/>
		<DELIVERYTYPE.GET NAME="pubdt" FIELD="dtype" OUTPUT="pubdt:dtype"/>
		
		<SETVAR NAME="type" VALUE="Variables.pubtgt:type"/> 
		<SELECTTO FROM="PubTarget" WHAT="name" WHERE="type" LIST="descList" /> 


		
		
		<IF COND="Variables.pubdt:dtype=mirror">
		<THEN>
		<SETVAR NAME="mirror_or_realtime" VALUE="true"/>
		<XLAT.LOOKUP KEY="dvin/UI/Admin/InitializeMirrorDestination" ENCODE="false" VARNAME="_XLAT_"/>
		</THEN>
		<ELSE>
			<IF COND="Variables.pubdt:dtype=realtime">
			<THEN>
				<SETVAR NAME="mirror_or_realtime" VALUE="true"/>
				<XLAT.LOOKUP KEY="dvin/UI/Admin/InitializeRealTimeDestination" ENCODE="false" VARNAME="_XLAT_"/>
			</THEN>
			<ELSE>
				<SETVAR NAME="mirror_or_realtime" VALUE="false"/>
			</ELSE>
			</IF>
		</ELSE>
		</IF>
		<IF COND="Variables.mirror_or_realtime=true">
		<THEN>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="InitializeDestination:Variables.NodeID"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/TargetSiteEdit" outstring="ExecuteURL">
				<satellite.argument name="id" value="Variables.NodeID"/>
			</SATELLITE.LINK>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>
			
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_ : descList.name"/> 
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
			</CALLELEMENT>
		</THEN>
		</IF>
		
        <XLAT.LOOKUP KEY="dvin/TreeApplet/ApproveMultipleAssets" ENCODE="false" VARNAME="_XLAT_"/>
        
        <CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<ARGUMENT NAME="AdHoc" VALUE="ApproveMultipleAssets:Variables.NodeID"/>
			<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
		</CALLELEMENT>
		
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/BulkApproveFront" outstring="ExecuteURL">
			<satellite.argument name="target" value="Variables.NodeID"/>
		</SATELLITE.LINK>
  
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables._XLAT_ : descList.name"/> 
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
		</CALLELEMENT>
		
		<IF COND="Variables.mirror_or_realtime=true">
		<THEN>
			<XLAT.LOOKUP KEY="dvin/UI/Admin/CopyAuxiliaryTables" ENCODE="false" VARNAME="_XLAT_"/>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="CopyAuxiliaryTables:Variables.NodeID"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/CopyAuxiliaryTablesEdit" outstring="ExecuteURL">
				<satellite.argument name="id" value="Variables.NodeID"/>
			</SATELLITE.LINK>
			

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>
			
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_ : descList.name"/> 
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
			</CALLELEMENT>
		</THEN>
		</IF>

		<IF COND="Variables.pubdt:dtype=static">
		<THEN>
	        <XLAT.LOOKUP KEY="dvin/TreeApplet/SetDefaultTemplates" ENCODE="false" VARNAME="_XLAT_"/>
			
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="SetDefaultTemplates:Variables.NodeID"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/AssetDefaultTemplateFront" outstring="ExecuteURL">
				<satellite.argument name="target" value="Variables.NodeID"/>
			</SATELLITE.LINK>
	
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>
	
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_ : descList.name"/> 
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Target.png"/>
			</CALLELEMENT>
		
		</THEN>
		</IF>
	</ELSE>
	</IF>
</ELSE>
</IF>

</FTCS> 
