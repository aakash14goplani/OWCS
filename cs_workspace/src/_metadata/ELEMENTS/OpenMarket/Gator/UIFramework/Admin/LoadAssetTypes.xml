<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=UTF-8"/>

<!-- OpenMarket/Gator/UIFramework/Admin/LoadAssetTypes
-
- INPUT
-
- OUTPUT
-
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- This element handles all children of the Asset Types root node -->
<!-- Variables.Depth=1 means 'Add New' and all Asset Types -->
<!-- Variables.Depth=2 means 'Categories', 'Asset Associations' and
     'Revision Tracking' for Variables.currentAssetType -->
<!-- Variables.Depth=3 means children of the 3 Depth=2 nodes -->

<XLAT.LOOKUP KEY="dvin/TreeApplet/AddNew" ENCODE="false" VARNAME="_AddNew_"/>

<IF COND="Variables.Depth=1">
<THEN>
	<!-- 'Add New' is for xceldevel ACL users only -->
	<setvar NAME="errno" VALUE="0"/>
	<userismember GROUP="xceldevel"/>
	<if COND="Variables.errno=1">
	<then>
		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<ARGUMENT NAME="AdHoc" VALUE="AssetTypes:New"/>
			<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
		</CALLELEMENT>

		<REMOVEVAR NAME="LoadURL"/>
		<REMOVEVAR NAME="OKActions"/>
        <XLAT.LOOKUP KEY="dvin/TreeApplet/AddANewAssetType" ENCODE="false" VARNAME="_XLAT_"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetTypeFront" outstring="ExecuteURL">
			<satellite.argument name="action" value="new"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/>
			<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
		</CALLELEMENT>
	</then>
	</if>
	<!-- Attempt to get a list of all asset types -->
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/ListAvailableAssetType">
			<ARGUMENT NAME="listname" VALUE="AllAssetTypes"/>
			<ARGUMENT NAME="ignoreslots" VALUE="true"/>
			<ARGUMENT NAME="showSitePlan" VALUE="true"/>
			<ARGUMENT NAME="showWebRoot" VALUE="true"/>
	</CALLELEMENT>
	<IF COND="IsError.Variables.errno=true">
	<THEN>
		<IF COND="Variables.errno!=-101">
		<THEN>
			<LOGMSG STR="Xcelerate error Variables.errno on attempt to load asset types"/>
		</THEN>
		</IF>
	</THEN>
	</IF>

	<IF COND="IsList.AllAssetTypes=true">
	<THEN>
		<LOOP LIST="AllAssetTypes">
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="AssetTypes:Existing:AllAssetTypes.assettype"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>

			<REMOVEVAR NAME="OKActions"/>
            <XLAT.LOOKUP KEY="dvin/TreeApplet/DisplayDetails" ENCODE="false" VARNAME="_XLAT_"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetTypeFront" outstring="ExecuteURL">
				<satellite.argument name="action" value="details"/>
				<satellite.argument name="assettype" value="AllAssetTypes.assettype"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
				<satellite.argument name="op" value="load"/>
				<satellite.argument name="NodeType" value="AssetTypes"/>
				<satellite.argument name="currentType" value="AllAssetTypes.assettype"/>
				<satellite.argument name="Depth" value="2"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL"/>

			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="AllAssetTypes.assettype"/>
				<ARGUMENT NAME="Description" VALUE="AllAssetTypes.description"/>
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/AllAssetTypes.assettype.png"/>
			</CALLELEMENT>
		</LOOP>
	</THEN>
	</IF>
</THEN>
<ELSE>
	<IF COND="Variables.Depth=2">
	<THEN>
		  <CALLELEMENT NAME="OpenMarket/Xcelerate/Util/HandleAssetTypeOperations" >
		  <ARGUMENT NAME="currentAssetType" VALUE="Variables.currentType" />
		  </CALLELEMENT>
	
	    <IF COND="Variables.showCategory!=no">
		<THEN>
		<!-- if the asset type has a category column -->
		<SETCOUNTER NAME="rownum" VALUE="0"/>
		<SETVAR NAME="done" VALUE="false"/>
		<SETVAR NAME="hasCategory" VALUE="false"/>
		<CATALOGDEF LIST="cols" FROM="Variables.currentType"/>
		<if COND="IsError.Variables.errno=false">
		<then>
			<LOOP UNTIL="Variables.done=true">
				<INCCOUNTER NAME="rownum" VALUE="1"/>
				<GOTOROW LIST="cols" ROWNUM="Counters.rownum"/>
				<if COND="cols.COLNAME=category">
				<then>
					<setvar NAME="hasCategory" VALUE="true"/>
					<setvar NAME="done" VALUE="true"/>
				</then>
				</if>
				<if COND="cols.#numRows=Counters.rownum">
				<then>
					<setvar NAME="done" VALUE="true"/>
				</then>
				</if>
			</LOOP>
		</then>
		</if>
        
		
		
		<if COND="Variables.hasCategory=true">
		<then>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="ATCategories:Variables.AssetType"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>

			<REMOVEVAR NAME="ExecuteURL"/>
			<REMOVEVAR NAME="OKActions"/>
            <XLAT.LOOKUP KEY="dvin/TreeApplet/Categories" ENCODE="false" VARNAME="_XLAT_"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/CategoryFront" outstring="ExecuteURL">
				<satellite.argument name="action" value="list"/>
				<satellite.argument name="assettype" value="Variables.currentType"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
				<satellite.argument name="op" value="load"/>
				<satellite.argument name="NodeType" value="AssetTypes"/>
				<satellite.argument name="currentType" value="Variables.currentType"/>
				<satellite.argument name="Node" value="Categories"/>
				<satellite.argument name="Depth" value="3"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
				<satellite.argument name="AssetType" value="Variables.AssetType"/>
			</SATELLITE.LINK>

			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Category.png"/>
				<ARGUMENT NAME="RefreshKeys" VALUE="Variables.currentType_Category"/>
			</CALLELEMENT>

			<REMOVEVAR NAME="RefreshKeys"/>
		</then>
		</if>
		</THEN>
		</IF>
		
		<IF COND="Variables.showSubTypes!=no">
		<THEN>
		<!-- only for assets that support subtypes (not Collection, Query and Template) -->
		<ASSET.GetAssetTypeProperties TYPE="Variables.currentType"/>
		<IF COND="Variables.CanAddSubtypes=true">
		<THEN>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="ATSubtypes:Variables.AssetType"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>

			<REMOVEVAR NAME="ExecuteURL"/>
			<REMOVEVAR NAME="OKActions"/>
			<REMOVEVAR NAME="LoadURL"/>
            <XLAT.LOOKUP KEY="dvin/TreeApplet/Subtypes" ENCODE="false" VARNAME="_XLAT_"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetSubtypeFront" outstring="ExecuteURL">
				<satellite.argument name="action" value="list"/>
				<satellite.argument name="assettype" value="Variables.currentType"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
				<satellite.argument name="op" value="load"/>
				<satellite.argument name="NodeType" value="AssetTypes"/>
				<satellite.argument name="currentType" value="Variables.currentType"/>
				<satellite.argument name="Node" value="ATSubTypes"/>
				<satellite.argument name="Depth" value="3"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
				<satellite.argument name="AssetType" value="Variables.AssetType"/>
			</SATELLITE.LINK>

			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/subtype.png"/>
			</CALLELEMENT>
		</THEN>
		</IF>
		</THEN>
		</IF>
		
		
        <IF COND="Variables.showAssociation!=no">
		<THEN>
         <CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<ARGUMENT NAME="AdHoc" VALUE="ATAssetAssoc:Variables.currentType"/>
			<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
		</CALLELEMENT>

		<REMOVEVAR NAME="ExecuteURL"/>
		<REMOVEVAR NAME="OKActions"/>
        <XLAT.LOOKUP KEY="dvin/TreeApplet/AssetAssociations" ENCODE="false" VARNAME="_XLAT_"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssociationFront" outstring="ExecuteURL">
			<satellite.argument name="action" value="list"/>
			<satellite.argument name="parentassettype" value="Variables.currentType"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
			<satellite.argument name="op" value="load"/>
			<satellite.argument name="NodeType" value="AssetTypes"/>
			<satellite.argument name="currentType" value="Variables.currentType"/>
			<satellite.argument name="Node" value="AssetAssoc"/>
			<satellite.argument name="Depth" value="3"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
		</SATELLITE.LINK>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
			<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/assoc.png"/>
			<ARGUMENT NAME="RefreshKeys" VALUE="Variables.currentType_Association"/>
		</CALLELEMENT>
        </THEN>
		</IF>
		
		<REMOVEVAR NAME="RefreshKeys"/>

		<IF COND="Variables.showTracking!=no">
		<THEN>
		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<ARGUMENT NAME="AdHoc" VALUE="ATRevTrack:Variables.AssetType"/>
			<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
		</CALLELEMENT>

		<REMOVEVAR NAME="ExecuteURL"/>
		<REMOVEVAR NAME="OKActions"/>
        <XLAT.LOOKUP KEY="dvin/TreeApplet/RevisionTracking" ENCODE="false" VARNAME="_XLAT_"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
			<satellite.argument name="op" value="load"/>
			<satellite.argument name="NodeType" value="AssetTypes"/>
			<satellite.argument name="currentType" value="Variables.currentType"/>
			<satellite.argument name="Node" value="RevTrack"/>
			<satellite.argument name="Depth" value="3"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
		</SATELLITE.LINK>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/track.png"/>
			<ARGUMENT NAME="RefreshKeys" VALUE="Variables.currentType_RevTrack"/>
		</CALLELEMENT>
      </THEN>
	  </IF>
	  
	  <IF COND="Variables.showStartMenu!=no">
	  <THEN>
	    <CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<ARGUMENT NAME="AdHoc" VALUE="ATStartMenu:Variables.currentType"/>
			<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
		</CALLELEMENT>
		<REMOVEVAR NAME="ExecuteURL"/>
		<REMOVEVAR NAME="OKActions"/>
        <REMOVEVAR NAME="Description"/>
        <XLAT.LOOKUP KEY="dvin/TreeApplet/StartMenu" ENCODE="false" VARNAME="_XLAT_"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/StartMenuFront" outstring="ExecuteURL">
			<satellite.argument name="op" value="list"/>
			<satellite.argument name="AssetType" value="Variables.currentType"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
			<satellite.argument name="op" value="load"/>
			<satellite.argument name="NodeType" value="ATStartMenu"/>
			<satellite.argument name="ATFilter" value="Variables.currentType"/>
		</SATELLITE.LINK>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
		</SATELLITE.LINK>

		<XLAT.LOOKUP KEY="dvin/UI/Admin/StartMenusforAssetType" ENCODE="false" VARNAME="newStartMenuDesc"/>
		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables.newStartMenuDesc : Variables.currentType"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
			<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/startmenu.png"/>
			<ARGUMENT NAME="RefreshKeys" VALUE="StartMenuVariables.currentType"/>
		</CALLELEMENT>
		</THEN>
		</IF>
		<IF COND="Variables.showWebReferencePatterns!=no">
	    <THEN>
			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
				<ARGUMENT NAME="AdHoc" VALUE="ATWebRefPattern:Variables.currentType"/>
				<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
			</CALLELEMENT>

			<REMOVEVAR NAME="ExecuteURL"/>
			<REMOVEVAR NAME="OKActions"/>
			<REMOVEVAR NAME="LoadURL"/>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/WebRefPatternFront" outstring="ExecuteURL">
				<satellite.argument name="action" value="list"/>
				<satellite.argument name="parentassettype" value="Variables.currentType"/>
			</SATELLITE.LINK>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadAdminTree" outstring="LoadURL">
				<satellite.argument name="op" value="load"/>
				<satellite.argument name="NodeType" value="AssetTypes"/>
				<satellite.argument name="currentType" value="Variables.currentType"/>
				<satellite.argument name="Node" value="WebRefPatterns"/>
				<satellite.argument name="Depth" value="3"/>
			</SATELLITE.LINK>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
				<satellite.argument name="AssetType" value="Variables.AssetType"/>
			</SATELLITE.LINK>
			
			<XLAT.LOOKUP KEY="dvin/TreeApplet/URLPattern" ENCODE="false" VARNAME="_XLAT_"/>

			<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
				<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
				<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
				<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
				<ARGUMENT NAME="LoadURL" VALUE="Variables.LoadURL"/>
				<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
				<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/assoc.png"/>
				<ARGUMENT NAME="RefreshKeys" VALUE="Variables.currentType_WebRefPattern"/>
			</CALLELEMENT>
		</THEN>
		</IF>
        <REMOVEVAR NAME="showCategory" />
		<REMOVEVAR NAME="showSubTypes" />
		<REMOVEVAR NAME="showAssociation" />
		<REMOVEVAR NAME="showTracking" />
		<REMOVEVAR NAME="showStartMenu" />
		<REMOVEVAR NAME="showWebReferencePatterns" />
	</THEN>
	<ELSE>
		<IF COND="Variables.Depth=3">
		<THEN>
			<IF COND="Variables.Node=Categories">
			<THEN>
				<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
					<ARGUMENT NAME="AdHoc" VALUE="ATCategories:New"/>
					<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
				</CALLELEMENT>

				<REMOVEVAR NAME="LoadURL"/>
				<REMOVEVAR NAME="OKActions"/>
                <XLAT.LOOKUP KEY="dvin/TreeApplet/AddANewCategory" ENCODE="false" VARNAME="_XLAT_"/>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/CategoryFront" outstring="ExecuteURL">
					<satellite.argument name="action" value="new"/>
					<satellite.argument name="assettype" value="Variables.currentType"/>
				</SATELLITE.LINK>

				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
					<satellite.argument name="AssetType" value="Variables.AssetType"/>
				</SATELLITE.LINK>

				<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
					<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/>
					<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
					<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
					<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
					<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
					<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
				</CALLELEMENT>

				<SETVAR NAME="assettype" VALUE="Variables.currentType"/>
				<SELECTTO LIST="ActiveCat" FROM="Category" WHAT="*" WHERE="assettype" ORDERBY="description"/>
				<LOOP LIST="ActiveCat">
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
						<ARGUMENT NAME="AdHoc" VALUE="ATCategories:Existing:ActiveCat.category"/>
						<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
					</CALLELEMENT>

					<REMOVEVAR NAME="Description"/>
					<REMOVEVAR NAME="LoadURL"/>
					<REMOVEVAR NAME="OKActions"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/CategoryFront" outstring="href">
						<satellite.argument name="action" value="details"/>
						<satellite.argument name="assettype" value="Variables.currentType"/>
						<satellite.argument name="category" value="ActiveCat.category"/>
					</SATELLITE.LINK>

					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
						<satellite.argument name="AssetType" value="Variables.AssetType"/>
					</SATELLITE.LINK>

					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
						<ARGUMENT NAME="Label" VALUE="ActiveCat.category: ActiveCat.description"/>
						<ARGUMENT NAME="Description" VALUE="ActiveCat.description"/>
						<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
						<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
						<ARGUMENT NAME="ExecuteURL" VALUE="Variables.href"/>
						<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Category.png"/>
					</CALLELEMENT>
				</LOOP>

			</THEN>
			<ELSE>

				<IF COND="Variables.Node=AssetAssoc">
				<THEN>
					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
						<ARGUMENT NAME="AdHoc" VALUE="ATAssetAssoc:New"/>
						<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
					</CALLELEMENT>

					<REMOVEVAR NAME="LoadURL"/>
					<REMOVEVAR NAME="OKActions"/>
                    <XLAT.LOOKUP KEY="dvin/TreeApplet/AddNewAssetAssociation" ENCODE="false" VARNAME="_XLAT_"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssociationFront" outstring="ExecuteURL">
						<satellite.argument name="action" value="new"/>
						<satellite.argument name="parentassettype" value="Variables.currentType"/>
					</SATELLITE.LINK>

					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
						<satellite.argument name="AssetType" value="Variables.AssetType"/>
					</SATELLITE.LINK>

					<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
						<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/>
						<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
						<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
						<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
						<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
						<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
					</CALLELEMENT>

					<ASSETTYPE.LIST LIST="AssetType" FIELD1="assettype" VALUE1="Variables.currentType"/>
                    <ASSOCNAMEDMANAGER.FIND   PREFIX="AssetRelations:" TYPE="AssetType.assettype"/>
                     <IF COND="Variables.AssetRelations:Total!=0">
            		  	<THEN>
            		   		<SETCOUNTER NAME="currentItem" VALUE="0"/>
            		   		<LOOP COUNT="Variables.AssetRelations:Total">
                                <ASSOCNAMED.GETID NAME="AssetRelations:Counters.currentItem" VARNAME="AssetRelations.id"/>
                                <ASSOCNAMED.GETNAME NAME="AssetRelations:Counters.currentItem" VARNAME="AssetRelations.name"/>
        						<ASSOCNAMED.GETTYPE NAME="AssetRelations:Counters.currentItem" VARNAME="AssetRelations.type"/>
        						<ASSOCNAMED.GETCHILDTYPE NAME="AssetRelations:Counters.currentItem" VARNAME="AssetRelations.childtype"/>
                                <ASSOCNAMED.GETDESCRIPTION NAME="AssetRelations:Counters.currentItem" VARNAME="AssetRelations.description"/>
                                <ASSOCNAMED.GETSUBTYPES NAME="AssetRelations:Counters.currentItem" OBJVARNAME="AssetRelations.subtypes"/>

                                <CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
									<ARGUMENT NAME="AdHoc" VALUE="Variables.AssetRelations.name"/>
									<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
								</CALLELEMENT>

    							<REMOVEVAR NAME="Description"/>
    							<REMOVEVAR NAME="LoadURL"/>
    							<REMOVEVAR NAME="OKActions"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssociationFront" outstring="ExecuteURL">
								<satellite.argument name="action" value="details"/>
								<satellite.argument name="id" value="Variables.AssetRelations.id"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.AssetType"/>
							</SATELLITE.LINK>

    							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
    								<ARGUMENT NAME="Label" VALUE="Variables.AssetRelations.name"/>
									<ARGUMENT NAME="Description" VALUE="Variables.AssetRelations.description"/>
    								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
    								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
    								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
    								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/assoc.png"/>
                                    <ARGUMENT NAME="RefreshKeys" VALUE="Variables.AssetRelations.id"/>
                                </CALLELEMENT>
                                <INCCOUNTER NAME="currentItem" VALUE="1"/>
                            </LOOP>
    						<REMOVEVAR NAME="RefreshKeys"/>
                        </THEN>
                    </IF>
				</THEN>
				<ELSE>
					<IF COND="Variables.Node=RevTrack">
					<THEN>
						<callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
							<argument NAME="AssetType" VALUE="Variables.currentType"/>
						</callelement>
						<IF COND="Variables.trackingenabled=true">
						<THEN>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="AdHoc" VALUE="ATSetRevisions:Variables.currentType"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>

							<REMOVEVAR NAME="LoadURL"/>
							<REMOVEVAR NAME="OKActions"/>
                            <XLAT.LOOKUP KEY="dvin/TreeApplet/SetRevisions" ENCODE="false" VARNAME="_XLAT_"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/RevTracking" outstring="ExecuteURL">
								<satellite.argument name="action" value="details"/>
								<satellite.argument name="assettype" value="Variables.currentType"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.AssetType"/>
							</SATELLITE.LINK>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
								<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/track.png"/>
							</CALLELEMENT>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="AdHoc" VALUE="ATUntrack:Variables.currentType"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>

							<REMOVEVAR NAME="LoadURL"/>
							<REMOVEVAR NAME="OKActions"/>
                            <XLAT.LOOKUP KEY="dvin/TreeApplet/Untrack" ENCODE="false" VARNAME="_XLAT_"/>
                            <XLAT.LOOKUP KEY="dvin/TreeApplet/UntrackTable" ENCODE="false" VARNAME="_XLAT1_"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/RevTracking" outstring="ExecuteURL">
								<satellite.argument name="action" value="untrack"/>
								<satellite.argument name="assettype" value="Variables.currentType"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.AssetType"/>
							</SATELLITE.LINK>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
								<ARGUMENT NAME="Description" VALUE="Variables._XLAT1_"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/track.png"/>
							</CALLELEMENT>
						</THEN>
						<ELSE>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="AdHoc" VALUE="ATTrack:Variables.currentType"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>

							<REMOVEVAR NAME="LoadURL"/>
							<REMOVEVAR NAME="OKActions"/>
                            <XLAT.LOOKUP KEY="dvin/TreeApplet/Track" ENCODE="false" VARNAME="_XLAT_"/>
                            <XLAT.LOOKUP KEY="dvin/TreeApplet/TrackTable" ENCODE="false" VARNAME="_XLAT1_"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/RevTracking" outstring="ExecuteURL">
								<satellite.argument name="action" value="track"/>
								<satellite.argument name="assettype" value="Variables.currentType"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.AssetType"/>
							</SATELLITE.LINK>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
								<ARGUMENT NAME="Description" VALUE="Variables._XLAT1_"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/track.png"/>
							</CALLELEMENT>
						</ELSE>
						</IF>
					</THEN>
					<ELSE>
						<IF COND="Variables.Node=ATSubTypes">
						<THEN>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="AdHoc" VALUE="ATSubtypes:New"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>

							<REMOVEVAR NAME="LoadURL"/>
							<REMOVEVAR NAME="OKActions"/>
							<XLAT.LOOKUP KEY="dvin/UI/Admin/AddNewSubtype" ENCODE="false" VARNAME="_XLAT_"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetSubtypeFront" outstring="ExecuteURL">
								<satellite.argument name="action" value="new"/>
								<satellite.argument name="assettype" value="Variables.currentType"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="Variables.currentType"/>
							</SATELLITE.LINK>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/>
								<ARGUMENT NAME="Description" VALUE="Variables._XLAT_"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
							</CALLELEMENT>

							<SUBTYPES.GETSUBTYPES LISTVARNAME="lstSubtypes" ASSETTYPE="Variables.currentType" DISTINCT="true"/>
							<IF COND="IsList.lstSubtypes=true">
							<THEN>
								<LOOP LIST="lstSubtypes">
									<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
										<ARGUMENT NAME="AdHoc" VALUE="ATSubtypes:Existing:lstSubtypes.subtype"/>
										<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
									</CALLELEMENT>

									<REMOVEVAR NAME="Description"/>
									<REMOVEVAR NAME="LoadURL"/>
									<REMOVEVAR NAME="OKActions"/>
									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetSubtypeFront" outstring="ExecuteURL">
										<satellite.argument name="action" value="details"/>
										<satellite.argument name="assettype" value="Variables.currentType"/>
										<satellite.argument name="subtype" value="lstSubtypes.subtype"/>
									</SATELLITE.LINK>

									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
										<satellite.argument name="AssetType" value="Variables.currentType"/>
									</SATELLITE.LINK>

									<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
										<ARGUMENT NAME="Label" VALUE="lstSubtypes.subtype"/>
										<ARGUMENT NAME="Description" VALUE="lstSubtypes.subtype"/>
										<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
										<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
										<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
										<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/Category.png"/>
									</CALLELEMENT>
								</LOOP>
							</THEN>
							</IF>
						</THEN>
						<ELSE>
							<IF COND="Variables.Node=WebRefPatterns">
							<THEN>
								<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
									<ARGUMENT NAME="AdHoc" VALUE="ATSubtypes:New"/>
									<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
								</CALLELEMENT>

								<REMOVEVAR NAME="LoadURL"/>
								<REMOVEVAR NAME="OKActions"/>
								<XLAT.LOOKUP KEY="dvin/UI/Admin/AddNewURLPattern" ENCODE="false" VARNAME="_XLAT_"/>
								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/WebRefPattern/PatternUIFront" outstring="ExecuteURL">
									<satellite.argument name="action" value="new"/>
									<satellite.argument name="assettype" value="Variables.currentType"/>
								</SATELLITE.LINK>

								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
									<satellite.argument name="AssetType" value="Variables.currentType"/>
								</SATELLITE.LINK>

								<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
									<ARGUMENT NAME="Label" VALUE="Variables._AddNew_"/>
									<ARGUMENT NAME="Description" VALUE="Variables._AddNew_"/>
									<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
									<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
									<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
									<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/plus.png"/>
								</CALLELEMENT>
								<CALLELEMENT NAME="OpenMarket/Xcelerate/WebRefPattern/BuildWebRefPatternNodes">
									<ARGUMENT NAME="assettype" VALUE="Variables.currentType"/>
								</CALLELEMENT>
							</THEN>
							</IF>
						</ELSE>
						</IF>
					</ELSE>
					</IF>
				</ELSE>
				</IF>
			</ELSE>
			</IF>
		</THEN>
		</IF>
	</ELSE>
	</IF>
</ELSE>
</IF>

</FTCS>
