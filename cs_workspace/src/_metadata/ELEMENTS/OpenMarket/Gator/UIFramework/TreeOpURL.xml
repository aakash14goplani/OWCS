<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Gator/UIFramework/TreeOpURL
--
-- INPUT
--
-- OUTPUT
--
-->
<!-- first check to see if the user is logged in or not -->

<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceleditor"/>
<if COND="Variables.errno=0">
<then>
	<SATELLITE.LINK ASSEMBLER="query" OUTSTRING="urltimeouterror" PAGENAME="OpenMarket/Xcelerate/Actions/Security/TimeoutError">
	</SATELLITE.LINK>
	<REPLACE STR="Variables.urltimeouterror">
		<script LANGUAGE="JavaScript">
			parent.parent.location="Variables.urltimeouterror";
		</script>
	</REPLACE>
	<throwexception/>
</then>
</if>


<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>
<!-- parse out node data -->
<SETCOUNTER NAME="myoutercounter" VALUE="0"/>
<SETVAR NAME="outertermvar" VALUE="false"/>

<LOOP UNTIL="Variables.outertermvar=true">

    <SETCOUNTER NAME="missingTermTot" VALUE="0"/>
	<REMOVEVAR  NAME="TreeNodePath"/>
	<REMOVEVAR  NAME="TreeNodeParentPath"/>
	<REMOVEVAR  NAME="TreeNodeOldParentPath"/>

	<SETVAR NAME="pathKey" VALUE="nCounters.myoutercounter_"/>

    <setvar NAME="errno" VALUE="0"/>
	<SETVAR NAME="testPathValue" VALUE="Variables.Variables.pathKey"/>

    <BEGINS STR="Variables.testPathValue" WHAT="Variables."/>

    <IF COND="Variables.errno=0">
	<THEN>
		<SETVAR NAME="TreeNodePath" VALUE="Variables.Variables.pathKey"/>
    </THEN>
	<ELSE>
        <INCCOUNTER NAME="missingTermTot" VALUE="1"/>
	</ELSE>
	</IF>
	
	<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
		<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
	</callelement>

	<LISTOBJECT.CREATE NAME="validateList" COLUMNS="val_variable,dataType"/>
	<IF COND="IsVariable.ID=true">
	<THEN>
		<LISTOBJECT.ADDROW NAME="validateList" val_variable="Variables.ID" dataType="long"/>
	</THEN>
	</IF>
	<IF COND="IsVariable.AssetType=true">
	<THEN>
		<LISTOBJECT.ADDROW NAME="validateList" val_variable="Variables.AssetType" dataType="string"/>
	</THEN>
	</IF>
	<IF COND="IsVariable.AssetType=true">
	<THEN>
		<LISTOBJECT.ADDROW NAME="validateList" val_variable="Variables.AdHoc" dataType="string"/>
	</THEN>
	</IF>
	<LISTOBJECT.TOLIST NAME="validateList" LISTVARNAME="VList"/>
	<SETVAR NAME="validatedstatus" VALUE="true" />
	<LOOP LIST="VList">
		<IF COND="Variables.validatedstatus=true" >
			<THEN>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/validateFields">
					<ARGUMENT NAME="columnvalue" VALUE="VList.val_variable"/>
					<ARGUMENT NAME="type" VALUE="VList.dataType"/>
				</CALLELEMENT>
			</THEN>
		</IF>
	</LOOP>


	<SETVAR NAME="pathKey" VALUE="pCounters.myoutercounter_"/>
	<setvar NAME="errno" VALUE="0"/>
	<SETVAR NAME="testPathValue" VALUE="Variables.Variables.pathKey"/>
	<BEGINS STR="Variables.testPathValue" WHAT="Variables."/>
	<IF COND="Variables.errno=0">
	<THEN>
		<SETVAR NAME="TreeNodeParentPath" VALUE="Variables.Variables.pathKey"/>
	</THEN>
	<ELSE>
		<INCCOUNTER NAME="missingTermTot" VALUE="1"/>
	</ELSE>
	</IF>

	<SETVAR NAME="pathKey" VALUE="oCounters.myoutercounter_"/>
	<setvar NAME="errno" VALUE="0"/>
	<SETVAR NAME="testPathValue" VALUE="Variables.Variables.pathKey"/>
	<BEGINS STR="Variables.testPathValue" WHAT="Variables."/>
	<IF COND="Variables.errno=0">
	<THEN>
		<SETVAR NAME="TreeNodeOldParentPath" VALUE="Variables.Variables.pathKey"/>
	</THEN>
	<ELSE>
		<INCCOUNTER NAME="missingTermTot" VALUE="1"/>
	</ELSE>
	</IF>

    <!--
     Set all required tree node paths
    -->

<IF COND="IsVariable.TreeNodePathKey=true">
<THEN>
    <SETVAR NAME="TreeNodePath" VALUE="Variables.TreeNodePathKey"/>
    <INCCOUNTER NAME="missingTermTot" VALUE="2"/>
</THEN>
<ELSE>
</ELSE>
</IF>

<IF COND="Counters.missingTermTot!=3">
<THEN>

		<!-- handle the opcode -->
		<!-- Node creation from the tree now uses the Start Menu.  From the
			global popup menu, ops are of the format:
			"__GENERICSTARTMENU__,[assettype],[start menu id]"
		-->
		<IF COND="IsVariable.op=true">
		<THEN>
			<!-- need to match op to the translation -->
            <STRINGLIST NAME="lCommandList" STR="Build;Delete;Edit;Inspect;Remove;PlacePage;OrderSiteplan;CopySiteNavigation;Preview;Status;__LIKEMESTARTMENU__;__CHILDSTARTMENU__" DELIM=";"/>
			
			<SETVAR NAME="foundOp" VALUE="no"/>
			<LOOP LIST="lCommandList">
				<XLAT.LOOKUP KEY="dvin/TreeApplet/Commands/lCommandList.ITEM" ENCODE="false" VARNAME="currentTranslation"/>
				<IF COND="Variables.currentTranslation=Variables.op">
				<THEN>
					<SETVAR NAME="foundOp" VALUE="yes"/>
					<SETVAR NAME="op" VALUE="lCommandList.ITEM"/>
					<SETROW LIST="lCommandList" ACTION="LAST"/>
				</THEN>
				</IF>
			</LOOP>
			<SETVAR NAME="errno" VALUE="0"/>
			<BEGINS STR="Variables.op" WHAT="__GENERICSTARTMENU__"/>
			<IF COND="Variables.errno=1">
			<THEN>
				<STRINGLIST STR="Variables.op" NAME="parsedop" DELIM=","/>
				<SETROW LIST="parsedop" ACTION="NEXT"/>
				<SETVAR NAME="AssetType" VALUE="parsedop.ITEM"/>
				<SETROW LIST="parsedop" ACTION="NEXT"/>
				<SETVAR NAME="StartItem" VALUE="parsedop.ITEM"/>
				<SETVAR NAME="VarsToPreserve" VALUE="Variables.empty"/>
				<setvar NAME="op" VALUE="createNode"/>
			</THEN>
			<ELSE>
				<IF COND="Variables.op=__LIKEMESTARTMENU__">
				<THEN>
					<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
						<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
					</callelement>
					<SETVAR NAME="errno" VALUE="0"/>
								
					<IF COND="Variables.validatedstatus=true">
					<THEN>
					<SETVAR NAME="errno" VALUE="0"/>			
					<ASSET.LOAD NAME="treeAsset" TYPE="Variables.AssetType" FIELD="id" VALUE="Variables.ID"/>
					<IF COND="Variables.errno=0">
					<THEN>
						<!-- we should first look for any start menu items that have a subtype like the selected assets -->
						<!-- if there are none of those look for ones that allow subtype as a legal arg -->
						<ASSET.GETSUBTYPE NAME="treeAsset" OUTPUT="currentSubtype"/>
						<SETVAR NAME="Arg:subtype" VALUE="Variables.currentSubtype"/>
						<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" ASSETTYPE="Variables.AssetType" ASSETSUBTYPE="Variables.currentSubtype" LISTVARNAME="startitems"/>   
						<IF COND="startitems.#numRows=0">
						<THEN>
							<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" ASSETTYPE="Variables.AssetType" INPUTARGUMENTS="subtype" LISTVARNAME="startitems"/>
						</THEN>
						</IF>
						<IF COND="startitems.#numRows!=0">
						<THEN>
							<IF COND="startitems.#numRows=1">
							<THEN>
								<SETVAR NAME="StartItem" VALUE="startitems.id"/>
								<SETVAR NAME="op" VALUE="createNode"/>
								<SETVAR NAME="VarsToPreserve" VALUE="Variables.empty"/>
							</THEN>
							<ELSE>
								<LISTOBJECT.CREATE NAME="startoptions" COLUMNS="name,assettype,subtype,startid"/>
								<LOOP LIST="startitems">
									<LISTOBJECT.ADDROW NAME="startoptions" name="startitems.name" assettype="Variables.AssetType" subtype="Variables.Arg:subtype" startid="startitems.id"/>
								</LOOP>
								<LISTOBJECT.TOLIST NAME="startoptions" LISTVARNAME="startOptions"/>
								<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
									<argument NAME="ThisPage" VALUE="ShowStartMenuTreeItems"/>
									<argument NAME="contentfunctions" VALUE="false"/>
									<!-- StartItem passed implicitly -->
									<argument NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
								</callelement>
							</ELSE>
							</IF>
						</THEN>
						</IF>
					</THEN>
					<ELSE>
						<XLAT.STREAM KEY="dvin/UI/Error/notfindAssetTypeID"/><BR/>
					</ELSE>
					</IF>
					</THEN>
					</IF>
				</THEN>
				<ELSE>
					<IF COND="Variables.op=__CHILDSTARTMENU__">
					<THEN>
						<!-- we need to guess the child definition based on the parent selected in the tree -->
						<!-- this logic should be similar to doclink drop logic -->
						<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
							<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
						</callelement>
						<IF COND="Variables.validatedstatus=true">
						<THEN>
						<SETVAR NAME="errno" VALUE="0"/>
						<ASSET.LIST LIST="treeAsset" TYPE="Variables.AssetType" FIELD1="id" VALUE1="Variables.ID"/>
						<IF COND="Variables.errno=0">
						<THEN>
							<FGTM.GETTEMPLATETYPE ASSETTYPE="Variables.AssetType" VARNAME="templateAT"/>
							<ASSET.LIST LIST="lTreeDef" TYPE="Variables.templateAT" FIELD1="id" VALUE1="treeAsset.flexgrouptemplateid"/>
							<!-- This argument is designed to set the parent when NewContentFront is called -->
							<SETVAR NAME="Arg:Group_lTreeDef.name" VALUE="Variables.ID"/>
							<SETVAR NAME="Arg:Group_lTreeDef.name:Total" VALUE="1"/>
							<SETVAR NAME="Arg:Group_lTreeDef.name:0" VALUE="Variables.ID"/>
							<SETVAR NAME="VarsToPreserve" VALUE="Arg:Group_lTreeDef.name,Arg:Group_lTreeDef.name:Total,Arg:Group_lTreeDef.name:0"/>
							<FATM.GETLEGALCHILDREN PARENTGROUPTYPE="Variables.AssetType" LISTVARNAME="childATs"/>
							<FATM.GETTEMPLATETYPE ASSETTYPE="childATs.assettype" VARNAME="childTemplateAT"/>
					
							<ATM.LOCATE VARNAME="gm" TYPE="Variables.templateAT"/>
							<FLEXGROUPTEMPLATES.GETLEGALCHILDREN NAME="gm" ID="treeAsset.flexgrouptemplateid" LISTVARNAME="childgroupTmpls"/>
					
							<LISTOBJECT.CREATE NAME="startoptions" COLUMNS="name,assettype,subtype,startid,templateChosen"/>
					
							<IF COND="childgroupTmpls.#numRows!=0">
							<THEN>
								<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" ASSETTYPE="Variables.AssetType" LISTVARNAME="startitems"/>
								<IF COND="IsList.startitems=true">
								<THEN>
									<IF COND="startitems.#numRows!=0">
									<THEN>
										<LOOP LIST="startitems">
											<LOOP LIST="childgroupTmpls">
												<ASSET.LIST LIST="lCurrentDef" TYPE="Variables.templateAT" FIELD1="id" VALUE1="childgroupTmpls.assetid"/>
												<LISTOBJECT.ADDROW NAME="startoptions" name="startitems.name" assettype="Variables.AssetType" subtype="lCurrentDef.name" startid="startitems.id" templateChosen="lCurrentDef.id"/>
											</LOOP>
										</LOOP>
									</THEN>
									</IF>
								</THEN>
								</IF>
							</THEN>
							</IF>
					
							<ATM.LOCATE VARNAME="am" TYPE="Variables.childTemplateAT"/>
							<FLEXTEMPLATES.GETLEGALCHILDREN NAME="am" ID="treeAsset.flexgrouptemplateid" LISTVARNAME="childTmpls"/>
							<IF COND="childTmpls.#numRows!=0">
							<THEN>
								<LOOP LIST="childATs">
									<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" ASSETTYPE="childATs.assettype" LISTVARNAME="startitems"/>
									<IF COND="IsList.startitems=true">
									<THEN>
										<IF COND="startitems.#numRows!=0">
										<THEN>
											<LOOP LIST="startitems">
												<LOOP LIST="childTmpls">
													<ASSET.LIST LIST="lCurrentDef" TYPE="Variables.childTemplateAT" FIELD1="id" VALUE1="childTmpls.assetid"/>
														<IF COND="lCurrentDef.name=startitems.assetsubtype">
														<THEN>
															<LISTOBJECT.ADDROW NAME="startoptions" name="startitems.name" assettype="childATs.assettype" subtype="lCurrentDef.name" startid="startitems.id" templateChosen="lCurrentDef.id"/>
														</THEN>
														</IF>
														<IF COND="startitems.assetsubtype=CS.Empty">
														<THEN>
															<LISTOBJECT.ADDROW NAME="startoptions" name="startitems.name" assettype="childATs.assettype" subtype="lCurrentDef.name" startid="startitems.id" templateChosen="lCurrentDef.id"/>
														</THEN>
														</IF>
												</LOOP>
											</LOOP>
										</THEN>
										</IF>
									</THEN>
									</IF>
								</LOOP>
							</THEN>
							</IF>
							<LISTOBJECT.TOLIST NAME="startoptions" LISTVARNAME="startOptions"/>
							
							<IF COND="startOptions.#numRows!=0">
							<THEN>
								<IF COND="startOptions.#numRows=1">
								<THEN>
									<SETVAR NAME="StartItem" VALUE="startOptions.startid"/>
									<SETVAR NAME="AssetType" VALUE="startOptions.assettype"/>
									<SETVAR NAME="Arg:subtype" VALUE="startOptions.subtype"/>
									<SETVAR NAME="VarsToPreserve" VALUE="Variables.VarsToPreserve,Arg:subtype"/>
									<SETVAR NAME="op" VALUE="createNode"/>
								</THEN>
								<ELSE>
									<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
										<argument NAME="ThisPage" VALUE="ShowStartMenuTreeItems"/>
										<argument NAME="contentfunctions" VALUE="false"/>
										<ARGUMENT NAME="startmenutype" VALUE="child"/>
										<ARGUMENT NAME="cs_ParentDef" VALUE="lTreeDef.name"/>
										<!-- StartItem passed implicitly -->
										<argument NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
									</callelement>
								</ELSE>
								</IF>
							</THEN>
							</IF>
						</THEN>
						</IF>
					</THEN>
					</IF>
					</THEN>
					<ELSE>
						<IF COND="Variables.op=Edit">
						<THEN>
							<setvar NAME="op" VALUE="editNode"/>
						</THEN>
						<ELSE>
							<IF COND="Variables.op=Delete">
							<THEN>
								<setvar NAME="op" VALUE="deleteNode"/>
							</THEN>
							<ELSE>
								<IF COND="Variables.op=Inspect">
								<THEN>
									<setvar NAME="op" VALUE="displayNode"/>
								</THEN>
								<ELSE>
									<IF COND="Variables.op=Remove">
									<THEN>
										<setvar NAME="op" VALUE="removeFromActive"/>
									</THEN>
									</IF>
								</ELSE>
								</IF>
							</ELSE>
							</IF>
						</ELSE>
						</IF>
					</ELSE>
					</IF>
				</ELSE>
				</IF>
			</ELSE>
			</IF>
	
			<IF COND="Variables.op=createNode">
			<THEN>
				<IF COND="IsVariable.TreeNodeParentPath=false">
				<THEN>
					<!-- 
					   A create request is made from the tree-level popup,
					   there is no parent node, so use the selected node
					-->
					<setvar NAME="TreeNodeParentPath" VALUE="Variables.TreeNodePath"/>
				</THEN>
				</IF>

				<!-- Calling NewContentFront is special; we have to pass it a list of variables it's supposed to preserve (above and beyond the
					startmenu item), because it reposts through the workflow assignees selection etc. -->
				<IF COND="IsVariable.VarsToPreserve=false">
				<THEN>
					<SETVAR NAME="VarsToPreserve" VALUE="Variables.empty"/>
				</THEN>
				</IF>
				<IF COND="IsList.startOptions=true">
				<THEN>
					<IF COND="IsColumn.startOptions.templateChosen=true">
					<THEN>
						<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
							<argument NAME="ThisPage" VALUE="NewContentFront"/>
							<argument NAME="PostPage" VALUE="NewContentPost"/>
							<argument NAME="contentfunctions" VALUE="true"/>
							<argument NAME="AssetType"        VALUE="Variables.AssetType"/>
							<!-- StartItem passed implicitly -->
							<argument NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
							<argument NAME="VarsToPreserve" VALUE="Variables.VarsToPreserve"/>
							<argument NAME="TemplateChosen" VALUE="startOptions.templateChosen"/>
						</callelement>
					</THEN>
					<ELSE>
						<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
							<argument NAME="ThisPage" VALUE="NewContentFront"/>
							<argument NAME="PostPage" VALUE="NewContentPost"/>
							<argument NAME="contentfunctions" VALUE="true"/>
							<argument NAME="AssetType"        VALUE="Variables.AssetType"/>
							<!-- StartItem passed implicitly -->
							<argument NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
							<argument NAME="VarsToPreserve" VALUE="Variables.VarsToPreserve"/>
						</callelement>
					</ELSE>
					</IF>
				</THEN>
				<ELSE>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
						<argument NAME="ThisPage" VALUE="NewContentFront"/>
						<argument NAME="PostPage" VALUE="NewContentPost"/>
						<argument NAME="contentfunctions" VALUE="true"/>
						<argument NAME="AssetType"        VALUE="Variables.AssetType"/>
						<!-- StartItem passed implicitly -->
						<argument NAME="TreeNodeParentPath"  VALUE="Variables.TreeNodeParentPath"/>
						<argument NAME="VarsToPreserve" VALUE="Variables.VarsToPreserve"/>
					</callelement>
				</ELSE>
				</IF>
			</THEN>

			<ELSE>
				<IF COND="Variables.op=deleteNode">
				<THEN>
					<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
						<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
					</callelement>
					<IF COND="Variables.validatedstatus=true">
					<THEN>
					<setvar NAME="id" VALUE="Variables.ID"/>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
						<argument NAME="ThisPage" VALUE="DeleteFront"/>
						<argument NAME="PostPage" VALUE="DeletePost"/>
						<argument NAME="contentfunctions" VALUE="true"/>
						<argument NAME="AssetType" VALUE="Variables.AssetType"/>
						<argument NAME="TreeNodePath" VALUE="Variables.TreeNodePath"/>
						<argument NAME="TreeNodeParentPath" VALUE="Variables.TreeNodeParentPath"/>
					</callelement>
					</THEN>
					</IF>
				</THEN>
				<ELSE>
					<IF COND="Variables.op=displayNode">
					<THEN>

                        <!-- OpUrl op = Inspect OpUrl Release -->
                        
                        <callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
							<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
						</callelement>
						<IF COND="Variables.validatedstatus=true">
						<THEN>
						<setvar NAME="id" VALUE="Variables.ID"/>

                        <callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
							<argument NAME="ThisPage" VALUE="ContentDetailsFront"/>
							<argument NAME="contentfunctions" VALUE="true"/>
							<argument NAME="AssetType" VALUE="Variables.AssetType"/>
						</callelement>
						</THEN>
						</IF>

					</THEN>

					<ELSE>
						<IF COND="Variables.op=editNode">
						<THEN>
							<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
								<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
							</callelement>
							<IF COND="Variables.validatedstatus=true">
							<THEN>
							<setvar NAME="id" VALUE="Variables.ID"/>
								
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
								<argument NAME="ThisPage" VALUE="EditFront"/>
								<argument NAME="PostPage" VALUE="EditPost"/>
								<argument NAME="contentfunctions" VALUE="true"/>
								<argument NAME="AssetType" VALUE="Variables.AssetType"/>
								<argument NAME="TreeNodeParentPath" VALUE="Variables.TreeNodeParentPath"/>
								</callelement>
							</THEN>
							</IF>
						</THEN>
						<ELSE>
							<IF COND="Variables.op=PlacePage">
							<THEN>

								<!-- request from node level popup -->
								<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
									<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
								</callelement>
								<IF COND="Variables.validatedstatus=true">
								<THEN>
								<!-- if request was not from a Page node, don't set ParentPage -->
									<INDEXOF STR="Variables.TreeNodePath" WHAT="assettype%3" OUTSTR="index"/>
									<IF COND="Variables.index!=-1">
									<THEN>
										<IF COND="Variables.AssetType=Page">
										<THEN>
											<setvar NAME="ParentPage" VALUE="Variables.ID"/>
										</THEN>
										</IF>
									</THEN>
									</IF>
								
								<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
									<argument NAME="ThisPage" VALUE="PlacePageFront"/>
									<argument NAME="PostPage" VALUE="PlacePagePost"/>
									<argument NAME="AssetType" VALUE="Variables.AssetType"/>
									<argument NAME="TreeNodeParentPath" VALUE="Variables.TreeNodeParentPath"/>
								</callelement>
								</THEN>
								</IF>
							</THEN>
							<ELSE>
								<IF COND="Variables.op=OrderSiteplan">
								<THEN>
									<!-- request from node level popup -->
									<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
										<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
									</callelement>
									<IF COND="Variables.validatedstatus=true">
									<THEN>
										<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
											<argument NAME="ThisPage" VALUE="OrderSiteplan"/>
											<argument NAME="formtype" VALUE="front" />
											<argument NAME="pubid" VALUE="Variables.pubid" />
										</callelement>
									</THEN>
									</IF>
								</THEN>
								<ELSE>
									<IF COND="Variables.op=CopySiteNavigation" >
									<THEN>
										<callelement NAME="OpenMarket/Xcelerate/Actions/CopySiteNavigationFront" SCOPED="LOCAL">
											<argument NAME="AssetType" VALUE="Variables.AssetType"/>
											<argument NAME="ID" VALUE="Variables.ID"/>
											<argument NAME="confirm" VALUE="false"/>
										</callelement>
									</THEN>
									<ELSE>
										<IF COND="Variables.op=Publish">
										<THEN>

											<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
												<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
											</callelement>
											<IF COND="Variables.validatedstatus=true">
											<THEN>
											<setvar NAME="id" VALUE="Variables.ID"/>
											<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
												<argument NAME="ThisPage" VALUE="PublishFront"/>
												<argument NAME="PostPage" VALUE="PublishPost"/>
												<argument NAME="contentfunctions" VALUE="true"/>
												<argument NAME="AssetType" VALUE="Variables.AssetType"/>
											</callelement>
											</THEN>
											</IF>

										</THEN>
										<ELSE>
											<IF COND="Variables.op=Status">
											<THEN>
												<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
													<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
												</callelement>
												<IF COND="Variables.validatedstatus=true">
												<THEN>
												<setvar NAME="id" VALUE="Variables.ID"/>
												<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
													<argument NAME="ThisPage" VALUE="StatusDetailsFront"/>
													<argument NAME="AssetType" VALUE="Variables.AssetType"/>
												</callelement>
												</THEN>
												</IF>
											</THEN>
											<ELSE>
												<IF COND="Variables.op=removeFromActive">
												<THEN>
													<callelement NAME="OpenMarket/Gator/UIFramework/TreeIDFromPath">
														<argument NAME="TreePath" VALUE="Variables.TreeNodePath"/>				
													</callelement>
													<IF COND="Variables.validatedstatus=true">
													<THEN>
													<setvar NAME="report" VALUE="Remove"/>
													<setvar NAME="RemoveAsset" VALUE="Variables.ItemId"/>
													<callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPage">
														<argument NAME="ThisPage" VALUE="ShowMyActiveListFront"/>
													</callelement>
													</THEN>
													</IF>
												</THEN>
												</IF>
											</ELSE>
											</IF>
										</ELSE>
										</IF>
									</ELSE>
									</IF>
								</ELSE>
								</IF>
							</ELSE>
							</IF>
						</ELSE>
						</IF>
					</ELSE>
					</IF>
				</ELSE>
				</IF>
			</ELSE>
			</IF>
		</THEN>
		</IF>

		<!-- Finished handling the opcode -->
        <SETVAR NAME="outertermvar" VALUE="true"/>   
        
	</THEN>
	<ELSE>
		<SETVAR NAME="outertermvar" VALUE="true"/>
    </ELSE>

    </IF>

	<INCCOUNTER NAME="myoutercounter" VALUE="1"/>	
</LOOP>
<!-- Finished parsing the nodedata -->

</FTCS> 
