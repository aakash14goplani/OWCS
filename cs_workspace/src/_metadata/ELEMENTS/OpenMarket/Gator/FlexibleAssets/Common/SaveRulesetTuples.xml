<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Gator/FlexibleAssets/Common/SaveRulesetTuples
-
- INPUT
-
--	Prefix - prefix of variables names - prefix used in appropriate gather.
-
- OUTPUT
-
-->
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType" />

 <IF COND="Variables.Prefix=flexassets">
    <THEN>
        <FLEXASSET.GETRATINGRULESETMAP NAME="theCurrentAsset" OBJVARNAME="theAppMap"/> 
    </THEN>
</IF>
<IF COND="Variables.Prefix=flexgroups">
    <THEN>
        <FLEXGROUP.GETRATINGRULESETMAP NAME="theCurrentAsset" OBJVARNAME="theAppMap"/> 
    </THEN>
</IF>

	<!--If nothing is set up, then make sure "this" is set up--> 
	<IF COND="Variables.ContentDetails:ruleset_map:Total=0">
		<THEN>
			<SETVAR NAME="ContentDetails:ruleset_map:Total" VALUE="1"/>
			<SETVAR NAME="ContentDetails:ruleset_map:0:key" VALUE="this"/>
			<SETVAR NAME="ContentDetails:ruleset_map:0:type" VALUE="asset"/>
			<ASSET.GET NAME="theCurrentAsset" FIELD="id"/>
			<SETVAR NAME="ContentDetails:ruleset_map:0:value" VALUE="Variables.AssetType:Variables.id"/>
		</THEN>
	</IF>

    <RULESETMAP.SET NAME="theAppMap" KEY="this" TYPE="asset" VALUE="Variables.AssetType:Variables.id"/>
    <IF COND="Variables.Prefix=flexassets">
        <THEN>
            <FLEXASSET.SETRATINGRULESETMAP NAME="theCurrentAsset" OBJECT="theAppMap"/>
        </THEN>
    </IF>
    <IF COND="Variables.Prefix=flexgroups">
        <THEN>
            <FLEXGROUP.SETRATINGRULESETMAP NAME="theCurrentAsset" OBJECT="theAppMap"/>
        </THEN>
    </IF>
    <ASSET.SCATTER NAME="theCurrentAsset" PREFIX="Variables.Prefix" FIELDLIST="ruleset"/>
	<STRING.ENCODE VARIABLE="ContentDetails:ruleset_map:Total" VARNAME="ContentDetails:ruleset_map:Total" />
	<INPUT TYPE="HIDDEN" NAME="Variables.Prefix:ruleset_map:Total" VALUE="Variables.ContentDetails:ruleset_map:Total" REPLACEALL="Variables.ContentDetails:ruleset_map:Total,Variables.Prefix"/>

	<SETCOUNTER NAME="typecount" VALUE="0"/>
	<IF COND="Variables.ContentDetails:ruleset_map:Total!=0">
		<THEN>
			<LOOP COUNT="Variables.ContentDetails:ruleset_map:Total">
				<ICS.RESOLVEVARIABLES  NAME="$(Variables.ContentDetails:ruleset_map:$(Counters.typecount):key)" OUTPUT="ourKey" DELIMITED="true"/>
				<STRING.ENCODE VARIABLE="ourKey" VARNAME="ourKey" />
				<INPUT TYPE="HIDDEN" NAME="Variables.Prefix:ruleset_map:Counters.typecount:key" VALUE="Variables.ourKey" REPLACEALL="Variables.ourKey,Counters.typecount,Variables.Prefix"/>
				<ICS.RESOLVEVARIABLES  NAME="$(Variables.ContentDetails:ruleset_map:$(Counters.typecount):type)" OUTPUT="ourType" DELIMITED="true"/>
				<STRING.ENCODE VARIABLE="ourType" VARNAME="ourType" />
				<INPUT TYPE="HIDDEN" NAME="Variables.Prefix:ruleset_map:Counters.typecount:type" VALUE="Variables.ourType" REPLACEALL="Variables.ourType,Counters.typecount,Variables.Prefix"/>
				<ICS.RESOLVEVARIABLES  NAME="$(Variables.ContentDetails:ruleset_map:$(Counters.typecount):value)" OUTPUT="ourValue" DELIMITED="true"/>
				<STRING.ENCODE VARIABLE="ourValue" VARNAME="ourValue" />
				<INPUT TYPE="HIDDEN" NAME="Variables.Prefix:ruleset_map:Counters.typecount:value" VALUE="Variables.ourValue" REPLACEALL="Variables.ourValue,Counters.typecount,Variables.Prefix"/>
				<INCCOUNTER NAME="typecount" VALUE="1"/>
			</LOOP>
		</THEN>
	</IF>

</FTCS>