<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Revision: 11 $ 
$Modtime: 6/28/02 11:07a $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- UnRegisterAsset.xml
-
- DESCRIPTION
-
- HISTORY 
-->

<!-- to unregister an asset, we must:

	1.	Delete the entries for the asset type from the ElementCatalog table.
	2.	Delete the entries for the asset type from the SystemSQL table.
-->

<!--
	1.  do the ElementCatalog entries
-->

<if COND="Variables.errno=0">
<then>
	<setvar NAME="tablename" VALUE="ElementCatalog"/>
	<SQLEXP OUTSTR="qry" VERB="LIKE" STR="OpenMarket/Xcelerate/AssetType/Variables.assettype/" COLNAME="elementname" TYPE="AND"/>
	<EXECSQL SQL="SELECT * FROM ElementCatalog WHERE Variables.qry" LIST="elementsToDelete"/>
	<if COND="IsError.Variables.errno=false">
	<then>
		<setcounter NAME="count" VALUE="0"/>
		<LOOP LIST="elementsToDelete">
			<setvar NAME="elementnameCounters.count" VALUE="elementsToDelete.elementname"/>
			<inccounter NAME="count" VALUE="1"/>
		</LOOP>

		<setvar NAME="errno" VALUE="0"/>
		<CATALOGMANAGER>
			<ARGUMENT NAME="tablename" VALUE="ElementCatalog"/>
			<ARGUMENT NAME="ftcmd" VALUE="deleterows"/>
			<ARGUMENT NAME="Delete uploaded file(s)" VALUE="yes"/>
		</CATALOGMANAGER>
		<if COND="IsError.Variables.errno=true">
		<then>
				<XLAT.STREAM KEY="dvin/Assetmaker/ErrorForDeleteRegister" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false"/> <br/>
		</then>
		</if>
	</then>
	<else>
		<if COND="Variables.errno=-101">
		<then>
			<XLAT.LOOKUP KEY="dvin/Assetmaker/UnRegisterAsset-noElements" VARNAME="_xlat_warning"/>
			<setvar NAME="deletewarnings" VALUE="Variables.deletewarningsVariables._xlat_warning&#60;br&#62;"/>
			<setvar NAME="errno" VALUE="0"/>
		</then>
		<else>
				<XLAT.STREAM KEY="dvin/Assetmaker/ErrorForSearchRegister" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false"/><br/>
		</else>
		</if>
	</else>
	</if>
</then>
</if>

<!--
	2.  next do the SystemSQL entries
-->
<if COND="Variables.errno=0">
<then>
	<setvar NAME="tablename" VALUE="SystemSQL"/>
	<SQLEXP OUTSTR="qry" VERB="LIKE" STR="OpenMarket/Xcelerate/AssetType/Variables.assettype/" COLNAME="qryname" TYPE="AND"/>
	<EXECSQL SQL="SELECT * FROM SystemSQL WHERE Variables.qry" LIST="queriesToDelete"/>
	<if COND="IsError.Variables.errno=false">
	<then>
		<setcounter NAME="count" VALUE="0"/>
		<LOOP LIST="queriesToDelete">
			<setvar NAME="qrynameCounters.count" VALUE="queriesToDelete.qryname"/>
			<inccounter NAME="count" VALUE="1"/>
		</LOOP>

	<setvar NAME="errno" VALUE="0"/>
	<CATALOGMANAGER>
		<ARGUMENT NAME="tablename" VALUE="SystemSQL"/>
		<ARGUMENT NAME="ftcmd" VALUE="deleterows"/>
		<ARGUMENT NAME="Delete uploaded file(s)" VALUE="yes"/>
	</CATALOGMANAGER>
		<if COND="IsError.Variables.errno=true">
		<then>
			<XLAT.STREAM KEY="dvin/Assetmaker/ErrorForDeleteQueryRegister" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false"/>  <br/>
		</then>
		</if>
	</then>
	<else>
		<if COND="Variables.errno=-101">
		<then>
			<XLAT.LOOKUP KEY="dvin/Assetmaker/UnRegisterAsset-noQueries" VARNAME="_xlat_warning"/>
			<setvar NAME="deletewarnings" VALUE="Variables.deletewarningsVariables._xlat_warning&#60;br&#62;"/>
		</then>
		<else>
			<XLAT.STREAM KEY="dvin/Assetmaker/ErrorForSearchQueryRegister" errno="Variables.errno" assettype="Variables.assettype" EVALALL="false"/>  <br/>
		</else>
		</if>
	</else>
	</if>
</then>
</if>
</FTCS> 
