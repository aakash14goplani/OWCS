<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/CSClient/CheckOut
-
- INPUT
-  AssetType
-  ainst
-  id
-  Function
- OUTPUT
-  doproceed
-->

<ASSET.CANEDIT NAME="ainst"/>
<SETVAR NAME="doproceed" VALUE="true"/>
<IF COND="IsError.Variables.errno=true">
<THEN>        
   <SETVAR NAME="doproceed" VALUE="EditNotAllowed"/>
</THEN>
<ELSE>
   <callelement NAME="OpenMarket/Xcelerate/Actions/Workflow/CheckPrivs">
     <argument NAME="AssetType" VALUE="Variables.AssetType"/>
     <argument NAME="assetObjectName" VALUE="ainst"/>
     <argument NAME="Function" VALUE="Variables.Function"/>
   </callelement>
   
   <if COND="Variables.PrivsFailed=true">
   <then>
      <SETVAR NAME="doproceed" VALUE="Variables.PrivsFailedReason"/>
   </then>
   <else>
      <!-- check to see if the table is tracked
        if so, then the current record must
        be locked by the current user -->
      <callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
          <argument NAME="AssetType" VALUE="Variables.AssetType"/>
      </callelement>
      <if COND="Variables.trackingenabled=true">
      <then>
         <history TABLE="Variables.AssetType" ASSET="Variables.id" LIST="ItsHistory"/>
         <callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/LockIfNeeded">
            <argument NAME="AssetType" VALUE="Variables.AssetType"/>
            <argument NAME="id" VALUE="Variables.id"/>
        </callelement>
         <IF COND="Variables.alreadylocked!=true">
         <THEN>
		<USERMANAGER.GETLOGINUSER VARNAME="userID"/>
		<IMPLICITCHECKOUT.LOGIMPLICITCHECKOUT USER="Variables.userID"
			ASSETTYPE="Variables.AssetType"
			ASSETID="Variables.id"
			FUNCTION="Edit"/>

           <!-- implicit checkout adds a row to CheckOutInfo -->
            <!-- CATALOGMANAGER>
               <ARGUMENT NAME="checkout" VALUE="CS.UniqueID"/>
               <ARGUMENT NAME="tablename" VALUE="CheckOutInfo"/>
               <ARGUMENT NAME="assetid" VALUE="Variables.id"/>
               <ARGUMENT NAME="assettype" VALUE="Variables.AssetType"/>
               <ARGUMENT NAME="functionid" VALUE="Edit"/>
               <ARGUMENT NAME="checkoutdate" VALUE="CS.SQLDate"/>
               <ARGUMENT NAME="username" VALUE="SessionVariables.username"/>
               <ARGUMENT NAME="ftcmd" VALUE="addrow"/>
            </CATALOGMANAGER --> 
         </THEN>
         </IF>
      </then>
      </if>
   </else>
   </if>
</ELSE>
</IF>

</FTCS> 
