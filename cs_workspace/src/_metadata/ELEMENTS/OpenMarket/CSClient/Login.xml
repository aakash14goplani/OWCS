<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/CSClient/Login
- INPUT
- OUTPUT
-->

<IF COND="Variables.command!=logout">
<THEN>
   <MISC.DOCLINKDECRYPT PASSWORD="Variables.LoginPassword" VARNAME="LoginPassword"/>
   <USERMANAGER.LOGINUSER USERNAMEVARIABLE="LoginUserID" PASSWORDVARIABLE="LoginPassword" VARNAME="loggedIn"/>
   <IF COND="Variables.loggedIn=true">
   <THEN>
	<SETVAR NAME="sessionidvar" VALUE="CS.Empty"/>
	<STRINGLIST NAME="CookiesList" STR="CS.Header.Cookie" DELIM=";"/>
	<LOOP LIST="CookiesList">
		<INDEXOF STR="CookiesList.ITEM" WHAT="JSESSIONID" OUTSTR="index"/>
		<IF COND="Variables.index=0">
		<THEN>
			<SETVAR NAME="sessionidvar" VALUE="CookiesList.ITEM"/>
		</THEN>
		</IF>
	</LOOP>
	<IF COND="Variables.sessionidvar=CS.Empty">
	  <THEN>
			<SETVAR NAME="sessionidvar" VALUE="CS.UniqueID"/>
	  </THEN>
	</IF>
	<SESSION SESSIONID="Variables.sessionidvar" REPLACEALL="Variables.sessionidvar"/>
    
   	<USERMANAGER.GETLOGINUSER VARNAME="loginuser"/>
   
   	<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetLocale">
   		<ARGUMENT NAME="loginuser" VALUE="Variables.loginuser"/>
   	</CALLELEMENT>
      <SETSSVAR NAME="username" VALUE="Variables.LoginUserID"/>
   </THEN>
   <ELSE>
      <CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetLocale"/>
      <XLAT.LOOKUP KEY="dvin/CSDocLink/Loginfailed" VARNAME="_XLAT_"/>
   	<ERROR CODE="2" DESCRIPTION="Variables._XLAT_" SEVERITY="2" REPLACEALL="Variables._XLAT_"/>
   </ELSE>
   </IF>
</THEN>
<ELSE>
   <CATALOGMANAGER>
      <ARGUMENT NAME="ftcmd" VALUE="logout"/>
   	<ARGUMENT NAME="killsession" VALUE="true"/>
   </CATALOGMANAGER>
</ELSE>
</IF>

</FTCS> 
