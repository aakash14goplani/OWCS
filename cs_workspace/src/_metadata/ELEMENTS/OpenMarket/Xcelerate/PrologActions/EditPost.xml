<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/Xcelerate36/install/Populate/ElementCatalog/OpenMarket/Xcelerate/PrologActions/EditPost.xml $ 
$Revision: 2 $ 
$Modtime: 3/02/01 6:01p $ 
-->

<!--
- Confidential and Proprietary Information of Open Market Inc.
-					All Rights Reserved.
-
- EditPost.xml
-
- INPUT
-	Variables.id
-	Variables.AssetType
-  Variables.upcommand - cancel or submit
-->

<SETVAR NAME="hasError" VALUE="false"/>
<IF COND="Variables.upcommand!=cancel">
<THEN>
	<!-- Load the asset -->
	<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="theCurrentAsset" EDITABLE="true"/>
	<IF COND="IsError.Variables.errno=true">
	<THEN>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<ARGUMENT NAME="elem" VALUE="EnterAssetFailed"/>
			<ARGUMENT NAME="severity" VALUE="error"/>
			<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
		</CALLELEMENT>
		<SETVAR NAME="errorAlreadyDisplayed" VALUE="true"/>
		<SETVAR NAME="hasError" VALUE="true"/>
	</THEN>
	<ELSE>
		<ASSET.GET NAME="theCurrentAsset" FIELD="status" OUTPUT="assetStatusBeforeEdit"/>
		<IF COND="Variables.assetStatusBeforeEdit=VO">
		<THEN>
			<setvar NAME="error" VALUE="CantEditVoidedAsset"/>
			<SETVAR NAME="reterrno" VALUE="-12077"/>
			<SETVAR NAME="hasError" VALUE="true"/>
		</THEN>
		<ELSE>
			<!-- check whether we can perform this function on this asset (access right may have changed since the front page was displayed) -->
			<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Workflow/CheckPrivs">
				<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
				<ARGUMENT NAME="assetObjectName" VALUE="theCurrentAsset"/>
				<ARGUMENT NAME="Function" VALUE="edit"/>
			</CALLELEMENT>
			<IF COND="Variables.PrivsFailed=true">
			<THEN>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
					<ARGUMENT NAME="error" VALUE="Variables.PrivsFailedReason"/>
				</CALLELEMENT>
				<SETVAR NAME="hasError" VALUE="true"/>
				<SETVAR NAME="errorAlreadyDisplayed" VALUE="true"/>
			</THEN>
			</IF>
		</ELSE>
		</IF>
	</ELSE>
	</IF>
</THEN>
</IF>

</FTCS>


