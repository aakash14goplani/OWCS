<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Xcelerate/PrologActions/Publish/Mirror1/ShowPublishedAssets
-
- INPUT
- Variables.output - the publish output file
- Variables.limit - how many to display
- OUTPUT
-
-->
<!-- Mirror publish output -->		     
 <STRINGLIST NAME="strlist1" STR="Variables.output" DELIM="%0a"/>
 <if COND="strlist1.#numRows!=0">
 <then>
 		<SETCOUNTER NAME="numAssets" VALUE="0"/>
		<!-- expecting string '#mirroring Article,100000000 ' on each line-->
		<LISTOBJECT.CREATE NAME="listobject" COLUMNS="assetid,assettype" />
 		<LOOP LIST="strlist1">
 			<BEGINS STR="strlist1.ITEM" WHAT="#mirroring"/>
 			<if COND="Variables.errno=1">
 			<then>
 				<IF COND="Counters.numAssets!=Variables.limit">
 				<THEN>
	 				<STRINGLIST NAME="strlist2" STR="strlist1.ITEM" DELIM="%20"/>
		 	      <GOTOROW LIST="strlist2" ROWNUM="2"/>
			      <setvar NAME="assettype" VALUE="strlist2.ITEM"/>
			      <GOTOROW LIST="strlist2" ROWNUM="3"/>
			      <setvar NAME="assetid" VALUE="strlist2.ITEM"/>
		 	    	<LISTOBJECT.ADDROW NAME="listobject"
				        assetid="Variables.assetid"
				        assettype="Variables.assettype" />
				   <INCCOUNTER NAME="numAssets" VALUE="1"/>
				</THEN>
				</IF>
		   </then>
		   <else>
		   	<STRING.STREAM VALUE="strlist1.ITEM"/><br/>
		   </else>
		   </if>
		</LOOP>
		<LISTOBJECT.TOLIST NAME="listobject" LISTVARNAME="assetlist" />
		<if COND="assetlist.#numRows!=0">
		<then>
			<!-- if there were more than the limit of assets, say so and display link to full list-->
			<IF COND="Counters.numAssets=Variables.limit">
			<THEN>
				<table width="100%"><tr>
				<td class="form-label-text">
				<XLAT.STREAM KEY="dvin/UI/Publish/Mirror1ShowPublishedAssets-firstN"/>
				</td>
				<td class="small-text" align="right">
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowPublishOutputFront" outstring="urlshpuboutfront">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
				<satellite.argument name="id" value="Variables.id"/>
				<satellite.argument name="limit" value="-1"/>
				</SATELLITE.LINK>
				<XLAT.LOOKUP KEY="dvin/UI/Publish/Mirror1ShowPublishedAssets-showpublishedassets" VARNAME="_XLAT_"/>
				<XLAT.LOOKUP KEY="dvin/UI/Publish/Mirror1ShowPublishedAssets-showpublishedassets" VARNAME="mouseover" ESCAPE="true"/>
	         <A HREF="Variables.urlshpuboutfront" OnMouseOver="window.status='Variables.mouseover'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.mouseover,Variables.urlshpuboutfront"><XLAT.STREAM KEY="dvin/UI/Publish/Mirror1ShowPublishedAssets-completelist"/></A>
				</td>
				</tr></table>
			</THEN>
			</IF>
     		<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/TileMixedAssets">
				<ARGUMENT NAME="list" VALUE="assetlist"/>
				<ARGUMENT NAME="target" VALUE="Variables.pubtgt:id"/>
				<ARGUMENT NAME="targetname" VALUE="Variables.pubtgt:name"/>
				<ARGUMENT NAME="limit" VALUE="Variables.limit"/>
				<ARGUMENT NAME="doIcons" VALUE="false"/>
			</CALLELEMENT>
		</then>
		</if>						
 </then>
 <else>
 	<STRING.STREAM VARIABLE="output"/>
 </else>
 </if>     			 


</FTCS> 
