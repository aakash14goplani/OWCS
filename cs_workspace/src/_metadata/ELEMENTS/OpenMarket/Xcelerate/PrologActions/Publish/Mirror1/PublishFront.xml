<?xml version="1.0" ?>
<!DOCTYPE ftcs SYSTEM "futuretense_cs.dtd">
<ftcs version="1.2">
<!-- OpenMarket/Xcelerate/PrologActions/Publish/Mirror1/PublishFront
-
- INPUT
-	  Variables.target -- target id
-	  Variables.pubtgt:*  -- scattered pubtarget variables
- OUTPUT
-
-->
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PublishFront" outstring="urlsitepost">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
        <satellite.argument name="target" value="Variables.target"/>
        <satellite.argument name="cs_PublishSite" value="yes"/>
    </SATELLITE.LINK>

<SCRIPT LANGUAGE="JavaScript">
<replaceall LIST="Variables.urlsitepost">
<![CDATA[
function setCheckSite(form)
{       ]]>
   if (confirm("<XLAT.STREAM KEY="dvin/UI/Publish/AboutToPublish" ESCAPE="true" ENCODE="false"/>")) {
   <![CDATA[
    var pURL = "Variables.urlsitepost";
        ]]>
        <if cond="Variables.cs_environment=portal">
        <then>
            window.location=pURL;
        </then>
        <else>
            parent.frames['XcelAction'].location=pURL;
        </else>
        </if><![CDATA[
    }
    return false;
}
]]>

</replaceall>
</SCRIPT>

<IF COND="IsVariable.cs_PublishSite=true">
<THEN>
    <CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/MirrorSitePost">
        <ARGUMENT NAME="pubid" VALUE="SessionVariables.pubid"/>
        <ARGUMENT NAME="target" VALUE="Variables.target"/>
        <ARGUMENT NAME="cs_ExcludeSite" VALUE="false"/>
        <ARGUMENT NAME="cs_ExcludePlan" VALUE="true"/>
        <ARGUMENT NAME="cs_Verbose" VALUE="false"/>
    </CALLELEMENT>
    <SETVAR NAME="pagetype" VALUE="front"/>
</THEN>
</IF>

<setvar NAME="targettype" VALUE="mirror" />

<table class="width-outer-70" border="0" cellpadding="0" cellspacing="0">

	<tr>
		<td><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Publishdestination"/>:  </span><span class="title-value-text"><STRING.STREAM VALUE="Variables.pubtgt:name"/></span></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar">
		<argument NAME="SpaceBelow" VALUE="No"/>
	</callelement>

	<tr>
	<td>
	
	<table border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Destination"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><img id="_targetStatus" border="0" style="position:relative;top:3px" src="Variables.cs_imagedir/graphics/common/icon/unavailable.gif" REPLACEALL="Variables.cs_imagedir"/>&nbsp;<XLAT.STREAM KEY="dvin/UI/Publish/pubtgtnameusingpubdtname"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td NOWRAP="NOWRAP" class="form-label-text"><XLAT.STREAM KEY="dvin/UI/Admin/Destinationaddress"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><string.stream VARIABLE="pubtgt:dest"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Arguments"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><STRINGLIST   NAME="factorsList" STR="Variables.pubtgt:factors" DELIM="%26"/>
		<loop LIST="factorsList">
		<INDEXOF STR="factorsList.ITEM" WHAT="EMAILIDS" OUTSTR="index" INDEX="0"/>
		<IF COND="Variables.errno=0">
			<THEN>
				<span><STRING.STREAM VALUE="factorsList.ITEM"/><BR/></span>
			</THEN>
		</IF>
		</loop>
		</td>
	</tr>

	<tr>
	<td colspan="2"><BR/></td>
	<td>
	
	<if COND="Variables.AbortFlag!=true">
	<then>
	     <PROPERTY.GET PARAM="xcelerate.batchhost" INIFILE="futuretense_xcel.ini" VARNAME="batchhost"/>
	     <if COND="Variables.batchhost=Variables.empty">
	     <then>
	          <P><XLAT.STREAM KEY="dvin/UI/Error/notfoundxceleratepropertybatchhost"/>
	          </P>
	          <setvar NAME="AbortFlag" VALUE="true"/>
	     </then>
	     </if>
	</then>
	</if>
	
	<if COND="Variables.AbortFlag!=true">
	<then>
	    <CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Publish/HeldPublishableAssets">
			<ARGUMENT NAME="target" VALUE="Variables.target"/>
			<ARGUMENT NAME="targettype" VALUE="mirror"/>
			<ARGUMENT NAME="allowLinks" VALUE="true"/>
		</CALLELEMENT>
	</then>
	</if>
	
	</td></tr>
	    
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
	
	<SETVAR NAME="errno" VALUE="0"/>
	<USERISMEMBER GROUP="xcelpublish"/>
	<IF COND="Variables.errno=1">
	<THEN>
		<tr>
			<td colspan="2"><BR/></td>
			<td align="left">
			<SETVAR NAME="errno" VALUE="0"/>
			<USERISMEMBER GROUP="xceladmin"/>
			<IF COND="Variables.errno=1">
			<THEN>	
			<satellite.link assembler="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urlConfdest">
				<satellite.argument name="action" value="details"/>
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
	            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
	            <satellite.argument name="id" value="Variables.pubtgt:id"/>
			</satellite.link>
			<A HREF="Variables.urlConfdest" REPLACEALL="Variables.urlConfdest"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/ConfigureDestination_"/></CALLELEMENT></A>
			<img height="1" width="20" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
			<satellite.link assembler="query" pagename="OpenMarket/Xcelerate/Admin/Publish/PublishEventEdit" outstring="urlConfSch">
				<satellite.argument name="action" value="edit"/>
				<satellite.argument name="target" value="Variables.pubtgt:id"/>
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
	            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>                                 
			</satellite.link>
			<A HREF="Variables.urlConfSch" REPLACEALL="Variables.urlConfSch"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/EditPublishSchedule_"/></CALLELEMENT></A>
	
			<img height="1" width="100" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
			</THEN>
			</IF>		
			<if COND="Variables.AbortFlag!=true">
				<then>
				<if COND="Variables.publishIsRunning!=true">
					<then>
					<if COND="Variables.PublishableAssetsCount!=0">
						<then>
							<XLAT.LOOKUP KEY="dvin/UI/Publish" VARNAME="_XLAT_" ESCAPE="true"/>
							<A HREF="javascript:void(0)" onclick="return setCheck(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Publish"/></CALLELEMENT></A>
							<img height="1" width="20" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
		                </then>
		            </if>
		            <!--<SETVAR NAME="errno" VALUE="0"/>
		            <USERISMEMBER GROUP="xceladmin"/>
		            <IF COND="Variables.errno=1">
						<THEN>
		                    <A HREF="javascript:void(0)" onclick="return setCheckSite(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><IMG src="Variables.cs_imagedir/graphics/SessionVariables.locale/button/content/images/create_site_on_target.gif" VSPACE="10" HSPACE="15" BORDER="0"  REPLACEALL="Variables.cs_imagedir,SessionVariables.locale"/></A>
		                </THEN>
		            </IF>-->
					</then>
		        </if>
				</then>
		    </if>
			<XLAT.LOOKUP KEY="dvin/UI/CancelPublish" VARNAME="_XLAT_" ESCAPE="true"/>
			<A HREF="javascript:void(0)" onclick="return CancelHandler()" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
		   </td>
		</tr>
	</THEN>
	</IF>

	</table>
	</td>
	</tr>
</table>
</ftcs>