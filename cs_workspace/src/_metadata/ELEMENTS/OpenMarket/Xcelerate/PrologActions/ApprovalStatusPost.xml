<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/PrologActions/ApprovalStatusPost
-
- INPUT
- Variables.id
- Variables.AssetType
- Variables.approveIt - semicolon separated list of assettype,id to approve
- Variables.target
- Variables.targetname
-
- OUTPUT
-
-->

<IF COND="Variables.upcommand!=cancel">
<THEN>
	<!-- figure out the target type is mirror or export. If it is export, 
	     approval type is template, otherwise fundamental -->
	<PUBTARGETMANAGER.LOAD ID="Variables.target" OBJVARNAME="pubtgt"/>
	<if COND="IsError.Variables.errno=true">
	<then>
		Error = <CSVAR NAME="Variables.errno"/><br/>
      <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
         <argument NAME="error" VALUE="NoPublishDest"/>
     	</callelement>
     	<setvar NAME="upcommand" value="cancel"/>
	</then>
	</if>
	<PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
	     
	<if COND="IsError.Variables.errno=false">
	<then>
	     <DELIVERYTYPE.LOAD NAME="pubdt" OBJECTID="Variables.pubtgt:type"/>
	     <DELIVERYTYPE.GET NAME="pubdt" FIELD="path" OUTPUT="pubdt:path"/>
	     <if COND="IsError.Variables.errno=true">
	     <then>
				Error = <CSVAR NAME="Variables.errno"/><br/>
		      <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		         <argument NAME="error" VALUE="NoPublishDest"/>
		     	</callelement>
     			<setvar NAME="upcommand" value="cancel"/>
	     </then>
	     <else>
	          <ENDS STR="Variables.pubdt:path" WHAT="Export"/>
	          <if COND="Variables.errno=1">
	          <then>
	          		<!-- Export -->
	               <setvar NAME="targettype" VALUE="export" />
		  		</then>
	          <else>
	          		<!-- Mirror -->
	               <setvar NAME="targettype" VALUE="mirror" />
	          </else>
		  </if>
	          <setvar NAME="errno" VALUE="0" />
	     </else>
	     </if>
	</then>
	</if> 
</THEN>
</IF>

</FTCS> 
