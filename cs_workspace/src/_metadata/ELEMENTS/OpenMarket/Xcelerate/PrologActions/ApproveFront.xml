<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/PrologActions/ApproveFront
-
- INPUT
-
- OUTPUT
-
-->
<setvar NAME="doproceed" VALUE="true"/>

<SETVAR NAME="assetname" VALUE="theCurrentAsset"/> <!--this line to be removed after to assetObjectName complete jrws-->
<SETVAR NAME="assetObjectName" VALUE="theCurrentAsset"/>
<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetObjectName"/>
<if COND="IsError.Variables.errno=true">
    <then>        
        <setvar NAME="doproceed" VALUE="InvalidContentId"/>
    </then>
</if>


<if COND="Variables.doproceed=true">
<then>
		
	<callelement NAME="OpenMarket/Xcelerate/Scripts/ValidateInput"></callelement>
		
    <callelement NAME="OpenMarket/Xcelerate/Actions/Workflow/CheckPrivs">
        <argument NAME="AssetType" VALUE="Variables.AssetType"/>
        <argument NAME="assetObjectName" VALUE="Variables.assetObjectName"/>
        <argument NAME="Function" VALUE="approve"/>
    </callelement>
    
     <if COND="Variables.PrivsFailed=true">
     <then>
         <setvar NAME="doproceed" VALUE="Variables.PrivsFailedReason"/>
     </then>
     <else>
     			<!-- asset must not be locked, in order to do approval -->
			<callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
			    <argument NAME="AssetType" VALUE="Variables.AssetType"/>
			</callelement>
			<if COND="Variables.trackingenabled=true">
			<then>
	        	<history TABLE="Variables.AssetType" ASSET="Variables.id" LIST="ItsHistory"/>
			   <if COND="ItsHistory.#numRows!=0">
			    <then>
					<if COND="ItsHistory.lockedby!=Variables.empty">
					<then>
        				<setvar NAME="doproceed" VALUE="ApproveCheckedOut"/>
					</then>
					</if>
				</then>
				</if>
		    </then>
			</if>
		</else>
		</if>
</then>
</if>

<if COND="Variables.doproceed=true">
<then>
	<ASSET.GETASSETTYPE NAME="Variables.assetObjectName" OUTNAME="type"/>
	<ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="atDescription"/>
	
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="id" OUTPUT="id"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="name" />
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="createdby" OUTPUT="createdby"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="createddate" OUTPUT="createddate"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="updatedby" OUTPUT="updatedby"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="updateddate" OUTPUT="updateddate"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="description" OUTPUT="description"/>
	<ASSET.GET NAME="Variables.assetObjectName" FIELD="status" OUTPUT="statuscode"/>

</then>
</if>
</FTCS> 
