<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/PrologActions/AddToActiveListPost
-
- INPUT
-
- OUTPUT
-
-->

<SETVAR NAME="doProceed" VALUE="false"/>
<SETVAR NAME="errno" VALUE="0"/>

<USERMANAGER.GETLOGINUSER VARNAME="theUser"/>
<USERMANAGER.GETLOGINUSERNAME VARNAME="theUserName"/>
<IF COND="IsVariable.AddALAsset=true">
<THEN>
	<STRINGLIST NAME="NewList" STR="Variables.AddALAsset" DELIM=";"/>

	<LOOP LIST="NewList">
	
		<SETVAR NAME="assettype" VALUE="NewList.ITEM"/>
		
	  	<SETROW LIST="NewList" ACTION="NEXT"/>
		<SETVAR NAME="assetid" VALUE="NewList.ITEM"/>
		<SETVAR NAME="userid" VALUE="Variables.theUser"/>
	
		<SELECTTO LIST="currentItem" FROM="ActiveList" WHERE="userid,assetid"/>
		
		<IF COND="Variables.errno!=-101">
		<THEN>
			<!-- we only wish to report that an asset is already in the activelist if 
				we are adding just a single asset. If we are adding a list of assets, 
				we should fail silently, skipping any duplicates
			-->
			<IF COND="NewList.#numRows=2">
			<THEN>
				<SETVAR NAME="doProceed" VALUE="alreadyThere"/>
			</THEN>
			</IF>
		</THEN>
		<ELSE>
	
			<ACTIVELIST.CREATE OBJVARNAME="ali"/>
			<ACTIVEITEM.SETASSETTYPE NAME="ali" VALUE="Variables.assettype"/>
			<ACTIVEITEM.SETASSETID NAME="ali" VALUE="Variables.assetid"/>
			<ACTIVEITEM.SETUSER NAME="ali" VALUE="Variables.theUser"/>
			
			<ACTIVELIST.SAVE OBJECT="ali"/>
			<SETVAR NAME="doProceed" VALUE="true"/>
			
			<SETVAR NAME="__NeedRefresh__" VALUE="yes"/>
		</ELSE>
		</IF>
	</LOOP>
</THEN>
<ELSE>
	<XLAT.LOOKUP VARNAME="AddSuccess" KEY="dvin/UI/AssetMgt/NoitemstoaddtoAL" theUserName="Variables.theUserName" EVALALL="false"/>
	<SETVAR NAME="doProceed" VALUE="true"/>
</ELSE>
</IF>


</FTCS> 
