<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!-- OpenMarket/Xcelerate/UIFramework/ShowPreviewFrames

 INPUT
   Variables.AssetType
   Variables.id
   Variables.target     (optional)
   Variables.pubid
 OUTPUT

-->

<if COND="IsVariable.mode=false">
<then>
	<SETVAR NAME="mode" VALUE="preview"/>
</then>
</if>
<IF COND="IsVariable.cs_environment=false">
<THEN>
	<SETVAR NAME="cs_environment" VALUE="CS.Empty"/>
</THEN>
</IF>
<CALLELEMENT NAME="OpenMarket/Xcelerate/ControlPanel/Login">
	<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
	<ARGUMENT NAME="id" VALUE="Variables.id"/>
	<if COND="IsVariable.target=true">
	<then>
		<ARGUMENT NAME="target" VALUE="Variables.target"/>
	</then>
	</if>
	<ARGUMENT NAME="mode" VALUE="Variables.mode"/>
	<ARGUMENT NAME="pubid" VALUE="Variables.pubid"/>
	<ARGUMENT NAME="cs_environment" VALUE="Variables.cs_environment"/>
</CALLELEMENT>
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>

<!-- set locale -->
<USERMANAGER.GETLOGINUSER VARNAME="loginuser"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetLocale">
    <ARGUMENT NAME="loginuser" VALUE="Variables.loginuser"/>
</CALLELEMENT>

<IF COND="IsVariable.target=false">
<THEN>
	<SETVAR NAME="target" VALUE="Variables.empty"/>
</THEN>
</IF>

<html>
<head>
	<!-- BEGIN: Check current user and site in session -->
	<TITLE><XLAT.STREAM KEY="dvin/Common/ContentServer"/></TITLE>
	<script language="JavaScript">
		<CALLELEMENT NAME="OpenMarket/Xcelerate/Util/getSessionIdentifier"/>
		<REPLACEALL LIST="CS.Property.ft.cgipath,Variables.sessionIdentifier">
		<![CDATA[
		var csPath = "CS.Property.ft.cgipathContentServer";
		var currentUserSite = "Variables.sessionIdentifier";
		]]>
	</REPLACEALL>
	</script>

	<script src="CS.Property.ft.cgipathjs/cs.js" REPLACEALL="CS.Property.ft.cgipath"></script>
    <script src="CS.Property.ft.cgipathjs/csWindowButtons.js"  REPLACEALL="CS.Property.ft.cgipath"></script>
	 <if COND="Variables.wem=true">
		<then>
			<SETVAR NAME="windowName" VALUE="WEM_INSITE_SCREEN"/>
		</then>	
		<else>
			<SETVAR NAME="windowName" VALUE="INSITE_SCREEN"/>
		</else>
	</if> 
	
	<REPLACEALL LIST="Variables.windowName">
    <script language="JavaScript">
		<![CDATA[
		window.onmouseover = checkUser;
		window.onfocus = checkUser;
        window.name=Variables.windowName;
        insiteWin=window;
		if( window.opener != null && window.opener.cloneWindowReferences ){
		    //this page was opened up form another..need to set window references for window buttons after this page
		    // has loaded so call it now!
		    window.opener.cloneWindowReferences();
		}
        
		]]>
	</script>
	</REPLACEALL>
	<!-- END: Check current user and site in session -->

    <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>
    <script>
	<![CDATA[
    	function update() {
    	    if (window.frames) {
	    		var panelWindow = window.frames["ControlPanel"];
	    		if (panelWindow && panelWindow.fw) {
		    		var panel = panelWindow.fw.controlPanel;
					if (panel) {
						panel.update();
					}
				}
			}
    	}

    	function init() {
    	    if (window.frames) {
	    		var panelWindow = window.frames["ControlPanel"];
	    		if (panelWindow && panelWindow.fw && panelWindow.fw.controlPanel) {
					panelWindow.fw.controlPanel.init();
				}
			}
    	}
	]]>
    </script>

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo"/>    
</head>

<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="theCurrentAsset"/>
<!-- check whether we can perform this function on this asset -->
<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/AccessCheck">
    <ARGUMENT NAME="assetObjectName" VALUE="theCurrentAsset"/>
    <ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
    <ARGUMENT NAME="pubid" VALUE="SessionVariables.pubid"/>
    <ARGUMENT NAME="id" VALUE="Variables.id"/>
    <ARGUMENT NAME="Function" VALUE="preview"/>
</CALLELEMENT>
<IF COND="Variables.error!=Variables.empty">
<THEN>
    <CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
        <ARGUMENT NAME="error" VALUE="Variables.error"/>
    </CALLELEMENT>
</THEN>
<ELSE>

<PROPERTY.GET INIFILE="futuretense_xcel.ini" PARAM="xcelerate.previewhost" VARNAME="preview-host"/>
<PROPERTY.GET INIFILE="futuretense_xcel.ini" PARAM="xcelerate.previewservlet" VARNAME="preview-servlet"/>
<ASSET.GET NAME="theCurrentAsset" FIELD="startdate" OUTPUT="startDate"/>
<ASSET.GET NAME="theCurrentAsset" FIELD="enddate" OUTPUT="endDate"/>

<STRING.LENGTH VALUE="Variables.startDate" VARNAME="valueLength"/> 
<IF COND="Variables.valueLength!=0">
<THEN>
	<SETVAR NAME="defaultPreviewDate" value="Variables.startDate"/>
</THEN>
</IF>

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PreviewWithTemplates" outstring="urlprevwithtemps">
    <satellite.argument name="AssetType" value="Variables.AssetType"/>
    <satellite.argument name="id" value="Variables.id"/>
    <satellite.argument name="target" value="Variables.target"/>
    <satellite.argument name="urlbase" value="Variables.preview-hostCS.Property.ft.cgipathVariables.preview-servlet"/>
	<IF COND="IsVariable.defaultPreviewDate=true">
	<THEN>	
		<satellite.argument name="defaultPreviewDate" value="Variables.defaultPreviewDate"/>
	</THEN>
	</IF>
    <IF COND="IsVariable.rendermode=true">
    <THEN>
        <satellite.argument name="rendermode" value="Variables.rendermode"/>
    </THEN>
    </IF>
</SATELLITE.LINK>
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/BlankPreview" outstring="urlblankprev">
    <satellite.argument name="urlbase" value="Variables.preview-hostCS.Property.ft.cgipathVariables.preview-servlet"/>
</SATELLITE.LINK>

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/ControlPanel/Scripts/ManagePreview" outstring="urlpanel">
    <satellite.argument name="AssetType" value="Variables.AssetType"/>
    <satellite.argument name="id" value="Variables.id"/>
	<if COND="Variables.wem=true">
	<then>
		<satellite.argument name="wem" value="Variables.wem"/>
	</then>
	</if>
    <if COND="IsVariable.target=true">
    <then>
	    <satellite.argument name="target" value="Variables.target"/>
	</then>
	</if>
    <satellite.argument name="urlbase" value="Variables.preview-hostCS.Property.ft.cgipathVariables.preview-servlet"/>
    <IF COND="IsVariable.mode=true">
    <THEN>
        <satellite.argument name="mode" value="Variables.mode" />
    </THEN>
    <ELSE>
        <satellite.argument name="mode" value="preview" />
    </ELSE>
    </IF>
</SATELLITE.LINK>

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowWemPreviewHeader" outstring="urlheader">
		<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
		<satellite.argument name="wem" value="true"/>
</SATELLITE.LINK>
<frameset rows="38,*" framespacing="0" frameborder="0" border="0" onload="init()" onfocus="checkUser()">
    <frame name="Header" src="Variables.urlheader" scrolling="no" framespacing="1" frameborder="1" border="1" onfocus="checkUser()" REPLACEALL="Variables.urlheader" />
    <frameset id="previewFrameset" cols="275px,*" framespacing="0" frameborder="0" border="5" bordercolor="#eaeaea" onfocus="checkUser()">
        <frame name="TemplateSelect" src="Variables.urlprevwithtemps" framespacing="0" frameborder="0" border="0" onfocus="checkUser()" REPLACEALL="Variables.urlprevwithtemps" scrolling="no"/>
        <frameset rows="0,*" framespacing="1" frameborder="0" border="0" onfocus="checkUser()">
            <frame name="ControlPanel" src="Variables.urlpanel" framespacing="1" frameborder="1" border="0" bordercolor="#eaeaea" marginwidth="0" marginheight="0" scrolling="no" REPLACEALL="Variables.urlpanel"/>
			<frame name="Work" src="Variables.cs_imagedir/graphics/common/logo/spacer.gif" marginwidth="0" marginheight="0" framespacing="0" frameborder="0" border="0" onfocus="checkUser()" REPLACEALL="Variables.cs_imagedir" onload="update()"/>
        </frameset>
    </frameset>
</frameset>

</ELSE>
</IF>

</html>
</FTCS>

