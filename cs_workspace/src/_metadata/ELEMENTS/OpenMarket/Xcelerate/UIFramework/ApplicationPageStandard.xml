<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!--
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/UIFramework/ApplicationPage.xml $
$Revision: 105 $
$Modtime: 7/29/04 9:51a $
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- Do the specified action
-
- DESCRIPTION
-	Given an action, call the element that corresponds to it
-
- HISTORY
-->

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardVariables"/>

<if COND="Variables.cs_environment!=standard">
<then>
    <callelement NAME="OpenMarket/Xcelerate/UIFramework/ApplicationPageLiteBody" />
</then>
<else>

<HTML>


    <HEAD>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>

        <callelement NAME="OpenMarket/Xcelerate/Scripts/SetTitle"/>
		<SCRIPT Language="JavaScript">
		<![CDATA[
		var isNew = 0;
		var isNS4 = 0;
		var isIE4 = 0;
		var isIE5 = 0;
		var isNS5 = 0;
		var isID  = 0;
		var docObj = "";
		var styleObj = "";

		// Determine browser versions
		var brow = ((navigator.appName) + (parseInt(navigator.appVersion)));
		var isat = navigator.userAgent.indexOf("MSIE");
		var ieVer = -1;
		if (isat > -1)
		{
			// IE
			isat += 5;
			var end = navigator.userAgent.indexOf(";", isat);
			if (end > isat)
				ieVer = parseInt(navigator.userAgent.substring(isat, end));
		}

		if (ieVer == 4)
		{isIE4 = 1;}
		if (ieVer == 5)
		{isIE5 = 1;}
		if (ieVer == 6)
		{isIE5 = 1;}
		if (ieVer > 6)
		{isNew = 1;}

		if (parseInt(navigator.appVersion) >= 5) { isNew=1; }
		else if (brow=="Netscape4") {isNS4=1;}

		if (brow=="Netscape5") {isNS5=1;}

		// Set docObj and styleObj
		if (isNS4 || isIE4 || isIE5 ||isNew) {
			docObj = (isNS4) ? 'document' : 'document.all';
			styleObj = (isNS4) ? '' : '.style';
			if (isIE5 || isNS5 || isNew) {isID=1;}
		}
		]]>
		</SCRIPT>
		<!--override the top value for the forms tabs-->
		<style type="text/css"><![CDATA[
		.fw .formsTabs{
			/*top:49px;*/
		}
		]]></style>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo"/>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/SetStylesheet"/>
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/AddCustomHeader"/>
</HEAD>
<BODY class="centerpane AdvForms">
<!-- first check to see if the user is logged in or not -->

	<SETVAR NAME="errno" VALUE="0"/>
	<USERISMEMBER GROUP="xceleditor"/>
	<if COND="Variables.errno=0">
		<then>
            <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Security/TimeoutError" outstring="urltimeouterror">
	            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            </SATELLITE.LINK>
			<REPLACE STR="Variables.urltimeouterror">
				<script LANGUAGE="JavaScript">
					parent.parent.location="Variables.urltimeouterror";
				</script>
			</REPLACE>
			<throwexception/>
		</then>
	</if>

    <!-- set the publication name if it has not been done -->
    <if COND="SessionVariables.PublicationName=Not Selected">
        <then>
			<if COND="IsVariable.pubid=true">
			<then>
				<setssvar NAME="pubid" VALUE="Variables.pubid"/>
				<callelement NAME="OpenMarket/Xcelerate/Actions/Security/SetPublicationName"/>
			</then>
			</if>
        </then>
    </if>

	<SATELLITE.FORM ASSEMBLER="query" NAME="AppForm" METHOD="POST">
	<STRING.ENCODE VARIABLE="charset" VARNAME="OutputQString"/>
    <INPUT TYPE="HIDDEN" NAME="_charset_" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
    <STRING.ENCODE VARIABLE="cs_environment" VARNAME="OutputQString"/>
    <INPUT TYPE="HIDDEN" NAME="cs_environment" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
    <STRING.ENCODE VARIABLE="cs_formmode" VARNAME="OutputQString"/>
    <INPUT TYPE="HIDDEN" NAME="cs_formmode" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
	<INPUT TYPE="HIDDEN" NAME="PubName" VALUE="SessionVariables.PublicationName" REPLACEALL="SessionVariables.PublicationName"/>
	
	<IF COND="IsVariable.PostPage=true">
	<THEN>
		<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
	</THEN>
	</IF>
	
	<IF COND="IsVariable.id=true">
	<THEN>
		<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
	</THEN>
	</IF>
	
	<IF COND="IsVariable.AssetType=true">
	<THEN>
		<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
	</THEN>
	</IF>
 
	<!-- Set any tree specific variables -->
   <PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
	<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/SetTreeVariablesVariables.proptreetype=true">
		<then>
  			<callelement NAME="OpenMarket/Xcelerate/UIFramework/SetTreeVariablesVariables.proptreetype">
			</callelement>
		</then>
	</if>
	<setvar NAME="showSiteTree" VALUE="SessionVariables.showSiteTree"/>

    <!-- create a default dateformat object for use by all child elements -->

 
    <IF COND="IsSessionVariable.locale=true">
        <THEN>
            <LOCALE.CREATE VARNAME="LocaleName" LOCALENAME="SessionVariables.locale"/>
            <DATEFORMAT.CREATE NAME="_FormatDate_" DATESTYLE="FULL" TIMESTYLE="FULL" LOCALE="LocaleName" TIMEZONEID="SessionVariables.time.zone"/>
        </THEN>
        <ELSE>
            <DATEFORMAT.CREATE NAME="_FormatDate_" DATESTYLE="FULL" TIMESTYLE="FULL" TIMEZONEID="SessionVariables.time.zone"/>
        </ELSE>
    </IF>

	<!-- Save off variables used in toolbar generation, since the asset toolbar is rendered AFTER
		executing the action of the current page, and the variables may be changed by the executing page
	-->
	<IF COND="IsVariable.AssetType=true"><THEN>
	<setvar NAME="InAssetType" VALUE="Variables.AssetType"/></THEN></IF>
	<IF COND="IsVariable.id=true"><THEN><setvar NAME="Inid" VALUE="Variables.id"/></THEN></IF>

	<if COND="IsVariable.ThisPage=true">
	<then>
		<if COND="IsElement.OpenMarket/Xcelerate/PrologActions/Variables.ThisPage=true">
	        <then>
	            <callelement NAME="OpenMarket/Xcelerate/PrologActions/Variables.ThisPage"/>
	        </then>
	        <else>
		        <span class="alert-color"><XLAT.STREAM KEY="dvin/Error/UI/NoPrologActionsElement"/></span><BR/>
			</else>
	    </if>

		<callelement NAME="OpenMarket/Xcelerate/Actions/Variables.ThisPage"/>
	</then>
	<else>
		<!-- Display an informational message. -->
		<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
			<ARGUMENT NAME="elem" VALUE="NoActionSpecified"/>
			<ARGUMENT NAME="severity" VALUE="error"/>
		</CALLELEMENT>
	</else>
	</if>

	<!-- Refresh the toolbar, 'cos it may have changed based on the action that was performed -->

			<IF COND="IsVariable.InAssetType=true">
			<THEN>
				<IF COND="IsVariable.Inid=true">
				<THEN>
					<!-- Get keyfield -->
					<ASSET.LOAD NAME="asset" TYPE="Variables.InAssetType" OBJECTID="Variables.Inid"/>
					<IF COND="IsError.Variables.errno=false">
						<THEN>
							<ASSET.GET NAME="asset" FIELD="name" OUTPUT="keyfieldof"/>
						</THEN>
						<ELSE>
							<SETVAR NAME="keyfieldof" VALUE="" />
						</ELSE>
					</IF>

					<STRING.LENGTH VALUE="Variables.keyfieldof" VARNAME="keyfieldlen"/>

					<if COND="Variables.keyfieldlen!=0">
					<then>

						<IF COND="Variables.showSiteTree=true">
						<THEN>
							<!-- add to History tab -->
							<ASSET.GET NAME="asset" FIELD="description" OUTPUT="treeDesc"/>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildSearchTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables.keyfieldof"/>
								<ARGUMENT NAME="Description" VALUE="Variables.treeDesc"/>
								<ARGUMENT NAME="ID" VALUE="Variables.Inid"/>
								<ARGUMENT NAME="Varname" VALUE="historyNode"/>
								<ARGUMENT NAME="RefreshKeys" VALUE="Variables.Inid"/>
							</CALLELEMENT>
                            <XLAT.LOOKUP VARNAME="historyTabTitle" KEY="dvin/UI/History" ENCODE="false" ESCAPE="true"/>
							<SCRIPT LANGUAGE="JavaScript">
							<REPLACEALL LIST="Variables.historyNode,Variables.historyTabTitle">
								<![CDATA[
									createHistoryNode('Variables.historyNode','Variables.historyTabTitle',100);
								]]>
							</REPLACEALL>
							</SCRIPT>
						</THEN>
						</IF>
							<STRING.ENCODE VARIABLE="keyfieldof" VARNAME="keyfieldof"/>
							<SCRIPT LANGUAGE="JavaScript">
							<substitute STR="Variables.keyfieldof" OUTSTR="keyfieldof" WHAT="&#39;" WITH="Variables.empty"/>
							<substitute STR="Variables.keyfieldof" OUTSTR="keyfieldof" WHAT="&#34;" WITH="Variables.empty"/>
							<replaceall  LIST="Variables.keyfieldof,Variables.InAssetType,Variables.Inid">
								<![CDATA[
									parent.parent.XcelBanner.addToHistory("Variables.InAssetType","Variables.Inid","Variables.keyfieldof");
								]]>
							</replaceall>
							</SCRIPT>

					</then>
					</if>
				</THEN>
				</IF>
			</THEN>
			</IF>

	<SCRIPT LANGUAGE="JavaScript">
		<![CDATA[
			var num = document.AppForm.length;
			document.AppForm.encoding="application/x-www-form-urlencoded";
			for (i=0; i < num; i++)
			{
				if (document.AppForm.elements[i].type=="file") document.AppForm.encoding="multipart/form-data";
			}
		]]>
	</SCRIPT>
	</SATELLITE.FORM>

    </BODY>
</HTML>

</else>
</if>
</FTCS>