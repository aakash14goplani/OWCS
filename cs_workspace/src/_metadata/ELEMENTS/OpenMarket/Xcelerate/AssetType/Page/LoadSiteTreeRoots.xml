<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/AssetType/Page/LoadSiteTreeRoots
-
- INPUT
-
- OUTPUT
-
-->

<PUBLICATION.LOAD NAME="publication" FIELD="id" VALUE="SessionVariables.pubid"/>
<PUBLICATION.GET NAME="publication" FIELD="name" OUTPUT="pubname"/>
<PUBLICATION.GET NAME="publication" FIELD="description" OUTPUT="pubdesc"/>
		
<REMOVEVAR NAME="LoadURL"/>
<REMOVEVAR NAME="ExecuteURL"/>
<REMOVEVAR NAME="executeFunction" />

<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<argument NAME="AdHoc" VALUE="SiteName"/>
			<argument NAME="TreeNodeID" VALUE="Variables.empty"/>
</callelement>

<XLAT.LOOKUP KEY="dvin/TreeApplet/PubnameSite" ENCODE="false" VARNAME="_XLAT_"/>
<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables.pubdesc"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>		
</CALLELEMENT>
		
<!-- Create the Placed Pages and Unplaced Page ROOT dummy nodes -->


<SETVAR NAME='currentAssetType' VALUE='Variables.AssetType' />

<SITEPLAN.ROOT LIST="PubRoot" OBJECTID="SessionVariables.pubid"/>
<SITEPLAN.LOAD NAME="PubRootNode" NODEID="PubRoot.nid"/>
<SITEPLAN.CHILDREN NAME="PubRootNode" LIST="pubchildren" CODE="Placed" ORDER="nrank"/>

<SETVAR NAME='tmpOkFunctions' VALUE='treerefresh' />

<SETVAR NAME='tmpOkFunctions' VALUE='Variables.tmpOkFunctions;paste-site-navigation;approve' />

<IF COND="IsList.pubchildren=true">
<THEN>
<SETVAR NAME='tmpContinue' VALUE='true' />
<LOOP LIST="pubchildren" UNTIL='Variables.tmpContinue=false'>
	
	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
		<satellite.argument name="AssetType" value="pubchildren.otype"/>
		<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/pubchildren.otype/LoadSiteTree"/>
		<satellite.argument name="op" value="load"/>
		<satellite.argument name="loadpages" value="Placed"/>
		<satellite.argument name="assetid" value="pubchildren.oid"/>
	</SATELLITE.LINK>
		
	<IF COND="pubchildren.otype=Page" >
	<THEN>
		<XLAT.LOOKUP KEY="dvin/TreeApplet/PlacedPages" VARNAME="currentName" />
		<SETVAR NAME='tmpContinue' VALUE='false' />
	</THEN>
	<ELSE>
		<ASSET.LOAD NAME="tmpSiteplanObj" TYPE="pubchildren.otype" OBJECTID="pubchildren.oid"/>
		<ASSET.GET NAME="tmpSiteplanObj" FIELD="name" OUTPUT="currentName"/>
	</ELSE>
	</IF>

	<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
		<ARGUMENT NAME="ID" VALUE="pubchildren.oid"/>
		<ARGUMENT NAME="AssetType" VALUE="pubchildren.otype"/>
		<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
	</callelement>
 	 
 	<SITEPLAN.LOAD NAME="childSitePlanNode" NODEID="pubchildren.nid"/>
	<SITEPLAN.CHILDREN NAME="childSitePlanNode" LIST="childSitePlanList" CODE="Placed"/>
	
	<INDEXOF STR="childSitePlanList.#numRows" WHAT="#" OUTSTR="index" INDEX="0"/>
	<IF COND="Variables.errno=1">
	<THEN>
	 	<SETVAR NAME="hasChildren" VALUE="No"/>	
	</THEN>
	<ELSE>
		<SETVAR NAME="hasChildren" VALUE="Yes"/>	
	</ELSE>
	</IF>
	
	<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
		<ARGUMENT NAME="Label" VALUE="Variables.currentName"/>
		<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
	    <ARGUMENT NAME="OKActions" VALUE="refresh"/>
		<ARGUMENT NAME="okFunctions" VALUE="Variables.tmpOkFunctions" />  	
		<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/placedpage.png"/>
		<ARGUMENT NAME="RefreshKeys" VALUE="pubchildren.oid"/>
		<ARGUMENT NAME="hasChildren" VALUE="Variables.hasChildren"/>
			
		<!--  SitePlanTree SitePlan Root Node Asset  identifier    -->
		<ARGUMENT NAME="nid" VALUE="pubchildren.nid"/>
		<ARGUMENT NAME="oid" VALUE="pubchildren.oid"/>	
		<ARGUMENT NAME="otype" VALUE="pubchildren.otype"/>		
		<ARGUMENT NAME="oversion" VALUE="pubchildren.oversion"/>	
	</CALLELEMENT>
	
</LOOP>
</THEN>
</IF>		

<SETVAR NAME='AssetType' VALUE='Variables.currentAssetType' />

<REMOVEVAR NAME='tmpSiteplanObj' />
<REMOVEVAR NAME='tmpContinue' />
<REMOVEVAR NAME='pubchildren' />
<REMOVEVAR NAME='currentAssetType' />
<REMOVEVAR NAME='currentName' />


<setvar NAME="tablename" VALUE="SitePlanTree"/>
<execsql LIST="mylist"
		 SQL="SELECT COUNT(*) as mycount FROM  SitePlanTree
			  WHERE nparentid = PubRoot.nid AND ncode = 'UnPlaced'"/>

<REMOVEVAR NAME="LoadURL"/>
<REMOVEVAR NAME="ExecuteURL"/>
<IF COND="IsList.mylist=true">
<THEN>
	<IF COND="mylist.mycount!=0">
	<THEN>
		<SETVAR NAME="hasChildren" VALUE="Yes"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
			<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/Variables.AssetType/LoadSiteTree"/>
			<satellite.argument name="op" value="load"/>
			<satellite.argument name="loadpages" value="Unplaced"/>
		</SATELLITE.LINK>
	</THEN>
	</IF>
</THEN>
</IF>
		
<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
	<argument NAME="AdHoc" VALUE="UnplacedPages"/>
	<argument NAME="TreeNodeID" VALUE="Variables.empty"/>
</callelement>
		
<XLAT.LOOKUP KEY="dvin/TreeApplet/UnplacedPages" ENCODE="false" VARNAME="_XLAT_"/>

<SETVAR NAME='tmpOkFunctions' VALUE='treerefresh;paste-site-navigation' />

<!--  Generate the "UnPlacePages" Root Dummy Node  -->				
<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
	<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
	<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
	<ARGUMENT NAME="OKActions" VALUE="refresh"/>
 	<ARGUMENT NAME="okFunctions" VALUE="Variables.tmpOkFunctions" />
	<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/unplacedpage.png"/>
	<ARGUMENT NAME="RefreshKeys" VALUE="UnplacedPages"/>
	<ARGUMENT NAME="hasChildren" VALUE="Variables.hasChildren"/>
	<!--  SPN UnplacePages Dummy Node no record in SitePlanTree  -->
	<ARGUMENT NAME="nid" VALUE="0"/>
	<ARGUMENT NAME="oid" VALUE="0"/>	
	<ARGUMENT NAME="oversion" VALUE="0"/>	
</CALLELEMENT>

<REMOVEVAR NAME='tmpOkFunctions' />

</FTCS>