<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Xcelerate/ControlPanel/ShowAssignments
-
- INPUT
-
- OUTPUT
-
- HISTORY
  [2007-09-13 KGF]
  * Made this page reusable via AJAX with some minor tweaks.
  * Added functionality to make assignment list pageable,
    along the lines of SearchResults. (Utilizes new AJAXability)
  [2008-03-18 KGF]
  * Show asset name instead of description in listing, and properly
    truncate the name if it is too long.
  * (XSS) Encode name/description values before output.
-->

<!-- workaround for reloading this page via AJAX (for images) -->
<IF COND="IsVariable.cs_imagedir=false"><THEN>
	<ICS.GETPROPERTY NAME="ft.cgipath" OUTPUT="f_cgipath" />
	<ICS.GETPROPERTY NAME="xcelerate.imageurl" FILE="futuretense_xcel.ini" OUTPUT="x_imageurl" />
	<SETVAR NAME="cs_imagedir" VALUE="Variables.f_cgipathVariables.x_imageurl" />
</THEN></IF>

<IF COND="IsVariable.r=false">
<THEN>
    <SETVAR NAME="r" VALUE="5"/>
</THEN>
</IF> 

<IF COND="IsVariable.start=false" >
<THEN>
    <SETVAR NAME="start" VALUE="0" /> 
</THEN>
</IF>

<CALCULATOR.GO VALUE="Variables.r Variables.start +" VARNAME="next"/>
<CALCULATOR.GO VALUE="Variables.start Variables.r -" VARNAME="prev"/>

<USERMANAGER.GETLOGINUSER VARNAME="theUser"/>
<USERMANAGER.GETLOGINUSERNAME VARNAME="theUserName"/>
<STRINGLIST STR="Variables.theUser" NAME="theUserList" DELIM=";"/>
<WORKFLOWENGINE.GETFILTEREDASSIGNMENTS PREFIX="allAssignments:" SITE="SessionVariables.pubid" NOTSTATUS="notactive" ASSIGNEDTO="theUserList"  SORTSTYLE="assigneddate"/>
<if COND="Variables.allAssignments:Total=0">
<then>
	<p>&nbsp;&nbsp;&nbsp;<XLAT.STREAM KEY="dvin/UI/Wf/Noassignmentforyou"/></p>
</then>
<else>
<!-- assignment_count is used to access assignments by ID.
     Changing VALUE from 0 to Variables.start for paging support.
-->
    <setcounter NAME="assignment_count" VALUE="Variables.start"/>
<!-- variable used for switching between rowStyles -->
	<SETVAR NAME="rowStyle" VALUE="highlightOn"/>
<!--isNext and isPrev, for paging support-->
	<CALCULATOR.GO VALUE="Variables.next Variables.allAssignments:Total LT" VARNAME="isNext"/>
	<CALCULATOR.GO VALUE="Variables.prev 0 GTE" VARNAME="isPrev"/>
    <IF COND="IsSessionVariable.locale=true">
       <THEN>
           <LOCALE.CREATE VARNAME="LocaleName" LOCALENAME="SessionVariables.locale"/>
           <DATEFORMAT.CREATE NAME="temp_date_object" DATESTYLE="SHORT" TIMESTYLE="SHORT" LOCALE="LocaleName"/>
       </THEN>
       <ELSE>
           <DATEFORMAT.CREATE NAME="temp_date_object" DATESTYLE="SHORT" TIMESTYLE="SHORT"/>
       </ELSE>
    </IF>
	
<TABLE cellspacing="0"  width="100%">
	<tr>
	<td class="tableHeader" width="1%">&nbsp;</td>
	<td class="tableHeader" colspan="2"><XLAT.STREAM KEY="dvin/UI/Common/Assignment"/></td>
	<td class="tableHeader" width="1%"><XLAT.STREAM KEY="dvin/Common/Finish"/></td>
	</tr>
	<!--formerly, loop went through all assignments (just set count to total)-->
	<IF COND="Variables.isNext=1"><THEN>
		<setvar NAME="remain" VALUE="Variables.r"/>
	</THEN><ELSE>
		<CALCULATOR.GO VALUE="Variables.allAssignments:Total Variables.start -" VARNAME="remain"/>
	</ELSE></IF>

    <loop FROM="Variables.start" COUNT="Variables.remain">
		

        <WorkflowAssignment.GetID NAME="allAssignments:Counters.assignment_count" VARNAME="assignmentid"/>
        <WorkflowAssignment.GetAssignedObject NAME="allAssignments:Counters.assignment_count" OBJVARNAME="workflowObject"/>
        <WorkflowAssignment.GetAssignmentComment NAME="allAssignments:Counters.assignment_count" VARNAME="assigncomment" />
        <if COND="IsVariable.assigncomment!=true">
        <then>
            <XLAT.LOOKUP KEY="dvin/UI/Wf/Nocomment" VARNAME="_XLAT_"/>
            <setvar NAME="assigncomment" VALUE="Variables._XLAT_" />
        </then>
        </if>
        
        <WorkflowAsset.GetAssetId OBJECT="workflowObject" VARNAME="workflow_assetid" />
        <WorkflowAsset.GetAssetType OBJECT="workflowObject" VARNAME="workflow_assettype" />
        
        <!--[KGF 2008-12-09] get asset type description for tooltip/alt-->
        <ASSETTYPE.LOAD NAME="wfAT" TYPE="Variables.workflow_assettype"/>
        <ASSETTYPE.GET NAME="wfAT" FIELD="description" OUTPUT="wfATdesc"/>
        <IF COND="Variables.searchAssetTypeDesc=Variables.empty"><THEN>
            <SETVAR NAME="wfATdesc" VALUE="Variables.workflow_assettype"/>
        </THEN></IF>
		
		<TR class="Variables.rowStyle" REPLACEALL="Variables.rowStyle">
		<td class="tableCell"><img src="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/Variables.workflow_assettype.png" title="Variables.wfATdesc" alt="Variables.wfATdesc" onerror="swap(this,'Variables.cs_imagedir/OMTree/TreeImages/default.png');" REPLACEALL="Variables.cs_imagedir,Variables.workflow_assettype,Variables.wfATdesc"/></td>
        <td class="tableCell" style="padding-bottom:2px;">

        <ASSET.LIST TYPE="Variables.workflow_assettype" FIELD1="id" VALUE1="Variables.workflow_assetid" LIST="theAssetList"/>
        <TEXTFORMAT.LENGTH VALUE="theAssetList.name" VARNAME="length"/>
        <CALCULATOR.GO VALUE="Variables.length 25 GT" VARNAME="toolong"/>
        <IF COND="Variables.toolong=1">
        <THEN>
            <SUBSTRING STR="theAssetList.name" OUTSTR="workflow_assetname" ENDINDEX="25"/>
            <STRING.ENCODE VARNAME="workflow_assetname" VALUE="Variables.workflow_assetname..."/>
        </THEN>
        <ELSE>
            <STRING.ENCODE VARNAME="workflow_assetname" VALUE="theAssetList.name"/>
        </ELSE>
        </IF>
        
        <if COND="theAssetList.description=Variables.empty">
        <then>
            <STRING.ENCODE VARNAME="workflow_assetdescription" VALUE="theAssetList.name"/>
        </then>
        <else>
            <STRING.ENCODE VARNAME="workflow_assetdescription" VALUE="theAssetList.description"/>
        </else>
        </if>
        
	<XLAT.LOOKUP KEY="dvin/UI/Common/NotApplicableAbbrev" VARNAME="_NA_"/>
	<SETVAR NAME="dateInfo" VALUE="Variables._NA_" />
	<SETVAR NAME="currentAssetStartDate" VALUE="theAssetList.startdate" />
	<IF COND="Variables.currentAssetStartDate!=Variables.empty">
	<THEN>			
		<DATEFORMAT.GETDATETIME NAME="temp_date_object" VALUE="Variables.currentAssetStartDate" VALUETYPE="jdbcdate" VARNAME="startDateShortVersion" />
		<SETVAR NAME="dateInfo" VALUE="Variables.startDateShortVersion" />
	</THEN>
	</IF>
	
	<SETVAR NAME="currentAssetEndDate" VALUE="theAssetList.enddate" />		
	<IF COND="Variables.currentAssetEndDate!=Variables.empty">
	<THEN>		
		<DATEFORMAT.GETDATETIME NAME="temp_date_object" VALUE="Variables.currentAssetEndDate" VALUETYPE="jdbcdate" VARNAME="endDateShortVersion" />
		<SETVAR NAME="dateInfo" VALUE="Variables.dateInfo - Variables.endDateShortVersion" />
	</THEN>
	<ELSE>
		<SETVAR NAME="dateInfo" VALUE="Variables.dateInfo - Variables._NA_" />
	</ELSE>
	</IF>			

	<setvar NAME="externaldoc" VALUE="yes" />                   
	<if COND="theAssetList.externaldoctype!=Variables.empty">
	<then>
		<setvar NAME="externaldoc" VALUE="no" />
	</then>                                          
        </if>
                   <if COND="Variables.wem=true">
					<then>		
					   <PREVIEWURL.MAKEURL VARNAME="previewURL" 
						   ASSETTYPE="Variables.workflow_assettype" 
						   ASSETID="Variables.workflow_assetid" 
						   PACKEDARGS="rendermode=preview-SessionVariables.username&#38;wem=Variables.wem"
						   PUBID="SessionVariables.pubid" USERNAME="Variables.cs_username" PASSWORD="Variables.cs_password"/>
					   </then>
					<else>
					   <PREVIEWURL.MAKEURL VARNAME="previewURL" 
						   ASSETTYPE="Variables.workflow_assettype" 
						   ASSETID="Variables.workflow_assetid" 
						   PACKEDARGS="rendermode=preview-SessionVariables.username&#38;"
						   PUBID="SessionVariables.pubid" USERNAME="Variables.cs_username" PASSWORD="Variables.cs_password"/>

					</else>
				</if>		
                   <IF COND="IsVariable.previewURL=true">
					   <THEN>
						   <A class="resultItem" HREF="javascript:void(0);" onClick="parent.location.href='Variables.previewURL';"
								 REPLACEALL="Variables.previewURL,Variables.externaldoc,Variables.dateInfo,Variables.workflow_assetdescription" TITLE="Variables.dateInfo | Variables.workflow_assetdescription">
						   		<STRING.STREAM VARIABLE="workflow_assetname"/> 
						   </A>&nbsp; 
            				<XLAT.LOOKUP KEY="dvin/UI/Wf/Nocomment" VARNAME="commentChecker"/>
            				<XLAT.LOOKUP KEY="dvin/UI/Wf/ProcessAssigment" VARNAME="ProcessAssigment"/>
                   			<setvar name="blankSpace" value=" " />
       						 <td class="tableCell" style="padding:0px 5px 2px 0px; border-left:none;" align="right">
                   			<if COND="Variables.assigncomment=Variables.blankSpace">
							     <then>							  
									&nbsp;
							     </then>                                          
					   			<ELSE>
                   					<if COND="Variables.assigncomment=Variables.empty">
									     <then>							  
											&nbsp;
									     </then>                                          
					   					<ELSE>
                   								<if COND="Variables.commentChecker=Variables.assigncomment">
											     <then>							  
														&nbsp;
											     </then>                                          
					   							<ELSE>
						   					  		<img src="Variables.cs_imagedir/graphics/common/controlpanel/info.gif" style="position: relative; top: 2px; left: 0px;" alt="Variables.assigncomment" title="Variables.assigncomment" REPLACEALL="Variables.assigncomment,Variables.cs_imagedir,SessionVariables.locale"/>
					   							</ELSE>
                   							</if>
					   					</ELSE>
                   					</if>
					   			</ELSE>
                   			</if>
					   		</td>
					   </THEN>
					   <ELSE>
							<STRING.STREAM VARIABLE="workflow_assetname"/>
					   </ELSE>
                   </IF>
		</td>
		<td class="tableCell" align="center" valign="middle">
				<WorkflowAssignment.GetAssignedUserRole NAME="allAssignments:Counters.assignment_count" VARNAME="assignrole"/>
				<if COND="IsVariable.assignrole=true">
				<then>
					<WorkflowEngine.GetLegalNextWorkflowSteps OBJECT="workflowObject" ROLE="Variables.assignrole" SITE="SessionVariables.pubid" PREFIX="nextsteps" />
				</then>
				<else>
					<WorkflowEngine.GetLegalNextWorkflowSteps OBJECT="workflowObject" SITE="SessionVariables.pubid" PREFIX="nextsteps" />
				</else>
				</if>
				<if COND="Variables.nextstepsTotal!=0">
				<then>
            		<XLAT.LOOKUP KEY="dvin/UI/Wf/ProcessAssignment" VARNAME="ProcessAssignment"/>
					<img src="Variables.cs_imagedir/graphics/SessionVariables.locale/controlpanel/finish_assignment.gif" style="cursor:pointer; cursor:hand" alt="Variables.ProcessAssignment" title="Variables.ProcessAssignment" onclick="goFinishAssignment('Variables.workflow_assetid', 'Variables.workflow_assettype');" REPLACEALL="Variables.ProcessAssignment,Variables.cs_imagedir,Variables.workflow_assetid,Variables.workflow_assettype,SessionVariables.locale"/>
				</then>
				<else>
					&nbsp;
				</else>
				</if>        
        <inccounter NAME="assignment_count" VALUE="1"/>
		<IF COND="Variables.rowStyle=highlightOn">
			<THEN>
				<SETVAR NAME="rowStyle" VALUE="highlightOff"/>
			</THEN>
			<ELSE>
				<SETVAR NAME="rowStyle" VALUE="highlightOn"/>
			</ELSE>
		</IF>
		</td>
		</TR>
		
    </loop>
	<!-- for paging support. -->
        <tr>
            <td colspan="4" class="bottomBorder">
            	<IF COND="Variables.isPrev=1">
            	<THEN>
                    <XLAT.LOOKUP KEY="dvin/Common/Previous" VARNAME="XLAT_Previous"/>
                    <span style="float:left; padding-left:10px;"><a class="paginate" href="javascript:void(0);" title="Variables.XLAT_Previous" onclick='fw.controlPanel.getAssignments("Variables.prev");return false;' REPLACEALL="Variables.url,Variables.prev,Variables.XLAT_Previous">&lt;&nbsp;<XLAT.STREAM KEY="dvin/Common/lowercaseprev"/></a></span>
                </THEN>
                </IF> 
            	<IF COND="Variables.isNext=1">
            	<THEN>
                    <XLAT.LOOKUP KEY="dvin/Common/Next" VARNAME="XLAT_Next"/>
                    <span style="float:right; padding-right:10px;"><a class="paginate" href="javascript:void(0);" title="Variables.XLAT_Next" onclick='fw.controlPanel.getAssignments("Variables.next");return false;' REPLACEALL="Variables.url,Variables.next,Variables.XLAT_Next"><XLAT.STREAM KEY="dvin/Common/lowercasenext"/>&nbsp;&gt;</a></span>
                </THEN>
                </IF>
            </td>
        </tr>
	</TABLE>
</else>
</if>
</FTCS>
