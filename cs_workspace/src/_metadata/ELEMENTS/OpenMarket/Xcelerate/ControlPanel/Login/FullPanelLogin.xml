<?xml version="1.0" ?>
<!DOCTYPE ftcs SYSTEM "futuretense_cs.dtd">
<ftcs version="1.2">
	<!-- Logged in, make sure that pubid is set -->
    <removevar name="IsSiteSelected"/>
    <if cond="IsSessionVariable.pubid=true">
    <then>
    	<if cond="SessionVariables.pubid!=notSet">
        <then>
        	<setvar name="IsSiteSelected" value="true"/>
        </then>
        </if>
    </then>
    </if>
    <if cond="IsVariable.IsSiteSelected=false">
    <then>          
    	<!--  TODO: go to choose pubid screen            
    	<CALLELEMENT NAME="OpenMarket/Xcelerate/ControlPanel/Login/ChoosePublication"/>
    	-->
   	</then>
   	<else>
    	<removevar name="IsSiteSelected"/>
		<if cond="Variables.action=login">
		<then>
			<satellite.link assembler="query" pagename="OpenMarket/Xcelerate/UIFramework/ShowPreviewFrames" outstring="previewurl">
				<satellite.argument NAME="cs_environment" VALUE="preview"/>
	       		<satellite.argument NAME="AssetType" VALUE="Variables.AssetType"/>
	       		<satellite.argument NAME="id" VALUE="Variables.id"/>
	       		<satellite.argument NAME="mode" VALUE="Variables.mode"/>
	       		<satellite.argument NAME="pubid" VALUE="Variables.pubid"/>	  
	       		<if cond="IsVariable.target=true">
	       		<then>
	       			<satellite.argument NAME="target" VALUE="Variables.target"/>
	       		</then>
	       		</if>      			        		
	       	</satellite.link>

	       	<replaceall LIST="Variables.previewurl">
	       	<script>
	       		document.location.replace("Variables.previewurl");
	       	</script>
	       	</replaceall>
		</then>
		</if>
	</else>
    </if>
</ftcs>