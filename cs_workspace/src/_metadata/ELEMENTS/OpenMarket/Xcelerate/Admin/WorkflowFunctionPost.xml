<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Admin/WorkflowFunctionPost

 INPUT

 OUTPUT

-->



    <!-- process deletion of stuff -->
    <if COND="Variables.action=delete">
    <then>

                <setvar NAME="errno" VALUE="0"/>
	  
	  			<WORKFLOWENGINE.GETFUNCTIONID OBJVARNAME="delaction" ID="Variables.id"/>
		    		<WORKFLOWFUNCTION.SCATTER PREFIX="wfdelete:" NAME="delaction"/>
		    		<XLAT.LOOKUP KEY="dvin/UI/Security/CCFunction/Variables.wfdelete:name" VARNAME="wfdelete:description" />
		    		<WORKFLOWENGINE.DELETEFUNCTIONID OBJVARNAME="delaction" ID="Variables.wfdelete:id"/>

                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="DeleteFailed"/>
                    </callelement>            
                    
                    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFunctionFront">
                        <argument NAME="id" VALUE="Variables.wfa:id"/>
                        <argument NAME="action" VALUE="details"/>
                        <argument NAME="showtitle" VALUE="true"/>
                    </callelement>

                </then>
                <else>
                    <XLAT.STREAM KEY="dvin/UI/Deletesuccessful"/>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFunctionFront">
                        <argument NAME="action" VALUE="list"/>
                        <argument NAME="showtitle" VALUE="true"/>
                    </callelement>
                    
                </else>
                </if>
    </then>
    </if>

    <!-- process addition of stuff -->
    <if COND="Variables.action=new">
    <then>

                <if COND="IsVariable.name!=true">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="NoName"/>
                    </callelement>            
                    <throwexception/>
                </then>
                </if>
                <!-- insert the specified information
                    into the table. Report any errors.
                    Refresh the navigation -->
                <if COND="IsVariable.description!=true">
                <then>
                    <setvar NAME="description" VALUE="Variables.empty"/>
                </then>
                </if>
	          <if COND="Variables.existingaction=false">
		    <then>
	  			<WORKFLOWENGINE.CREATENEWFUNCTION OBJVARNAME="newfunction"/>
		    </then>
		    <else>
	  			<WORKFLOWENGINE.GETFUNCTIONID OBJVARNAME="newfunction" ID="Variables.id"/>
		    </else>
		    </if>	
		    <WORKFLOWFUNCTION.SETNAME NAME="newfunction" VALUE="Variables.name"/>
		    <WORKFLOWFUNCTION.SETDESCRIPTION NAME="newfunction" VALUE="Variables.description"/>

		    <WORKFLOWENGINE.SETFUNCTION OBJECT="newfunction"/>
		    <WORKFLOWFUNCTION.SCATTER PREFIX="wfa:" NAME="newfunction"/>

                <if COND="Variables.errno!=0">
                <then>
                    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                        <argument NAME="error" VALUE="EnterFailed"/>
                    </callelement>            
                </then>
                <else>
                    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFunctionFront">
                        <argument NAME="id" VALUE="Variables.wfa:id"/>
                        <argument NAME="action" VALUE="details"/>
                        <argument NAME="showtitle" VALUE="true"/>
                    </callelement>
                </else>
                </if>
    </then>
    </if>
 

</FTCS> 
