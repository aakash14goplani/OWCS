<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/Publish/TargetSiteEdit.xml $ 
$Revision: 22 $ 
$Modtime: 3/23/04 1:57p $ 
-->
<!-- OpenMarket/Xcelerate/Admin/Publish/TargetSiteEdit
-
- INPUT
-
- OUTPUT
-
-->


<SCRIPT LANGUAGE="JavaScript">
<![CDATA[

function checkfields()
{
	var obj = document.forms[0];
	var errors = "";
	var assettypes = obj.elements['assettypes'].value;
	]]>
	var replacestr = /\bVariables.table\b/;
	var xlatstr = "<XLAT.STREAM KEY="dvin/UI/Admin/Error/assettypescannotbemirrored" ESCAPE="true" ENCODE="false"/>" ;
	<![CDATA[
	for ( var i = 0 ; i < 5 ; i++ )
	{
		var table = obj.elements['catalogs'][i].value;
		if ( table.length > 0 )
		{
			if (assettypes.indexOf( "/" + table + "/" ) != -1) {
				errors += xlatstr.replace(replacestr,table) + "\n";
			}
		}
	}
	if (errors.length != 0) {
		alert (errors);
		return false;
	}
	return true;
}

]]>
</SCRIPT>
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<PUBTARGETMANAGER.LOAD ID="Variables.id" OBJVARNAME="pubtgt"/>
<if COND="IsError.Variables.errno=false">
<then>
	<PUBTARGET.GETNAME NAME="pubtgt" VARNAME="pubtgt:name"/>
 <table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/InitializeMirrorDestination"/>: <STRING.STREAM VALUE="Variables.pubtgt:name"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
 		
	<SELECTTO LIST="AllPubs" WHAT="*" FROM="Publication" ORDERBY="name"/>

		<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-50">
		<tr><td>
			<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Sites"/>:
				</td>
				<td></td>
				<td class="form-inset">
					
					<if COND="AllPubs.#numRows=1">
					<then>
						<STRING.ENCODE LIST="AllPubs" COLUMN="id" VARNAME="Apid"/>
						<STRING.STREAM VALUE="AllPubs.description"/>
						<INPUT TYPE="hidden" NAME="thePubs" VALUE="Variables.Apid" REPLACEALL="Variables.Apid"/>
					</then>
					<else>
						<XLAT.STREAM KEY="dvin/UI/Admin/Selectallsiteswhichsupporteddest"/>:<BR/>
						<SELECT NAME="thePubs" MULTIPLE="yes" SIZE="5">
							<loop LIST="AllPubs">
								<STRING.ENCODE LIST="AllPubs" COLUMN="id" VARNAME="Apid"/>
								<if COND="AllPubs.id=SessionVariables.pubid">
								<then>
									<setvar name="selectSite" value="true"/>
								</then>
								<else>
									<setvar name="selectSite" value="false"/>
								</else>
								</if>
								<if COND="Variables.selectSite=true">
								<then>
									<OPTION VALUE="Variables.Apid" SELECTED="true"  REPLACEALL="Variables.Apid"/><STRING.STREAM VALUE="AllPubs.description"/>
								</then>
								<else>
									<OPTION VALUE="Variables.Apid" REPLACEALL="Variables.Apid"/><STRING.STREAM VALUE="AllPubs.description"/>
								</else>
								</if>
							</loop>
						</SELECT>
					</else>
					</if>
				</td>
			</tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			
			<!-- other non-asset tables -->
			<!-- get a list of asset type tables, to make sure user does not try and mirror asset types this way -->
			<ASSETTYPE.LIST LIST="allAssetTypes"/>
			<SETVAR NAME="assettypes" VALUE="Variables.empty"/>
			<LOOP LIST="allAssetTypes">
				<SETVAR NAME="assettypes" VALUE="Variables.assettypes/allAssetTypes.assettype/"/>
			</LOOP>
			<INPUT TYPE="hidden" NAME="assettypes" VALUE="Variables.assettypes" REPLACEALL="Variables.assettypes"/>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/AuxilliaryTables"/>:
				</td>
				<td></td>
				<td class="form-inset">
					<XLAT.STREAM KEY="dvin/UI/Admin/AddanyothernonAtablesdatarefdsply"/><br/>
					<INPUT NAME="catalogs" TYPE="TEXT" SIZE="32" VALUE="Source"/><br/>
					<INPUT NAME="catalogs" TYPE="TEXT" SIZE="32" VALUE="MimeType"/><br/>
                       <INPUT NAME="catalogs" TYPE="TEXT" SIZE="32" VALUE="Category"/><br/>
                    <INPUT NAME="catalogs" TYPE="TEXT" SIZE="32" VALUE="DeviceRepository"/><br/>
					<INPUT NAME="catalogs" TYPE="TEXT" SIZE="32"/><br/>
					<INPUT NAME="catalogs" TYPE="TEXT" SIZE="32"/><br/>
					<INPUT NAME="catalogs" TYPE="TEXT" SIZE="32"/><br/>
				</td>
			</tr>
			<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
			<INPUT TYPE="HIDDEN" NAME="pubtargetid" VALUE="Variables.id" REPLACEALL="Variables.id"/>
			<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/Publish/TargetSitePost"/>

			<XLAT.LOOKUP KEY="dvin/AdminForms/Mirror" VARNAME="_XLAT_" ESCAPE="true"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="DestEditURL">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
			 <satellite.argument name="action" value="details"/>
			 <satellite.argument name="id" value="Variables.id"/>
			  </SATELLITE.LINK>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD></TD><TD class="form-inset">
					<if cond="Variables.cs_environment=portal">
					<then>
						<A HREF="javascript:void(0);" ONCLICK="window.close();">
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT>
						</A>
					</then>
					<else>
						<A HREF="Variables.DestEditURL" REPLACEALL="Variables.DestEditURL">
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT>
						</A>
					</else>
					</if>
					<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_">
						<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Mirror"/></CALLELEMENT>
					</A>
				</TD>
			</TR>
			</table>
			</td></tr>
</table>


</then>
<else>
	<XLAT.STREAM KEY="dvin/Common/Error"/> = <CSVAR NAME="Variables.errno"/><br/>
   <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
      <argument NAME="error" VALUE="NoPublishDest"/>
  	</callelement>
  	<setvar NAME="upcommand" value="cancel"/>
</else>
</if>

</FTCS> 
