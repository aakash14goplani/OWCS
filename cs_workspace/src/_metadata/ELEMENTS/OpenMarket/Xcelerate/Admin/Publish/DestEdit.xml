<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/Publish/DestEdit.xml $ 
$Revision: 56 $ 
$Modtime: 3/23/04 1:56p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- DESCRIPTION
-	Display form for edit or new a PubTarget.
-
- HISTORY 
    [2007-09-17 KG]
    * XSS fixes (adapted from 6.3 fixes):
      * isCleanString function usage
      * CSVAR -> STRING.STREAM
-->
<!-- New/Edit this class -->
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<STRING.ENCODE VARIABLE="pubtgt:name" VARNAME="pubtgt:name"/>
<SETVAR NAME="class" VALUE="com.openmarket.xcelerate.publish.PubTarget"/>
<setvar NAME="defaultdest" VALUE="http://[targetserver:port]CS.Property.ft.cgipath"/>
<setvar NAME="defaultuser" VALUE="fwadmin"/>
<setvar NAME="defaultpass" VALUE=""/>
<replaceall LIST="Variables.defaultdest,Variables.defaultuser,Variables.defaultpass,CS.Property.ft.cgipath,Variables.action">
<script type="text/javascript" src="CS.Property.ft.cgipathjs/prototype.js"></script>
<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/ValidateInputForXSS" />
<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
var PUBLISHOPTION = '';
function divclose(name){
        var divObj;
        divObj= document.getElementById(name);
        divObj.style.display = "none";
}

function showHideEmailConfig(val){
	if(val){
		document.getElementById('emailConfig').style.display="";
	} else {
		document.getElementById('emailConfig').style.display="none";
	}
}

function validateAndInsertEmail(form_id,email) {
   var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
   var address = document.forms[form_id].elements[email].value;
   if(reg.test(address) == false) {
      alert("]]><XLAT.STREAM KEY="dvin/UI/Publish/InvalidEmailAddress" ESCAPE="true" ENCODE="false"/><![CDATA[");
      return false;
   } else {
	  insertEmail(document.forms[form_id].emailList,document.forms[form_id].elements[email].value,document.forms[form_id].elements[email].value);
   }
   //Clear out the value from the input
   document.forms[form_id].elements[email].value="";
}

function insertEmail(theSel, newText, newValue)
{
	//Use the 'insertBefore' method to insert a new email id 'option' into the select box
	var newOpt2 = document.createElement('option');
	newOpt2.value = newText;
	newOpt2.innerHTML = newValue;
	theSel.insertBefore(newOpt2, theSel.firstChild);
}

function removeEmail(theSel)
{
  var selIndex = theSel.selectedIndex;
  if (selIndex != -1) {
    for(i=theSel.length-1; i>=0; i--)
    {
      if(theSel.options[i].selected)
      {
        theSel.options[i] = null;
      }
    }
    if (theSel.length > 0) {
      theSel.selectedIndex = selIndex == 0 ? 0 : selIndex - 1;
    }
  }
}

function checkfields()
{
    var obj = document.forms[0];
	var errors = "";

    var isclean = isCleanString(obj.elements['pubtgt:name'].value);
	if (!isclean) {
		alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowed" ESCAPE="true" ENCODE="false"/><![CDATA[");
		return false;
	}
	
	if ( (obj.elements['pubtgt:name'].value.length == 0) ||
		 (obj.elements['pubtgt:name'].value.match(/^[\s]/) != null) ) {
		
		//Here means something is wrong, let us figure out what
		
		 if ( obj.elements['pubtgt:name'].value.match(/^[\s]/) != null ) {
				]]>
				errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/Thenamecannotstartwithaspace" ESCAPE="true" ENCODE="false"/>\n";
				<![CDATA[
		 } 

		 if (obj.elements['pubtgt:name'].value.length == 0) {
				]]>
				errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyaname" ESCAPE="true" ENCODE="false"/>\n";
				<![CDATA[
		 }
		obj.elements['pubtgt:name'].focus();
	} else {
		obj.elements['pubtgt:name'].value = trim(obj.elements['pubtgt:name'].value);
	}
	
	if ( obj.elements['pubtgt:name'].value.length > 30) {
		alert("]]><XLAT.STREAM KEY="dvin/UI/Admin/NameShouldBeMaximum30Characters"/><![CDATA[");
		return false;
	}
	
	//validation for roles fields
	if (!checkMultiSelect(obj.elements['pubtgt:pubroles'])) {
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyoneormoreroles" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
		obj.elements['pubtgt:pubroles'].focus();
	}
	if (!checkMultiSelect(obj.elements['pubtgt:approles'])) {
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyoneormoreroles" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
		obj.elements['pubtgt:approles'].focus();
	}
	//validation for sites field
	if (!checkMultiSelect(obj.elements['pubtgt:sites'])) {
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyoneormoresites" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
		obj.elements['pubtgt:sites'].focus();
	}
	if('Variables.action' == 'new'){
		pubtgtTypeElement = obj.elements['pubtgt:type'].options[obj.elements['pubtgt:type'].selectedIndex]; 
	} else {
		if(obj.elements['pubtgt:type'].length){
			for (i=0; i < obj.elements['pubtgt:type'].length; i++){
				if (obj.elements['pubtgt:type'][i].checked){
					pubtgtTypeElement = obj.elements['pubtgt:type'][i];
				}
			}
		} else {
			pubtgtTypeElement = obj.elements['pubtgt:type'];
		}
	}
	//Prevent users to use the local address
	if (obj.elements['pubtgt:dest'] && (((obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('servername').value.toLowerCase()) != -1 && (obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('serverportcontext').value.toLowerCase()) != -1) || ((obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('serveraddress').value.toLowerCase()) != -1  && (obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('serverportcontext').value.toLowerCase()) != -1) || ((obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf('localhost') != -1 && (obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('serverportcontext').value.toLowerCase()) != -1) || ((obj.elements['pubtgt:dest'].value).indexOf('127.0.0.1') != -1 && (obj.elements['pubtgt:dest'].value.toLowerCase()).indexOf($('serverportcontext').value.toLowerCase()) != -1) && (pubtgtTypeElement.getAttribute('dtype')=="mirror" || pubtgtTypeElement.getAttribute('dtype')=="realtime")))
	{
	]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyadifferentnolocaldest" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
	}
	if (  pubtgtTypeElement.getAttribute('dtype')=="mirror" || pubtgtTypeElement.getAttribute('dtype')=="realtime")
	{
		if( obj.elements['pubtgt:dest'] && trim(obj.elements['pubtgt:dest'].value).length==0 ){
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyaddresscreatingmirrordest" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
		obj.elements['pubtgt:dest'].value="Variables.defaultdest";
		}
		else if(obj.elements['pubtgt:dest']){
			if(obj.elements['pubtgt:dest'].value.match(/:\d+/) == null){
					]]>
			errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyport" ESCAPE="true" ENCODE="false"/>\n";
			<![CDATA[
			}
			obj.elements['pubtgt:dest'].value = trim(obj.elements['pubtgt:dest'].value);
		}
	} 
	if ( obj.elements['remoteUser'] && trim(obj.elements['remoteUser'].value).length==0 && (pubtgtTypeElement.getAttribute('dtype')=="mirror" || pubtgtTypeElement.getAttribute('dtype')=="realtime"))
	{
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyusernamecreatingmirrordest" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[
		//Set the focus on the username input field
		obj.elements['remoteUser'].focus();
	}
	if ( obj.elements['remotePassword'] && trim(obj.elements['remotePassword'].value).length==0 && (pubtgtTypeElement.getAttribute('dtype')=="mirror" || pubtgtTypeElement.getAttribute('dtype')=="realtime"))
	{
		]]>
		errors += "<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifypasswordcreatingmirrordest" ESCAPE="true" ENCODE="false"/>\n";
		<![CDATA[		
		//Set the focus on the password field ONLY if the username is already entered
		if(obj.elements['remoteUser'] && obj.elements['remoteUser'].value.length > 0)
			obj.elements['remotePassword'].focus();
	}
	if (errors.length != 0) {
		]]>
		alert ("<XLAT.STREAM KEY="dvin/UI/Admin/Error/Theformisnotcomplete" ESCAPE="true" ENCODE="false"/>:\n\n" + errors);
		<![CDATA[
		document.forms[0].elements['pubtgt:factors'].value="";
		return false;
	}
	
	// GRM: call the function that is dependent on delivery type, these are included in the
    // file: OpenMarket/Xcelerate/PrologActions/Publish/[Type]/DestEditUI
	if (typeof(checkFactors) == 'function') 
	{
	    checkFactors();
	}
	return true;
}

//[KGF] function to handle checking of the Sites field and the new Roles fields.
//First checks whether a selection has been made; if so, ensures that if 'Any'
//was selected, that nothing else is (since that could confuse matters).
function checkMultiSelect(obj)
{
	if (!obj) return false;
	if (obj.selectedIndex == -1)
		return false;
	if (obj.options[0].selected) //Any is selected; deselect others
		for (var i = 1; i < obj.options.length; i++)
			obj.options[i].selected = false;
	return true;
}

function setdest(obj)
{
	i = 0;
	while (i < obj.elements['pubtgt:type'].length) 
	{
		if (obj.elements['pubtgt:type'].options[i].selected) 
		{
			if(obj.elements['pubtgt:type'].options[i].getAttribute('dtype')=="mirror" || obj.elements['pubtgt:type'].options[i].getAttribute('dtype')=="realtime") 
			{
				document.getElementById('mirrorRows').style.display="";
				if(obj.elements['pubtgt:type'].options[i].getAttribute('dtype')=="realtime") {
				document.getElementById('pubOptionsRow').style.display="";
				} else {
					document.getElementById('pubOptionsRow').style.display="none";
				}
				document.getElementById('exportToDiskRows').style.display="none";
				obj.elements['pubtgt:dest'].value="Variables.defaultdest";
				obj.elements['remoteUser'].value="Variables.defaultuser";
				obj.elements['remotePassword'].value="Variables.defaultpass";
				
				//Show the email alert check box, verbose check box and the <br> to seperate the factors from the other sections
				document.getElementById('sendEmailCheckBox').style.display="";				
				break;
			} else {
				obj.elements['pubtgt:dest'].value="";
				obj.elements['remoteUser'].value="";
				obj.elements['remotePassword'].value="";
				if(obj.elements['pubtgt:type'].options[i].getAttribute('dtype')=="static"){
					document.getElementById('exportToDiskRows').style.display="";
					document.getElementById('mirrorRows').style.display="none";
					document.getElementById('pubOptionsRow').style.display="none";
				} else if(obj.elements['pubtgt:type'].options[i].getAttribute('dtype')=="xmlexport"){
					document.getElementById('exportToDiskRows').style.display="none";
					document.getElementById('mirrorRows').style.display="none";
					document.getElementById('pubOptionsRow').style.display="none";
				}
				//As per the UI requirement doc all the destination types will have following fields
				// 1) Send email check box 2) Email addresses text boxes 3) Verbose check box 
				document.getElementById('sendEmailCheckBox').style.display="";
				document.getElementById('verboseCheckBoxBody').style.display="";
				break;
			}
		}
		i++;
	}
	return true;
}

function checkExportOption(radioSelect){
	if(radioSelect.value == 'Export'){
		document.getElementById('mirrorRows').style.display="none";
		document.getElementById('exportToDiskOption').style.display="";
	} else {
		document.getElementById('mirrorRows').style.display="";
		document.getElementById('exportToDiskOption').style.display="none";
	}
}

function setCheckedValue(radioObj, newValue) {
	if(!radioObj)
		return;
	var radioLength = radioObj.length;
	if(radioLength == undefined) {
		radioObj.checked = (radioObj.value == newValue.toString());
		return;
	}
	for(var i = 0; i < radioLength; i++) {
		radioObj[i].checked = false;
		if(radioObj[i].value == newValue.toString()) {
			radioObj[i].checked = true;
		}
	}
}

function setRealTimePubOption(option){
	PUBLISHOPTION = option;
}

function trim(str){
	return str.replace(/^\s+|\s+$/g, '') ;
}

function showExecuting(){
	var ld=(document.all);
	var ns4=document.layers;
	var ns6=document.getElementById&&!document.all;
	var ie4=document.all;
	if (ns4)
		ld=document.loading;
	else if (ns6)
		ld=document.getElementById("loading").style;
	else if (ie4)
		ld=document.all.loading.style;
	if(ns4){ld.visibility="hidden";}
		else if (ns6||ie4) ld.display="";
}
]]>
</SCRIPT>
</replaceall>
<IF COND="Variables.action=list">
<THEN>
		<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
			<tr><td>
				<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/PublishDestinations"/></span>
			</td></tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
		</table>
		
		<IF COND="IsVariable.orderby!=true">
		<THEN>
			<SETVAR NAME="orderby" VALUE="name"/>
		</THEN>
		</IF>

		<selectto LIST="dtype" WHAT="id,name,type" FROM="PubTarget" ORDERBY="Variables.orderby"/>

    	<IF COND="IsList.dtype=true">
    	<THEN>
			<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30">
					<tr>
						<td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
					</tr>
					<tr>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
						<td >
							<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="7" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							<tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
								<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
					            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></td>
					            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/UI/Publish/DeliveryType"/></DIV></td>
								<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
							</tr>
							<tr><td colspan="7" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							<!-- Loop over all search results. -->
					   			<setvar NAME="rowStyle" VALUE="tile-row-normal"/>
								<SETVAR NAME="separatorLine" VALUE="0"/>
							<LOOP LIST="dtype">

									<IF COND="Variables.separatorLine=1">
									<THEN>
										<!--<tr>
											<td colspan="7" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
										</tr>-->
									</THEN>
									</IF>
									<SETVAR NAME="separatorLine" VALUE="1"/>
			
							<tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
							<td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
								<XLAT.LOOKUP KEY="dvin/UI/Admin/InspectThisDestination" VARNAME="alt"/>
								<XLAT.LOOKUP KEY="dvin/Common/Inspect" VARNAME="statustxt" ESCAPE="true"/>
                                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="dtype.id"/>
                                                         <satellite.argument name="action" value="details"/>
                                                          </SATELLITE.LINK>
								<A HREF="Variables.urldestedit" onmouseover="window.status='Variables.statustxt';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables.statustxt"><img name="inspect" height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconInspectContent.gif"  border="0" alt="Variables.alt" title="Variables.alt"  REPLACEALL="Variables.cs_imagedir,Variables.alt"/></A>
								<XLAT.LOOKUP KEY="dvin/UI/Admin/EditThisDestination" VARNAME="alt"/>
								<XLAT.LOOKUP KEY="dvin/Common/Edit" VARNAME="statustxt" ESCAPE="true"/>
                                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="dtype.id"/>
                                                         <satellite.argument name="action" value="edit"/>
                                                          </SATELLITE.LINK>
								<A HREF="Variables.urldestedit" onmouseover="window.status='Variables.statustxt';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables.statustxt"><img name="edit" height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconEditContent.gif"  border="0" alt="Variables.alt" title="Variables.alt"  REPLACEALL="Variables.cs_imagedir,Variables.alt"/></A> 
								<XLAT.LOOKUP KEY="dvin/Common/Delete" VARNAME="statustxt" ESCAPE="true"/>
								<XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteThisDestination" VARNAME="alt"/>
                                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="dtype.id"/>
                                                         <satellite.argument name="action" value="confirmdelete"/>
                                                          </SATELLITE.LINK>
								<A HREF="Variables.urldestedit" onmouseover="window.status='Variables.statustxt';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables.statustxt"><img name="delete" height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconDeleteContent.gif"  border="0" alt="Variables.alt" title="Variables.alt"  REPLACEALL="Variables.cs_imagedir,Variables.alt"/></A>
							</td>
					                <td><BR /></td><td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
					                    <DIV class="small-text-inset">
                                            <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                                                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="dtype.id"/>
                                                         <satellite.argument name="action" value="details"/>
                                                          </SATELLITE.LINK>
										<A HREF="Variables.urldestedit" REPLACEALL="Variables.urldestedit"><STRING.STREAM VALUE="dtype.name"/></A>
										</DIV>
									</td>
									<td><BR /></td><td VALIGN="TOP" ALIGN="LEFT">
					                    <DIV class="small-text-inset">
					                    	<DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="dtype.type"/>
											<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
											<STRING.STREAM VARIABLE="dt:name"/>
					                    </DIV>
					                 </td>
					                 	<td><BR /></td></tr>
					            <IF COND="Variables.rowStyle=tile-row-normal">
					            <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
					            </THEN>
					            <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
					            </ELSE>
					            </IF>
							</LOOP>
							</table>
						</td>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
						</tr>
					<tr>
					<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
					</tr>
					<tr>
					<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
					</tr>
					</table> 
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="AddDestURL">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="new"/>
                                                          </SATELLITE.LINK>
		<div class="width-outer-70">
			<A HREF="Variables.AddDestURL" REPLACEALL="Variables.AddDestURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/AddNewDestination"/></CALLELEMENT></A>
    	</div>
    	</THEN>
    	<ELSE>
    	
    	</ELSE>
    	</IF>


</THEN>
</IF>





<IF COND="Variables.action=details">
<THEN>
		<PUBTARGETMANAGER.LOAD ID="Variables.id" OBJVARNAME="pubtgt"/>
		<if COND="IsError.Variables.errno=true">
		<then>
		   <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		      <argument NAME="error" VALUE="NoPublishDest"/>
		  	</callelement>
		</then>
		<else>
		    <PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
			<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
				<tr>
					<td><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Publishdestination"/>: <STRING.STREAM VARIABLE="pubtgt:name"/></span></td>
				</tr>
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
			</table>
		    <DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="Variables.pubtgt:type"/>
		    <DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
		    <if COND="IsElement.Variables.dt:path/DestEditUI=true">
		        <then>
		            <SETVAR NAME="uiElement" VALUE="Variables.dt:path/DestEditUI"/>
		        </then>
		        <else>
		            <SETVAR NAME="uiElement" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestEditUI"/>
		        </else>
		    </if>

   	<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-70 margin-top-zero">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<tr>
				<td class="form-label-text" colspan="3" ALIGN="LEFT">
				<table border="0" cellpadding="0" cellspacing="0">
				<tr>
					<XLAT.LOOKUP KEY="dvin/Common/Inspect" VARNAME="_XLAT_" ESCAPE="true"/>
					<XLAT.LOOKUP KEY="dvin/UI/Admin/InspectThisDestination" VARNAME="statustxt"/>
                    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="Variables.id"/>
                                                         <satellite.argument name="action" value="details"/>
                                                          </SATELLITE.LINK>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><img name="inspect" height="14" width="14" hspace="2" src="Variables.cs_imagedir/graphics/common/icon/iconInspectContentUp.gif"  border="0" alt="Variables.statustxt" REPLACEALL="Variables.cs_imagedir,Variables.statustxt"/></A></td>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Inspect"/></span></A></td>
					<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<XLAT.LOOKUP KEY="dvin/Common/Edit" VARNAME="_XLAT_" ESCAPE="true"/>
					<XLAT.LOOKUP KEY="dvin/UI/Admin/EditThisDestination" VARNAME="statustxt"/>
                    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                        <satellite.argument name="id" value="Variables.id"/>
                        <satellite.argument name="action" value="edit"/>
                    </SATELLITE.LINK>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><img name="edit" height="14" width="14" src="Variables.cs_imagedir/graphics/common/icon/iconEditContentUp.gif" hspace="2" border="0" alt="Variables.statustxt" REPLACEALL="Variables.cs_imagedir,Variables.statustxt"/></A></td>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Edit"/></span></A></td>

					<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<XLAT.LOOKUP KEY="dvin/Common/Delete" VARNAME="_XLAT_" ESCAPE="true"/>
					<XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteThisDestination" VARNAME="statustxt"/>
                     <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
                         <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                         <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="id" value="Variables.id"/>
                                                         <satellite.argument name="action" value="confirmdelete"/>
                                                          </SATELLITE.LINK>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><img name="delete" height="14" width="14" src="Variables.cs_imagedir/graphics/common/icon/iconDeleteContentUp.gif" hspace="2" border="0" alt="Variables.statustxt" REPLACEALL="Variables.cs_imagedir,Variables.statustxt"/></A></td>
					<td><A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urldestedit,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Delete"/></span></A></td>

					<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<XLAT.LOOKUP KEY="dvin/TreeApplet/ApproveMultipleAssets" VARNAME="alt"/>
					<XLAT.LOOKUP KEY="dvin/UI/Admin/ApproveMultipleAssetsforpubtgtname" VARNAME="_XLAT_" ESCAPE="true"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/BulkApproveFront" outstring="urldestedit">
					    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
					                                                         <satellite.argument name="target" value="Variables.id"/>
					                                                          </SATELLITE.LINK>
					<td><NOBR>
					<table><tr><td>
					<A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urldestedit"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/ApproveMultipleAssets"/></CALLELEMENT></A>
					</td><td>
					<IF COND="Variables.dt:dtype=static" REPLACEALL="Variables.dt:dtype">
					<THEN>
					<XLAT.LOOKUP KEY="dvin/TreeApplet/SetDefaultTemplates" VARNAME="alt"/>
					<XLAT.LOOKUP KEY="dvin/TreeApplet/SetDefaultTemplates" VARNAME="_XLAT_" ESCAPE="true"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/AssetDefaultTemplateFront" outstring="urlastdeftempfront">
					    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
					                                                         <satellite.argument name="target" value="Variables.id"/>
					                                                          </SATELLITE.LINK>
					<A HREF="Variables.urlastdeftempfront"  onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urlastdeftempfront"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SetDefaultTemplates"/></CALLELEMENT></A>
					</THEN>
					</IF>
					</td></tr></table>
					</NOBR>
					</td>
					</tr>
					</table>
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
					   <IF COND="Variables.dt:dtype=realtime">
							<THEN>
							<!--Check that the realtime target is available-->
							<img id="_targetStatus" border="0" style="position:relative;top:3px" src="Variables.cs_imagedir/graphics/common/icon/unavailable.gif" REPLACEALL="Variables.cs_imagedir"/>&nbsp;
							</THEN>
					   </IF>
					   <IF COND="Variables.dt:dtype=mirror">
					   <THEN>
							<!--Check that the mirror target is available-->
							<img id="_targetStatus" border="0" style="position:relative;top:3px" src="Variables.cs_imagedir/graphics/common/icon/unavailable.gif" REPLACEALL="Variables.cs_imagedir"/>&nbsp;
					   </THEN>
					   </IF>
					   <STRING.STREAM VARIABLE="pubtgt:name"/>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                                <CALLELEMENT NAME="Variables.uiElement">
                                        <ARGUMENT NAME="destField" VALUE="type"/>
                                </CALLELEMENT>
			</tr>
	

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                                <CALLELEMENT NAME="Variables.uiElement">
                                        <ARGUMENT NAME="destField" VALUE="factors"/>
                                </CALLELEMENT>
			</tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Sites"/>:
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETSITES NAME="pubtgt" OBJVARNAME="sites"/>
					<SITELIST.ISALL NAME="sites" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
					<PUBLICATION.LIST LIST="allSites" ORDER="description"/>
						<LOOP LIST="allSites">
							<SITELIST.HASSITE NAME="sites" PUBID="allSites.id" VARNAME="hasSite"/>
							<if COND="Variables.hasSite=true">
							<then>
								<STRING.STREAM VALUE="allSites.description"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/ApproveforPublish"/>):
				</td>
				<td class="form-inset">
					<PUBTARGET.GETAPPROVALROLES NAME="pubtgt" OBJVARNAME="approles"/>
					<ROLELIST.ISALL NAME="approles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="approles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<IF COND="Variables.hasrole=true"><THEN>
								<STRING.STREAM VALUE="allRoles.aclname"/><br />
							</THEN></IF>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/Publish"/>):
				</td>
				<td class="form-inset">
					<PUBTARGET.GETPUBLISHROLES NAME="pubtgt" OBJVARNAME="pubroles"/>
					<ROLELIST.ISALL NAME="pubroles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="pubroles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<IF COND="Variables.hasrole=true"><THEN>
								<STRING.STREAM VALUE="allRoles.aclname"/><br />
							</THEN></IF>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/Publishevent"/>:
				</td>
				<td class="form-inset">
						<setvar NAME="errno" VALUE="0"/>
						<setvar NAME="existEvent" VALUE="false"/>
						
						<!-- read SystemEvents table -->
						<ics.queryevents LIST="publishevent" NAME="PublishEvent_Variables.pubtgt:id%"/>
						
						<if COND="IsError.Variables.errno=true">
						<then>
						         <XLAT.STREAM KEY="dvin/UI/Admin/Noexistingpublishevent"/>
						</then>
						<else>
						      <setvar NAME="existEvent" VALUE="true"/>
						         <XLAT.STREAM KEY="dvin/UI/Admin/Publisheventscheduledat"/>:<BR/> <b><STRING.STREAM VALUE="publishevent.time"/></b><BR/>
								 <CALLELEMENT NAME="OpenMarket/Xcelerate/Util/SetServerTimeZoneVar" />
								 <XLAT.LOOKUP KEY='UI/Forms/datesInServerTime' VARNAME="datesInServerTime"/>
								 <font size="2">[ <CSVAR NAME="Variables.datesInServerTime" /> ]</font>
								 <br/>
						         <IF COND="publishevent.enabled!=true">
						         <THEN>
						         <BR/><span class="alert-color"><XLAT.STREAM KEY="dvin/UI/PdisabledP"/></span>
						         </THEN>
						         </IF>
						</else>
						</if>
						<BR/>
						<XLAT.LOOKUP KEY="dvin/UI/Admin/SetPublishEvent" VARNAME="alt"/>
						<XLAT.LOOKUP KEY="dvin/UI/Admin/SetPublishEvent" VARNAME="_XLAT_" ESCAPE="true"/>

                        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/PublishEventEdit" outstring="urlpubevedit">
                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="target" value="Variables.pubtgt:id"/>
                                                         <satellite.argument name="action" value="edit"/>
                                                          </SATELLITE.LINK>
						<A HREF="Variables.urlpubevedit"  onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urlpubevedit">
							<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SetPublishEvent_"/></CALLELEMENT>
						</A>
						<IF COND="Variables.existEvent=true">
						<THEN>
							<XLAT.LOOKUP KEY="dvin/UI/Admin/DeletePublishEventforDestinationName" VARNAME="alt"/>
							<XLAT.LOOKUP KEY="dvin/UI/Admin/DeletePublishEventforDestinationName" VARNAME="_XLAT_" ESCAPE="true"/>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/PublishEventEdit" outstring="urlpubevedit">
                                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="target" value="Variables.pubtgt:id"/>
                                                         <satellite.argument name="action" value="confirmdelete"/>
                                                          </SATELLITE.LINK>
                            <A HREF="Variables.urlpubevedit"  onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urlpubevedit">
								<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Delete"/></CALLELEMENT>
							</A>
						</THEN>
						</IF>
				</td>
			</tr>			
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/ID"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
					<STRING.STREAM VARIABLE="id"/>
				</td>
			</tr>

			<XLAT.LOOKUP KEY="dvin/UI/Admin/ForcePublishApprovedAssets" VARNAME="alt"/>
			<XLAT.LOOKUP KEY="dvin/UI/Admin/ForcePublishApprovedAssets" VARNAME="_XLAT_" ESCAPE="true"/>

			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
																	 <satellite.argument name="id" value="Variables.pubtgt:id"/>
																	 <satellite.argument name="action" value="forcepublish"/>
																	  </SATELLITE.LINK>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
					<A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urldestedit"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/ForceApprovePublishedAssets"/></CALLELEMENT></A>
				</TD>
			</TR>
			
			</table>
	</td></tr>
</table>
<DIV>
<XLAT.LOOKUP KEY="dvin/UI/Admin/Listallpublishdestinations" VARNAME="alt"/>
<XLAT.LOOKUP KEY="dvin/UI/Admin/Listallpublishdestinations" VARNAME="_XLAT_" ESCAPE="true"/>
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="urldestedit">
	<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
	<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
														 <satellite.argument name="action" value="list"/>
														  </SATELLITE.LINK>
<A HREF="Variables.urldestedit" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_,Variables.urldestedit"><IMG NAME="listpubdest" src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" ALT="Variables.alt" REPLACEALL="Variables.cs_imagedir,Variables.alt"/><XLAT.STREAM KEY="dvin/UI/Admin/Listallpublishdestinations"/></A>
</DIV>

	</else>
	</if>




</THEN>
</IF>






<IF COND="Variables.action=new">
<THEN>
	<SETVAR NAME="doForm" VALUE="true"/>
	<SETVAR NAME="buttonName" VALUE="AddNewDestination"/>
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="DestEditURL">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
        <satellite.argument name="action" value="list"/>
    </SATELLITE.LINK>
</THEN>
</IF>
<IF COND="Variables.action=edit">
<THEN>
	<SETVAR NAME="doForm" VALUE="true"/>
	<SETVAR NAME="buttonName" VALUE="Save"/>
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="DestEditURL">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
        <satellite.argument name="action" value="details"/>
        <satellite.argument name="id" value="Variables.id"/>
    </SATELLITE.LINK>

</THEN>
</IF>
<IF COND="Variables.doForm=true">
<THEN>
<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
	<IF COND="Variables.action=new">
	<THEN>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/AddNewDestination"/></span>
	   <PUBTARGETMANAGER.CREATE OBJVARNAME="pubtgt"/>
	   <SETVAR NAME="pubtgt:name" VALUE="Variables.empty"/>
	   <SETVAR NAME="pubtgt:type" VALUE="dtype.id"/>
	   <SETVAR NAME="pubtgt:dest" VALUE="Variables.empty"/>
	   <SETVAR NAME="pubtgt:factors" VALUE="Variables.empty"/>
	   <SETVAR NAME="pubtgt:id" VALUE="Variables.empty"/>
	</THEN>
	</IF>
	<IF COND="Variables.action=edit">
	<THEN>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/EditDestination"/></span>
		<PUBTARGETMANAGER.LOAD ID="Variables.id" OBJVARNAME="pubtgt"/>
		<if COND="IsError.Variables.errno=true">
		<then>
			<XLAT.STREAM KEY="dvin/Common/Error"/> = <STRING.STREAM VARIABLE="errno"/><br/>
		   <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		      <argument NAME="error" VALUE="NoPublishDest"/>
		  	</callelement>
		</then>
		<else>
		    <PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
		    <DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="Variables.pubtgt:type"/>
		    <DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
		    <if COND="IsElement.Variables.dt:path/DestEditUI=true">
		        <then>
		            <SETVAR NAME="uiElement" VALUE="Variables.dt:path/DestEditUI"/>
		        </then>
		        <else>
		            <SETVAR NAME="uiElement" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestEditUI"/>
		        </else>
		    </if>
		</else>
		</if>
	</THEN>
	</IF>
		</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
	
	<SELECTTO LIST="dtype" WHAT="*" FROM="DeliveryType" ORDERBY="name"/>
	<IF COND="IsList.dtype=false">
	<THEN>
	    <p><XLAT.STREAM KEY="dvin/UI/Admin/PleasedefineDeliveryTbeforedefiningDest"/></p>
	    <![CDATA[<!-- errno=]]><STRING.STREAM VARIABLE="errno"/><![CDATA[ -->]]>
	</THEN>
	</IF>

	<IF COND="IsError.Variables.errno=false">
	<THEN>

	    <setvar NAME="approot" VALUE="CS.Property.ft.approot"/>

		<INPUT NAME="pubtgt:id" TYPE="HIDDEN" VALUE="Variables.pubtgt:id" REPLACEALL="Variables.pubtgt:id"/>

   	<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-70">
   	<tr><td>	
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<tbody>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
			 		<INPUT NAME="pubtgt:name" TYPE="TEXT" SIZE="32" VALUE="Variables.pubtgt:name" REPLACEALL="Variables.pubtgt:name"/>
				</td><td></td>
			</tr>
			</tbody>
			<IF COND="Variables.action=edit">
			<THEN>
				<tbody>
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Publish/DeliveryType"/>:
				</td>
				<td class="form-inset"  nowrap="nowrap">
						<DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="Variables.pubtgt:type"/>
						<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
						<IF COND="Variables.dt:dtype=realtime">
						<THEN>
							<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
						</THEN>
						<ELSE>
							<IF COND="Variables.dt:dtype=mirror">
							<THEN>
								<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
							</THEN>
							<ELSE>
								<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="false"/>
							</ELSE>
							</IF>
						</ELSE>
						</IF>
						<IF COND="Variables.REALTIME_OR_MIRROR=true">
						<THEN>
							<INPUT style="margin-left:0px" TYPE="RADIO" NAME="pubtgt:type" VALUE="Variables.pubtgt:type" DTYPE="Variables.dt:dtype" REPLACEALL="Variables.pubtgt:type,Variables.dt:dtype" CHECKED="TRUE"/><STRING.STREAM VALUE="Variables.dt:name: Variables.dt:description"/><BR/>
							<IF COND="Variables.dt:dtype=realtime">
							<THEN>
							<TABLE><TR><TD WIDTH="10%"></TD><TD WIDTH="90%">
							<CALLELEMENT NAME="Variables.dt:path/DestEditUI">
                                <ARGUMENT NAME="PublishOptAction" VALUE="getPublishOption"/>
                            </CALLELEMENT>
							</TD>
							</TR>
							</TABLE>
							</THEN>
							</IF>
							<IF COND="Variables.dt:dtype=realtime">
							<THEN>
								<DELIVERYTYPE.LOAD NAME="dtype" FIELD="dtype" VALUE="mirror"/>
								<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt1"/>
								<INPUT style="margin-left:0px" TYPE="RADIO" NAME="pubtgt:type" VALUE="Variables.dt1:id" DTYPE="Variables.dt1:dtype"       REPLACEALL="Variables.pubtgt:type,Variables.dt1:id,Variables.dt1:dtype"  ONCLICK="setCheckedValue(document.forms['AppForm'].elements['PubOptions'],'');"/><STRING.STREAM VALUE="Variables.dt1:name: Variables.dt1:description"/><BR/>
							</THEN>
							<ELSE>
								<DELIVERYTYPE.LOAD NAME="dtype" FIELD="dtype" VALUE="realtime"/>
								<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt2"/>
								<!-- Setting the Realtime publishing option to complete(Default value) when the change of destination type(Mirror to Realtime) radio button is clicked..The reason that we are not giving all the options here because the fields are different for different options and that part is driven by DestEditUI.jsp for realtime(its not available here for mirror destination type.)-->
								<INPUT style="margin-left:0px" TYPE="RADIO" NAME="pubtgt:type" VALUE="Variables.dt2:id" DTYPE="Variables.dt2:dtype" REPLACEALL="Variables.pubtgt:type,Variables.dt2:id,Variables.dt2:dtype"  ONCLICK="setRealTimePubOption('Complete');" /><STRING.STREAM VALUE="Variables.dt2:name: Variables.dt2:description"/>
							</ELSE>
							</IF>
						</THEN>
						<ELSE>
							<INPUT TYPE="HIDDEN" NAME="pubtgt:type" VALUE="Variables.pubtgt:type" REPLACEALL="Variables.pubtgt:type"/><STRING.STREAM VALUE="Variables.dt:name: Variables.dt:description"/>
						</ELSE>
						</IF>
				</td>
				<td><BR/></td>
				</tr>
				</tbody>
			</THEN>
			<ELSE>
			<tbody>
			<SETVAR NAME="uiElement" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestEditUI"/>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Publish/DeliveryType"/>:
				</td>
				<td class="form-inset"  nowrap="nowrap">
				   <SELECT NAME="pubtgt:type" onChange="setdest(document.forms[0])">
						<loop LIST="dtype">
						    <IF COND="dtype.name!=VOID">
						    <THEN>
						    	<setvar NAME="dtfullname" VALUE="dtype.name"/>
						    	<if COND="dtype.description!=Variables.empty">
						    	<then>
									<setvar NAME="dtfullname" VALUE="Variables.dtfullname: dtype.description"/>
						    	</then>
						    	</if>
								<STRING.ENCODE LIST="dtype" COLUMN="id" VARNAME="dtid"/>
								<if COND="dtype.dtype=realtime">
								<then>
									<OPTION VALUE="Variables.dtid" DTYPE="dtype.dtype" REPLACEALL="Variables.dtid,dtype.dtype" SELECTED="true" /><STRING.STREAM VARIABLE="dtfullname"/>
								</then>
								<else>
									<OPTION VALUE="Variables.dtid" DTYPE="dtype.dtype" REPLACEALL="Variables.dtid,dtype.dtype"/><STRING.STREAM VARIABLE="dtfullname"/>
								</else>
								</if>
						    </THEN>
						    </IF>
						</loop>
				    </SELECT>
				</td>
			</tr>
			</tbody>
			<tbody id="pubOptionsRow">
				<img height="1" width="10" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
				<tr>
				<td><BR/></td>
				<td class="form-inset">
					<XLAT.STREAM KEY="dvin/UI/Publish/SelectDesiredPubOption"/><br/>
					<INPUT style="margin-left:0px" type="radio" name="PubOptions" value="Complete" onclick="checkExportOption(this)" checked="checked"/><XLAT.STREAM KEY="dvin/UI/Publish/CompletePublish"/><br/>
					<INPUT style="margin-left:0px" type="radio" name="PubOptions" value="Delayed" onclick="checkExportOption(this)" /><XLAT.STREAM KEY="dvin/UI/Publish/DelayedPublish"/>
				</td>
				</tr>
			</tbody>
			</ELSE>
			</IF>
			<IF COND="Variables.action=new">
			<THEN>
			<tbody id="mirrorRows">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/Destinationaddress"/>:
				</td>
				<td class="form-inset">
					<INPUT NAME="pubtgt:dest" TYPE="TEXT" SIZE="32"/>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
			<td class="form-label-text">
                    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Publish/Mirror1Destination-RemoteUser"/>:
                </td>
                <td class="form-inset"><INPUT NAME="remoteUser" TYPE="TEXT" SIZE="32"/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Publish/Mirror1Destination-RemotePassword"/>:
                </td>
                <td class="form-inset"><INPUT NAME="remotePassword" TYPE="PASSWORD" SIZE="32"/></td>
                <td></td>
            </tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			</tbody>
			<tbody id="exportToDiskOption" style="display:none">
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				<tr>
					<td class="form-label-text">
						<XLAT.STREAM KEY="dvin/UI/Publish/Export-Dir"/>:
					</td>
					<td class="form-inset"><INPUT NAME="realTimeDir" TYPE="TEXT" SIZE="32"/></td>
					<td></td>
				</tr>
				<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>
			</tbody>
			<tbody id="exportToDiskRows" style="display:none">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Dir"/>:
                </td>
                <td class="form-inset"><INPUT NAME="dir" TYPE="TEXT" SIZE="32"/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Urlprefix"/>:
                </td>
                <td class="form-inset"><INPUT NAME="urlPrefix" TYPE="text" SIZE="32"/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Suffix"/>:
                </td>
                <td class="form-inset"><INPUT NAME="suffix" TYPE="text" SIZE="32"/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Simplename"/>:
                </td>
                <td class="form-inset"><INPUT TYPE="CHECKBOX" NAME="simpleName" VALUE='true' /></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Simpledir"/>:
                </td>
                <td class="form-inset"><INPUT TYPE="CHECKBOX" NAME="simpleDir" VALUE='true'/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Export-Oldtemplate"/>:
                </td>
                <td class="form-inset"><INPUT NAME="oldTemplate" TYPE="text" SIZE="32"/></td>
                <td></td>
            </tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			</tbody>
			<tbody id="sendEmailCheckBox">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/SendEmailOnFailure"/>:
                </td>
                <td class="form-inset"><INPUT TYPE="CHECKBOX" NAME="alert" VALUE='true' onClick="showHideEmailConfig(this.checked)"/></td>
                <td></td>
            </tr>
			</tbody>
			<tbody id="emailConfig" style="display:none">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/EmailIds"/>:
                </td>
                <td class="form-inset"><INPUT TYPE="text" NAME="emailInput" /></td>
                <td></td>
            </tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td></td>
                <td class="form-inset"><table><tr><td rowSpan="2"><select id="emailList" size="5" multiple="multiple" STYLE="width:250px">
					</select></td><td>&nbsp;<A href="#" onclick="validateAndInsertEmail('0','emailInput');return false;"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Add"/></CALLELEMENT></A></td></tr>
					<tr><td>&nbsp;<A href="#" onclick="removeEmail(document.forms[0].emailList);return false;"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Remove"/></CALLELEMENT></A></td></tr></table></td>
                <td></td>
            </tr>
			</tbody>
			<tbody ID="verboseCheckBoxBody">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Mirror1Destination-Verbose"/>:
                </td>
                <td class="form-inset"><INPUT TYPE="CHECKBOX" NAME="verbose" VALUE='true'/></td>
                <td></td>
            </tr>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
                <td class="form-label-text">
                    <XLAT.STREAM KEY="dvin/UI/Publish/Mirror1Destination-More"/>:
                </td>
                <td class="form-inset"><INPUT NAME="pubtgt:factors" TYPE="TEXT" SIZE="32" MAXLENGTH="800"/></td>
                <td></td>
			</tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
				</tr>-->
			</tbody>
			</THEN>
			</IF>
			<tbody>
			<!-- GRM -->
			<CALLELEMENT NAME="Variables.uiElement">
            	<ARGUMENT NAME="destField" VALUE="factors"/>
            </CALLELEMENT>
			<!-- END GRM -->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Sites"/>:
				</td>
				<td class="form-inset">
					<SELECT NAME="pubtgt:sites" MULTIPLE="yes" SIZE="6" STYLE="width:250px">
		    		<PUBTARGET.GETSITES NAME="pubtgt" OBJVARNAME="sites"/>
					<PUBLICATION.LIST LIST="allSites" ORDER="description"/>
					<SITELIST.ISALL NAME="sites" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN>
						<option value="_ALL_" selected="selected"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allSites">
						<STRING.ENCODE LIST="allSites" COLUMN="id" VARNAME="asid"/>
						<option value="Variables.asid" REPLACEALL="Variables.asid"><STRING.STREAM VALUE="allSites.description"/></option>
						</LOOP>
					</THEN>
					<ELSE>
						<option value="_ALL_"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allSites">
						    <if COND="Variables.action=new">
							<then>
							   <if COND="allSites.id=SessionVariables.pubid">
							   <then>
									<setvar name="hasSite" value="true"/>
							   </then>
							   <else>
									<setvar name="hasSite" value="false"/>
							   </else>
							   </if>
							</then>
							<else>
								<SITELIST.HASSITE NAME="sites" PUBID="allSites.id" VARNAME="hasSite"/>
							</else>
							</if>
							<STRING.ENCODE LIST="allSites" COLUMN="id" VARNAME="asid"/>
							<if COND="Variables.hasSite=true">
							<then>
							    <OPTION VALUE="Variables.asid" SELECTED="true" REPLACEALL="Variables.asid"/><STRING.STREAM VALUE="allSites.description"/>
							</then>
							<else>
								<OPTION VALUE="Variables.asid" REPLACEALL="Variables.asid"/><STRING.STREAM VALUE="allSites.description"/>
							</else>
							</if>
						</LOOP>
					</ELSE>
					</IF>
					</SELECT>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/ApproveforPublish"/>):
				</td>
				<td class="form-inset">
					<IF COND="Variables.action=new">
					<THEN><SETVAR NAME="isall" VALUE="true"/></THEN>
					<ELSE>
			    		<PUBTARGET.GETAPPROVALROLES NAME="pubtgt" OBJVARNAME="approles"/>
						<ROLELIST.ISALL NAME="approles" VARNAME="isall"/>
					</ELSE>
					</IF>
					<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
					<select name="pubtgt:approles" multiple="yes" size="6">
					<IF COND="Variables.isall=true">
					<THEN>
						<option value="_ALL_" selected="selected"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allRoles">
							<option value="allRoles.aclname" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
						</LOOP>
					</THEN>
					<ELSE>
						<option value="_ALL_"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="approles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<option value="allRoles.aclname" selected="selected" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
							</then>
							<else>
								<option value="allRoles.aclname" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
							</else>
							</if>
						</LOOP>
					</ELSE>
					</IF>
					</select>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/Publish"/>):
				</td>
				<td class="form-inset">
					<IF COND="Variables.action=new">
					<THEN><SETVAR NAME="isall" VALUE="true"/></THEN>
					<ELSE>
			    		<PUBTARGET.GETPUBLISHROLES NAME="pubtgt" OBJVARNAME="pubroles"/>
						<ROLELIST.ISALL NAME="pubroles" VARNAME="isall"/>
					</ELSE>
					</IF>
					<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
					<select name="pubtgt:pubroles" multiple="yes" size="6">
					<IF COND="Variables.isall=true">
					<THEN>
						<option value="_ALL_" selected="selected"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allRoles">
							<option value="allRoles.aclname" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
						</LOOP>
					</THEN>
					<ELSE>
						<option value="_ALL_"><XLAT.STREAM KEY="dvin/Common/Any"/></option>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="pubroles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<option value="allRoles.aclname" selected="selected" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
							</then>
							<else>
								<option value="allRoles.aclname" REPLACEALL="allRoles.aclname"><STRING.STREAM VALUE="allRoles.aclname"/></option>
							</else>
							</if>
						</LOOP>
					</ELSE>
					</IF>
					</select>
				</td><td></td>
			</tr>
			
			<IF COND="Variables.action!=new">
			<THEN>
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/ID"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
					<STRING.STREAM VARIABLE="id"/>
				</td><td><BR /></td>
			</tr>
			</THEN>
			</IF>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
			<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestPost"/>
			<INPUT TYPE="HIDDEN" NAME="action" VALUE="Variables.action" REPLACEALL="Variables.action"/>
			<XLAT.LOOKUP KEY="dvin/UI/Save" VARNAME="_XLAT_" ESCAPE="true"/>
			
				<A HREF="Variables.DestEditURL" REPLACEALL="Variables.DestEditURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
			
				<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Variables.buttonName"/></CALLELEMENT></A>
				</TD>
			</TR>

			
		 </tbody>
		</table>
		</td></tr>
</table>


	</THEN>
	</IF>
</THEN>
</IF>

<IF COND="Variables.action=confirmdelete">
<THEN>  
		<PUBTARGETMANAGER.LOAD ID="Variables.id" OBJVARNAME="pubtgt"/>
		<if COND="IsError.Variables.errno=true">
		<then>
			<XLAT.STREAM KEY="dvin/Common/Error"/> = <STRING.STREAM VARIABLE="errno"/><br/>
		    <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		        <argument NAME="error" VALUE="NoPublishDest"/>
		  	</callelement>
            <throwexception/>
		</then>
		<else>
		    <PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
			<PUBTARGET.GETFACTORS NAME="pubtgt" VARNAME="pubtgt:factors"/>
		</else>
		</if>
        <table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
			<tr><td>
				<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/DeletePublishDestination"/></span>
			</td></tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
		</table>
		
		<div class="width-outer-70">
        <ApprovedAssets.GetDeletedAssetsToPublish TARGET="Variables.id" PREFIX="DeletedPublishableAssets" />
		<if cond="Variables.DeletedPublishableAssetsTotal!=0">
		<then>
			<XLAT.LOOKUP KEY="dvin/UI/Admin/UnPublishedAssetsWarning" ENCODE="false" VARNAME="unpublishedDeletedAssetMessage"/>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
            <argument NAME="msgtext" VALUE="Variables.unpublishedDeletedAssetMessage"/>
            <argument NAME="severity" VALUE="error"/>
        </callelement>
		</then>
		<else>
			<PUBTARGET.GETPUBLISHEDASSETSCOUNT NAME="pubtgt" VARNAME="publishedAssetsCount"/>
			<IF COND="Variables.publishedAssetsCount!=0">
			<THEN>
				<XLAT.LOOKUP KEY="dvin/UI/Admin/publishedAssetsErrorMessage" ENCODE="false" VARNAME="publishedAssetsErrorMessage"/>
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
					<argument NAME="msgtext" VALUE="Variables.publishedAssetsErrorMessage"/>
					<argument NAME="severity" VALUE="error"/>
				</callelement>
			</THEN>
			</IF>
		</else>
		</if>
		<XLAT.LOOKUP KEY="dvin/UI/Admin/DeletePublishDestinationWarning" ENCODE="false" VARNAME="deletemessage"/>
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
            <argument NAME="msgtext" VALUE="Variables.deletemessage"/>
            <argument NAME="severity" VALUE="warning"/>
        </callelement>
		</div>

    <table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-70">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
			 		<STRING.STREAM VARIABLE="pubtgt:name"/>
				</td><td></td>
			</tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>	
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Publish/DeliveryType"/>:
				</td>
				<td class="form-inset"  nowrap="nowrap">
					<DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="Variables.pubtgt:type"/>
					<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
					<STRING.STREAM VALUE="Variables.dt:name: Variables.dt:description"/>
					<INPUT TYPE="HIDDEN" NAME="pubtgt:type" VALUE="Variables.pubtgt:type" REPLACEALL="Variables.pubtgt:type"/>
		        	<setvar NAME="path" VALUE="Variables.dt:path"/>
				</td><td><BR /></td>
			</tr>
			<IF COND="Variables.dt:dtype=realtime" REPLACEALL="Variables.dt:dtype">
			<THEN>
				<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
			</THEN>
			<ELSE>
				<IF COND="Variables.dt:dtype=mirror" REPLACEALL="Variables.dt:dtype">
				<THEN>
					<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
				</THEN>
				<ELSE>
					<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="false"/>
				</ELSE>
				</IF>
			</ELSE>
			</IF>	
			<IF COND="Variables.REALTIME_OR_MIRROR=true" REPLACEALL="Variables.REALTIME_OR_MIRROR">
			<THEN>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>	
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/Destinationaddress"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VALUE="Variables.pubtgt:dest"/>
				</td><td></td>
			</tr>
			</THEN>
			</IF>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/Common/Arguments"/>:
				</td>
				<td class="form-inset">
			    	<STRINGLIST NAME="factorsList" STR="Variables.pubtgt:factors" DELIM="%26"/>
					<loop LIST="factorsList">
						<INDEXOF STR="factorsList.ITEM" WHAT="EMAILIDS" OUTSTR="index" INDEX="0"/>
						<IF COND="Variables.errno=0">
						<THEN>
							<span><STRING.STREAM VALUE="factorsList.ITEM"/><BR/></span>
						</THEN>
						</IF>
					</loop>
				</td><td></td>
			</tr>			
          <!--<tr><td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Sites"/>:
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETSITES NAME="pubtgt" OBJVARNAME="sites"/>
					<SITELIST.ISALL NAME="sites" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
					<PUBLICATION.LIST LIST="allSites" ORDER="description"/>
						<LOOP LIST="allSites">
							<SITELIST.HASSITE NAME="sites" PUBID="allSites.id" VARNAME="hasSite"/>
							<if COND="Variables.hasSite=true">
							<then>
								<STRING.STREAM VALUE="allSites.description"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/ApproveforPublish"/>):
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETAPPROVALROLES NAME="pubtgt" OBJVARNAME="approles"/>
					<ROLELIST.ISALL NAME="approles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="approles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<STRING.STREAM VALUE="allRoles.aclname"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/Publish"/>):
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETPUBLISHROLES NAME="pubtgt" OBJVARNAME="pubroles"/>
					<ROLELIST.ISALL NAME="pubroles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="pubroles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<STRING.STREAM VALUE="allRoles.aclname"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/ID"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
					<STRING.STREAM VARIABLE="id"/>
				</td>
			</tr>
			<XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteThisDestination" VARNAME="statustxt" ESCAPE="true"/>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="DestEditURL">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
					<satellite.argument name="action" value="details"/>
					<satellite.argument name="id" value="Variables.id"/>
			</SATELLITE.LINK>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
					<A HREF="Variables.DestEditURL" REPLACEALL="Variables.DestEditURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					<A HREF="javascript:void(0);" onclick="document.forms['AppForm'].submit(); return false;" onmouseover="window.status='Variables.statustxt';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables.statustxt"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/DeleteDestination"/></CALLELEMENT></A>
				</TD>
			</TR>		
		</table>
	</td></tr>
</table>

<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestPost"/>
<INPUT TYPE="HIDDEN" NAME="action" VALUE="delete"/>

</THEN>
</IF>


<IF COND="Variables.action=forcepublish">
<THEN>
		<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
			<tr><td>
				<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/ForcePublishApprovedAssets"/></span>
			</td></tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
		</table>
		
		<PUBTARGETMANAGER.LOAD ID="Variables.id" OBJVARNAME="pubtgt"/>
		<if COND="IsError.Variables.errno=true">
		<then>
			<XLAT.STREAM KEY="dvin/Common/Error"/> = <STRING.STREAM VARIABLE="errno"/><br/>
		   <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		      <argument NAME="error" VALUE="NoPublishDest"/>
		  	</callelement>
		</then>
		<else>
		    <PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
			<PUBTARGET.GETFACTORS NAME="pubtgt" VARNAME="pubtgt:factors"/>
		</else>
		</if>

	<div class="width-outer-70">
	<XLAT.LOOKUP KEY="dvin/UI/Admin/Confirmforcepubdest" VARNAME="msgtext" ENCODE="false"/>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="severity" VALUE="warning"/>
	</callelement>
	</div>
    <table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-70">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
			 		<STRING.STREAM VALUE="Variables.pubtgt:name"/>
				</td><td></td>
			</tr>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Publish/DeliveryType"/>:
				</td>
				<td class="form-inset"  nowrap="nowrap">
							<DELIVERYTYPE.LOAD NAME="dtype" OBJECTID="Variables.pubtgt:type"/>
							<DELIVERYTYPE.SCATTER NAME="dtype" PREFIX="dt"/>
							<STRING.STREAM VALUE="Variables.dt:name: Variables.dt:description"/>
							<INPUT TYPE="HIDDEN" NAME="pubtgt:type" VALUE="Variables.pubtgt:type" REPLACEALL="Variables.pubtgt:type"/>
				         <setvar NAME="path" VALUE="Variables.dt:path"/>
				</td><td><BR /></td>
			</tr>
			<IF COND="Variables.dt:dtype=realtime" REPLACEALL="Variables.dt:dtype">
			<THEN>
				<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
			</THEN>
			<ELSE>
				<IF COND="Variables.dt:dtype=mirror" REPLACEALL="Variables.dt:dtype">
				<THEN>
					<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="true"/>
				</THEN>
				<ELSE>
					<SETVAR NAME="REALTIME_OR_MIRROR" VALUE="false"/>
				</ELSE>
				</IF>
			</ELSE>
			</IF>	
			<IF COND="Variables.REALTIME_OR_MIRROR=true" REPLACEALL="Variables.REALTIME_OR_MIRROR">
			<THEN>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>	
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/Destinationaddress"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VALUE="Variables.pubtgt:dest"/>
				</td><td></td>
			</tr>
			</THEN>
			</IF>
			<!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/Common/Arguments"/>:
				</td>
				<td class="form-inset">
					<string.stream VARIABLE="pubtgt:factors"/>
				</td><td></td>
			</tr>			
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Sites"/>:
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETSITES NAME="pubtgt" OBJVARNAME="sites"/>
					<SITELIST.ISALL NAME="sites" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
					<PUBLICATION.LIST LIST="allSites" ORDER="description"/>
						<LOOP LIST="allSites">
							<SITELIST.HASSITE NAME="sites" PUBID="allSites.id" VARNAME="hasSite"/>
							<if COND="Variables.hasSite=true">
							<then>
								<STRING.STREAM VALUE="allSites.description"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/ApproveforPublish"/>):
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETAPPROVALROLES NAME="pubtgt" OBJVARNAME="approles"/>
					<ROLELIST.ISALL NAME="approles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="approles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<STRING.STREAM VALUE="allRoles.aclname"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Roles"/> (<XLAT.STREAM KEY="dvin/UI/Publish"/>):
				</td>
				<td class="form-inset">
		    		<PUBTARGET.GETPUBLISHROLES NAME="pubtgt" OBJVARNAME="pubroles"/>
					<ROLELIST.ISALL NAME="pubroles" VARNAME="isall"/>
					<IF COND="Variables.isall=true">
					<THEN><XLAT.STREAM KEY="dvin/Common/Any"/></THEN>
					<ELSE>
						<ROLEMANAGER.GETROLENAMES LISTVARNAME="allRoles"/>
						<LOOP LIST="allRoles">
							<ROLELIST.HASROLE NAME="pubroles" ROLE="allRoles.aclname" VARNAME="hasrole"/>
							<if COND="Variables.hasrole=true">
							<then>
								<STRING.STREAM VALUE="allRoles.aclname"/><BR />
							</then>
							</if>
						</LOOP>
					</ELSE>
					</IF>
				</td><td></td>
			</tr>
          <!--<tr>
				<td colspan="3" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>-->			
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/ID"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
					<STRING.STREAM VARIABLE="id"/>
				</td>
			</tr>			
			</table>
	</td></tr>
</table>

<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/Publish/DestPost"/>
<INPUT TYPE="HIDDEN" NAME="action" VALUE="forcepublish"/>
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/Publish/DestEdit" outstring="DestEditURL">
    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="details"/>
                                                         <satellite.argument name="id" value="Variables.id"/>
                                                          </SATELLITE.LINK>
<div class="width-outer-70">
<if cond="Variables.cs_environment=portal">
<then>
    <A HREF="javascript:void(0);" ONCLICK="window.close();">
        <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT>
    </A>
</then>
<else>
    <A HREF="Variables.DestEditURL" REPLACEALL="Variables.DestEditURL">
        <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT>
    </A>
</else>
</if>
<A HREF="javascript:void(0);" onclick="showExecuting();document.forms['AppForm'].submit(); return false;" onmouseover="window.status='';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables.statustxt">
    <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/ForceApprovePublishedAssets"/></CALLELEMENT>
</A>
</div>
</THEN>
</IF>
<satellite.link pagename="OpenMarket/Xcelerate/PrologActions/Publish/AdvPub/PublishingStatController" assembler="query" outstring="pubStatcontrollerURL">
	<satellite.argument name="target" value='Variables.id'/>
	<satellite.argument name="action" value="getPubTargetStatus"/>
</satellite.link>
<input type="hidden" id="servername" value="CS.SERVER_NAME" replaceAll="CS.SERVER_NAME"/>
<input type="hidden" id="serveraddress" value="Variables.serverAddress" replaceAll="CS.SERVER_ADDRESS"/>
<input type="hidden" id="serverportcontext" value="CS.SERVER_PORTCS.Property.ft.cgipath" replaceAll="CS.SERVER_PORT,CS.Property.ft.cgipath"/>
<!--This screen can be slow if the number of assets are large.Show the Executing div-->
<div id="loading" style="width:200px;height:100px;position:absolute;display:none;top: 350px;left: 320px;" bgcolor="white">
<table width="100%" height="100%" cellspacing="0" cellpadding="0" bgcolor="#ffffff" align="center" style="border: 1px solid rgb(204,204,204);">
<tbody>
<tr>
<td valign="middle" align="center">
<img src="Variables.cs_imagedir/graphics/common/icon/wait_ax.gif" REPLACEALL="Variables.cs_imagedir"/>
<br/>
<br/>
<b>
<span id="loadingMsg"><XLAT.STREAM KEY="dvin/UI/Executing"/></span>
<img src="Variables.cs_imagedir/graphics/common/icon/short_Progress.gif" REPLACEALL="Variables.cs_imagedir"/>
</b>
<a id="hider2" style="cursor: pointer; text-decoration: underline;"/>
</td>
</tr>
</tbody>
</table>
</div>
<replaceall list="Variables.dt:dtype,Variables.id,Variables.pubStatcontrollerURL,Variables.cs_imagedir,Variables.action">
<STRING.ENCODE VARIABLE="action" VARNAME="action"/>
<script type="text/javascript">
<![CDATA[
	var invokeIntervalId = 0;
	function init(){
		getTargetStatus();
		invokeIntervalId = setInterval(function() {getTargetStatus()},5000);
	}
	
	function getTargetStatus(){
		if('Variables.dt:dtype' == 'mirror' || 'Variables.dt:dtype' == 'realtime' ){
			new Ajax.Request('Variables.pubStatcontrollerURL',{
			method: 'get'});
		}
	}
	
	function updateStatus(req){
		var _targetStatusElm = document.getElementById('_targetStatus');
		if(req.readyState == 4){
			var targetStatus = req.responseText.evalJSON();
			if(targetStatus.pubTargetStatus.status){
				_targetStatusElm.src = "Variables.cs_imagedir/graphics/common/icon/available.gif";
				_targetStatusElm.title = ']]><XLAT.STREAM KEY="dvin/Common/Success" ENCODE="false" ESCAPE="true"/><![CDATA[';
			} else {
				_targetStatusElm.src = "Variables.cs_imagedir/graphics/common/icon/unavailable.gif";
				_targetStatusElm.title = ']]><XLAT.STREAM KEY="dvin/Common/Connection/Error" ENCODE="false" ESCAPE="true"/><![CDATA[';
				var unknownCreds = ']]><XLAT.STREAM KEY="dvin/UI/Invalidusernameorpassword" ENCODE="false" ESCAPE="true"/><![CDATA[';
				if (targetStatus.pubTargetStatus.msg == 'Unknown  username/password.')//ftMessage.noUser
				{
					_targetStatusElm.title = unknownCreds;
				}
			}
		} else{
			_targetStatusElm.src = "Variables.cs_imagedir/graphics/common/icon/unavailable.gif";
			_targetStatusElm.title = ']]><XLAT.STREAM KEY="dvin/Common/NetworkDownRetrying" ENCODE="false" ESCAPE="true"/><![CDATA[';
		}
	}
	
	function callIsActive (xmlhttp)
	{
        switch (xmlhttp.readyState)
        {
                  case 1: case 2: case 3:
                      return true;
                      break;
                  // Case 4 and 0
                  default:
                      return false;
                      break;
        }
	}

	function TimeOutCheck(request)
	{
		// If we have hit the timeout and the AJAX request is active, abort it and let the user know
		if (callIsActive(request.transport))
		{
           request.transport.abort();
           updateStatus(request.transport);
		}
	} 

	// Register global responders that will occur on all AJAX requests
	Ajax.Responders.register(
	{
        onCreate: function(request)
        {
            request['timeoutId'] = window.setTimeout(function () { TimeOutCheck(request); }, 2000); //Two Seconds
        },
        onComplete: function(request)
        {
            // Clear the timeout, the request completed ok
            window.clearTimeout(request['timeoutId']);
			updateStatus(request.transport);
		}
	});
	
	if('Variables.action'=='details'){
		window.onload=init;
	} else if('Variables.action'=='new'){
		window.onload=function(){ setdest(document.forms[0]);}
	}
]]>
</script>
</replaceall>
</FTCS>
