<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/AssociationPost.xml $

-->

<!--
 Confidential and Proprietary Information of divine Inc.
					All Rights Reserved.
 DESCRIPTION
	Admin things about a asset asscoiations	

 INPUT
   pagetype  front/post
   action  new/edit/delete/details
-->

 



	<!-- process editing of stuff -->
	<IF COND="Variables.action=edit">
	<THEN>

		<ASSOCNAMEDMANAGER.LOAD OBJVARNAME="association" ID="Variables.id"/> 
		<ASSOCNAMED.GATHER NAME="association" PREFIX="Association:"/>
		<ASSOCNAMEDMANAGER.SAVE OBJECT="association"/>
				
		<IF COND="Variables.errno!=0">
		<THEN>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
				<argument NAME="error" VALUE="UpdateFailed"/>
			</callelement>
			<ASSOCNAMED.GETTYPE NAME="association" VARNAME="parentassettype"/>
			<callelement NAME="OpenMarket/Xcelerate/Admin/AssociationFront">
				<argument NAME="action" VALUE="list"/>
				<argument NAME="parentassettype" VALUE="Variables.parentassettype"/>
			</callelement>
		</THEN>
		<ELSE>
			<ASSOCNAMED.GETID NAME="association" VARNAME="id"/>
			<callelement NAME="OpenMarket/Xcelerate/Admin/AssociationFront">
				<argument NAME="id" VALUE="Variables.id"/>
				<argument NAME="action" VALUE="details"/>
				<argument NAME="showtitle" VALUE="false"/>
			</callelement>
		</ELSE>
		</IF>
     
		<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
		<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
				<argument NAME="__TreeRefreshKeys__" VALUE="Parent:Variables.id"/>
			</callelement>		
		</then>
		</if>
	
	</THEN>
	</IF>

	<!-- process deletion of stuff -->
	<IF COND="Variables.action=delete">
	<THEN>
		<ASSOCNAMEDMANAGER.LOAD OBJVARNAME="association" ID="Variables.id"/> 
		<ASSOCNAMED.GETTYPE NAME="association" VARNAME="parentassettype"/>
		<ASSOCNAMEDMANAGER.DELETE ID="Variables.id"/> 
		<IF COND="Variables.errno!=0">
		<THEN>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
				<argument NAME="error" VALUE="DeleteFailed"/>
			</callelement>
		</THEN>
		<ELSE>
			<XLAT.STREAM KEY="dvin/UI/Deletesuccessful"/><br/>
		</ELSE>
		</IF>

		<callelement NAME="OpenMarket/Xcelerate/Admin/AssociationFront">
			<argument NAME="action" VALUE="list"/>
			<argument NAME="parentassettype" VALUE="Variables.parentassettype"/>
		</callelement>
       
		<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
		<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
				<argument NAME="__TreeRefreshKeys__" VALUE="Parent:Variables.id"/>
			</callelement>		
		</then>
		</if>
		
	</THEN>
	</IF>

	<!-- process addition of stuff -->
	<!--Calling New Tag AsscoNamed to save datus into New table AssocNamed and AssocNamed_SubTypes-->
	<IF COND="Variables.action=new">
	<THEN>            
		<IF COND="IsVariable.Association:name=true">
		<THEN>
            
			<IF COND="IsVariable.Association:description=true">
			<THEN>
				<ASSOCNAMEDMANAGER.CREATE OBJVARNAME="association"/>
				<ASSOCNAMED.GATHER NAME="association" PREFIX="Association:"/>
				
				<ASSOCNAMEDMANAGER.SAVE OBJECT="association"/>
				<IF COND="Variables.errno!=0">
				<THEN>
					<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
						<argument NAME="error" VALUE="AssociationFailed"/>
					</callelement>
					<ASSOCNAMED.GETTYPE NAME="association" VARNAME="parentassettype"/>
					<callelement NAME="OpenMarket/Xcelerate/Admin/AssociationFront">
						<argument NAME="action" VALUE="list"/>
						<argument NAME="parentassettype" VALUE="Variables.parentassettype"/>
					</callelement>
				</THEN>
				<ELSE>
					<ASSOCNAMED.GETID NAME="association" VARNAME="id"/>
					<callelement NAME="OpenMarket/Xcelerate/Admin/AssociationFront">
						<argument NAME="id" VALUE="Variables.id"/>
						<argument NAME="action" VALUE="details"/>
					</callelement>
				</ELSE>
				</IF>
			</THEN>
			<ELSE>
				<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
					<argument NAME="error" VALUE="NoAssociation"/>
				</callelement>
			</ELSE>
			</IF>
		</THEN>
		<ELSE>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
				<argument NAME="error" VALUE="NoAssociation"/>
			</callelement>
		</ELSE>
		</IF>
        
		<PROPERTY.GET PARAM="xcelerate.treeType" INIFILE="futuretense_xcel.ini" VARNAME="proptreetype"/>
		<if  COND="IsElement.OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/UpdateTreeVariables.proptreetype">
				<argument NAME="__TreeRefreshKeys__" VALUE="Self:Variables.assettype_Association"/>
			</callelement>		
		</then>
		</if>
	</THEN>
	</IF>



</FTCS>