<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/SiteFront.xml $

-->

<!--
 Confidential and Proprietary Information of FutureTense Inc.
					All Rights Reserved.

 Site.xml

 DESCRIPTION
	Admin things about a Publication (site)

 HISTORY
 [2007-09-18 KGF]
 * XSS fixes (adapted from 6.3 fixes):
   * isCleanString function usage
   * CSVAR -> STRING.STREAM
 * changed definitions of 'obj' to just forms[0] (not .elements[0])
 [2008-02-25 KGF]
 * further XSS fix: encode HTML special chars in description field

 Updated :  Following Asset Types Can Not Be previewed

   //   Template,CSElement, SiteEntry, AttributeEditor, Attributes,Definitions,
   //   Filters, Promotion, Segments, StyleSheets, Visitor Stuff

 Modified: March 09, 2011
 By:       JAG 
 Reason:   1)Added new property "cs_wrapperpage" to Publication  providing the
             ability in pub site edit mode
             to show the list of available wrapper pages and allow the user to select and
             assign the default wrapper page for that site.

           2)Cleaned up Insite preview asset functionality and
             asset parsing and formating.
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/ValidateInputForXSS" />
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
	<SCRIPT LANGUAGE="JavaScript">
	<![CDATA[

    var assetTypeArray = new Array( "Template","CSElement", "Visitor", "SiteEntry",
                                    "Attributes", "_D","Filters", "Promotion","Segments",
                                    "StyleSheets" ) ; 


	function checkfields()
	{
		var obj = document.forms[0];

		//Check for something wrong in the name
		if (typeof(obj.elements['Publication:name'])!='undefined') {
			var isclean = true;
			isclean = isCleanString(obj.elements['Publication:name'].value, '<\'">\\/&?;:',true);
			if (!isclean) {
				alert("]]><XLAT.STREAM KEY="dvin/UI/Admin/InvalidCharactersNotAllowedInSiteName" ESCAPE="true" ENCODE="false"/><![CDATA[");
				return false;
			}
			
			//trim leading/trailing spaces from name
			obj.elements['Publication:name'].value =
				obj.elements['Publication:name'].value.replace(/^\s*(.*?)\s*$/, '$1');
			
			if ( (obj.elements['Publication:name'].value.length == 0) ||
				 (obj.elements['Publication:name'].value.search(/\s/) != -1) ) {
	
				//Here means something is wrong, let us figure out what
				
				if ( obj.elements['Publication:name'].value.search(/\s/) != -1 ) {
				]]>
					alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/notusespaceinnamesite" ESCAPE="true" ENCODE="false"/>");
				<![CDATA[
				}
	
				if (obj.elements['Publication:name'].value.length == 0) {
				]]>
					alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/mustspecifynamesite" ESCAPE="true" ENCODE="false"/>");
				<![CDATA[
				}
	
				obj.elements['Publication:name'].focus();
				return false;
			}
		}
		if (typeof(obj.elements['Publication:description'])!='undefined') {
			//trim leading/trailing spaces from description
			obj.elements['Publication:description'].value =
				obj.elements['Publication:description'].value.replace(/^\s*(.*?)\s*$/, '$1');
			if (obj.elements['Publication:description'].value=="")
			{
			]]>
				alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/mustspecifydescriptionsite" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
				obj.elements['Publication:description'].focus();
				return false;
			}
		}
		return true;
	}
  
  // Updated: April 29, 2008
  //
  //   Preview all asset types except
  //   Template,CSElement, SiteEntry, AttributeEditor, Attributes,Definitions,
  //   Filters, Promotion, Segments, StyleSheets, Visitor Stuff
  function isPreviewAssetTypeNot ( assetType )
  {
    var valid = true ;
    for (var i = 0, l = assetTypeArray.length; i < l; i++)
    {
       if ( assetType.search(assetTypeArray[i] ) != -1 )
       {
           ]]>
             var xlatstr='<XLAT.STREAM KEY="dvin/UI/Error/selectionoftypeinvalid" ENCODE="false" ESCAPE="true"/>';
             var replacestr=/Variables.splitpair/;
             alert(xlatstr.replace(replacestr,assetType));
             <![CDATA[
             return false ;

       }
    }
    return true ;
  }


 function DecodeUTF8(encoded)
 {
   var i=0;
   var currentUnicode=0;
   var UnicodeString = new Array();
   var UnicodeIndex = 0;

   var currentState = "Start";

   for (i = 0; i<encoded.length;i+=2) {
       var twochars = encoded.substr(i,2);
       var currentByte = parseInt(twochars,16);

       // utf-8 representation may have up to 4 bytes per character
       if (currentState=="Start") {
           if ((currentByte & 0x80) != 0) {
               // if 1st 3 bits are 110 then 2 bytes
               if ((currentByte>>5) == 0x06) {
                   // 2 bytes - want 3 bits after 0xC0 as low 3 bits in first unicode byte
                   currentUnicode = (currentByte & 0x1C)>>2;

                   // 2 remaining bits of byte 1 become low bits of currentUnicode
                   currentUnicode = currentUnicode << 2;
                   currentUnicode = currentUnicode | (currentByte & 0x03);
                   currentState = "Done";
               }
               // if first 4 bits are 1110 then 3 bytes
               else if ((currentByte>>4) == 0x0E) {
                       currentUnicode = (currentByte & 0x0F);
                       currentState = "Middle1";
               }
               // if first 5 bits are 11110 then 4 bytes
               else if ((currentByte>>3) == 0x1E) {
                       currentUnicode = (currentByte & 0x07);
                       currentState = "Middle2";
               }
           }
           else
           {
               UnicodeString[UnicodeIndex] = currentByte;
               UnicodeIndex++;
           }
       }
       else if (currentState=="Done") {
           currentUnicode = currentUnicode << 6;
           currentUnicode = currentUnicode | (currentByte & 0x3F);
           UnicodeString[UnicodeIndex] = currentUnicode;
           UnicodeIndex++;
           currentState = "Start";
       }
       else if (currentState=="Middle1") {
           currentUnicode = currentUnicode << 6;
           currentUnicode = currentUnicode | (currentByte & 0x3F);
           currentState = "Done";
       }
       else if (currentState=="Middle2") {
           currentUnicode = currentUnicode << 6;
           currentUnicode = currentUnicode | (currentByte & 0x3F);
           UnicodeString[UnicodeIndex] = currentUnicode;
           UnicodeIndex++;
           currentState = "Middle1";
       }

   }
   var StringCode = "String.fromCharCode(";
   StringCode += UnicodeString[0];
   for (var y = 1; y < UnicodeIndex; y++) {
       StringCode+=","+UnicodeString[y];
   }
   StringCode += ");";

   return(eval(StringCode));
 }

 // Clears the Preview Asset
 function clearPreviewAsset ()
 {
   var obj = document.forms[0];     
   // Clear the preview Asset Field
   obj.elements['Publication:cs_previewasset'].value = "" ;
   //document.getElementById("AssetName").innerHTML = " ";
   document.forms[0].elements['AssetName'].value = '';
 }

  // preview asset buuton click validation
  // Consult and Validate  from the  Selected Tab / tree( Applet )
  // That the selected Asset os of appropriate Type to be previewed
  function getPrivewAssetFromTree()
  {
     var obj = document.forms[0];
	 var id,name;
	 var EncodedString = parent.frames["XcelTree"].document.TreeApplet.exportSelections()+'';
     var idArray = EncodedString.split(',');
     var assetcheck = unescape(idArray[0]);
     var assetName = idArray[1] ;

     if (assetcheck.indexOf('assettype=')!=-1 && assetcheck.indexOf('id=')!=-1)
     {
         // Make Sure the new CS_PRIVEWASSET Attribute is defined
          if (typeof(obj.elements['Publication:cs_previewasset'])!='undefined')
	      {
            var newStr = unescape(idArray[0]).split('=');
			var newStr1 = unescape(idArray[0]).split(',');
			var id = (newStr1[0].split('='))[1];
			var type = (newStr1[1].split('='))[1];
			var subtype = (newStr1[3].split('='))[1];
			var name = (newStr1[2].split('='))[1];
			name = name.replace(/\+/g," ");
			subtype = subtype.replace(/\+/g," ");
			type = type.replace(/\+/g," ");	
            // Need To Determine if Asset Type is previable
            goodTogo = isPreviewAssetTypeNot(type) ;
            if ( goodTogo )
            {
               var str2 = newStr[1].split(',');
               // Preview AssetType
               pos = idArray[1].indexOf(':') ;
               if ( pos != -1 )
               {
                 assetName = assetName.substring(0,pos) ;
                 assetName.replace(/\+/g,' ');
   			     assetName = DecodeUTF8(assetName);
   			   }
   			   //Drop The AssetName
               // Set the Publication Preview Asset
			   var prevAssetId = type + ":" + id + ":" + assetName;

               obj.elements['Publication:cs_previewasset'].value = prevAssetId ;

               // Display the Asset Name 
               document.forms[0].elements['AssetName'].value = assetName;
            }
          }
      }
      else
      {
      ]]>
      alert("<XLAT.STREAM KEY="dvin/UI/PleaseSelectAssetFromTree" ENCODE="false" ESCAPE="true"/>");
      <![CDATA[
      }
  }


	]]>
	</SCRIPT>
			
<!-- Check for page type of front -->


<IF COND="Variables.action=list">
<THEN>
<PROPERTY.GET PARAM="xcelelem.manageuserpub" INIFILE="futuretense_xcel.ini" VARNAME="propmanageuserpub"/>
<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<span class="title-text"><XLAT.STREAM KEY="dvin/Common/Sites"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
<IF COND="IsVariable.orderby!=true">
<THEN>
	<SETVAR NAME="orderby" VALUE="name"/>
</THEN>
</IF>
	<PUBLICATION.LIST LIST="ActivePub" ORDER="Variables.orderby"/>

	<callelement NAME="Variables.propmanageuserpub">
		<argument NAME="upcommand" VALUE="IsSystemAdmin"/>
		<argument NAME="username"  VALUE="SessionVariables.username"/>
		<argument NAME="qryprefix" VALUE="alldepts"/>
	</callelement>

	<callelement NAME="Variables.propmanageuserpub">
		<argument NAME="upcommand" VALUE="GetManager"/>
	</callelement>
	<setcounter NAME="CI" VALUE="0"/>

	<setvar NAME="dosites" VALUE="true"/>
	<if COND="Variables.UserManager=LDAP">
		<then>
			<if COND="Variables.IsSystemAdmin=true">
				<then>
					<setvar NAME="dosites" VALUE="false"/>
				</then>
			</if>
		</then>
	</if>

	<if COND="Variables.dosites=true">
	<then>

		<SETVAR NAME="errno" VALUE="0"/>
		<callelement NAME="Variables.propmanageuserpub">
			<argument NAME="upcommand" VALUE="GetManager"/>
		</callelement>
		<if COND="Variables.errno=0">
		<then>
		  <!-- If there are some publications... -->
			<if COND="IsList.ActivePub=true">
			<then>

			
			
				<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30">
					<tr>
						<td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
					</tr>
					<tr>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
						<td >
							<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="7" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							<tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
							<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
					            	<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
	                                                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
        	                                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                	                                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                        				    <satellite.argument name="action" value="list"/>
                                                        </SATELLITE.LINK>
	                                                <A HREF="Variables.urlsitefront" REPLACEALL="Variables.urlsitefront"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Name"/></DIV></A></td>
		  					<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
	                                                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlshowsites">
        	                                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                	                                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                	                                    <satellite.argument name="action" value="list"/>
                        				    <satellite.argument name="orderby" value="description"/>
                                                        </SATELLITE.LINK>
	                                                <A HREF="Variables.urlshowsites" REPLACEALL="Variables.urlshowsites"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Description"/></DIV></A></td>
								<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
							</tr>
							<tr><td colspan="7" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

					   			<setvar NAME="rowStyle" VALUE="tile-row-normal"/>
								<SETVAR NAME="separatorLine" VALUE="0"/>
															
							<USERMANAGER.GETLOGINUSERNAME VARNAME="currentUserName" />																					
							<USERMANAGER.GETUSERFROMNAME USERNAME="Variables.currentUserName" OBJVARNAME="userObj"/>

							<SETVAR NAME="userIsGeneralAdmin" VALUE="false" />
							<!-- Check if the current user has General Admin role in any one of the publications 
								If so, he can see all sites and manage them.
							-->
							<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/CheckIsUserAdmin">
							      <ARGUMENT NAME="adminRoleToCheck" VALUE="GeneralAdmin" />
							      <ARGUMENT NAME="userObject" VALUE="userObj" />
							</CALLELEMENT>	
							<!-- loop through the list of defined publications -->							
							<LOOP LIST="ActivePub">

									<IF COND="Variables.separatorLine=1">
									<THEN>
										<!--<tr>
											<td colspan="7" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
										</tr>-->
									</THEN>
									</IF>
									<SETVAR NAME="separatorLine" VALUE="1"/>
									<SETVAR NAME="userIsSiteAdmin" VALUE="false" />																		
									<PUBLICATION.LOAD NAME="publication" OBJECTID="ActivePub.id"/>
									<IF COND="Variables.userIsGeneralAdmin=false">
									<THEN>
										<!-- IF the current user does NOT have general admin role for any site,
											then we need to check if the user has Site admin role for this site to be 
											able to manage this site -->
										<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/CheckIsUserAdmin">
										      <ARGUMENT NAME="publicationId" VALUE="ActivePub.id"/>
										      <ARGUMENT NAME="adminRoleToCheck" VALUE="SiteAdmin" />
										      <ARGUMENT NAME="userObject" VALUE="userObj" />
										</CALLELEMENT>
									</THEN>
									<ELSE>
										<!--if the user has general admin role, we do not bother about his site admin role,
											we can simply show him all sites to edit and manage.
											Hence we set this variable simply as a controller to show/hide the current site -->
										<SETVAR NAME="userIsSiteAdmin" VALUE="true" />
									</ELSE>
									</IF>
									<IF COND="Variables.userIsSiteAdmin=true" >
									<THEN>
										<tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
										<td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
										<XLAT.LOOKUP KEY="dvin/Common/Inspect" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/InspectThisSite" VARNAME="_alt_"/>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                        							        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
							                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                        				<satellite.argument name="action" value="details"/>
				                                                        <satellite.argument name="pubid" value="ActivePub.id"/>
                                			                        </SATELLITE.LINK>
							                        <A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconInspectContent.gif"  border="0" alt="Variables._alt_" title="Variables._alt_"  REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A>
							           
										<XLAT.LOOKUP KEY="dvin/Common/Edit" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/EditThisSite" VARNAME="_alt_"/>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                        							        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
							                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                        				<satellite.argument name="action" value="edit"/>
				                                                        <satellite.argument name="pubid" value="ActivePub.id"/>
                                			                        </SATELLITE.LINK>
							                        <A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconEditContent.gif"  border="0" alt="Variables._alt_" title="Variables._alt_"  REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A>
                                        <IF COND="ActivePub.name=AdminSite">
                                        <THEN>
                                        </THEN>
                                        <ELSE>
										<XLAT.LOOKUP KEY="dvin/Common/Delete" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteThisSite" VARNAME="_alt_"/>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                        							        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
							                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                        				<satellite.argument name="action" value="confirmdelete"/>
				                                                        <satellite.argument name="pubid" value="ActivePub.id"/>
			                                                        </SATELLITE.LINK>
                        							<A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconDeleteContent.gif"  border="0" alt="Variables._alt_" title="Variables._alt_"  REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A>
								
                                        </ELSE>
                                        </IF>

										</td>
								                <td><BR /></td><td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
					                			<DIV class="small-text-inset">
											<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
												<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                            							<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
					                                                        <satellite.argument name="action" value="details"/>
                                        					                <satellite.argument name="pubid" value="ActivePub.id"/>
				                                                          </SATELLITE.LINK>
							                                  <A HREF="Variables.urlsitefront" REPLACEALL="Variables.urlsitefront"><STRING.STREAM LIST="ActivePub" COLUMN="name"/></A>
										</DIV>
										</td>
										<td><BR /></td><td VALIGN="TOP" ALIGN="LEFT">
										<DIV class="small-text-inset">
										<STRING.STREAM LIST="ActivePub" COLUMN="description"/>
										</DIV>
										</td>
							                 	<td><BR /></td></tr>
										<IF COND="Variables.rowStyle=tile-row-normal">
									            <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
									            </THEN>
									            <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
									            </ELSE>
			 							</IF>
			 							</THEN> <!-- End of the check for user is Site admin -->
										</IF>
							</LOOP>
							</table>
						</td>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
						</tr>
					<tr>
					<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
					</tr>
					<tr>
					<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
					</tr>
					</table> 


			</then>
			<else><XLAT.STREAM KEY="dvin/UI/Admin/NOpublications"/>
			</else>
			</if>
			<PUBLICATION.ALLOWEDTOADD VARNAME="checkvar"/>
			<IF COND="Variables.checkvar=true">
			<THEN>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="AddSiteFrontURL">
				    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                    <satellite.argument name="action" value="new"/>
                                </SATELLITE.LINK>
                 <div class="width-outer-70">               
				<A HREF="Variables.AddSiteFrontURL" REPLACEALL="Variables.AddSiteFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/AddNewSite"/></CALLELEMENT></A>
				</div>
			</THEN>
			</IF>
		</then>
		<else><XLAT.STREAM KEY="dvin/UI/Admin/NotamanagerQ"/>
		</else>
		</if>
	</then>
	<else><XLAT.STREAM KEY="dvin/UI/Admin/DonthavepermissionstoseethesitesQ"/>
	</else>
	</if>
</THEN>
</IF>
<!-- Check for details front -->

					<if COND="Variables.action=details">
						<then>

<!-- Load the publication record -->
                            <PUBLICATION.LOAD NAME="publication" OBJECTID="Variables.pubid"/>
							<PUBLICATION.SCATTER NAME="publication" PREFIX="Publication"/>
<!-- Extract the preview asset id and type-->
                            <IF COND="Variables.Publication:cs_previewasset!=Variables.empty">
                            <THEN>
								<STRINGLIST NAME="pa_tempList" STR="Variables.Publication:cs_previewasset" DELIM=":"/>
								<LOOP LIST="pa_tempList">
									<IF COND="pa_tempList.#curRow=1">
									<THEN>
										<SETVAR NAME="previewAssetType" VALUE="pa_tempList.ITEM"/>
									</THEN>
									<ELSE>
										<IF COND="pa_tempList.#curRow=2">
										<THEN>
											<SETVAR NAME="previewAssetId" VALUE="pa_tempList.ITEM"/>
										</THEN>
										</IF>
									</ELSE>
									</IF>
								</LOOP>

                               <!--
                                 Asset Load to get the Name of the Preview Asset  
                                -->
							<IF COND="IsVariable.previewAssetId=true">
							<THEN>
                               <ASSET.LOAD NAME="previewAsset" TYPE="Variables.previewAssetType" OBJECTID="Variables.previewAssetId"/>
							   <ASSET.GET NAME="previewAsset"  FIELD="name" OUTPUT="previewAssetName"/>
							</THEN>
							</IF>
                              </THEN>
                              <ELSE>
                                  <SETVAR NAME="previewAssetName" VALUE=""/>

                              </ELSE>
                            </IF>

                            <!--
                                site inspect has a wrapper page been selected
                             -->
                            <IF COND="Variables.Publication:cs_wrapperasset!=Variables.empty">
                            <THEN>
                               <STRINGLIST NAME="tempList" STR="Variables.Publication:cs_wrapperasset" DELIM=":"/>
                               <LOOP LIST="tempList">
                                    <IF COND="tempList.#curRow=1">
                                    <THEN>
                                        <SETVAR NAME="wrappertype" VALUE="tempList.ITEM"/>
                                    </THEN>
                                    <ELSE>
                                        <SETVAR NAME="wrapperid" VALUE="tempList.ITEM"/>
                                    </ELSE>
                                   </IF>
                                </LOOP>
                                <!--
                                   Asset Load to get the Name of the Wrapper Page 
                                  -->
                                <ASSET.LOAD NAME="wrapperAsset" TYPE="Variables.wrappertype" OBJECTID="Variables.wrapperid"/>
                                <ASSET.GET  NAME="wrapperAsset"  FIELD="name" OUTPUT="wrappername"/>

                             </THEN>
                             </IF>

                            <!-- Get the Wrapper Name -->
    <if COND="Variables.showtitle!=false">
								<then>
									<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
										<tr><td>
											<span class="title-text"><XLAT.STREAM KEY="dvin/Common/Site"/>: <STRING.STREAM VARIABLE="Publication:name"/></span>
										</td></tr>
										<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
									</table>
								</then>
								</if>

<!-- Display the publication details -->
<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-50 margin-top-zero">
	<tr><td>
		<table  class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<tr>
				<td class="form-label-text" colspan="3">
				<table class="legacyAbar" border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td><XLAT.LOOKUP KEY="dvin/Common/Inspect" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/InspectThisSite" VARNAME="_alt_"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="details"/>
                                                         <satellite.argument name="pubid" value="Variables.Publication:id"/>
                                                          </SATELLITE.LINK>
                    <A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" hspace="2" src="Variables.cs_imagedir/graphics/common/icon/iconInspectContentUp.gif"  border="0" alt="Variables._alt_" REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A></td>
					<td>
					<A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Inspect"/></span></A></td>
					<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
				<td><XLAT.LOOKUP KEY="dvin/Common/Edit" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/EditThisSite" VARNAME="_alt_"/>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="edit"/>
                                                         <satellite.argument name="pubid" value="Variables.Publication:id"/>
                                                          </SATELLITE.LINK>
                <A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" src="Variables.cs_imagedir/graphics/common/icon/iconEditContentUp.gif" hspace="2" border="0" alt="Variables._alt_" REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A></td>
					<td>
					<A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Edit"/></span></A></td>

				<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>

                <IF COND="Variables.Publication:name=AdminSite">
                <THEN>
                <td></td><td></td>   
                </THEN>
                <ELSE>
				<td><XLAT.LOOKUP KEY="dvin/Common/Delete" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteThisSite" VARNAME="_alt_"/>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="confirmdelete"/>
                                                         <satellite.argument name="pubid" value="Variables.Publication:id"/>
                                                          </SATELLITE.LINK>
                <A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><img height="14" width="14" src="Variables.cs_imagedir/graphics/common/icon/iconDeleteContentUp.gif" hspace="2" border="0" alt="Variables._alt_" REPLACEALL="Variables.cs_imagedir,Variables._alt_"/></A></td>
					<td>
					<A HREF="Variables.urlsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsitefront,Variables._XLAT_"><span class="action-text"><XLAT.STREAM KEY="dvin/Common/Delete"/></span></A></td>
                </ELSE>
                </IF>		
				</tr>
			</table>
				</td>
			</tr>
						
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:name"/>
				</td>
			</tr>
			
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Description"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:description"/>
				</td>
			</tr>
			
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PublicationID"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:id"/>
				</td>
			</tr>

		   <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
		   <tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PreviewGen"/>:
				</td>
				<td class="form-inset">
                    <IF COND="Variables.Publication:cs_preview=Variables.empty">
					<THEN>
						<PROPERTY.GET PARAM="xcelerate.defaultpreviewurlgenerator" INIFILE="futuretense_xcel.ini" VARNAME="Publication:cs_preview"/>
						<SETVAR NAME="name" VALUE="Variables.Publication:cs_preview"/>
						<SELECTTO LIST="previewdescription" FROM="Previewgen" WHAT="*" WHERE="name"/>
						<XLAT.STREAM KEY="dvin/Common/Usedefault"/> (<XLAT.STREAM KEY="fatwire/admin/previewgen/previewdescription.name"/>)
					</THEN>
					<ELSE>
						<SETVAR NAME="name" VALUE="Variables.Publication:cs_preview"/>
						<SELECTTO LIST="previewdescription" FROM="Previewgen" WHAT="*" WHERE="name"/>
						<XLAT.STREAM KEY="fatwire/admin/previewgen/previewdescription.name"/>
					</ELSE>
					</IF>
				</td>
			</tr>

            <!-- Display the Wrapper Page -->
              <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			  <tr>
                       <td class="form-label-text">
                          <XLAT.STREAM KEY="dvin/AT/SiteEntry/wrapperpage"/>
                       </td>
                       <td class="form-inset">
                       		<STRING.STREAM VARIABLE="wrappername"/>
                       </td>
                 </tr>

			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Users"/>:
				</td>
				<td class="form-inset">
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/User/List" outstring="urluserlist">
                      <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                      <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                      <satellite.argument name="action" value="ask"/>
                      <satellite.argument name="pubid" value="Variables.Publication:id"/>
                    </SATELLITE.LINK>
                  <A HREF="Variables.urluserlist" REPLACEALL="Variables.urluserlist"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/Manageusersforthissite"/></A>
				</td>
			</tr>			
			
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/EnabledAssetTypes"/>:
				</td>
				<td class="form-inset" NOWRAP="NOWRAP">
					<CALLELEMENT NAME="OpenMarket/Xcelerate/Admin/ListSiteAssetTypes">
					<ARGUMENT NAME="pubid" VALUE="Variables.Publication:id"/>
					<ARGUMENT NAME="doCheck" VALUE="false"/>
					<ARGUMENT NAME="action" VALUE="revoke"/>
					</CALLELEMENT>
					<SETVAR NAME="action" VALUE="details"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetTypePubFront" outstring="AssetFrontURL">
					    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
	                  <satellite.argument name="pubid" value="Variables.pubid"/>
	                  <satellite.argument name="action" value="grant"/>
	                   </SATELLITE.LINK>
					<table><tr><td>
					<A HREF="Variables.AssetFrontURL" REPLACEALL="Variables.AssetFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/EnableAssetTypes_"/></CALLELEMENT></A>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetTypePubFront" outstring="AssetFrontURL">
					    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                         <satellite.argument name="pubid" value="Variables.pubid"/>
                         <satellite.argument name="action" value="revoke"/>
                    </SATELLITE.LINK>
					</td><td>
					<A HREF="Variables.AssetFrontURL" REPLACEALL="Variables.AssetFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/DisableAssetTypes_"/></CALLELEMENT></A>
					</td></tr></table>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/StartMenuFront" outstring="StartMenuFrontURL">
					    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
						<satellite.argument name="pubid" value="Variables.pubid"/>
						<satellite.argument name="op" value="list"/>
					</SATELLITE.LINK>
					<A HREF="Variables.StartMenuFrontURL" REPLACEALL="Variables.StartMenuFrontURL"><XLAT.STREAM KEY="dvin/UI/Admin/ListallStartMenuItemsforthissite"/></A>
				</td>
			</tr>			
			
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/Admin/WorkflowProcesses"/>:
				</td>
				<td class="form-inset">
                        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/WorkflowProcessListFront" outstring="workflowlistfront">
                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                     <satellite.argument name="pubid" value="Variables.pubid"/>
                                     <satellite.argument name="action" value="list"/>
                                      </SATELLITE.LINK>
						<A HREF="Variables.workflowlistfront" REPLACEALL="Variables.workflowlistfront"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/ListallWorkflowProcessesForSite"/></A>
				</td>
			</tr>	

			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/CSDesktop"/>:
				</td>
				<td class="form-inset">
                        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/AssetTypeClientFront" outstring="urlasttypclientfront">
                            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                     <satellite.argument name="pubid" value="Variables.pubid"/>
                                     <satellite.argument name="action" value="list"/>
                                     <satellite.argument name="clientapp" value="MSWord"/>
                                      </SATELLITE.LINK>
						<A HREF="Variables.urlasttypclientfront" REPLACEALL="Variables.urlasttypclientfront"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/ConfigureCSDesktopforthissite"/></A>
				</td>
			</tr>
			
			<!--To manage Site Plans-->
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/UI/SitePlan"/>:
				</td>
				<td class="form-inset">
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteplanAdminForm" outstring="siteplanadminform">
						<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
						<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
						<satellite.argument name="pubid" value="Variables.pubid"/>
						<satellite.argument name="tool" value="SiteplanMgt"/>
						<satellite.argument name="form" value="Home"/>
					</SATELLITE.LINK>
					<A HREF="Variables.siteplanadminform" REPLACEALL="Variables.siteplanadminform"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/ManageSitePlans"/></A>
					<BR/>
					<XLAT.LOOKUP KEY="dvin/TreeApplet/Commands/OrderSiteplan" ENCODE="false" VARNAME="_ordersiteplan_"/>
					<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ordersiteplan">
						<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
						<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
						<satellite.argument name="pubid" value="Variables.pubid"/>
						<satellite.argument name="p0_" value="ROOT"/>
						<satellite.argument name="op" value="Variables._ordersiteplan_"/>
						<satellite.argument name="AssetType" value="Page"/>
					</SATELLITE.LINK>
					<A HREF="Variables.ordersiteplan" REPLACEALL="Variables.ordersiteplan"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/OrderSitePlans"/></A>
				</td>
			</tr>
			
			<!-- if there are any mirror targets for this site, add link to allow mirror of configuration information -->
			<PUBTARGETMANAGER.Find PUBID="Variables.pubid" DELIVERYTYPE="mirror,realtime" PREFIX="pubtgt:"/>
			<if COND="Variables.pubtgt:Total!=0">
			<then>
				<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				<tr>
					<td class="form-label-text">
						<XLAT.STREAM KEY="dvin/UI/Admin/PublishDestinations"/>:
					</td>
					<td class="form-inset">
						<SETCOUNTER NAME="nth" VALUE="0"/>
						<LOOP COUNT="Variables.pubtgt:Total">
							<PUBTARGET.SCATTER NAME="pubtgt:Counters.nth" PREFIX="tgt:"/>
							<XLAT.LOOKUP KEY="dvin/Admin/MirrorSiteConfiguration" VARNAME="_XLAT_" ESCAPE="true"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/MirrorSiteFront" outstring="urlmirsitefront">
                                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                     <satellite.argument name="pubid" value="Variables.pubid"/>
                                     <satellite.argument name="target" value="Variables.tgt:id"/>
                                      </SATELLITE.LINK>
                            <A HREF="Variables.urlmirsitefront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlmirsitefront,Variables._XLAT_">
							<IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/>
							<setvar NAME="pubtgt" VALUE="Variables.tgt:name"/>
							<XLAT.STREAM KEY="dvin/Admin/MirrorSiteConfigurationfor"/>
							</A><br/>
							<INCCOUNTER NAME="nth" VALUE="1"/>
						</LOOP>
					</td>
				</tr>
			</then>
			</if>
							
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	
			<!--  add link to make this publication a sitebuilder source -->
		<PUBLICATION.ALLOWEDTOADD VARNAME="checkvar"/>
		<!-- Check to see if more sites could be added. If so show the link to launch a copy, or hide the link -->
		<IF COND="Variables.checkvar=true">
		<THEN>	
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/CSSiteBuilder/WizardName:"/>
				</td>
				<td class="form-inset">
						<!-- If this is a prototype sites, then include link to launch the site replicator -->
						<IF COND="Variables.Publication:cs_prefix!=Variables.empty">
						<THEN>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteBuilder/SiteLauncherFront" outstring="sitebuilderfront">
								<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
								<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
								<satellite.argument name="PostPage" value="SiteLauncherPost"/>
								<satellite.argument name="pubid" value="Variables.Publication:id"/>
							</SATELLITE.LINK>
							 <XLAT.LOOKUP KEY="dvin/CSSiteBuilder/LaunchASite" VARNAME="_XLAT_" ESCAPE="true"/><XLAT.LOOKUP KEY="dvin/CSSiteBuilder/LaunchASite" VARNAME="_alt_"/>
				          	<A HREF="Variables.sitebuilderfront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.sitebuilderfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/LaunchCopy_"/></CALLELEMENT></A>
						</THEN>
						</IF>
						
						<XLAT.LOOKUP KEY="dvin/CSSiteBuilder/MakeASiteBuilderSite" VARNAME="_XLAT_" ESCAPE="true"/>
						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteBuilder/SitePrototypeFront" outstring="urlsiteprotofront">
                             <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                             <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                  <satellite.argument name="pubid" value="Variables.pubid"/>
                                   </SATELLITE.LINK>
                         <A HREF="Variables.urlsiteprotofront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlsiteprotofront,Variables._XLAT_">
						<IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/>
						<XLAT.STREAM KEY="dvin/CSSiteBuilder/UseSiteWithSitebuilder"/>
						</A>
				</td>
			</tr>			
	  	</THEN>
		</IF>		
	</table>
	</td></tr>
</table>
<DIV class="width-outer-70">
    <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="urlsitefront">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                         <satellite.argument name="action" value="list"/>
                                                          </SATELLITE.LINK>
    <A HREF="Variables.urlsitefront" REPLACEALL="Variables.urlsitefront"><IMG src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" WIDTH="15" HEIGHT="12" BORDER="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/Admin/Listallsites"/></A>
</DIV>
									</then>

<!-- Otherwise, check for edit front -->

						<else> <if COND="Variables.action=edit"> <then>

                            <!-- Load the publication record -->
							<PUBLICATION.LOAD NAME="publication" OBJECTID="Variables.pubid"/>
							<PUBLICATION.SCATTER NAME="publication" PREFIX="Publication"/>

                             <!--
                                 site yoda-edit get All  wrapper pages
                                 that are  available to be assigned and set as the default
                              -->
                             <IF COND="Variables.Publication:cs_wrapperasset!=Variables.empty">
					  	     <THEN>
                                <STRINGLIST NAME="tempList" STR="Variables.Publication:cs_wrapperasset" DELIM=":"/>
                                <LOOP LIST="tempList">
                                   <IF COND="tempList.#curRow=2">
                                   <THEN>
                                       <SETVAR NAME="wrapperid" VALUE="tempList.ITEM"/>
                                   </THEN>
                                   <ELSE>
                                       <SETVAR NAME="wrappertype" VALUE="tempList.ITEM"/>
                                   </ELSE>
                                   </IF>
                                </LOOP>
                              </THEN>
                             </IF>
                  
<!-- Extract the preview asset id and type-->
                           <IF COND="Variables.Publication:cs_previewasset!=Variables.empty">
                           <THEN>
                            <STRINGLIST NAME="pa_tempList" STR="Variables.Publication:cs_previewasset" DELIM=":"/>
							<LOOP LIST="pa_tempList">
								<IF COND="pa_tempList.#curRow=1">
								<THEN>
									<SETVAR NAME="previewAssetType" VALUE="pa_tempList.ITEM"/>
								</THEN>
								<ELSE>
									<IF COND="pa_tempList.#curRow=2">
									<THEN>
										<SETVAR NAME="previewAssetId" VALUE="pa_tempList.ITEM"/>
									</THEN>
									</IF>
								</ELSE>
								</IF>
							</LOOP>
							<IF COND="IsVariable.previewAssetId=true">
							<THEN>
								<ASSET.LOAD NAME="previewAsset" TYPE="Variables.previewAssetType" OBJECTID="Variables.previewAssetId"/>
								<ASSET.GET NAME="previewAsset"  FIELD="name" OUTPUT="previewAssetName"/>
							</THEN>
							</IF>							
							
                         </THEN>
                         <ELSE>
                             <SETVAR NAME="previewAssetName" VALUE="CS.Empty"/>
                         </ELSE>
                         </IF> 

<!-- Display the edit form -->
                            <STRING.ENCODE VARIABLE="pubid" VARNAME="pubid"/>
                            <INPUT type="HIDDEN" NAME="pubid" VALUE="Variables.pubid" REPLACEALL="Variables.pubid"/>
<!-- ******** -->
<IF COND="Variables.showtitle!=false">
<THEN>
<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/EditSite"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
</THEN>
</IF>

<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-50">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset" colspan="2">
					<STRING.STREAM VARIABLE="Publication:name"/>
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Description"/>:
				</td>
				<td class="form-inset" colspan="2">
					<SETVAR NAME="OutputQString" VALUE="Variables.empty"/>
					<STRING.ENCODE VARIABLE="Publication:description" VARNAME="OutputQString"/>
					<INPUT TYPE="TEXT" SIZE="32" MAXLENGTH="64" NAME="Publication:description" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
				</td>
			</tr>
 			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr >
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PublicationID"/>:
				</td>
				<td class="form-inset" colspan="2">
					<STRING.STREAM VARIABLE="Publication:id"/>
				</td>
			</tr>

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PreviewGen"/>:
				</td>
				<SELECTTO LIST="previewgens" FROM="Previewgen" WHAT="*"/>
				<PROPERTY.GET PARAM="xcelerate.defaultpreviewurlgenerator" INIFILE="futuretense_xcel.ini" VARNAME="name"/>
				<SELECTTO LIST="defaultpreview" FROM="Previewgen" WHAT="*" WHERE="name"/>
				<td class="form-inset" colspan="2">
					<select NAME="Publication:cs_preview" style="min-width: 208px">
						<IF COND="Variables.Publication:cs_preview=Variables.empty">
						<THEN>
							<option value="" selected="true"/><XLAT.STREAM KEY="dvin/Common/Usedefault"/> (<XLAT.STREAM KEY="fatwire/admin/previewgen/defaultpreview.name"/>)
						</THEN>
						<ELSE>
							<option value=""/><XLAT.STREAM KEY="dvin/Common/Usedefault"/> (<XLAT.STREAM KEY="fatwire/admin/previewgen/defaultpreview.name"/>)
						</ELSE>
						</IF>
						<LOOP LIST="previewgens">
							<IF COND="Variables.Publication:cs_preview=previewgens.name">
							<THEN>
								<option value="previewgens.name" selected="true" REPLACEALL="previewgens.name"/><XLAT.STREAM KEY="fatwire/admin/previewgen/previewgens.name"/>
							</THEN>
							<ELSE>
								<option value="previewgens.name" REPLACEALL="previewgens.name"/><XLAT.STREAM KEY="fatwire/admin/previewgen/previewgens.name"/>
							</ELSE>
							</IF>
						</LOOP>
					</select>
				</td>
			</tr>


                <!--
                    The Available Wrapper Pages available for the user to be selected as default
                 -->
                <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				<tr>
                      <td class="form-label-text" NOWRAP="NOWRAP" size="32">
                            <XLAT.STREAM KEY="dvin/AT/SiteEntry/wrapperpage"/>
                      </td>
                       <!--
                          Get The List of Available Wrapper Pages
                         -->
                       <ASSET.LIST LIST="Wrappers" TYPE="SiteEntry" FIELD1="cs_wrapper" VALUE1="y"/>
                       <IF COND="IsList.Wrappers=true">
                       <THEN>
	                      <IF COND="Wrappers.#numRows!=0">
	                      <THEN>
                            <td class="form-inset" colspan="2">
                                <SELECT name="Publication:cs_wrapperasset" size="1" style="min-width: 208px">
								  <LOOP LIST="Wrappers">
                                     <IF COND="Variables.wrapperid=Wrappers.id">
                                     <THEN>
                                        <OPTION VALUE="SiteEntry:Wrappers.id" SELECTED="yes" REPLACEALL="Wrappers.id,Wrappers.name"/><STRING.STREAM LIST="Wrappers" COLUMN="name"/>
                                     </THEN>
                                     <ELSE>
                                        <OPTION VALUE="SiteEntry:Wrappers.id" REPLACEALL="Wrappers.id,Wrappers.name"/><STRING.STREAM LIST="Wrappers" COLUMN="name"/>
                                     </ELSE>
                                     </IF>
                                  </LOOP>
                                 </SELECT>
                        	</td>
                     </THEN>
                      </IF>
                   </THEN>
                   </IF>
                </tr>
				<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/SitePost"/>
				<INPUT TYPE="HIDDEN" NAME="action" VALUE="edit"/>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="AdminSiteFrontURL">
					<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
					<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
					 <satellite.argument name="action" value="details"/>
					 <satellite.argument name="pubid" value="Variables.pubid"/>
					  </SATELLITE.LINK>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
					<TR>
						<TD class="form-label-text"></TD><TD></TD><TD class="form-inset">
							<A HREF="Variables.AdminSiteFrontURL" REPLACEALL="Variables.AdminSiteFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A><XLAT.LOOKUP KEY="dvin/UI/SaveSite" VARNAME="_XLAT_" ESCAPE="true"/>
							<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Save"/></CALLELEMENT></A>	  
						</TD>
					</TR>
           </table>
	</td></tr>
</table>
							
						</then>

<!-- Otherwise, check for new front -->

						<else> 
						<if COND="Variables.action=new"> <then>
						<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
							<tr><td>
								<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/AddNewSite"/></span>
							</td></tr>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
						</table>
	
<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="TEXT" SIZE="32" MAXLENGTH="255" NAME="Publication:name"/>
				</td>
			</tr>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<span class="alert-color">*</span><XLAT.STREAM KEY="dvin/Common/Description"/>:
				</td>
				<td class="form-inset">
					<INPUT TYPE="TEXT" SIZE="32" MAXLENGTH="64" NAME="Publication:description"/>
				</td>
			</tr>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PreviewGen"/>:
				</td>
				<SELECTTO LIST="previewgens" FROM="Previewgen" WHAT="*"/>
				<PROPERTY.GET PARAM="xcelerate.defaultpreviewurlgenerator" INIFILE="futuretense_xcel.ini" VARNAME="name"/>
				<SELECTTO LIST="defaultpreview" FROM="Previewgen" WHAT="*" WHERE="name"/>
				<td class="form-inset">
					<select NAME="Publication:cs_preview">
						<IF COND="Variables.Publication:cs_preview=Variables.empty">
						<THEN>
							<option value="" selected="true"/><XLAT.STREAM KEY="dvin/Common/Usedefault"/> (<XLAT.STREAM KEY="fatwire/admin/previewgen/defaultpreview.name"/>)
						</THEN>
						<ELSE>
							<option value=""/><XLAT.STREAM KEY="dvin/Common/Usedefault"/> (<XLAT.STREAM KEY="fatwire/admin/previewgen/defaultpreview.name"/>)
						</ELSE>
						</IF>
						<LOOP LIST="previewgens">
							<IF COND="Variables.Publication:cs_preview=previewgens.name">
							<THEN>
								<option value="previewgens.name" selected="true" REPLACEALL="previewgens.name"/><XLAT.STREAM KEY="fatwire/admin/previewgen/previewgens.name"/>
							</THEN>
							<ELSE>
								<option value="previewgens.name" REPLACEALL="previewgens.name"/><XLAT.STREAM KEY="fatwire/admin/previewgen/previewgens.name"/>
							</ELSE>
							</IF>
						</LOOP>
					</select>
				</td>
			</tr>
			
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="AdminSiteFrontURL">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
				<satellite.argument name="action" value="list"/>
			</SATELLITE.LINK>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/SitePost"/>
					<INPUT TYPE="HIDDEN" NAME="action" VALUE="new"/>
					<A HREF="Variables.AdminSiteFrontURL" REPLACEALL="Variables.AdminSiteFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					<XLAT.LOOKUP KEY="dvin/UI/Admin/AddNewSite" VARNAME="_XLAT_" ESCAPE="true"/>
					<A HREF="javascript:void(0);" onClick="if(checkfields()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/AddSite"/></CALLELEMENT></A>
				</TD>
			</TR>
		</table>
	</td></tr>
</table>

						</then>
						
						<else><if COND="Variables.action=confirmdelete">
						<then>
<!-- Load the publication record -->

							<PUBLICATION.LOAD NAME="publication" OBJECTID="Variables.pubid"/>
							<PUBLICATION.SCATTER NAME="publication" PREFIX="Publication"/>
						<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
							<tr><td>
								<span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/DeleteSite"/></span>
							</td></tr>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
						</table>
							
						<XLAT.LOOKUP KEY="dvin/UI/Admin/AreyousuredeletesiteQ" VARNAME="_msgtext_"/>
					<div class="width-outer-70">
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
						<argument NAME="msgtext" VALUE="Variables._msgtext_"/>
						<argument NAME="severity" VALUE="warning"/>
					</callelement>		
					</div>					
							
	<table BORDER="0" CELLSPACING="0" CELLPADDING="0" class="width-outer-30">
	<tr><td>
		<table class="width-inner-100" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Name"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:name"/>
				</td>
			</tr>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Description"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:description"/>
				</td>
			</tr>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text">
					<XLAT.STREAM KEY="dvin/Common/Description"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="Publication:description"/>
				</td>
			</tr>
            
           <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/UI/Admin/PublicationID"/>:
				</td>
				<td class="form-inset">
					<STRING.ENCODE VARIABLE="Publication:id" VARNAME="Publication:id"/>
					<INPUT TYPE="HIDDEN" NAME="pubid" VALUE="Variables.Publication:id" REPLACEALL="Variables.Publication:id"/>
					<CSVAR NAME="Variables.Publication:id"/>
				</td>
			</tr>
			<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Admin/SiteFront" outstring="AdminSiteFrontURL">
				<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
				 <satellite.argument name="action" value="details"/>
				 <satellite.argument name="pubid" value="Variables.pubid"/>
			</SATELLITE.LINK>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
			<TR>
				<TD class="form-label-text"></TD><TD class="form-inset">
					<A HREF="Variables.AdminSiteFrontURL" REPLACEALL="Variables.AdminSiteFrontURL"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A><XLAT.LOOKUP KEY="dvin/UI/Admin/DeleteSite" VARNAME="_XLAT_" ESCAPE="true"/>
					<A HREF="javascript:void(0);" onclick="document.forms['AppForm'].submit(); return false;" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/DeleteSite"/></CALLELEMENT></A>
				</TD>
			</TR>		
		</table>
	</td></tr>
</table>


<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="OpenMarket/Xcelerate/Admin/SitePost"/>
<INPUT TYPE="HIDDEN" NAME="action" VALUE="delete"/>
				
<!-- end confirm delete -->												
						</then>
</if>
</else>
						</if> </else> </if> </else>
			</if>


</FTCS>
