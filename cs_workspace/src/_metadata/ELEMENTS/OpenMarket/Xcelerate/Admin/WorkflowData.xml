<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Admin/WorkflowData
-
- INPUT
-
- OUTPUT
-
HISTORY
 [2008-02-25 KGF]
 * XSS fix: encode HTML special chars in description field
-->

<!-- **************************************************************************************** -->
<if COND="Variables.DataAction=hiddenvariables">
<then>
	<!-- Put data corresponding to a scattered workflow process into hidden variables for posting.  This is done in addition
		to any changes that are made as a result of a form's data being posted as well.  The implication is that form data
		must be preferentially used instead of these hidden values.  That functionality can be found in other DataAction
		methods, further below.
	-->
	
	<!-- The meaning of the "new" variable is certainly questionable.  Should we get rid of it entirely? -->
	<STRING.ENCODE VARIABLE="new" VARNAME="new"/>
	<INPUT TYPE="HIDDEN" NAME="new" VALUE="Variables.new" REPLACEALL="Variables.new"/>
    
	<if COND="IsVariable.wfp:description!=true">
	<then>
		<!-- <setvar NAME="wfp:description" VALUE="Variables.null"/>  -->
	</then>
	<else>
		<SETVAR NAME="OutputQString" VALUE="Variables.empty"/>
		<STRING.ENCODE VARIABLE="wfp:description" VARNAME="OutputQString"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:description" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
	</else>
	</if>
    
	<if COND="IsVariable.wfp:name!=true">
	<then>
		<!-- <setvar NAME="wfp:name" VALUE="Variables.null"/>   -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:name" VARNAME="wfp:nameEnc"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:name" VALUE="Variables.wfp:nameEnc" REPLACEALL="Variables.wfp:nameEnc"/>
	</else>
	</if>
    
	<if COND="IsVariable.wfp:id!=true">
	<then>
		<!-- <setvar NAME="wfp:id" VALUE="Variables.null"/>  -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:id" VARNAME="wfp:id"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:id" VALUE="Variables.wfp:id" REPLACEALL="Variables.wfp:id"/>
	</else>
	</if>


	<if COND="IsVariable.wfp:startstep!=true">
	<then>
		<!-- <setvar NAME="wfp:startstep" VALUE="Variables.null"/>      -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:startstep" VARNAME="wfp:startstep"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:startstep" VALUE="Variables.wfp:startstep" REPLACEALL="Variables.wfp:startstep"/>
	</else>
	</if>


	<if COND="IsVariable.wfp:sitessites!=true">
	<then>
		<!-- <setvar NAME="wfp:sitessites" VALUE="Variables.null"/> -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:sitessites" VARNAME="wfp:sitessites"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:sitessites" VALUE="Variables.wfp:sitessites" REPLACEALL="Variables.wfp:sitessites"/>
	</else>
	</if>

	<if COND="IsVariable.wfp:typestypes!=true">
	<then>
		<!--  <setvar NAME="wfp:typestypes" VALUE="Variables.null"/>  -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:typestypes" VARNAME="wfp:typestypes"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:typestypes" VALUE="Variables.wfp:typestypes" REPLACEALL="Variables.wfp:typestypes"/>
	</else>
	</if>

	<if COND="IsVariable.wfp:rolesroles!=true">
	<then>
		<!--  <setvar NAME="wfp:rolesroles" VALUE="Variables.null"/>     -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:rolesroles" VARNAME="wfp:rolesroles"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:rolesroles" VALUE="Variables.wfp:rolesroles" REPLACEALL="Variables.wfp:rolesroles"/>
	</else>
	</if>

	<if COND="IsVariable.wfp:adminsroles!=true">
	<then>
		<!-- <setvar NAME="wfp:adminsroles" VALUE="Variables.null"/> -->
	</then>
	<else>
		<STRING.ENCODE VARIABLE="wfp:adminsroles" VARNAME="wfp:adminsroles"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:adminsroles" VALUE="Variables.wfp:adminsroles" REPLACEALL="Variables.wfp:adminsroles"/>
	</else>
	</if>

	<!-- deadlinetype -->
	<STRING.ENCODE VARIABLE="wfp:deadlinetype" VARNAME="wfp:deadlinetype"/>
	<INPUT TYPE="HIDDEN" NAME="wfp:deadlinetype" VALUE="Variables.wfp:deadlinetype" REPLACEALL="Variables.wfp:deadlinetype"/>

	<!-- delegation actions -->
	<setcounter NAME="DLGACTIONS" VALUE="0"/>
	<setvar NAME="actions" VALUE="Variables.empty"/>
	<if COND="IsVariable.wfp:actionsactionTotal=true">
	<then>
		<STRING.ENCODE VARIABLE="wfp:actionsactionTotal" VARNAME="wfp:actionsactionTotal"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:actionsactionTotal" VALUE="Variables.wfp:actionsactionTotal" REPLACEALL="Variables.wfp:actionsactionTotal"/>
		<if COND="Variables.wfp:actionsactionTotal!=0">
		<then>
			<loop FROM="0" COUNT="Variables.wfp:actionsactionTotal">
				<setvar NAME="tmp" VALUE="Variables.wfp:actionsactionCounters.DLGACTIONS"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp"/>
				<INPUT TYPE="HIDDEN" NAME="wfp:actionsactionCounters.DLGACTIONS" VALUE="Variables.tmp" REPLACEALL="Counters.DLGACTIONS,Variables.tmp"/>
				<setvar NAME="actions" VALUE="Variables.actions;Variables.wfp:actionsactionCounters.DLGACTIONS"/>
				<inccounter NAME="DLGACTIONS" VALUE="1"/>
	 		</loop>
			<substring STR="Variables.actions" OUTSTR="dlgactions" INDEX="1"/>
			<!--INPUT TYPE="HIDDEN" NAME="dlgactions" VALUE="Variables.dlgactions" REPLACEALL="Variables.dlgactions"/-->
		</then>
		</if>
	</then>
	</if><!-- dlgactions -->


	<!-- functionprivs -->
	<setcounter NAME="FUNCTIONPRIVS" VALUE="0"/>
	<if COND="IsVariable.wfp:privsprivTotal=true">
	<then>		
		<STRING.ENCODE VARIABLE="wfp:privsprivTotal" VARNAME="wfp:privsprivTotal"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:privsprivTotal" VALUE="Variables.wfp:privsprivTotal" REPLACEALL="Variables.wfp:privsprivTotal"/>
		<if COND="Variables.wfp:privsprivTotal!=0">
		<then>
			<loop FROM="0" COUNT="Variables.wfp:privsprivTotal">
				<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.FUNCTIONPRIVSfunction"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp"/>
				<INPUT TYPE="HIDDEN" NAME="wfp:privsprivCounters.FUNCTIONPRIVSfunction" VALUE="Variables.tmp" REPLACEALL="Counters.FUNCTIONPRIVS,Variables.tmp"/>
				<!-- state can be empty. This requires special handling -->
				<removevar NAME="tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.FUNCTIONPRIVSstate"/>
				<setvar NAME="errno" VALUE="0"/>
				<begins STR="Variables.tmp" WHAT="Variables"/>
				<if COND="Variables.errno=1">
				<then>
					<setvar NAME="Variables.tmp" VALUE="0"/>
					<setvar NAME="tmp" VALUE="0"/>
				</then>
				</if>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp"/>
				<INPUT TYPE="HIDDEN" NAME="wfp:privsprivCounters.FUNCTIONPRIVSstate" VALUE="Variables.tmp" REPLACEALL="Counters.FUNCTIONPRIVS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.FUNCTIONPRIVSrole"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp"/>
				<INPUT TYPE="HIDDEN" NAME="wfp:privsprivCounters.FUNCTIONPRIVSrole" VALUE="Variables.tmp" REPLACEALL="Counters.FUNCTIONPRIVS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:privsprivCounters.FUNCTIONPRIVSallowed"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp"/>
				<INPUT TYPE="HIDDEN" NAME="wfp:privsprivCounters.FUNCTIONPRIVSallowed" VALUE="Variables.tmp" REPLACEALL="Counters.FUNCTIONPRIVS,Variables.tmp"/>
				<inccounter NAME="FUNCTIONPRIVS" VALUE="1"/>
			</loop>
		</then>
		</if>
	</then>
	</if>


	<!-- steps -->
   	<setvar NAME="stepsTotal" VALUE="Variables.wfp:stepsTotal"/>

	<if COND="IsVariable.wfp:stepsTotal=true">
	<then>
		<STRING.ENCODE VARIABLE="wfp:stepsTotal" VARNAME="wfp:stepsTotal"/>
		<INPUT TYPE="HIDDEN" NAME="wfp:stepsTotal" VALUE="Variables.wfp:stepsTotal" REPLACEALL="Variables.wfp:stepsTotal"/>
		<if COND="Variables.wfp:stepsTotal!=0">
		<then>
			<setcounter NAME="NUMSTEPS" VALUE="0"/>
			<setvar NAME="stpnames" VALUE="Variables.empty"/>
			<loop FROM="0" COUNT="Variables.wfp:stepsTotal">
				<setvar NAME="stpnames" VALUE="Variables.stpnames;Variables.wfp:stepsCounters.NUMSTEPSname"/>
				<setvar NAME="NUMSTEPS" VALUE="Counters.NUMSTEPS"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSid"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSid" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSname"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSname" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>

				<!-- authroles can be empty. This requires special handling -->
				<removevar NAME="tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSauthrolesroles"/>

				<setvar NAME="errno" VALUE="0"/>
				<begins STR="Variables.tmp" WHAT="Variables"/>
				<if COND="Variables.errno=1">
				<then>
					<!--<setvar NAME="wfp:stepsCounters.NUMSTEPSauthrolesroles" VALUE="Variables.null"/>
					<setvar NAME="tmp" VALUE="Variables.null"/> -->
				</then>
				<else>
					<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
					<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSauthrolesroles" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				</else>
				</if>
     
				<!-- notifyroles can be empty. This requires special handling -->
				<removevar NAME="tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSnotifyrolesroles"/>

				<setvar NAME="errno" VALUE="0"/>
				<begins STR="Variables.tmp" WHAT="Variables."/>
				<if COND="Variables.errno=1">
				<then>
					<!-- <setvar NAME="wfp:stepsCounters.NUMSTEPSnotifyrolesroles" VALUE="Variables.null"/>
					<setvar NAME="tmp" VALUE="Variables.null"/> -->
				</then>
				<else>
					<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
					<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSnotifyrolesroles" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				</else>
				</if>
		    
				<!-- startstate can be empty. This requires special handling -->
				<removevar NAME="tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSstartstate"/>
				<setvar NAME="errno" VALUE="0"/>
				<begins STR="Variables.tmp" WHAT="Variables."/>
				<if COND="Variables.errno=1">
				<then>
					<!-- <setvar NAME="wfp:stepsCounters.NUMSTEPSstartstate" VALUE="Variables.null"/>
					<setvar NAME="tmp" VALUE="Variables.null"/>     -->
				</then>
				<else>
					<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
					<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSstartstate" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				</else>
				</if>
				
				<!-- endstate can be empty. This requires special handling -->
				<removevar NAME="tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSendstate"/>
				<setvar NAME="errno" VALUE="0"/>
				<begins STR="Variables.tmp" WHAT="Variables."/>
				<if COND="Variables.errno=1">
				<then>
					<!-- <setvar NAME="wfp:stepsCounters.NUMSTEPSendstate" VALUE="Variables.null"/>
					<setvar NAME="tmp" VALUE="Variables.null"/> -->
				</then>
				<else>       
				    <STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
					<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSendstate" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				</else>
				</if>

				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSoverride"/><STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSoverride" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSgrouplock"/><STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSgrouplock" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPStype"/><STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPStype" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSdeadlinetype"/><STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSdeadlinetype" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>

				<!-- step actions -->
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSactionsactionTotal"/>
				<setvar NAME="ACTIONSCOUNT" VALUE="Variables.tmp"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSactionsactionTotal" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<if COND="Variables.ACTIONSCOUNT!=0">
				<then>
					<setcounter NAME="NUMSTPACTIONS" VALUE="0"/>
					<setvar NAME="actions" VALUE="Variables.empty"/>
					<loop FROM="0" COUNT="Variables.ACTIONSCOUNT">
						<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSactionsactionCounters.NUMSTPACTIONS"/>
						<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
						<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
						<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSactionsactionCounters.NUMSTPACTIONS" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Counters.NUMSTPACTIONS,Variables.tmp"/>
						<inccounter NAME="NUMSTPACTIONS" VALUE="1"/>
					</loop>
					<substring STR="Variables.actions" OUTSTR="stpactionsCounters.NUMSTEPS" INDEX="1"/>
					<setvar NAME="temp" VALUE="Variables.stpactionsCounters.NUMSTEPS"/>
					<STRING.ENCODE VARIABLE="temp" VARNAME="temp" />
					<INPUT TYPE="HIDDEN" NAME="stpactionsCounters.NUMSTEPS" VALUE="Variables.temp" REPLACEALL="Variables.temp, Counters.NUMSTEPS"/>
				</then>
				</if>

				<!-- deadlock actions -->
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSdeadlockactionsactionTotal"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSdeadlockactionsactionTotal" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="ACTIONSCOUNT" VALUE="Variables.tmp"/>
				<setvar NAME="dlkactionsTotal" VALUE="Variables.wfp:stepsCounters.NUMSTEPSdeadlockactionsactionTotal"/>
				<if COND="Variables.ACTIONSCOUNT!=0">
				<then>
					<setcounter NAME="NUMDLKACTIONS" VALUE="0"/>
					<setvar NAME="actions" VALUE="Variables.empty"/>
					<loop FROM="0" COUNT="Variables.ACTIONSCOUNT">
						<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSdeadlockactionsactionCounters.NUMDLKACTIONS"/>
						<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
						<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
						<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSdeadlockactionsactionCounters.NUMDLKACTIONS" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Counters.NUMDLKACTIONS,Variables.tmp"/>
						<inccounter NAME="NUMDLKACTIONS" VALUE="1"/>
					</loop>
					<substring STR="Variables.actions" OUTSTR="dlkactionsCounters.NUMSTEPS" INDEX="1"/>
					<setvar NAME="temp" VALUE="Variables.dlkactionsCounters.NUMSTEPS"/>
					<STRING.ENCODE VARIABLE="temp" VARNAME="temp" />
					<INPUT TYPE="HIDDEN" NAME="dlkactionsCounters.NUMSTEPS" VALUE="Variables.temp" REPLACEALL="Variables.temp, Counters.NUMSTEPS"/>
					<STRINGLIST NAME="dlkactionsCounters.NUMSTEPS" STR="Variables.temp" DELIM=";"/>
				</then>
				</if>

				<!-- conditions -->
				<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSconditionsactionTotal"/>
				<setvar NAME="ACTIONSCOUNT" VALUE="Variables.tmp"/>
				<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
				<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSconditionsactionTotal" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Variables.tmp"/>
				<setvar NAME="conactionsTotal" VALUE="Variables.wfp:stepsCounters.NUMSTEPSconditionsactionTotal"/>
				<if COND="Variables.ACTIONSCOUNT!=0">
				<then>
					<setcounter NAME="NUMCONACTIONS" VALUE="0"/>
					<setvar NAME="actions" VALUE="Variables.empty"/>
					<loop FROM="0" COUNT="Variables.ACTIONSCOUNT">
						<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.NUMSTEPSconditionsactionCounters.NUMCONACTIONS"/>
						<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
						<STRING.ENCODE VARIABLE="tmp" VARNAME="tmp" />
						<INPUT TYPE="HIDDEN" NAME="wfp:stepsCounters.NUMSTEPSconditionsactionCounters.NUMCONACTIONS" VALUE="Variables.tmp" REPLACEALL="Counters.NUMSTEPS,Counters.NUMCONACTIONS,Variables.tmp"/>
						<inccounter NAME="NUMCONACTIONS" VALUE="1"/>
					</loop>	
					<substring STR="Variables.actions" OUTSTR="conactionsCounters.NUMSTEPS" INDEX="1"/>
					<setvar NAME="temp" VALUE="Variables.conactionsCounters.NUMSTEPS"/>
					<STRING.ENCODE VARIABLE="temp" VARNAME="temp" />
					<INPUT TYPE="HIDDEN" NAME="conactionsCounters.NUMSTEPS" VALUE="Variables.temp" REPLACEALL="Variables.temp, Counters.NUMSTEPS"/>
					<STRINGLIST NAME="conactionsCounters.NUMSTEPS" STR="Variables.temp" DELIM=";"/>
				</then>
				</if>

				<inccounter NAME="NUMSTEPS" VALUE="1"/>
			</loop>
	 		<substring STR="Variables.stpnames" OUTSTR="stpbynames" INDEX="1"/>
			<STRING.ENCODE VARIABLE="stpbynames" VARNAME="stpbynames" />
			<INPUT TYPE="HIDDEN" NAME="stpbynames" VALUE="Variables.stpbynames" REPLACEALL="Variables.stpbynames"/>
		</then>
		</if>
	</then>
	</if><!-- steps -->
</then>
</if> <!-- hiddenvariables -->

<!-- **************************************************************************************** -->
<if COND="Variables.DataAction=datafromprocesspage">
<then>
	<!-- Data has been posted from the "process page", which I think is the process editing view presented by Workflow.xml.
		The data needs to be collected preferentially from posted values from the form, rather than the scattered workflow
		already in the variable space.
	-->
	
	<stringlist NAME="pubid" STR="Variables.pubid" DELIM=";"/>
	<stringlist NAME="assettype" STR="Variables.assettype" DELIM=";"/>
	<stringlist NAME="roles" STR="Variables.roles" DELIM=";"/>

	<if COND="IsVariable.description=true">
	<then>
		<setvar NAME="wfp:description" VALUE="Variables.description"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:description=true">
		<then>
			<setvar NAME="wfp:description" VALUE="Variables.wfp:description"/>
		</then>
		<else>
			<!-- <setvar NAME="wfp:description" VALUE="Variables.null"/> -->
		</else>
		</if>
	</else>
	</if>

	<if COND="IsVariable.pName=true">
	<then>
		<setvar NAME="wfp:name" VALUE="Variables.pName"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:name=true">
		<then>
			<setvar NAME="wfp:name" VALUE="Variables.wfp:name"/>
		</then>
		<else>    
			<!--  <setvar NAME="wfp:name" VALUE="Variables.null"/> -->
		</else>
		</if>
	</else>
	</if>

	<if COND="IsVariable.deadlinetype=true">
	<then>
		<setvar NAME="wfp:deadlinetype" VALUE="Variables.deadlinetype"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:deadlinetype=true">
		<then> 
			<setvar NAME="wfp:deadlinetype" VALUE="Variables.wfp:deadlinetype"/>
		</then>
		</if>
	</else>
	</if> 

	<if COND="IsVariable.pubid=true">
	<then>
		<setvar NAME="wfp:sitessites" VALUE="Variables.pubid"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:sitessites!=true">
		<then>   
			<!-- <setvar NAME="wfp:sitessites" VALUE="Variables.null"/> -->
		</then>
		</if>
	</else>
	</if>

	<if COND="IsVariable.assettype=true">
	<then>
		<setvar NAME="wfp:typestypes" VALUE="Variables.assettype"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:typestypes!=true">
		<then>  
			<!-- <setvar NAME="wfp:typestypes" VALUE="Variables.null"/> -->
		</then>
		</if>
	</else>
	</if>

	<if COND="IsVariable.roles=true">
	<then>
		<setvar NAME="wfp:rolesroles" VALUE="Variables.roles"/>
		<substitute STR="Variables.wfp:rolesroles" WHAT=";" WITH="," OUTSTR="wfp:rolesroles"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:rolesroles!=true">
		<then>   
			<!-- <setvar NAME="wfp:rolesroles" VALUE="Variables.null"/> -->
		</then>
		</if>
	</else>
	</if>

	<if COND="IsVariable.startstep=true">
	<then>
		<setvar NAME="wfp:startstep" VALUE="Variables.startstep"/>
	</then>
	<else>
		<if COND="IsVariable.wfp:startstep!=true">
		<then>   
			<!-- <setvar NAME="wfp:startstep" VALUE="Variables.null"/> -->
		</then>
		</if>
	</else>
	</if>

	<!-- Following is an interesting case. If adminsroles is not set,it can be one of two resons:
		It is deliberately put to nothing
		OR, we are not coming from edit page
		To check if we are coming from edit page, we check roles as that is a required item
	-->
	<if COND="IsVariable.adminsroles=true">
	<then>
		<setvar NAME="wfp:adminsroles" VALUE="Variables.adminsroles"/>
		<substitute STR="Variables.adminsroles" WHAT=";" WITH="," OUTSTR="wfp:adminsroles"/>
	</then>
	<else>
		<if COND="IsVariable.roles=true">
		<then>
			<setvar NAME="wfp:adminsroles" VALUE="Variables.null"/>
		</then>
		</if>
	</else>
	</if>

	<!-- delegation actions -->
	<if COND="IsVariable.dlgactions=true">
	<then>

		<stringlist NAME="dlgactions" STR="Variables.dlgactions" DELIM=";"/>
		<setvar NAME="wfp:actionsactionTotal" VALUE="dlgactions.#numRows"/>

		<setcounter NAME="DLGACTIONS" VALUE="0"/>
		<if COND="Variables.wfp:actionsactionTotal!=0">
		<then>
			<loop LIST="dlgactions">
				<setvar NAME="tmp" VALUE="wfp:actionsactionCounters.DLGACTIONS"/>
				<setvar NAME="Variables.tmp" VALUE="dlgactions.ITEM"/>
				<inccounter NAME="DLGACTIONS" VALUE="1"/>
			</loop>
		</then>
		</if>
	</then>
	<else>
		<!-- For IsVariable.dlgactions=false, there can be two reasons:
			1. The previous screen is the workflow process main edit screen, and the user purposely
			set the actions to be none. In this case, need to set actionsactionTotal to be 0.
			2. The previous screen is any other screen, and the dlgactions variable is NOT passed.
			Do nothing in this case, and the existing actionsactionTotal is passed to the next screen.
		-->
		<if COND="Variables.fromProcessMainEditScreen=true">
		<then>
			<setvar NAME="wfp:actionsactionTotal" VALUE="0"/>
		</then>
		</if>
        
	</else>
	</if>

</then>
</if> <!-- datafromprocesspage -->

<!-- **************************************************************************************** -->
<if COND="Variables.DataAction=datafromsteppage">
<then>

	<!-- Data has been posted from the step form, in addition to the data posted in hiddens from the rest of any existing
		workflow process.  The step form data has precedence and should override the legacy data.
	-->
	
	<!-- authroles -->
	<if COND="IsVariable.acls!=true">
	<then>
		<setvar NAME="acls" VALUE="Variables.empty"/>
	</then>
	</if>
	<stringlist NAME="newauthroles" STR="Variables.acls" DELIM=","/>

	<!-- notifyacls -->
	<if COND="IsVariable.notifyacls!=true">
	<then>
		<setvar NAME="notifyacls" VALUE="Variables.empty"/>
	</then>
	</if>
	<stringlist NAME="newnotifyroles" STR="Variables.notifyacls" DELIM=","/>

	<!-- stepactions -->
	<if COND="IsVariable.newstpactions!=true">
	<then>
		<setvar NAME="newstpactions" VALUE="Variables.empty"/>
	</then>
	</if>
	<stringlist NAME="newstpactions" STR="Variables.newstpactions" DELIM=";"/>

	<!-- conditions -->
	<if COND="IsVariable.newconactions!=true">
	<then>
		<setvar NAME="newconactions" VALUE="Variables.empty"/>
	</then>
	</if>
	<stringlist NAME="newconactions" STR="Variables.newconactions" DELIM=";"/>

	<!-- deadlockactions -->
	<if COND="IsVariable.newdlkactions!=true">
	<then>
		<setvar NAME="newdlkactions" VALUE="Variables.empty"/>
	</then>
	</if>
	<stringlist NAME="newdlkactions" STR="Variables.newdlkactions" DELIM=";"/>

</then>
</if> <!-- datafromsteppage -->

<!-- **************************************************************************************** -->
<if COND="Variables.DataAction=datafromprivspage">
<then>

	<!-- Data has arrived from the privs editing form.  This data should override whatever other data came from
		the existing scattered workflow process.
	-->
	<substitute STR="Variables.acls" WHAT=";" WITH="," OUTSTR="fpacls"/>

</then>
</if> <!-- datafromprivspage -->

</FTCS> 


