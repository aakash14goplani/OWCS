<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini" VARNAME="charset"/>
<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset"/>

<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Admin/WorkflowRoutes.xml $ 
$Revision: 92 $ 
$Modtime: 8/24/04 2:33p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- WorkflowRoutes.xml
-
- DESCRIPTION
-	Admin things about workflow steps
-
- HISTORY 
  [2007-09-18 KG]
  * XSS fixes (adapted from 6.3 fixes):
    * isCleanString function usage
    * CSVAR -> STRING.STREAM
  [2007-10-09 KG]
  * XSS revision: minimized set of restricted characters.
-->
       
<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment"/>
<CALLELEMENT NAME="OpenMarket/Xcelerate/Scripts/ValidateInputForXSS" />
<HTML>

<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/StandardHeader"/>
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<!-- first check to see if the user is logged in or not -->
<SETVAR NAME="errno" VALUE="0"/>
<USERISMEMBER GROUP="xceladmin"/>
<if COND="Variables.errno=0">
	<then>
        <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/Util/ShowError" outstring="urlshowerror">
            <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
            <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                          <satellite.argument name="error" value="AdminTimeoutError"/>
                                           </SATELLITE.LINK>
		<REPLACE STR="Variables.urlshowerror">
			<script LANGUAGE="JavaScript">
				parent.parent.location="Variables.urlshowerror";
			</script>
		</REPLACE>
		<throwexception/>
	</then>
</if>

 
<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
	var	ns4	= document.layers;

	if (ns4) 
	{	/* Netscape requires manually capturing	the	event */
				  document.captureEvents(Event.KEYPRESS);
				  document.onkeypress =	checkSubmit;
	}

	function checkfields(frm)
	{
		var test = 0;
		for(i=0; i<frm.acls.options.length;i++)
		{
			if(frm.acls.options[i].selected == true)
			{
				test = test + frm.acls.options[i].value.length + 1;
			}
		}
		if(test >= 255)
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/lengthcslistauthorizedrolesexceeded255" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			return false;
		}
	
		if (frm.elements['stpname'].value == "")
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyastepname" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			return false;
		}
		var isclean = isCleanString(frm.elements['stpname'].value, '<">', true);
		if (!isclean) {
			alert("]]><XLAT.STREAM KEY="dvin/FlexibleAssets/Attributes/ApostropheNotAllowedMinimal" ESCAPE="true" ENCODE="false"/><![CDATA[");
			return false;
		}
		
		if (frm.beginstate.options.selectedIndex=="-1" || frm.endstate.options.selectedIndex=="-1")
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifybeginorendstatestep" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			return false;
		}
		if (frm.elements['IsStartStep'].value=="true")
		{
			if (frm.beginstate.options.selectedIndex=="0")
			{	
				]]>
				alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/startstepalreadyexistscantdefinemore1" ESCAPE="true" ENCODE="false"/>");
				<![CDATA[
				return false;
			}
		}

               
		if (frm.acls.options.selectedIndex=="-1")
		{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyauthorizedrolestep"/>");
			<![CDATA[
			return false;
		}

		if (frm.stptype[0].checked!=true && frm.stptype[1].checked!=true &&
            frm.stptype[2].checked!=true && frm.stptype[3].checked!=true &&
            frm.stptype[4].checked!=true)
		{
			if (frm.endstate.options.selectedIndex!="0")
			{
				]]>
				alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifysteptypeSelect" ESCAPE="true" ENCODE="false"/>");
				<![CDATA[
				return false;
			}
		}      

		if (frm.endstate.options.selectedIndex!="0")
		{
			if (frm.stptype[2].checked || frm.stptype[3].checked || frm.stptype[4].checked)
			{
				if (frm.notifyacls.options.selectedIndex=="-1")
				{
					]]>
					alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifynotifyrolestep" ESCAPE="true" ENCODE="false"/>");
					<![CDATA[
					return false;
				}
				test = 0;
				for(i=0; i<frm.notifyacls.options.length;i++)
				{
					if(frm.notifyacls.options[i].selected == true)
					{
						test = test + frm.notifyacls.options[i].value.length + 1;
					}
				}
				if(test >= 255)
				{
					]]>
					alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/lengthcslistnotifyrolesexceeded255" ESCAPE="true" ENCODE="false"/>");
					<![CDATA[
					return false;
				}
			}
			if (frm.stptype[3].checked && (frm.ovrd.checked || frm.lock.checked) )
			{
				]]>
				alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/askstepcannotbeallvotingorgrpsyncd" ESCAPE="true" ENCODE="false"/>");
				<![CDATA[
				return false;
			}
		}
        else if( frm.endstate.options.selectedIndex == "0" )
        { //The end state is "no state", the assignment method is set to "unassigned"
                 frm.stptype[1].checked=true;
        }
        return true;
    }


    function AddStep(frm)
    {
        frm.elements['pagename'].value = "OpenMarket/Xcelerate/Admin/WorkflowFront";

        if (frm.elements['stepaction'].value == "add")
        {
            frm.elements['subaction'].value = "addstep";

        } else {
	        frm.elements['subaction'].value = "editstep";
        }

        selectAllSelectedActions();
	    frm.submit();
	}


    function cancel(obj)
	{
	    obj.elements['pagename'].value = "OpenMarket/Xcelerate/Admin/WorkflowFront";
	    obj.elements['subaction'].value = "steps";
	    obj.submit();
	}

	function checkSubmit(e)
	{
		if (ns4)
		{
			var	key	= e.which;
		}
		else
		{
			var	key	= window.event.keyCode;
		}

		if (key	== 13)
		{
			if (document.forms[0].elements['stpname'].value !=	"")
			{
				document.forms[0].submit();
				return false;
			}
			else
			{
			]]>
			alert("<XLAT.STREAM KEY="dvin/UI/Admin/Error/specifyastepname" ESCAPE="true" ENCODE="false"/>");
			<![CDATA[
			 document.forms[0].elements['stpname'].focus(); return	false;
			}
		}
	}

	function xferActions(src,target)
	{
        var sc, itemText, i, newIndex, listy;
        target.selectedIndex = -1;
        for (i=0; i<src.options.length; i++) {
            if (src.options[i].selected) {
                var sc=i;
                var o=src.options[sc]
                items=new Option(o.text,o.value);
                newIndex=target.options.length;
                target.options[newIndex]=items;
              target.options[newIndex].selected=true
            var typeNid = new String(o.value);
            var descNname = new String(o.text);
            var typeNidArray =  typeNid.split(",");
            var lp = descNname.indexOf("(");
            var assetName = descNname.slice(0,lp);
            }
        }
        i = 0;
        while (i<src.options.length) {
            if (src.options[i].selected)
                src.options[i]=null
            else
                i = i + 1;
        }
        delNul(src)
        delNul(target)
    }

    function delNul(lst){
        i = 0;
        if (lst){
            while (i<lst.options.length) {
                if (lst.options[i].value==-1)
                    lst.options[i]=null
                else
                    i = i + 1;
            }
        }
    }

    function selectAllSelectedActions()
    {
        selectedActions = document.forms[0].elements['newstpactions'];
        if (selectedActions){
            delNul(selectedActions);
            for(i=0; i<selectedActions.options.length; i++)
                selectedActions.options[i].selected=true
        }
    }

    function promote(lst) {
        sel = lst.selectedIndex;
        if (sel == -1 ) return true;
        if (sel == 0 ) return true;

        orig = new Option(lst.options[sel].text,lst.options[sel].value);
        prev = new Option(lst.options[sel-1].text,lst.options[sel-1].value);
        lst.options[sel]=prev;
        lst.options[sel-1]=orig;
        lst.selectedIndex=sel-1;
    }
    
    function demote(lst) {
        sel = lst.selectedIndex;
        if (sel == -1 ) return true;
        if (sel == lst.options.length-1 ) return true;

        orig = new Option(lst.options[sel].text,lst.options[sel].value);
        prev = new Option(lst.options[sel+1].text,lst.options[sel+1].value);
        lst.options[sel]=prev;
        lst.options[sel+1]=orig;
        lst.selectedIndex=sel+1;
    }
]]>
</SCRIPT>


	
<if COND="IsVariable.wfp:stepsTotal!=true">
<then>
		<setvar NAME="wfp:stepsTotal" VALUE="0"/>
</then>
</if>

<!-- return process information as hidden variables -->

<if COND="Variables.stepaction!=delete">
<then>
<callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
	<argument NAME="DataAction" VALUE="datafromprocesspage"/>
</callelement>
<callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowData">
	<argument NAME="DataAction" VALUE="hiddenvariables"/>
</callelement>
</then>
</if>

<if COND="Variables.stepaction=apply">
<then>
    
    <callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFront">
		<argument NAME="action" VALUE="update"/>
		<argument NAME="subaction" VALUE="cancel"/>
		<argument NAME="wfp:name" VALUE="Variables.wfp:name"/>
	</callelement>
    
</then>
</if>

<!-- Delete this step -->
<if COND="Variables.stepaction=delete">
<then>
    <WORKFLOWENGINE.CREATENEWPROCESS OBJVARNAME="newprocess"/>
    <WORKFLOWPROCESS.GATHER PREFIX="wfp:" NAME="newprocess"/>

	<callelement NAME="OpenMarket/Xcelerate/Admin/WorkflowFront">
		<argument NAME="stepid" VALUE="Variables.stepid"/>
		<argument NAME="action" VALUE="update"/>
		<argument NAME="subaction" VALUE="deletestep"/>
		<argument NAME="wfp:name" VALUE="Variables.wfp:name"/>
	</callelement>
</then>
<else>

    <!--Add a new step or Edit the step -->  
    <WORKFLOWENGINE.CREATENEWPROCESS OBJVARNAME="newprocess"/>
    <WORKFLOWPROCESS.GATHER PREFIX="wfp:" NAME="newprocess"/>
    <WORKFLOWPROCESS.GETSTEP NAME="newprocess" OBJVARNAME="outputstepobject" VALUE="Variables.stepid"/>

	<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
		<tr><td>
	
	    <if COND="Variables.stepaction=add">
	    <then>
	        <span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/AddNewWorkflowProcessStep"/></span><p/>
	        <STRINGLIST NAME="authroles" STR="Variables.wfp:rolesroles" DELIM=","/>
	    	<STRINGLIST NAME="notifyroles" STR="Variables.wfp:rolesroles" DELIM=","/>
	    </then>
	    <else>
	        <WORKFLOWSTEP.SCATTER NAME="outputstepobject" PREFIX="wfs:"/>
	        <span class="title-text"><XLAT.STREAM KEY="dvin/UI/Admin/EditWorkflowProcessStep"/></span><p/>
	        <STRINGLIST NAME="authroles" STR="Variables.wfs:authrolesroles" DELIM=","/>
		    <STRINGLIST NAME="notifyroles" STR="Variables.wfs:notifyrolesroles" DELIM=","/>
	    </else>
	    </if>
	
		</td></tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	</table>
    
	<setvar NAME="isconditions" VALUE="false"/>
	<setvar NAME="isdlkactions" VALUE="false"/>
	<setvar NAME="isstpactions" VALUE="false"/>
    
    <!-- Prepare Condition Actions -->
	<setvar NAME="tmp" VALUE="Variables.wfs:conditionsactionTotal"/>
	<if COND="IsVariable.wfs:conditionsactionTotal=true">
	<then>
	    <if COND="Variables.wfs:conditionsactionTotal!=0">
		<then>
		    <setcounter NAME="NUMCONACTIONS" VALUE="0"/>
		    <setvar NAME="actions" VALUE="Variables.empty"/>
		    <loop FROM="0" COUNT="Variables.wfs:conditionsactionTotal">
		        <setvar NAME="tmp" VALUE="Variables.wfs:conditionsactionCounters.NUMCONACTIONS"/>
				<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
				<setvar NAME="isconditions" VALUE="true"/>
				<inccounter NAME="NUMCONACTIONS" VALUE="1"/>
			</loop>	
			<substring STR="Variables.actions" OUTSTR="conditions" INDEX="1"/>
			<STRINGLIST NAME="conditions" STR="Variables.actions" DELIM=";"/>
		</then>
		</if>
	</then>
	</if>

    
    <!-- Prepare actions -->
	<setvar NAME="tmp" VALUE="Variables.wfs:actionsactionTotal"/>
	<if COND="IsVariable.wfs:actionsactionTotal=true">
	<then>
		<if COND="Variables.wfs:actionsactionTotal!=0">
		<then>
			<setcounter NAME="NUMCONACTIONS" VALUE="0"/>
			<setvar NAME="actions" VALUE="Variables.empty"/>
			<loop FROM="0" COUNT="Variables.wfs:actionsactionTotal">
				<setvar NAME="tmp" VALUE="Variables.wfs:actionsactionCounters.NUMCONACTIONS"/>
				<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
				<setvar NAME="isstpactions" VALUE="true"/>
				<inccounter NAME="NUMCONACTIONS" VALUE="1"/>
			</loop>	
			<substring STR="Variables.actions" OUTSTR="stpactions" INDEX="1"/>
			<STRINGLIST NAME="stpactions" STR="Variables.actions" DELIM=";"/>
		</then>
		</if>
	</then>
	</if>

       
    <!-- Prepare Deadlock Actions -->
	<setvar NAME="tmp" VALUE="Variables.wfs:deadlockactionsactionTotal"/>
	<if COND="IsVariable.wfs:deadlockactionsactionTotal=true">
	<then>
		<if COND="Variables.wfs:deadlockactionsactionTotal!=0">
		<then>
			<setcounter NAME="NUMCONACTIONS" VALUE="0"/>
			<setvar NAME="actions" VALUE="Variables.empty"/>
			<loop FROM="0" COUNT="Variables.wfs:deadlockactionsactionTotal">
				<setvar NAME="tmp" VALUE="Variables.wfs:deadlockactionsactionCounters.NUMCONACTIONS"/>
				<setvar NAME="actions" VALUE="Variables.actions;Variables.tmp"/>
				<setvar NAME="isdlkactions" VALUE="true"/>
				<inccounter NAME="NUMCONACTIONS" VALUE="1"/>
			</loop>	
			<substring STR="Variables.actions" OUTSTR="dlkactions" INDEX="1"/>
			<STRINGLIST NAME="dlkactions" STR="Variables.actions" DELIM=";"/>
		</then>
		</if>
	</then>
	</if>

  
    <setvar NAME="tablename" VALUE="WorkflowRoutes"/>

    
	<setcounter NAME="numsteps" VALUE="Variables.wfp:stepsTotal"/>
    

    <!-- Walk the existing step information and write it out -->  
    <setvar NAME="NUM" VALUE="Counters.numsteps"/>
    
    <!-- Table Header -->
    <table BORDER="0" CELLSPACING="0" CELLPADDING="0"> 
       	 <tr><td>	
			    <table width="100%" cellpadding="0" cellspacing="0" border="0">
				    <!-- Item -->
				    <tr>
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/ProcessName"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
                                <if COND="Variables.wfp:name=Variables.null"><then>
                                    (<XLAT.STREAM KEY="dvin/Common/lcnew"/>)
                                </then><else> 
                                    <STRING.STREAM VARIABLE="wfp:name"/>
                                </else></if>
					    </td></tr> 
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
                    <if COND="Variables.stepaction=edit">
                    <then>
                        <setvar NAME="rowStyle" VALUE="tile-row-highlight"/>
                    </then><else>
                        <setvar NAME="rowStyle" VALUE="tile-row-normal"/>
                    </else></if>
                    
				    <tr>
					    <td class="form-label-text">
                            <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/StepName"/>:
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
                                <if COND="Variables.stepaction=add">
                                <then>
                                    <INPUT TYPE="TEXT" SIZE="45" MAXLENGTH="64" NAME="stpname" VALUE=""/>
                                </then><else>                     
                                    <!--csvar NAME="Variables.wfs:name"/-->
			                        <!--INPUT TYPE="HIDDEN" NAME="stpname" VALUE="Variables.wfs:name" REPLACEALL="Variables.wfs:name"/-->
                                   <!--INPUT TYPE="TEXT" SIZE="45" MAXLENGTH="24" NAME="stpname" VALUE=""/-->
								   <STRING.ENCODE VARIABLE="wfs:name" VARNAME="wfs:name"/>
                                   <INPUT TYPE="TEXT" SIZE="45" MAXLENGTH="64" NAME="stpname" VALUE="Variables.wfs:name" REPLACEALL="Variables.wfs:name"/>
                                </else></if>
								 <STRING.ENCODE VARIABLE="stepid" VARNAME="stepid"/>
			                    <INPUT TYPE="HIDDEN" NAME="stepid" VALUE="Variables.stepid" REPLACEALL="Variables.stepid"/>
					    </td></tr> 
       				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/States"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
						        <table width="100%" cellspacing="0" cellpadding="0">
                                    <tr>
                                        <td><XLAT.STREAM KEY="dvin/UI/Admin/FromState"/></td>
                                        <td><br/></td>
                                        <td><XLAT.STREAM KEY="dvin/UI/Admin/ToState"/></td>
                                    </tr>
                                    <tr>
                                        <td>                          
			                                <WORKFLOWENGINE.GETALLSTATES PREFIX="wfstate:"/>
                                            <select NAME="beginstate" SIZE="5">
			                                <if COND="IsVariable.wfstate:Total=true">
			                                <then>
			                                    <if COND="Variables.wfstate:Total!=0">
				                                <then>
				                                    <if COND="Variables.wfs:startstate=Variables.empty">
					                                <then>
						                                <OPTION VALUE="none" SELECTED="yes"/><XLAT.STREAM KEY="dvin/Common/lcnone"/> - <XLAT.STREAM KEY="dvin/UI/Admin/StartOfWorkflow"/>
					                                </then>
					                                <else>
						                                <OPTION VALUE="none"/><XLAT.STREAM KEY="dvin/Common/lcnone"/> - <XLAT.STREAM KEY="dvin/UI/Admin/StartOfWorkflow"/>
					                                </else>
					                                </if>
						
                                                    <setcounter NAME="STATECOUNT" VALUE="0"/>
					                                <loop FROM="0" COUNT="Variables.wfstate:Total">
					                                    <setvar NAME="tmp" VALUE="wfstate:Counters.STATECOUNT"/>
						                                <WORKFLOWSTATE.GETID NAME="Variables.tmp" VARNAME="stid"/>
						                                <WORKFLOWSTATE.GETSTATEDESCRIPTION NAME="Variables.tmp" VARNAME="stdesc"/>
														<STRING.ENCODE VARIABLE="stid" VARNAME="stid"/>
						                                <if COND="Variables.stid=Variables.wfs:startstate">
						                                <then>
								                        <OPTION VALUE="Variables.stid" SELECTED="yes" REPLACEALL="Variables.stid"/><STRING.STREAM VARIABLE="stdesc"/>
						                                </then>
						                                <else>
                                                            <OPTION VALUE="Variables.stid" REPLACEALL="Variables.stid"/><STRING.STREAM VARIABLE="stdesc"/>
						                                </else>
					                                    </if>
                        
                                                        <inccounter NAME="STATECOUNT" VALUE="1"/>
					                                </loop>
				                                </then>
				                                </if>
			                                </then>
			                                </if>
                                            </select>  
                                        </td>
                                        <td><br/></td>
                                        <td>
                                            <select NAME="endstate" SIZE="5">
				                            <if COND="IsVariable.wfstate:Total=true">
				                            <then>
					                            <if COND="Variables.wfstate:Total!=0">
					                            <then>
						                            <if COND="Variables.wfs:endstate=Variables.empty">
						                            <then>
							                            <OPTION VALUE="none" SELECTED="yes"/><XLAT.STREAM KEY="dvin/Common/lcnone"/> - <XLAT.STREAM KEY="dvin/UI/Admin/EndOfWorkflow"/>
						                            </then>
        						                    <else>
							                            <OPTION VALUE="none"/><XLAT.STREAM KEY="dvin/Common/lcnone"/> - <XLAT.STREAM KEY="dvin/UI/Admin/EndOfWorkflow"/>
						                            </else>
						                            </if>
                                                    
						                            <setcounter NAME="STATECOUNT" VALUE="0"/>
						                            <loop FROM="0" COUNT="Variables.wfstate:Total">
							                            <setvar NAME="tmp" VALUE="wfstate:Counters.STATECOUNT"/>
							                            <WORKFLOWSTATE.GETID NAME="Variables.tmp" VARNAME="stid"/>
							                            <WORKFLOWSTATE.GETSTATEDESCRIPTION NAME="Variables.tmp" VARNAME="stdesc"/>
														<STRING.ENCODE VARIABLE="stid" VARNAME="stid"/>
                            							<if COND="Variables.stid=Variables.wfs:endstate">
							                            <then>
                        				                    <OPTION VALUE="Variables.stid" SELECTED="yes" REPLACEALL="Variables.stid"/><STRING.STREAM VARIABLE="stdesc"/>
							                            </then>
							                            <else>
                        				                    <OPTION VALUE="Variables.stid" REPLACEALL="Variables.stid"/><STRING.STREAM VARIABLE="stdesc"/>
							                            </else>
							                            </if>
                                                        
							                            <inccounter NAME="STATECOUNT" VALUE="1"/>
						                            </loop>
					                            </then>
					                            </if>
				                            </then>
				                            </if>
                                            </select> 
                                        </td>
                                    </tr>
                                </table>
					    </td></tr> 
       			    
                    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
                    
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/AuthorizedRoles"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
	                            <ROLEMANAGER.GETROLENAMES LISTVARNAME="ACLList"/>
                                <SELECT NAME="acls" SIZE="4" MULTIPLE="yes">
                                <LOOP LIST="ACLList">
		                            <setvar NAME="errno" VALUE="0"/>
			                        <isinlist LIST="authroles" ITEM="ACLList.aclname"/>
			                        <if COND="Variables.errno=1">
			                        <then>
                                        <OPTION VALUE="ACLList.aclname" SELECTED="yes" REPLACEALL="ACLList.aclname"/><STRING.STREAM VALUE="ACLList.aclname"/>
		                            </then>
			                        <else>
                                        <OPTION VALUE="ACLList.aclname" REPLACEALL="ACLList.aclname"/><STRING.STREAM VALUE="ACLList.aclname"/>
			                        </else>
			                        </if>
                                </LOOP>
                                </SELECT>
					    </td></tr> 
       			    					
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <span class="alert-color">*</span><XLAT.STREAM KEY="dvin/UI/Admin/AssignmentMethod"/>:<br/>
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
	                            <gotorow LIST="ACLList" ROWNUM="1"/>
	                            <setvar NAME="errno" VALUE="0"/>  
								<if COND="Variables.wfp:rolesroles!=_ALL_">
								<then>
									<stringlist NAME="ACLList" STR="Variables.wfp:rolesroles" DELIM=","/>
									<if COND="Variables.errno=0">
									<then>
										<setvar NAME="ALCOL" VALUE="ITEM"/>
									</then>
									<else>
		    		                    <ROLEMANAGER.GETROLENAMES LISTVARNAME="ACLList"/>
		    		                    <setvar NAME="ALCOL" VALUE="aclname"/>
									</else>
									</if>
								</then>
								<else>
		  		                    <ROLEMANAGER.GETROLENAMES LISTVARNAME="ACLList"/>
		  		                    <setvar NAME="ALCOL" VALUE="aclname"/>
								</else>
								</if>
				                                    
                                <if COND="Variables.wfs:type=inplace">
	                            <then>
	                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="inplace" CHECKED="yes"/>
	                            </then>
	                            <else>
	                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="inplace"/>
                                </else>
	                            </if>
                               <!-- &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/AssigntoBeginningStateparticipants"/><br/>-->
                                &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/RetainFromStateAssignees"/><br/>
                                
                                <if COND="Variables.wfs:type=unassigned">
                                <then>
			                        <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="unassigned" CHECKED="yes"/>
                                </then>
                                <else>
                                    <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="unassigned"/>
                                </else>
                                </if>
                                <!--&nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/AssigntoEveryone"/><br/>-->
                                &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/NoAssignmentsControlActionsWithFunctionPrivs"/><br/>

    
                                <table width="100%" cellspacing="0" cellpadding="0">
                                    <tr><td><br/></td><td><br/></td><td><XLAT.STREAM KEY="dvin/UI/Admin/SelectRoles"/></td></tr><tr>
                                        <td valign="top" nowrap="true">
                                            <if COND="Variables.wfs:type=full">
	                                        <then>
	                                            <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="full" CHECKED="yes"/>
	                                        </then>
	                                        <else>
	                                            <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="full"/>
                                            </else>
	                                        </if>
                                            &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/AssignFromListOfParticipants"/><br/>
              
                                            <if COND="Variables.wfs:type=ask">
                                            <then>
                                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="ask" CHECKED="yes"/>
                                            </then>
                                            <else>
                                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="ask"/>
                                            </else>
                                            </if>     
                                            &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/ChooseAssigneesWhenStepIsTaken"/><br/>

                                            <if COND="Variables.wfs:type=all">
                                            <then>
                                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="all" CHECKED="yes"/>
                                            </then>
                                            <else>
                                                <INPUT style="margin-left:0px" TYPE="radio" NAME="stptype" VALUE="all"/>
                                            </else>
                                            </if>
                                            &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/AssigntoEveryone"/><br/>
                                        </td>
                                        <td><br/></td>
                                        <td>
                                            <SELECT NAME="notifyacls" SIZE="4" MULTIPLE="yes">
                                            <LOOP LIST="ACLList">
                                                <setvar NAME="ALacl" VALUE="ACLList.Variables.ALCOL"/>
				                                <setvar NAME="errno" VALUE="0"/>
												<if COND="Variables.stepaction=add">
												<then>
						                             <OPTION VALUE="Variables.ALacl" REPLACEALL="Variables.ALacl"/><STRING.STREAM VARIABLE="ALacl"/>
												</then>
												<else>
	                                                <isinlist LIST="notifyroles" ITEM="Variables.ALacl"/>
					                                <if COND="Variables.errno=1">
					                                <then>
	                                                    <OPTION VALUE="Variables.ALacl" SELECTED="yes" REPLACEALL="Variables.ALacl"/><STRING.STREAM VARIABLE="ALacl"/>
	 				                                </then>
					                                <else>
	                                                    <OPTION VALUE="Variables.ALacl" REPLACEALL="Variables.ALacl"/><STRING.STREAM VARIABLE="ALacl"/>
					                                </else>
					                                </if>
												</else>
												</if>
                                            </LOOP>
                                            </SELECT>
                                        </td>
                                        <td><br/></td>
                                    </tr>
                                </table>
					    </td></tr> 
       			    
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/CanSetStepDeadline"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
					<if COND="IsVariable.wfs:deadlinetype=true">
					<then>
						<if COND="Variables.wfs:deadlinetype=ask">
						<then>
				                       <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="ask" CHECKED="yes"/>  <XLAT.STREAM KEY="dvin/Common/CanChange"/>
						</then>
						<else>
						       <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="ask"/> <XLAT.STREAM KEY="dvin/Common/CanChange"/>
						</else>
						</if>
						<br/>
						<if COND="Variables.wfs:deadlinetype=default">
						<then>
						        <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="default" CHECKED="yes"/> <XLAT.STREAM KEY="dvin/Common/Usedefault"/>
						</then>
						<else>
						        <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="default"/> <XLAT.STREAM KEY="dvin/Common/Usedefault"/>
						</else>
						</if>
					</then>
					<else>
				                        <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="ask"/> <XLAT.STREAM KEY="dvin/Common/CanChange"/>
							<br/>
						        <INPUT style="margin-left:0px" TYPE="radio" NAME="sdeadlinetype" VALUE="default" CHECKED="yes"/> <XLAT.STREAM KEY="dvin/Common/Usedefault"/>
					</else>
					</if>
					    </td></tr> 
       			   <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/StepActions"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
                                <WORKFLOWENGINE.GETAVAILABLESTEPACTIONS PREFIX="wfstp:"/>
					            <if COND="Variables.wfstp:Total!=0">
					            <then>
                                <table width="100%" cellspacing="0" cellpadding="0">
                                    <tr>
                                        <td><XLAT.STREAM KEY="dvin/UI/Admin/AvailableActions"/></td>
                                        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td><XLAT.STREAM KEY="dvin/UI/Admin/SelectedActions"/></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <SELECT NAME="stpactcandidates" SIZE="5" MULTIPLE="yes">
                                                <setcounter NAME="STPCOUNT" VALUE="0"/>
                                                <loop FROM="0" COUNT="Variables.wfstp:Total">
                                                    <WORKFLOWACTION.GETID NAME="wfstp:Counters.STPCOUNT" VARNAME="stpactid"/>
                                                    <WORKFLOWACTION.GETNAME NAME="wfstp:Counters.STPCOUNT" VARNAME="stpactname"/>

                                                    <if COND="Variables.isstpactions=true">
                                                    <then>
                                                        <setvar NAME="errno" VALUE="0"/>
                                                        <isinlist LIST="stpactions" ITEM="Variables.stpactid"/>
                                                        <!-- Show only stepactions that are not part of the selected list -->
														<STRING.ENCODE VARIABLE="stpactid" VARNAME="stpactid"/>
                                                        <if COND="Variables.errno!=1">
                                                        <then>
                                                            <OPTION VALUE="Variables.stpactid" REPLACEALL="Variables.stpactid"/><STRING.STREAM VARIABLE="stpactname"/>
                                                        </then>
                                                        </if>
                                                    </then>
                                                    <else>
                                                        <OPTION VALUE="Variables.stpactid" REPLACEALL="Variables.stpactid"/><STRING.STREAM VARIABLE="stpactname"/>
                                                    </else>
                                                    </if>
                                                    <inccounter NAME="STPCOUNT" VALUE="1"/>
                                                </loop>
                                            </SELECT>
                                            </td>
                                        <td>&nbsp;&nbsp;&nbsp;</td>
                                        <td>
                                            <SELECT NAME="newstpactions" SIZE="5" MULTIPLE="yes">
                                                <if COND="Variables.isstpactions=true">
                                                    <then>
                                                    <loop LIST="stpactions">
                                                       <WORKFLOWENGINE.GETSTEPACTIONID ID="stpactions.ITEM" OBJVARNAME="stpactionobj"/>
                                                       <WORKFLOWACTION.GETNAME NAME="stpactionobj" VARNAME="stpactname"/>
                                                       <OPTION VALUE="stpactions.ITEM"SELECTED="yes" REPLACEALL="stpactions.ITEM"/><STRING.STREAM VARIABLE="stpactname"/>
                                                    </loop>
                                                    </then>
                                                    <else>
                                                        <option VALUE="-1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>
                                                    </else>
                                                </if>
                                            </SELECT>
                                        </td>
                                        <td>&nbsp;&nbsp;</td>
                                        <td align="center" valign="middle">
                                            <XLAT.LOOKUP KEY="dvin/Util/FlexAssets/Moveup" VARNAME="_XLAT_"/>
                                            <XLAT.LOOKUP KEY="dvin/Util/FlexAssets/Moveup" VARNAME="mouseover" ESCAPE="true"/>
                                            <A HREF="javascript:void(0)" onClick="promote(document.forms[0].elements['newstpactions']);" onMouseOver="window.status='Variables.mouseover';return true" onMouseOut="window.status='';return true" REPLACEALL="Variables.mouseover"><IMG src="Variables.cs_imagedir/graphics/common/screen/moveup.gif" HSPACE="4" VSPACE="4" ALT="Variables._XLAT_" TITLE="Variables._XLAT_" BORDER="0" REPLACEALL="Variables.cs_imagedir,Variables._XLAT_,SessionVariables.locale"/></A><BR/>
                                            <XLAT.LOOKUP KEY="dvin/Util/FlexAssets/Movedown" VARNAME="_XLAT_"/>
                                            <XLAT.LOOKUP KEY="dvin/Util/FlexAssets/Movedown" VARNAME="mouseover" ESCAPE="true"/>
                                            <A HREF="javascript:void(0)" onClick="demote(document.forms[0].elements['newstpactions']);" onMouseOver="window.status='Variables.mouseover';return true" onMouseOut="window.status='';return true" REPLACEALL="Variables.mouseover"><IMG src="Variables.cs_imagedir/graphics/common/screen/movedn.gif" HSPACE="4" VSPACE="4" BORDER="0" ALT="Variables._XLAT_" TITLE="Variables._XLAT_" REPLACEALL="Variables.cs_imagedir,Variables._XLAT_,SessionVariables.locale"/></A>
                                        </td>
                                        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                    </tr>
                                    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
                                    <tr>
                                        <td>
                                            <XLAT.LOOKUP KEY="dvin/AT/AdvCols/AddSelectedItems" VARNAME="_AddSelectedItems_ALT"/>
                                            <XLAT.LOOKUP KEY="dvin/AT/AdvCols/AddSelectedItems" VARNAME="_AddSelectedItems_" ESCAPE="true"/>
                                            <A HREF="javascript:void(0);" onClick="xferActions(document.forms[0].elements['stpactcandidates'], document.forms[0].elements['newstpactions'] )" ONMOUSEOVER="window.status='Variables._AddSelectedItems_';return true;" ONMOUSEOUT="window.status='';return true;" REPLACEALL="Variables._AddSelectedItems_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/AddSelectedItems"/></CALLELEMENT></A>
                                        </td>
                                        <td>&nbsp;&nbsp;&nbsp;</td>
                                        <td>
                                            <XLAT.LOOKUP KEY="dvin/UI/Admin/RemoveSelectedItems" ESCAPE="true" VARNAME="_XLAT_"/>
				                            <XLAT.LOOKUP KEY="dvin/UI/Admin/RemoveSelectedItems" VARNAME="_ALT_"/>
                                            <A HREF="javascript:void(0)" onMouseOver="window.status='Variables._XLAT_';return true;" onMouseOut="window.status='';return true;" onClick="xferActions(document.forms[0].elements['newstpactions'], document.forms[0].elements['stpactcandidates'])" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Remove"/></CALLELEMENT></A>
                                        </td>
                                    </tr>
                                </table>
                                </then>
					            <else><XLAT.STREAM KEY="dvin/UI/Admin/PleaseaddStepActionschoosefrom"/>
					            </else>
					            </if>
                        </td>
                    </tr>
       			    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/StepConditions"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
     				            <WORKFLOWENGINE.GETAVAILABLECONDITIONS PREFIX="wfcnd:"/>
                                <if COND="Variables.wfcnd:Total!=0">
					            <then>
                    		        <SELECT NAME="newconactions" SIZE="3" MULTIPLE="yes">

						            <setcounter NAME="CNDCOUNT" VALUE="0"/>
			  			            <loop FROM="0" COUNT="Variables.wfcnd:Total">
							            <WORKFLOWACTION.GETID NAME="wfcnd:Counters.CNDCOUNT" VARNAME="cndactid"/>
							            <WORKFLOWACTION.GETNAME NAME="wfcnd:Counters.CNDCOUNT" VARNAME="cndactname"/>
										<STRING.ENCODE VARIABLE="cndactid" VARNAME="cndactid"/>
                                        <if COND="Variables.isconditions=true">
							            <then>
								            <setvar NAME="errno" VALUE="0"/>
								            <isinlist LIST="conditions" ITEM="Variables.cndactid"/>
                                            <if COND="Variables.errno=1">
								            <then>
                       						    <OPTION VALUE="Variables.cndactid" SELECTED="yes" REPLACEALL="Variables.cndactid"/><STRING.STREAM VARIABLE="cndactname"/>
								            </then>
								            <else>
                       						    <OPTION VALUE="Variables.cndactid" REPLACEALL="Variables.cndactid"/><STRING.STREAM VARIABLE="cndactname"/>
								            </else>
								            </if>
							            </then>
							            <else>
	                       				    <OPTION VALUE="Variables.cndactid" REPLACEALL="Variables.cndactid"/><STRING.STREAM VARIABLE="cndactname"/>
							            </else>
							            </if>
								        <inccounter NAME="CNDCOUNT" VALUE="1"/>
			  			            </loop>
			  		                </SELECT>
					            </then>
					            <else><XLAT.STREAM KEY="dvin/UI/Admin/PleaseaddCondtionstochoosefrom"/>
					            </else>
					            </if>
					    </td></tr> 
       			    
    			 	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/DeadlockActions"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
                                <WORKFLOWENGINE.GETAVAILABLEDEADLOCKACTIONS PREFIX="wfdlk:"/>
					            <if COND="Variables.wfdlk:Total!=0">
					            <then>
                    		        <SELECT NAME="newdlkactions" SIZE="3" MULTIPLE="yes">

						            <setcounter NAME="DLKCOUNT" VALUE="0"/>
			  			            <loop FROM="0" COUNT="Variables.wfdlk:Total">
							            <WORKFLOWACTION.GETID NAME="wfdlk:Counters.DLKCOUNT" VARNAME="dlkactid"/>
							            <WORKFLOWACTION.GETNAME NAME="wfdlk:Counters.DLKCOUNT" VARNAME="dlkactname"/>
										<STRING.ENCODE VARIABLE="dlkactid" VARNAME="dlkactid"/>
                                        <if COND="Variables.isdlkactions=true">
							            <then>
								            <setvar NAME="errno" VALUE="0"/>
								            <isinlist LIST="dlkactions" ITEM="Variables.dlkactid"/>
								
                                            <if COND="Variables.errno=1">
								            <then>
                       						    <OPTION VALUE="Variables.dlkactid" SELECTED="yes" REPLACEALL="Variables.dlkactid"/><STRING.STREAM VARIABLE="dlkactname"/>
								            </then>
								            <else>
                       						    <OPTION VALUE="Variables.dlkactid" REPLACEALL="Variables.dlkactid"/><STRING.STREAM VARIABLE="dlkactname"/>
								            </else>
								            </if>
							            </then>
							            <else>
                       					    <OPTION VALUE="Variables.dlkactid" REPLACEALL="Variables.dlkactid"/><STRING.STREAM VARIABLE="dlkactname"/>
							            </else>
							            </if>
								        <inccounter NAME="DLKCOUNT" VALUE="1"/>
			  			            </loop>
			  		                </SELECT>
					            </then>
					            <else><XLAT.STREAM KEY="dvin/UI/Admin/PleaseaddDeadlockActionstochoosefrom"/>
					            </else>
					            </if>
					    </td></tr> 
       			   
 					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/Admin/Voting"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
		                        <if COND="Variables.wfs:override=true">
		                        <then>
                                    <INPUT style="margin-left:0px" TYPE="CHECKBOX" NAME="ovrd" CHECKED="true" VALUE="true"/>
		                        </then>
		                        <else>
                                    <INPUT style="margin-left:0px" TYPE="CHECKBOX" NAME="ovrd" VALUE="true"/>
		                        </else>
		                        </if>
                                &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/AllAssigneesmustvote"/>                           
					    </td></tr> 
       			    <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				    <!-- Item -->
				    <tr class="tile-row-normal">
					    <td class="form-label-text">
						    <XLAT.STREAM KEY="dvin/UI/WorkflowGroups"/>: 
					    </td> 
                        <td><br/></td>
					    <td class="form-inset">
		                        <if COND="Variables.wfs:grouplock=true">
		                        <then>
                                    <INPUT style="margin-left:0px" TYPE="CHECKBOX" NAME="lock" CHECKED="true" VALUE="true"/>
		                        </then>
		                        <else>
                                    <INPUT style="margin-left:0px" TYPE="CHECKBOX" NAME="lock" VALUE="true"/>
		                        </else>
		                        </if>
                                &nbsp;<XLAT.STREAM KEY="dvin/UI/Admin/Stepisgroupsynchronized"/>                           
					    </td></tr> 
						<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<!-- buttons -->
<INPUT TYPE="HIDDEN" NAME="pagename" VALUE=""/>
<STRING.ENCODE VARIABLE="action" VARNAME="action"/>
<INPUT TYPE="HIDDEN" NAME="action" VALUE="Variables.action" REPLACEALL="Variables.action"/>
<STRING.ENCODE VARIABLE="subaction" VARNAME="subaction"/>
<INPUT TYPE="HIDDEN" NAME="subaction" VALUE="Variables.subaction" REPLACEALL="Variables.subaction"/>
<STRING.ENCODE VARIABLE="stepaction" VARNAME="stepaction"/>
<INPUT TYPE="HIDDEN" NAME="stepaction" VALUE="Variables.stepaction" REPLACEALL="Variables.stepaction"/>

<!-- check if start step exists. You can not have more than one start steps -->

<setvar NAME="IsStartStep" VALUE="false"/>
<setcounter NAME="STEPS" VALUE="0"/>

<setvar NAME="stpT" VALUE="Variables.wfp:stepsTotal"/>
<if COND="Variables.stpT!=0">
<then>
<loop FROM="0" COUNT="Variables.stpT">
	<!-- startstate not defined -->
	<setvar NAME="tmp" VALUE="Variables.wfp:stepsCounters.STEPSstartstate"/>
	<setvar NAME="errno" VALUE="0"/>
	<begins STR="Variables.tmp" WHAT="Variables"/>
	<if COND="Variables.errno=1">
	<then>
		<setvar NAME="IsStartStep" VALUE="true"/>
		<setvar NAME="IdOfStartStep" VALUE="Variables.wfp:stepsCounters.STEPSid"/>
	</then>
	</if>
	<inccounter NAME="STEPS" VALUE="1"/>
</loop>
</then>
</if>
<removevar NAME="tmp"/>

<!-- to allow edit of start step itself -->
<if COND="Variables.stepid=Variables.IdOfStartStep">
<then>
	<setvar NAME="IsStartStep" VALUE="false"/>
</then>
</if> 
			<tr>
				<td class="form-label-text"></td>
				<td><br/></td>
				<td class="form-inset">
					<INPUT TYPE="HIDDEN" NAME="IsStartStep" VALUE="Variables.IsStartStep" REPLACEALL="Variables.IsStartStep"/>
					<XLAT.LOOKUP KEY="dvin/UI/CancelCreateStep" VARNAME="_XLAT_" ESCAPE="true"/>
					<A HREF="javascript: cancel(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					<XLAT.LOOKUP KEY="dvin/UI/SaveStep" VARNAME="_XLAT_" ESCAPE="true"/>
					<A HREF="javascript: AddStep(document.forms[0]);" onClick="return checkfields(document.forms[0]);" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Save"/></CALLELEMENT></A>
				</td>
			</tr>
	</table>
	</td></tr>
</table>
</else>
</if>

</HTML>
</FTCS>
