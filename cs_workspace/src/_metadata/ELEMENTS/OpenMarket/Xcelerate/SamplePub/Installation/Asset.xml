<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateA/install/Xcelerate/StarterPub/ElementCatalog/OpenMarket/Xcelerate/SamplePub/Installation/Asset.xml $
$Revision: 13 $
$Modtime: 8/23/01 6:03p $
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- DESCRIPTION
-    Element used to create the Assets - i.e, put an entry in the AssetType table
- 			and calls Install on the Asset's java class
-
- INPUT
-    command - command to process (deinstall or install)
-    catalog - name of asset
-	  assetDefDir - (optional) name of upload directory for this asset
-
- OUTPUT
-    result - result message string
-->


			
<!-- Check for deinstall on all assets -->

	<IF COND="Variables.catalog=AllAssets">
	<THEN>
		<ASSETTYPE.LIST LIST="AssetType"/>
		<IF COND="IsList.AssetType=true">
		<THEN>
			<LOOP LIST="AssetType">
				<LOGMSG STR="Deinstalling AssetType.assettype"/>
				<CALLELEMENT NAME="Variables.pagename">
					<ARGUMENT NAME="command" VALUE="deinstall"/>
					<ARGUMENT NAME="catalog" VALUE="AssetType.assettype"/>
					<ARGUMENT NAME="element" VALUE="Asset"/>
					<ARGUMENT NAME="result" VALUE="Variables.empty"/>
				</CALLELEMENT>
		<!-- Concatenate errors -->
				<IF COND="Variables.result!=Variables.empty">
				<THEN>
					<IF COND="IsVariable.errors=true">
					<THEN>					
						<SETVAR NAME="errors" VALUE="Variables.errors, Variables.result"/>
					</THEN>
					<ELSE>
						<SETVAR NAME="errors" VALUE="Variables.result"/>
					</ELSE>
					</IF>
				</THEN>
				</IF>
			</LOOP>
			<IF COND="IsVariable.errors=true">
			<THEN>
				<SETVAR NAME="result" VALUE="Variables.errors"/>
			</THEN>
			</IF>
		</THEN>
		</IF>
		<REMOVEVAR NAME="command"/>
	</THEN>
	</IF>
			
	<SETVAR NAME="assetname" VALUE="Variables.catalog"/>
<!-- Check for a deinstall command -->

	<IF COND="Variables.command=deinstall">
	<THEN>
<!-- Attempt to delete the catalog -->

     	<ASSET.DEINSTALL TYPE="Variables.assetname"/> 

<!-- Check for success -->

		<IF COND="IsError.Variables.errno=true">
		<THEN>
			<SETVAR NAME="result" VALUE="errno Variables.errno from deinstall of Variables.assetname"/>
		</THEN>
		<ELSE>
<!-- Delete the entry from the AssetType table -->
   		<ASSETTYPE.LOAD NAME="theAssetType" TYPE="Variables.assetname"/>

<!-- Check for success -->

			<IF COND="IsError.Variables.errno=true">
			<THEN>
				<SETVAR NAME="result" VALUE="errno Variables.errno loading asset type, Variables.assetname"/>
			</THEN>
			<ELSE>
				<ASSETTYPE.DELETE NAME="theAssetType"/>

<!-- Check for success -->

				<IF COND="IsError.Variables.errno=true">
				<THEN>
					<SETVAR NAME="result" VALUE="errno Variables.errno deleting asset type, Variables.assetname"/>
				</THEN>
				</IF>
			</ELSE>
			</IF>
		</ELSE>
		</IF>
	</THEN>
	</IF>

<!-- Check for an install command -->

		<IF COND="Variables.command=install">
		<THEN>

<!-- Attempt to create the entry in the AssetType table -->

     		<ASSETTYPE.CREATE NAME="theAssetType"/>
<!-- Check for success -->

			<IF COND="IsError.Variables.errno=true">
			<THEN>
				<SETVAR NAME="result" VALUE="errno Variables.errno creating an asset type, Variables.assetname"/>
			</THEN>
			</IF>

			<SETVAR NAME="at:assettype" VALUE="Variables.assetname"/>
			<SETVAR NAME="at:logic" VALUE="com.openmarket.sampleasset.asset.Variables.assetname"/>
			<SETVAR NAME="at:description" VALUE="Variables.assetname"/>
			<SETVAR NAME="at:plural" VALUE="Variables.assetnames"/>
			<SETVAR NAME="at:canbechild" VALUE="T"/>

         <ASSETTYPE.GATHER NAME="theAssetType" PREFIX="at"/>
         <ASSETTYPE.SAVE NAME="theAssetType"/>
<!-- Check for success -->

			<IF COND="IsError.Variables.errno=true">
			<THEN>
				<SETVAR NAME="result" VALUE="errno Variables.errno from saving asset type, Variables.assetname"/>
			</THEN>
			<ELSE>
<!-- Create the Asset table -->
				<IF COND="IsVariable.assetDefDir=true">
				<THEN>
 	  				<ASSET.INSTALL TYPE="Variables.assetname" CLASS="com.openmarket.sampleasset.asset.Variables.assetname" DIR="Variables.assetDefDir" ACL="Browser,SiteGod,xceleditor,xceladmin" />
				</THEN>
				<ELSE>
	 				<ASSET.INSTALL TYPE="Variables.assetname" CLASS="com.openmarket.sampleasset.asset.Variables.assetname" ACL="Browser,SiteGod,xceleditor,xceladmin"/> 
				</ELSE>
				</IF>

				<IF COND="IsError.Variables.errno=true">
				<THEN>
					<SETVAR NAME="result" VALUE="errno Variables.errno from installing asset, Variables.assetname with com.openmarket.sampleasset.asset.Variables.assetname"/>
				</THEN>
				</IF>
			</ELSE>
			</IF>
			<REMOVEVAR NAME="assetDefDir"/>
	
		</THEN>
		</IF>
</FTCS>
