<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!--
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/ContentDetailsFront.xml $
$Revision: 38 $
$Modtime: 6/28/04 3:02p $
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- ContentDetailsFront.xml
-
- DESCRIPTION
-	Get ContentDetails and display
-
- HISTORY
-->
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>

<if COND="Variables.cs_environment=popup">
<then>
    <!-- A popup window, show close button -->
    <button onclick="window.close()"><XLAT.STREAM KEY="dvin/Common/Closethiswindow" /></button>
</then>
</if>

<setvar NAME="assetname" VALUE="theCurrentAsset"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id" />
<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetname"/>
<if COND="IsError.Variables.errno=false">
<then>
	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/AccessCheck">
		<ARGUMENT NAME="assetObjectName" VALUE="theCurrentAsset"/>
		<ARGUMENT NAME="AssetType" VALUE="Variables.AssetType"/>
		<ARGUMENT NAME="pubid" VALUE="SessionVariables.pubid"/>
		<ARGUMENT NAME="id" VALUE="Variables.id"/>
		<ARGUMENT NAME="Function" VALUE="inspect"/>
	</CALLELEMENT>
	<IF COND="Variables.error!=Variables.empty">
	<THEN>
		<!-- if we are in the inspect screen due to an error performing another function,
			then leave only the first error displayed -->
		<if COND="Variables.errorAlreadyDisplayed!=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
				<argument NAME="error" VALUE="Variables.error"/>
				<argument NAME="assettype" VALUE="Variables.AssetType"/>
				<argument NAME="id" VALUE="Variables.id"/>
			</callelement>
		</then>
		</if>
	</THEN>
	<ELSE>
	
	
	
		<ASSET.GET NAME="Variables.assetname" FIELD="id" OUTPUT="id"/>
		<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/GetContentDetails">
			<argument NAME="getaux" VALUE="true"/>
			<argument NAME="qryprefix" VALUE="ContentDetails"/>
			<argument NAME="assetname" VALUE="Variables.assetname"/>
		</callelement>
		<if COND="IsError.Variables.errno=true">
		<then>
			<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
				<argument NAME="error" VALUE="InvalidContentId"/>
				<argument NAME="assettype" VALUE="Variables.AssetType"/>
				<argument NAME="id" VALUE="Variables.id"/>
			</callelement>
		</then>
		<else>
			<!-- if the user is authorized to view the asset, show the whole thing -->
			<WORKFLOWASSET.LOAD ASSETTYPE="Variables.AssetType" ID="Variables.id" OBJVARNAME="workflowasset" />
			<WORKFLOWENGINE.ISFUNCTIONLEGAL OBJECT="workflowasset" FUNCTIONNAME="inspect" SITE="SessionVariables.pubid" VARNAME="isLegal" MUSTBEASSIGNED="false"/>
			<IF COND="Variables.isLegal=true">
			<THEN>
				<callelement NAME="OpenMarket/Xcelerate/AssetType/Variables.AssetType/ContentDetails"/>
			</THEN>
			<!-- user is not authorized - put up a warning and a truncated inspect display -->
			<ELSE>
				<if COND="Variables.errorAlreadyDisplayed!=true">
				<then>
					<XLAT.LOOKUP KEY="dvin/UI/Error/notallowedInspect" VARNAME="msgtext"/>
					<IF COND="IsVariable.denialReason=true">
					<THEN>
						<SETVAR NAME="msgtext" VALUE="Variables.msgtext Variables.denialReason"/>
					</THEN>
					</IF>
	            <CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
	                <ARGUMENT NAME="severity" VALUE="error"/>
	                <ARGUMENT NAME="msgtext" VALUE="Variables.msgtext"/>
	            </CALLELEMENT>
	         </then>
	         </if>
				<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/MinimalContentDetails"/>
			</ELSE>
			</IF>
		</else>
		</if>
	</ELSE>
	</IF>
</then>
<else>
	<br/>
	<XLAT.STREAM KEY="dvin/UI/Error/ASSETLOADidfailederrorerrno" errno="Variables.errno" id="Variables.id" EVALALL="false"/>
	<br/><if COND="IsVariable.errdetail1=true">
	<then>
		<STRING.STREAM VALUE="Variables.errdetail1"/>
	</then>
	</if>
	<callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
		<argument NAME="error" VALUE="InvalidContentId"/>
	</callelement>
</else>
</if>
<if COND="Variables.cs_environment=popup">
<then>
    <!-- A popup window, show close button -->
    <button onclick="window.close()"><XLAT.STREAM KEY="dvin/Common/Closethiswindow" /></button>
</then>
</if>
</FTCS>
