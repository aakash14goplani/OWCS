<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/Workflow/SetGroupAssigneesForAskStep
-
- INPUT
-   id, AssetType, AskStep
-   groupid, workflowid (optioinal)
-
- OUTPUT
-   assigneeroles, user id list for each role
-
-->

<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
function CancelSetAssignees(cancelpage) 
{ 
    var obj = document.forms[0].elements[0];
    obj.form.elements['pagename'].value = cancelpage;
		obj.form.elements['didCancel'].value = true;
}
function SetAssignees() 
{ 
    var obj = document.forms[0].elements[0];

    if (typeof(obj.form.elements['assigneeroles']) != 'undefined' &&
         obj.form.elements['assigneeroles'].value!="")
    {
        var allRoles = obj.form.elements['assigneeroles'].value;
        roleArray = allRoles.split(",");
        var currentSel,j,numSelected;
        for (var i=0;i<roleArray.length;i++)
        {
            numSelected=0;
            currentSel = obj.form.elements['ask:' + roleArray[i]];
            
            for (j=0;j<currentSel.options.length;j++)
            {
                if (currentSel.options[j].selected)
                    numSelected++;
            }
            
            if (numSelected==0)
            {
					]]>
          		  var replacestr=/\bVariables.role\b/ ;
          		  var xlatstr='<XLAT.STREAM KEY="dvin/UI/Error/UsersOfTheRoleNotSelected" ENCODE="false" ESCAPE="true"/>';
          	     alert(xlatstr.replace(replacestr, roleArray[i]));
      			<![CDATA[
                return false;
            }
        }
    }
}

]]>
</SCRIPT>

<IF COND="IsVariable.cancelpage!=true">
	<THEN>
		<SETVAR NAME="cancelpage" VALUE="OpenMarket/Xcelerate/Actions/WorkflowGroupDetailsFront" />
	</THEN>
</IF>
<INPUT TYPE="HIDDEN" NAME="didCancel" VALUE=""/>
<!-- from AddToGroupPost -->
<WorkflowEngine.GetGroupID ID="Variables.groupid" OBJVARNAME="grpobj"/>
<WorkflowGroup.GetName NAME="grpobj" VARNAME="groupname" />
    
	<!-- load and scatter the group -->
<WORKFLOWGROUP.SCATTER PREFIX="wfg:" NAME="grpobj"/>
<setvar NAME="name" VALUE="Variables.wfg:name"/>
    

<WORKFLOWENGINE.GetCompleteAssignmentCandidateAssignees SITE="SessionVariables.pubid" NEXTSTEP="Variables.AskStep" OBJVARNAME="partsobj" />
<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
	<span class="title-text">
	<XLAT.STREAM KEY="dvin/UI/SetAssigneesforAskStep"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
<table class="width-outer-70" BORDER="0" CELLSPACING="0" CELLPADDING="0">
			<tr><td>
			<XLAT.STREAM KEY="dvin/UI/Pleaseselectatleastoneuserfromeachrole"/><br/> 
			<PARTICIPANTS.GETALLROLES NAME="partsobj" VARNAME="roles" />
			<STRINGLIST NAME="roleslist" STR="Variables.roles" DELIM="," />
			<INPUT TYPE="hidden" NAME="assigneeroles" VALUE="Variables.roles" REPLACEALL="Variables.roles"/>
			<REMOVEVAR NAME="roles"/></td></tr>
			</table>

<table class="width-outer-50" BORDER="0" CELLSPACING="0" CELLPADDING="0">
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
		<tr>
            <td class="form-label-text" NOWRAP="NOWRAP">
                <XLAT.STREAM KEY="dvin/Common/Name"/>:
            </td>
            <td class="form-inset">
               <STRING.STREAM VALUE="Variables.name"/><BR />
            </td>
        </tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text" NOWRAP="NOWRAP">
                <XLAT.STREAM KEY="dvin/Common/Description"/>:
            </td>
            <td class="form-inset">
               <STRING.STREAM VALUE="Variables.wfg:description"/><BR />
            </td>
        </tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text" NOWRAP="NOWRAP">
                <XLAT.STREAM KEY="dvin/Common/ID"/>:
            </td>
            <td class="form-inset">
               	<STRING.STREAM VALUE="Variables.groupid"/><BR />
            </td>
        </tr>
        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text" NOWRAP="NOWRAP">
                <XLAT.STREAM KEY="dvin/Common/WorkflowProcess"/>:
            </td>
            <td class="form-inset">
				<WORKFLOWENGINE.GETPROCESSID ID="Variables.wfg:process" OBJVARNAME="processObject"/>
				<WORKFLOWPROCESS.GETPROCESSNAME NAME="processObject" VARNAME="processName"/>
				<STRING.STREAM VALUE="Variables.processName"/><BR />
            </td>
        </tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
        <tr>
            <td class="form-label-text">
                <XLAT.STREAM KEY="dvin/Common/Assignees"/>:
            </td>
            <td class="form-inset" ALIGN="LEFT" WIDTH="300">
                
            <table BORDER="0" CELLSPACING="0" CELLPADDING="0" >
            <tr>
                <td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
            </tr>
            <tr>
                <td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
                <td >
                    <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="9" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
                    <tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
                        <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
						<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Role"/></DIV></td>
                        <td class="tile-b" style="background:url('Variables.cs_imagedir/graphics/common/screen/grad_inner.gif')" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="tile-b" style="background:url('Variables.cs_imagedir/graphics/common/screen/grad_inner.gif')" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="tile-b" style="background:url('Variables.cs_imagedir/graphics/common/screen/grad_inner.gif')" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Users"/></DIV></td>
                        <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
						<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
                    </tr>
                    <tr><td colspan="9" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
						<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
                        <!-- for each role, list the available participants -->
                        <setvar NAME="rowStyle" VALUE="tile-row-normal"/>
                        <loop LIST="roleslist">
                            <tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle"><td><BR /></td>
                                <td VALIGN="TOP"><BR /></td>                    
                                <td valign="TOP" align="LEFT" style="font-weight:bold" nowrap="NOWRAP">
                                    <span class="alert-color">*</span><STRING.STREAM VALUE="roleslist.ITEM"/>:
                                </td>
								<td><BR /></td>
            					<td><BR /></td>
            					<td><BR /></td>
                                <td class="form-inset" NOWRAP="NOWRAP" ALIGN="LEFT">
            
                                <Participants.GetParticipantsForRole NAME="partsobj" ROLE="roleslist.ITEM" LISTVARNAME="userslist" />
                                <USERMANAGER.GETUSERIDS LIST="userslist" PREFIX="ruser:"/>
                                <SELECT NAME="ask:roleslist.ITEM" MULTIPLE="yes" class="UITransferBox" style="width:150px;height:150px;" REPLACEALL="roleslist.ITEM">
                                <if COND="IsVariable.ruser:Total=true">
                                  <then>
                                    <if COND="Variables.ruser:Total!=0">
                                    <then>
                                      <SETCOUNTER NAME="USERCOUNT" VALUE="0"/>
                                        <LOOP FROM="0" COUNT="Variables.ruser:Total">
                                          <CCUSER.GETID NAME="ruser:Counters.USERCOUNT" VARNAME="uid"/>
                                          <CCUser.GETDISPLAYABLENAME NAME="ruser:Counters.USERCOUNT" VARNAME="uname"/>		
                                          <OPTION VALUE="Variables.uid" REPLACEALL="Variables.uid"/><STRING.STREAM VALUE="Variables.uname"/>
                                          <INCCOUNTER NAME="USERCOUNT" VALUE="1"/>
                                        </LOOP>
                                    </then>
                                    </if>
                                  </then>
                                </if>
                                </SELECT>
                                </td><td><BR /></td><td><BR /></td>
                            </tr>
                            <IF COND="Variables.rowStyle=tile-row-normal">
                            <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
                            </THEN>
                            <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
                            </ELSE>
                            </IF>
                        </loop>
                        <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
                    </table>
                    </td>
                    <td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
                </tr>
                <tr>
                <td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
                </tr>
                <tr>
                <td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
                </tr>
                </table>	
            </td>
        </tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
		<tr><td><BR/></td>
			<td>
			<XLAT.LOOKUP KEY="dvin/UI/CancelSetAssigneesforAskStep" VARNAME="_XLAT_"/>
			<XLAT.LOOKUP KEY="dvin/UI/CancelSetAssigneesforAskStep" VARNAME="mouseover" ESCAPE="true"/>
			<A HREF="javascript:void(0);" onClick="if(CancelSetAssignees('Variables.cancelpage')!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables.mouseover';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables.mouseover,Variables.cancelpage"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
			<XLAT.LOOKUP KEY="dvin/UI/SetAssigneesforAskStep" VARNAME="_XLAT_"/>
			<XLAT.LOOKUP KEY="dvin/UI/SetAssigneesforAskStep" VARNAME="mouseover" ESCAPE="true"/>
			<A HREF="javascript:void(0);" onClick="if(SetAssignees()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables.mouseover';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables.mouseover"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SetAssignees"/></CALLELEMENT></A>
			</td></tr>
    </table>
</FTCS> 
