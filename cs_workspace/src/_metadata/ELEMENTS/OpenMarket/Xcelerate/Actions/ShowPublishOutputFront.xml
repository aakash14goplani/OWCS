<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/ShowPublishOutputFront
-
- INPUT
-
- OUTPUT
-
-->
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>

<!-- Continue only if conditions from prologactions are satisfied -->
<if COND="Variables.doproceed=true">
<then>
<if COND="IsError.Variables.errno=true">
<then>
    <P><XLAT.STREAM KEY="dvin/UI/Error/notloadgetpathpublishingerrno2"/>
    </P>
</then>
<else>
	<PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
	<PUBTARGET.GETFACTORS NAME="pubtgt" VARNAME="pubtgt:factors"/>
	<PUBTARGET.UNPACK NAME="pubtgt" PREFIX="pubtgt:" FIELD="factors"/>

</else>
</if>

<if COND="IsError.Variables.errno=false">
<then>
     <DELIVERYTYPE.LOAD NAME="pubdt" OBJECTID="Variables.pubtgt:type"/>
     <DELIVERYTYPE.GET NAME="pubdt" FIELD="path" OUTPUT="pubdt:path"/>
     <DELIVERYTYPE.GET NAME="pubdt" FIELD="name" OUTPUT="pubdt:name"/>
    <if COND="IsError.Variables.errno=true">
     <then>
          <P><XLAT.STREAM KEY="dvin/UI/notloadgetpatpublishingdeliverytypeerrno2"  errno="Variables.errno" EVALALL="false"/>
          </P>
     </then>
     </if>
</then>
</if>
<PUBSESSION.GETSTATUS NAME="pubsess" VARNAME="pubsess:status"/>

<if COND="Variables.pubsess:status=running">
<then>
<SCRIPT TYPE="text/javascript">
<![CDATA[
var oReloadTimer = null;
var oCounterTimer = null;
var iCounter = 9;

function initDoc() {
if (oReloadTimer) window.clearInterval(oReloadTimer);
oReloadTimer = window.setInterval("reloadDocument();",10000);

// This code is not neccesary:
if (oCounterTimer) window.clearInterval(oCounterTimer);
oCounterTimer = window.setInterval("runReloadCounter();",1000);
}

function reloadDocument() {
window.location.reload();
}

function runReloadCounter() {
var oReloadContent = document.getElementById("ReloadContent");
if (oReloadContent) {
if (iCounter < 0) {
iCounter = 10;
}
oReloadContent.innerHTML = "]]><XLAT.STREAM KEY="dvin/Common/ThisPageWillReloadIn"/><![CDATA[".replace('Variables.count', iCounter);
iCounter--;
}
}

window.onload = initDoc;
]]>
</SCRIPT>
</then>
</if>
<if COND="Variables.pubsess:status=running">
<then>
	
	<tr><td colspan="3">
<div id="ReloadContent">
<SETVAR Name="count" Value="10" />
<XLAT.STREAM KEY="dvin/Common/ThisPageWillReloadIn"/>
</div></td>
</tr>
</then>
</if>


<table border="0" cellpadding="0" cellspacing="0">

	<tr>
		<td><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Publishsession"/>: </span><span class="title-value-text"><STRING.STREAM VARIABLE="OutputQString"/></span></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar">
		<argument NAME="SpaceBelow" VALUE="No"/>
	</callelement>

	<tr>
	<td>
	
	<table border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Destination"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><XLAT.STREAM KEY="dvin/UI/Publish/pubtgtnameusingpubdtname"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Arguments"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><string.stream VARIABLE="pubtgt:factors"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/PublishedBy"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<PUBSESSION.GETUSER NAME="pubsess" VARNAME="pubsess:publishedby"/>
		<td class="form-inset"><STRING.STREAM VALUE="Variables.pubsess:publishedby"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/PublishDate"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset">
		<PUBSESSION.GETSTARTDATE NAME="pubsess" VARNAME="pubsess:publishdate"/>
		<DATEFORMAT.GETDATETIME NAME="_FormatDate_" VALUE="Variables.pubsess:publishdate" VALUETYPE="jdbcdate"  VARNAME="pubsess:publishdate"/>
		<STRING.STREAM VALUE="Variables.pubsess:publishdate"/></td>
	</tr>

	<PUBSESSIONMANAGER.GETMESSAGES ID="Variables.OutputQString" LISTVARNAME="msgs"/>

	<IF COND="msgs.#numRows!=0">
	<THEN>
		<tr>
		<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Messages"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset">
		   <LOOP LIST="msgs">
		      <STRING.STREAM VALUE="msgs.ITEM"/><br/>
		   </LOOP>
			
		</td>
		</tr>
        </THEN>
	</IF>

	<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->

</table>
<table border="0" cellpadding="0" cellspacing="0">

	<tr>
	<td COLSPAN="3">
				
	<PublishClient.Retrieve ID="Variables.OutputQString" OUTPUT="output"/>
	
	<if COND="Variables.output!=Variables.empty">
	<then>
		  <IF COND="IsVariable.limit=false">
		  <THEN>
		  		<SETVAR NAME="limit" VALUE="50"/>
		  	</THEN>
		  	</IF>
		<STRING.ENCODE VARIABLE="limit" VARNAME="limit"/>
        <CALLELEMENT NAME="Variables.pubdt:path/ShowPublishedAssets">
        		<ARGUMENT NAME="limit" VALUE="Variables.limit"/>
        </CALLELEMENT>
	</then>
	<else>
	     <PublishClient.Status ID="Variables.OutputQString" OUTPUT="status" />
	     <BEGINS STR="Variables.status" WHAT="Not found" />
             <if COND="Variables.errno=1">
             <then>
	          <XLAT.STREAM KEY="dvin/UI/Nopublishstatusdetails" ENCODE="false"/>
	     </then>
	     </if>
	</else>
	</if>
	</td>
	</tr>
</table>

<br/>

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PublishConsoleFront" outstring="urlpubconsfront">
    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
</SATELLITE.LINK>
<A HREF="Variables.urlpubconsfront" REPLACEALL="Variables.urlpubconsfront"><IMG BORDER="0" HEIGHT="12" WIDTH="15" src="Variables.cs_imagedir/graphics/common/icon/doubleArrow.gif" REPLACEALL="Variables.cs_imagedir"/>
<b><XLAT.STREAM KEY="dvin/UI/GotoPublishConsole"/></b></A>

</td>
</tr>
</table>
</then></if>
</FTCS> 
