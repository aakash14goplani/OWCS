<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/ShowPublishableAssetsFront
-
- INPUT
-
- OUTPUT
-
-->
<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="target" VARNAME="target"/>
<!-- Continue only if conditions from prologactions are satisfied -->
<if COND="Variables.doproceed=true">
<then>
<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PublishFront" outstring="urlpubfront">
    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
    <satellite.argument name="target" value="Variables.target"/>
</SATELLITE.LINK>

<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/PublishConsoleFront" outstring="urlpubpost">
    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
    <satellite.argument name="target" value="Variables.target"/>
	<satellite.argument name="startPublishing" value="true"/>
</SATELLITE.LINK>
<SCRIPT LANGUAGE="JavaScript">
<replaceall LIST="Variables.urlpubfront,Variables.urlpubpost,Variables.ODQueue:Length">
<![CDATA[

function BackHandler()
{
    var pURL = "Variables.urlpubfront"; ]]>
    <if cond="Variables.cs_environment=portal">
    <then>
        window.location=pURL;
    </then>
    <else>
        parent.frames['XcelAction'].location=pURL;
    </else>
    </if> <![CDATA[
    return false;
}

function setCheck(form)
{
       ]]>
   if (confirm("<XLAT.STREAM KEY="dvin/UI/Publish/AboutToPublish" ESCAPE="true" ENCODE="false"/>")) {
      <![CDATA[
          var pURL = "Variables.urlpubpost"; ]]>
        <if cond="Variables.cs_environment=portal">
        <then>
            window.location=pURL;
        </then>
        <else>
            parent.frames['XcelAction'].location=pURL;
        </else>
        </if> <![CDATA[
	return false;
     }

    return false;
}

function setODCheck(form)
{
if ($('ODQueueSize').value == '0'){
			showMsg('_t1',']]><XLAT.STREAM KEY="dvin/UI/Publish/OnDemandQueueEmpty"/><![CDATA[');
			showMsg('_t2',']]><XLAT.STREAM KEY="dvin/UI/Publish/OnDemandQueueEmpty"/><![CDATA[');
			showMsg('_t3',']]><XLAT.STREAM KEY="dvin/UI/Publish/OnDemandQueueEmpty"/><![CDATA[');
			return false;
	}
    ]]>  
   if (confirm("<XLAT.STREAM KEY="dvin/UI/Publish/AboutToPublish" ESCAPE="true" ENCODE="false"/>")) {
      <![CDATA[
          var pURL = "Variables.urlpubpost"; 
		]]>
        <if cond="Variables.cs_environment=portal">
        <then>
            window.location=pURL + "&#38;publishOnDemandQueue=true";
        </then>
        <else>
            parent.frames['XcelAction'].location=pURL+ "&#38;publishOnDemandQueue=true";
        </else>
        </if> <![CDATA[
	return false;
     }

    return false;
}

]]>
</replaceall>
</SCRIPT>

<PUBTARGETMANAGER.LOAD ID="Variables.target" OBJVARNAME="pubtgt"/>
<if COND="IsError.Variables.errno=false">
<then>
	<PUBTARGET.SCATTER NAME="pubtgt" PREFIX="pubtgt:"/>
	<PUBTARGET.GETFACTORS NAME="pubtgt" VARNAME="pubtgt:factors"/>
     <DELIVERYTYPE.LOAD NAME="pubdt" OBJECTID="Variables.pubtgt:type"/>
     <DELIVERYTYPE.GET NAME="pubdt" FIELD="path" OUTPUT="pubdt:path"/>
     <DELIVERYTYPE.GET NAME="pubdt" FIELD="name" OUTPUT="pubdt:name"/>
    <if COND="IsError.Variables.errno=true">
     <then>
          <P><XLAT.STREAM KEY="dvin/UI/notloadgetpatpublishingdeliverytypeerrno2" errno="Variables.errno" EVALALL="false"/>
          </P>
     </then>
     </if>
</then>
</if>

<table border="0" cellpadding="0" cellspacing="0" class="width-outer-70">

	<tr>
		<td><span class="title-text"><XLAT.STREAM KEY="dvin/UI/Publishdestination"/>:  </span><span class="title-value-text"><STRING.STREAM VALUE="Variables.pubtgt:name"/></span></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar">
		<argument NAME="SpaceBelow" VALUE="No"/>
	</callelement>

	<tr>
	<td>
	
	<table border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Destination"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><XLAT.STREAM KEY="dvin/UI/Publish/pubtgtnameusingpubdtname"/></td>
	</tr>

	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Arguments"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><STRINGLIST   NAME="factorsList" STR="Variables.pubtgt:factors" DELIM="%26"/>
		<loop LIST="factorsList">
		<INDEXOF STR="factorsList.ITEM" WHAT="EMAILIDS" OUTSTR="index" INDEX="0"/>
		<IF COND="Variables.errno=0">
			<THEN>
				<span><STRING.STREAM VALUE="factorsList.ITEM"/><BR/></span>
			</THEN>
		</IF>
		</loop>
		</td>
	</tr>
	<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
	</table>
	</td>
	</tr>
</table>

<!-- unapprove first -->
<IF COND="Variables.function=unapprove"><THEN>
  <IF COND="IsVariable.assetsToUnApprove=true">
  <THEN>
	<STRINGLIST NAME="assetsListToUnApprove" STR="Variables.assetsToUnApprove" DELIM="%20"/>
		<LOOP LIST="assetsListToUnApprove">
			<setvar name="asset" value="assetsListToUnApprove.ITEM"/>
			<STRINGLIST NAME="assetIDTypeList" STR="Variables.asset" DELIM=":"/>
			<LOOP LIST="assetIDTypeList">
			<IF COND="assetIDTypeList.#curRow=1">
			<THEN>
				<setvar name="AssetType" value="assetIDTypeList.ITEM"/>
			</THEN>
			</IF>
			<IF COND="assetIDTypeList.#curRow=2">
			<THEN>
				<setvar name="id" value="assetIDTypeList.ITEM"/>
			</THEN>
			</IF>
			</LOOP>
			<ASSET.LIST LIST="lunapproveMe" FIELD1="id" VALUE1="Variables.id" TYPE="Variables.AssetType"/>
            <APPROVEDASSETS.NOTESAVE ID="Variables.id" TYPE="Variables.AssetType" UPDATEDDATE="lunapproveMe.updateddate"/>
		</LOOP>
  </THEN>
  <ELSE>
  <ASSET.LIST LIST="lunapproveMe" FIELD1="id" VALUE1="Variables.id" TYPE="Variables.AssetType"/>
  <APPROVEDASSETS.NOTESAVE ID="Variables.id" TYPE="Variables.AssetType" UPDATEDDATE="lunapproveMe.updateddate"/>
  </ELSE>
  </IF>
</THEN></IF>

<if COND="IsError.Variables.errno=false">
<then>
    <if COND="IsElement.Variables.pubdt:path/PreviewApprovedAssets=true">
    <then> 
        <callelement NAME="Variables.pubdt:path/PreviewApprovedAssets">
            <argument NAME="targetname" VALUE="Variables.pubtgt:name" />
            <argument NAME="target" VALUE="Variables.target" />
        </callelement>
    </then>
    <else>
        <P><XLAT.STREAM KEY="dvin/UI/Error/notfindPreviewApprovedAssetsdeliverytype"/>
        </P>
    </else>
    </if>
</then>
</if>
<table>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<IF COND="IsVariable.oDemandEnabled=false">
<THEN>
<USERISMEMBER GROUP="xcelpublish"/>
<IF COND="Variables.errno=1">
	<THEN>
	<tr>
		<td align="right"><XLAT.LOOKUP KEY="dvin/UI/Back" VARNAME="_XLAT_" ESCAPE="true"/>
			<A HREF="javascript:void(0)" onclick="return BackHandler()" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Back"/></CALLELEMENT></A>

   </td>
   <td></td>
   <td></td>
</tr>
</THEN>
</IF>
</THEN>
</IF>
</table>
</then></if>
</FTCS> 