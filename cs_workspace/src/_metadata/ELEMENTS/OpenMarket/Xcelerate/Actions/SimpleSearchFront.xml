<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/SimpleSearchFront.xml $ 
$Revision: 22 $ 
$Modtime: 7/30/04 4:03p $ 
-->
<!-- OpenMarket/Xcelerate/Actions/SimpleSearchFront
--   Confidential and Proprietary Information of Open Market, Inc.
--					All Rights Reserved.
--
-- INPUT
--
-- OUTPUT
--
-->

<!-- Load the search engine specific strings -->
<STRING.ENCODE VARIABLE="ThisPage" VARNAME="ThisPage"/> 
<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/> 
<STRING.ENCODE VARIABLE="frontpage" VARNAME="frontpage"/> 
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/> 

	<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/Search/seDescription"/>
     
     <if COND="IsVariable.frompage!=true">
    <then>
        <INPUT type="hidden" name="frontpage" VALUE="Variables.ThisPage" REPLACEALL="Variables.ThisPage"/>
        <INPUT type="hidden" name="postpage" VALUE="Variables.PostPage" REPLACEALL="Variables.PostPage"/>
    </then>
    <else>
        <INPUT type="hidden" name="frontpage" VALUE="Variables.frontpage" REPLACEALL="Variables.frontpage"/>
        <INPUT type="hidden" name="postpage" VALUE="Variables.postpage" REPLACEALL="Variables.postpage"/>
    </else>
    </if>
          
	<IF COND="IsVariable.cs_StartID=true">
	<THEN>
        <STRING.ENCODE VARIABLE="cs_StartID" VARNAME="OutputQString"/>
        <INPUT TYPE="hidden" NAME="cs_StartID" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>

        <!-- Load start menu item for subtype. -->
        <STARTMENU.LOAD ID="Variables.cs_StartID" OBJVARNAME="si"/>
        <STARTMENUITEM.GETASSETSUBTYPE NAME="si" VARNAME="cs_assetsubtype"/>

        <if COND="IsVariable.cs_assetsubtype=true">
			<then>       
				<IF COND="IsVariable.flextemplateid=true">
					<THEN>
			 <fatm.gettemplatetype ASSETTYPE="Variables.AssetType" VARNAME="templatetype"/>
			 <ASSET.LIST TYPE="Variables.templatetype" FIELD1="name" VALUE1="Variables.cs_assetsubtype" LIST="result"/>
			 <INPUT TYPE="hidden" NAME="flextemplateid" VALUE="result.id" REPLACEALL="result.id"/>
			 <SETVAR NAME="appendCountQuery" VALUE="Variables.AssetType.flextemplateid=result.id"/>
					</THEN>
				</IF>        
				<IF COND="IsVariable.flexgrouptemplateid=true">
					<THEN>
						 <fgtm.gettemplatetype ASSETTYPE="Variables.AssetType" VARNAME="templatetype"/>
						 <ASSET.LIST TYPE="Variables.templatetype" FIELD1="name" VALUE1="Variables.cs_assetsubtype" LIST="result"/>
						 <INPUT TYPE="hidden" NAME="flexgrouptemplateid" VALUE="result.id" REPLACEALL="result.id"/>
						 <SETVAR NAME="appendCountQuery" VALUE="Variables.AssetType.flexgrouptemplateid=result.id"/>   
					</THEN>
				</IF>

				<IF COND="IsVariable.flextemplateid=false">
				<THEN>
					<IF COND="IsVariable.flexgrouptemplateid=false">
					<THEN>			   
						   <fatm.gettemplatetype ASSETTYPE="Variables.AssetType" VARNAME="templatetype"/>
						   <IF COND="IsVariable.templatetype=true">
						   <THEN>
								<ASSET.LIST TYPE="Variables.templatetype" FIELD1="name" VALUE1="Variables.cs_assetsubtype" LIST="result"/>
								<INPUT TYPE="hidden" NAME="flextemplateid" VALUE="result.id" REPLACEALL="result.id"/>
								<SETVAR NAME="appendCountQuery" VALUE="Variables.AssetType.flextemplateid=result.id"/>
						   </THEN>
						   <ELSE>
								<fgtm.gettemplatetype ASSETTYPE="Variables.AssetType" VARNAME="templatetype"/>
								<IF COND="IsVariable.templatetype=true">
								<THEN>
									<ASSET.LIST TYPE="Variables.templatetype" FIELD1="name" VALUE1="Variables.cs_assetsubtype" LIST="result"/>
									<INPUT TYPE="hidden" NAME="flexgrouptemplateid" VALUE="result.id" REPLACEALL="result.id"/>
									<SETVAR NAME="appendCountQuery" VALUE="Variables.AssetType.flexgrouptemplateid=result.id"/>
								</THEN>
								</IF>
						   </ELSE>
						   </IF>
					</THEN>
					</IF>
				</THEN>
				</IF>

		   </then>
     	</if>
    </THEN>
	</IF>
	<!-- Load the asset type -->

	
	<ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType"/>
	<ASSETTYPE.SCATTER NAME="type" PREFIX="AssetTypeObj"/>

<!--
    If this content category does not use a search engine, then define the
    traditional Javascript functions for creating SQL query fragments.
-->

<IF COND="Variables.AssetTypeObj:usesearchindex!=1">
  <THEN>
    <callelement NAME="OpenMarket/Xcelerate/Scripts/FormatDate"/>
  </THEN>
  <ELSE>
    <SCRIPT LANGUAGE="JavaScript1.2">
    function formatSetDate(datestr, obj, formfield) {
        obj.form.elements[formfield].value = datestr;
    }
    </SCRIPT>
  </ELSE>
</IF>
<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td><span class="title-text"><XLAT.STREAM KEY="dvin/UI/SearchforAssetTypeObjplural"/></span></td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
</table>
<callelement NAME="OpenMarket/Xcelerate/Actions/Search/SimpleSearch"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="OutputQString"/>
<ics.literal table="AssetPublication" column="assettype" string="Variables.OutputQString"
    output="literal"/>
<setvar NAME="tablename" VALUE="Variables.OutputQString"/>

<IF COND="IsVariable.appendCountQuery=true">
<THEN>
	<EXECSQL LIST="ContentCount" SQL="SELECT count(*) as thecount FROM AssetPublication,Variables.OutputQString WHERE (AssetPublication.pubid=SessionVariables.pubid or AssetPublication.pubid=0) AND AssetPublication.assettype=Variables.literal AND AssetPublication.assetid=Variables.OutputQString.id AND Variables.OutputQString.status!='VO' AND Variables.appendCountQuery" TABLE="Variables.OutputQString,AssetPublication"/>
</THEN>
<ELSE>
	<EXECSQL LIST="ContentCount" SQL="SELECT count(*) as thecount FROM AssetPublication,Variables.OutputQString WHERE (AssetPublication.pubid=SessionVariables.pubid or AssetPublication.pubid=0) AND AssetPublication.assettype=Variables.literal AND AssetPublication.assetid=Variables.OutputQString.id AND Variables.OutputQString.status!='VO'" TABLE="Variables.OutputQString,AssetPublication"/>
</ELSE>
</IF>

<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td class="form-inset"><XLAT.STREAM KEY="dvin/UI/TotalAssetTypeObjplural"/>: <CSVAR NAME="ContentCount.thecount"/></td>
	</tr>
</table>
				
				
	
</FTCS>
