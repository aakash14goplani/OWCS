<?xml version="1.0"?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
	<!-- OpenMarket/Xcelerate/Actions/ShowStartMenuItems
-
- Note: This template is referenced by com.openmarket.xcelerate.jsp.insite.CreateAsset class.
-
- INPUT
-
-   assettypes - comma-separated list of assettypes. Used to limit the assettypes that show up in the list.
-   startmenu - Name of the start menu item that should be loaded and executed directly. If this parameter
-               is passed, then the start menu will be executed right away, instead of showing the list.
-
- OUTPUT
-
-->
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
	<if COND="Variables.didCancel=true">
		<then>
			<ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType"/>
			<ASSETTYPE.SCATTER NAME="type" PREFIX="AssetTypeObj"/>
			<XLAT.LOOKUP KEY="dvin/UI/AssetMgt/NewContent-CancelNew" VARNAME="_xlat_cancel"/>
			<div class="width-outer-70">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
				<argument NAME="msgtext" VALUE="Variables._xlat_cancel"/>
				<argument NAME="severity" VALUE="info"/>
			</callelement>
			</div>
		</then>
	</if>
	<if COND="Variables.cs_environment=popup">
		<then>
			<div>
				<!-- A popup window, show close button -->
				<button onclick="window.close()">
					<XLAT.STREAM KEY="dvin/Common/Closethiswindow"/>
				</button>
			</div>
			<br/>
		</then>
	</if>
	<PROPERTY.GET PARAM="advancedUI.enableAssetForms" INIFILE="futuretense_xcel.ini" VARNAME="_enableForms"/>
	<if COND="IsVariable.startmenu=true">
		<then>
			<if COND="Variables.didCancel!=true">			
				<then>
					<SETVAR NAME="isStartMenuFound" VALUE="false"/>
					<!-- "startmenu" is passed. Find the record -->
					<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" LISTVARNAME="items"/>
					<LOOP LIST="items">					
						<if COND="Variables.startmenu=items.name">
							<then>
								<!--Check if asset forms are enabled in the ui -->
								<if cond="Variables._enableForms!=true">
								<then>
									<callelement NAME="OpenMarket/Xcelerate/Util/CheckTypeForGenerateLink">
										<argument NAME="assettype" VALUE="items.assettype"/>
									</callelement>
								</then>
								</if>
								<if cond="Variables.navigateLink=true">
								<then>
									<setvar name="IsAuthorized" value="false"/>
								</then>
								<else>
									<!-- Record found. See if the assettype is enabled -->
								<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/EnableAssetTypePub">
									<argument NAME="upcommand" VALUE="IsAssetTypeEnabled"/>
									<argument NAME="assettype" VALUE="items.assettype"/>
									<argument NAME="pubid" VALUE="SessionVariables.pubid"/>
								</callelement>
								</else>
								</if>
								<if COND="Variables.IsAuthorized=true">								
									<then>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/NewContentFront" outstring="NewAssetURL">
											<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
											<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
											<satellite.argument name="AssetType" value="items.assettype"/>
											<satellite.argument name="StartItem" value="items.id"/>
											<satellite.argument name="startmenu" value="Variables.startmenu"/>
											<if COND="IsVariable.assettypes=true">
												<then>
													<satellite.argument name="assettypes" value="Variables.assettypes"/>
												</then>
											</if>
										</SATELLITE.LINK>
										<REPLACEALL LIST="Variables.NewAssetURL">
											<script language="Javascript">
                        document.location = "Variables.NewAssetURL";
                    </script>
										</REPLACEALL>
										<SETVAR NAME="isStartMenuFound" VALUE="true"/>
									</then>
								</if>
							</then>
						</if>
					</LOOP>
					<if COND="Variables.isStartMenuFound=false">
						<then>							
							<XLAT.LOOKUP KEY="fatwire/InSite/StartMenuNotFound" VARNAME="_xlat_"/>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
								<argument NAME="msgtext" VALUE="Variables._xlat_"/>
								<argument NAME="severity" VALUE="info"/>
							</callelement>
						</then>
					</if>
				</then>
			</if>
		</then>
		<else>		
			<if COND="IsVariable.assettypes=true">
							<then>
					<STRINGLIST NAME="listAssetTypes" STR="Variables.assettypes" DELIM=","/>
					<HASH.CREATE NAME="hAssetTypes" LIST="listAssetTypes" COLUMN="ITEM"/>
				</then>
				<else>			
					<HASH.CREATE NAME="hAssetTypes"/>					
				</else>
			</if>
			
						<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
							<tr><td>
								<span class="title-text"><XLAT.STREAM KEY="dvin/Common/New"/></span>
							</td></tr>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
						</table>
										<!-- Loop over all search results. -->
										<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
										<SETVAR NAME="separatorLine" VALUE="0"/>
										<HASH.CREATE NAME="hDisplayedAssetTypes"/>
										<STARTMENU.GETMATCHINGSTARTITEMS ITEMTYPE="ContentForm" PUBID="SessionVariables.pubid" LISTVARNAME="items"/>
										<IF COND="IsList.items=true">									
											<THEN>											
												<IF COND="items.#numRows!=0">
													<THEN>		
													<table class="width-outer-50" border="0" cellpadding="0" cellspacing="0">															
															<tr>
																<td>
																	<img height="0" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
																</td>
															</tr>
															<tr>
																<td>
																	<span class="table-header-text">
																		<XLAT.STREAM KEY="dvin/UI/SelectAssetTypeCreate"/>
																	</span>
																	<BR/>
															&nbsp;
														</td>
															</tr>
															<tr>
																<td>
													<!-- Table header -->
														<table class="width-inner-100" BORDER="0" CELLSPACING="0" CELLPADDING="0">
															<tr>
																<td/>
																<td class="tile-dark" VALIGN="TOP" HEIGHT="1">
																	<IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
																</td>
																<td/>
															</tr>
															<tr>
																<td class="tile-dark" VALIGN="top" WIDTH="1" nowrap="nowrap">
																	<BR/>
																</td>
																<td>
																<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff">
																	<tr>
																		<td colspan="6" class="tile-highlight">
																			<IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
																		</td>
																	</tr>
																	<tr>
																		<td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																	&nbsp;</td>
																		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																	&nbsp;</td>
																		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																			<DIV class="new-table-title">
																				<XLAT.STREAM KEY="dvin/Common/Type"/>
																			</DIV>
																		</td>
																		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																	&nbsp;&nbsp;&nbsp;&nbsp;</td>
																		<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																			<DIV class="new-table-title">
																				<XLAT.STREAM KEY="dvin/Common/Name"/>
																			</DIV>
																		</td>
																		<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">
																	&nbsp;</td>
																	</tr>
																	<tr>
																		<td colspan="6" class="tile-dark">
																			<IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
																		</td>
																	</tr>
														<LOOP LIST="items">
															<HASH.HASDATA NAME="hAssetTypes" VARNAME="hasData"/>
															<!--Check if asset forms are enabled in the ui -->
															<if cond="Variables._enableForms!=true">
															<then>
																<callelement NAME="OpenMarket/Xcelerate/Util/CheckTypeForGenerateLink">
																	<argument NAME="assettype" VALUE="items.assettype"/>
																</callelement>
															</then>
															</if>
															<if cond="Variables.navigateLink=true">
															<then>
																<setvar name="IsAuthorized" value="false"/>
															</then>
															<else>
																<if COND="Variables.hasData=true">
																	<then>
																		<HASH.CONTAINS NAME="hAssetTypes" VALUE="items.assettype" VARNAME="IsAuthorized"/>
																	</then>
																	<else>
																		<SETVAR NAME="IsAuthorized" VALUE="true"/>
																	</else>
																</if>
															</else>
															</if>
															<if COND="Variables.IsAuthorized=true">
																<then>
																	<callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/EnableAssetTypePub">
																		<argument NAME="upcommand" VALUE="IsAssetTypeEnabled"/>
																		<argument NAME="assettype" VALUE="items.assettype"/>
																		<argument NAME="pubid" VALUE="SessionVariables.pubid"/>
																	</callelement>
																</then>
															</if>
															<if COND="Variables.IsAuthorized=true">
																<then>																
																	<!-- Add the AssetType to the displayed list -->
																	<HASH.ADD NAME="hDisplayedAssetTypes" VALUE="items.assettype"/>
																	<IF COND="Variables.separatorLine=1">
																		<THEN>
																			<tr>
																				<!--<td colspan="6" class="light-line-color">
																					<img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
																				</td>-->
																			</tr>
																		</THEN>																		
																	</IF>
																	<SETVAR NAME="separatorLine" VALUE="1"/>
																	<ASSETTYPE.LIST LIST="ThisAsset" FIELD1="assettype" VALUE1="items.assettype"/>
																	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/NewContentFront" outstring="NewAssetURL">
																		<satellite.argument name="cs_environment" value="Variables.cs_environment"/>
																		<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
																		<satellite.argument name="AssetType" value="items.assettype"/>
																		<satellite.argument name="StartItem" value="items.id"/>
																		<if COND="IsVariable.assettypes=true">
																			<then>
																				<satellite.argument name="assettypes" value="Variables.assettypes"/>
																			</then>
																		</if>
																	</SATELLITE.LINK>
																	<tr class="Variables.rowStyle" REPLACEALL="Variables.rowStyle">
																		<td>
																			<BR/>
																		</td>
																		<td>
																			<BR/>
																		</td>
																		<td VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
																			<DIV class="small-text-inset">
																				<STRING.STREAM VALUE="ThisAsset.description"/>
																			</DIV>
																		</td>
																		<td>
																			<BR/>
																		</td>
																		<td VALIGN="TOP" ALIGN="LEFT">
																			<DIV class="small-text-inset">
																				<a href="Variables.NewAssetURL" REPLACEALL="Variables.NewAssetURL">
																					<IF COND="items.description!=Variables.empty">
																						<THEN>
																							<STRING.STREAM VALUE="items.description"/>
																						</THEN>
																						<ELSE>
																							<STRING.STREAM VALUE="items.name"/>
																						</ELSE>
																					</IF>
																				</a>
																			</DIV>
																		</td>
																		<td>
																			<BR/>
																		</td>
																	</tr>
																	<IF COND="Variables.rowStyle=tile-row-normal">
																		<THEN>
																			<SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
																		</THEN>
																		<ELSE>
																			<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
																		</ELSE>
																	</IF>
																</then>
																
															</if>
														</LOOP>
														</table>
														</td>
															<td class="tile-dark" VALIGN="top" WIDTH="1" nowrap="nowrap">
																<BR/>
															</td>
														</tr>
														<tr>
															<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1">
																<IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
															</td>
														</tr>
														<tr>
															<td/>
															<td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir">
																<IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/>
															</td>
															<td/>
														</tr>
													</table>
													</td>
												</tr>
												<!-- Display the page footer. -->
												<!--
												<tr>
													<td><img height="10" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
												</tr>
												<tr>
													<td class="dark-line-color"><img height="2" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
												</tr> -->
											</table>
										</THEN>
										<ELSE>	
											<div class="width-outer-70">																				
											<XLAT.LOOKUP KEY="UI/UC1/Layout/YouDoNotHaveAnyNewStartMenus" VARNAME="_xlat_"/>
											<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
												<argument NAME="msgtext" VALUE="Variables._xlat_"/>
												<argument NAME="severity" VALUE="warning"/>
											</callelement>
											</div>
								</ELSE>
									</IF>
								</THEN>
								
							</IF>
									
								
					
			<br/>
			<!-- Now check if any passed assettypes have not been displayed. If there is, show the error message. -->
			<if COND="IsVariable.assettypes=true">
				<then>
					<SETVAR NAME="listAssetTypesNotDisplayed" VALUE=""/>
					<LOOP LIST="listAssetTypes">
						<HASH.CONTAINS NAME="hDisplayedAssetTypes" VALUE="listAssetTypes.ITEM" VARNAME="isDisplayed"/>
						<if COND="Variables.isDisplayed=false">
							<then>
								<SETVAR NAME="listAssetTypesNotDisplayed" VALUE="Variables.listAssetTypesNotDisplayed, listAssetTypes.ITEM"/>
							</then>
						</if>
					</LOOP>
					<STRING.LENGTH VALUE="Variables.listAssetTypesNotDisplayed" VARNAME="strlen"/>
					<if COND="Variables.strlen!=0">
						<then>
							<SUBSTRING STR="Variables.listAssetTypesNotDisplayed" OUTSTR="assettypes" INDEX="2"/>
							<XLAT.LOOKUP KEY="fatwire/InSite/AssettypeNotFound" VARNAME="_xlat_"/>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
								<argument NAME="msgtext" VALUE="Variables._xlat_"/>
								<argument NAME="severity" VALUE="info"/>
							</callelement>
						</then>
					</if>
				</then>
			</if>
		</else>
	</if>
	<if COND="Variables.cs_environment=popup">
		<then>
			<br/>
			<div>
				<!-- A popup window, show close button -->
				<button onclick="window.close()">
					<XLAT.STREAM KEY="dvin/Common/Closethiswindow"/>
				</button>
			</div>
		</then>
	</if>
</FTCS>
