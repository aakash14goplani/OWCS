<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/AssetMgt/PubTargetStatus
-
- INPUT
- Variables.target - id of pubtarget object
- Variables.targetobj - loaded pubtarget object
- Variables.assetid
- Variables.assettype
- Variables.assetname - name of the loaded asset object
- Variables.targettype - 'export' or 'mirror'
- Variables.pubtgt:name - name of pubtarget
- OUTPUT
-
-->
<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/ApprovalStatus">
	<ARGUMENT NAME="target" VALUE="Variables.target"/>
	<ARGUMENT NAME="pubtargetname" VALUE="Variables.pubtgt:name"/>
	<ARGUMENT NAME="assetid" VALUE="Variables.id"/>
	<ARGUMENT NAME="assettype" VALUE="Variables.AssetType"/>
	<ARGUMENT NAME="assetname" VALUE="theAsset"/>
</CALLELEMENT>

  <table Border="0" cellpadding="0" cellspacing="0">
  <if COND="Variables.cs_environment=ucform">
  <then>
	  <tr>
		<td style="padding-left:0;"><XLAT.STREAM KEY="dvin/Common/ApprovalState"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset"><STRING.STREAM VALUE="Variables.approvalState"/>&nbsp;<STRING.STREAM VALUE="Variables.approvalDetails"/>			
		</td>
	  </tr>
	</then>
	<else>
  
 <IF COND="IsVariable.NoPreview!=true">
 <THEN>
    <PREVIEWURL.MAKEURL VARNAME="previewURL" ASSETTYPE="Variables.assettype" ASSETID="Variables.assetid" PUBID="SessionVariables.pubid" TARGET="Variables.target"/>
    <IF COND="IsVariable.previewURL=true">
    <THEN>
        <tr>
            <td colspan="3" class="form-label-text" style="text-align:left;">
            <XLAT.LOOKUP KEY="dvin/Common/Preview" VARNAME="_XLAT_"/>
            <XLAT.LOOKUP KEY="dvin/Common/Preview" VARNAME="mouseover" ESCAPE="true"/>            
            <A HREF="javascript:void(0)" onclick="openPreview('Variables.previewURL');" onmouseover="window.status='Variables.mouseover';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.previewURL,Variables.mouseover"><img height="14" width="14" src="Variables.cs_imagedir/graphics/common/icon/iconPreviewContentUp.gif" hspace="10" border="0" title="Variables._XLAT_" alt="Variables._XLAT_" REPLACEALL="Variables.cs_imagedir,Variables._XLAT_"/><XLAT.STREAM KEY="dvin/UI/AssetMgt/Previewthisforpubtgtname"/></A></td>
       </tr>
    </THEN>
    </IF>
</THEN>
 </IF>
<tr>
	<td class="form-label-text" style="padding-left:0;"><XLAT.STREAM KEY="dvin/Common/ApprovalState"/>:</td>
	<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	<td class="form-inset"><STRING.STREAM VALUE="Variables.approvalState"/>&nbsp;<STRING.STREAM VALUE="Variables.approvalDetails"/><br/>
	<if COND="Variables.approvalAction!=none">
	<then>
		<if COND="Variables.approvalAction=approve">
		<then>
			<REPLACEALL LIST="Variables.assettype,Variables.assetid,Variables.target">
					 <SCRIPT>
							<![CDATA[
							var getHiddenElement = function(name,value){
								var elm = document.createElement("input");
   								elm.type = "hidden";
								elm.name = name;
								elm.value = value;
								return elm;
							};
							
							var approveAsset = function(){
								if(!document.AppForm.elements['assetTotal'])
									document.AppForm.appendChild(getHiddenElement('assetTotal',"1"));
								if(!document.AppForm.elements['type0'])
									document.AppForm.appendChild(getHiddenElement('type0',"Variables.assettype"));
								if(!document.AppForm.elements['id0'])
									document.AppForm.appendChild(getHiddenElement('id0',"Variables.assetid"));
								if(!document.AppForm.elements['targetid'])
									document.AppForm.appendChild(getHiddenElement('targetid',"Variables.target"));
								if(!document.AppForm.elements['pagename'])
									document.AppForm.appendChild(getHiddenElement('pagename',"OpenMarket/Xcelerate/Actions/ApprovePost"));
								document.AppForm.submit();
							};
							]]> 
					</SCRIPT>
					</REPLACEALL>
			
			<SATELLITE.FORM ASSEMBLER="query" NAME="ApprovalPost" METHOD="POST" TARGET="_top">
			<XLAT.LOOKUP KEY="dvin/UI/Approvethisitem" VARNAME="_XLAT_" ESCAPE="true"/>
			<A HREF="#" ONCLICK="approveAsset();return false;" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables._XLAT_"><img height="20" width="16" src="Variables.cs_imagedir/graphics/common/icon/iconApprove.gif" hspace="2" border="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/AssetMgt/Approvethisasset"/></A>
			</SATELLITE.FORM>
		</then>
		</if>
		<if COND="Variables.approvalAction=releaseBlocking">
		<then>
			<XLAT.LOOKUP KEY="dvin/UI/Showassetsholdingthisassetfrombeingpublished" VARNAME="_XLAT_" ESCAPE="true"/>
            <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowBlockingAssetsFront" outstring="urlblockinassets">
                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                       <satellite.argument name="AssetType" value="Variables.assettype"/>
                       <satellite.argument name="id" value="Variables.assetid"/>
                       <satellite.argument name="target" value="Variables.target"/>
                        </SATELLITE.LINK>
			<A HREF="Variables.urlblockinassets" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlblockinassets,Variables._XLAT_"><img height="20" width="16" src="Variables.cs_imagedir/graphics/common/icon/iconApprove.gif" hspace="2" border="0" REPLACEALL="Variables.cs_imagedir"/><XLAT.STREAM KEY="dvin/UI/AssetMgt/Showassetspreventingpublish"/></A>. 
		</then>
		</if>
		<if COND="Variables.approvalAction=checkin">
		<then>
			<XLAT.LOOKUP KEY="dvin/UI/Checkinasset" VARNAME="_XLAT_" ESCAPE="true"/>
			<XLAT.LOOKUP KEY="dvin/UI/Checkinasset" VARNAME="_xlat_checkin"/>
			<XLAT.LOOKUP KEY="dvin/UI/UndoCheckout" VARNAME="_xlat_undocheckout"/>
			<XLAT.LOOKUP KEY="dvin/UI/UndoCheckout" VARNAME="_xlat_M_undocheckout" ESCAPE="true"/>
            <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/CommitFront" outstring="urlcommitfront">
                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                       <satellite.argument name="AssetType" value="Variables.assettype"/>
                       <satellite.argument name="id" value="Variables.assetid"/>
                        </SATELLITE.LINK>
            <table><tr><td>
			<A HREF="Variables.urlcommitfront" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlcommitfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/CheckIn"/></CALLELEMENT></A>
			</td><td> 
             <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/UnlockFront" outstring="urlunlockfront">
                 <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                       <satellite.argument name="AssetType" value="Variables.assettype"/>
                       <satellite.argument name="id" value="Variables.assetid"/>
                        </SATELLITE.LINK>
            <A HREF="Variables.urlunlockfront"  onmouseover="window.status='Variables._xlat_M_undocheckout';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlunlockfront,Variables._xlat_M_undocheckout"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/UndoCheckout"/></CALLELEMENT></A> 
            </td></tr></table>
		</then>
		</if>
	</then>
	</if>			
	</td>
</tr>
<if COND="Variables.targettype=export">
<then>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/Template"/>:</td>
	<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	<td class="form-inset">
			<!-- Get the default target from the AssetDefaultTemplate table, or if not there, from the asset -->
		<ASSET.GetTemplateForTarget NAME="theCurrentAsset" TARGET="Variables.target" OUTPUT="defTemplate"/>
		<if COND="IsVariable.defTemplate=true">
		<then>
			<STRING.STREAM VALUE="Variables.defTemplate"/>
		</then>
		</if>
	</td>
</tr>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/FileorPath"/>:</td>
	<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	<XLAT.LOOKUP KEY="dvin/UI/AssetMgt/PubTargetStatus-SpecifyPathorFnameforTarget" VARNAME="_XLAT_" ESCAPE="true"/>
	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/SetAssetExportDataFront" outstring="urlassetexportdata">
        <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
        <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                       <satellite.argument name="AssetType" value="Variables.AssetType"/>
                       <satellite.argument name="id" value="Variables.id"/>
                       <satellite.argument name="target" value="Variables.target"/>
                        </SATELLITE.LINK>
    <td class="form-inset"><A NAME="AssetExportData for Variables.pubtgt:name" HREF="Variables.urlassetexportdata" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true"  REPLACEALL="Variables.urlassetexportdata,Variables.pubtgt:name,Variables._XLAT_">
		<XLAT.STREAM KEY="dvin/UI/AssetMgt/SpecifyPathorFnameStartpts"/>
		</A>
	</td>
</tr>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<ApprovedAssets.GetPerm TARGET="Variables.target" ASSETID="Variables.id" OBJVARNAME="publishpoints" />
	<PublishPoints.GetAll NAME="publishpoints" PREFIX="refs"/>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/AssetMgt/Startpoints"/>:</td>
	<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
	<td class="form-inset">
		<if COND="Variables.refsTotal=0">
		<then>
			<XLAT.STREAM KEY="dvin/UI/AssetMgt/Notanexportstartingpoint"/>
		</then>
		<else>
			<SETCOUNTER NAME="nthRef" VALUE="0"/>
			<LOOP COUNT="Variables.refsTotal">
				<EXPORTKEY.SCATTER NAME="refsCounters.nthRef" PREFIX="ref"/>
				<EXPORTKEY.GETREFERENCE NAME="refsCounters.nthRef" REFERENCE="reference"/>
					<RENDER.GETPAGEDISKNAME REFERENCE="Variables.reference" TARGETID="Variables.target" OUTSTR="diskname" />
                   <STRING.STREAM VALUE="Variables.ref:pagename"/> (<STRING.STREAM VALUE="Variables.diskname"/>)<br/>
				<INCCOUNTER NAME="nthRef" VALUE="1"/>
			</LOOP>
		</else>
		</if>
	</td>	
	</tr>
</then>
</if>
<ApprovedAssets.GetDependencies TARGET="Variables.target" ID="Variables.assetid" TYPE="Variables.assettype" LISTVARNAME="depAssets"/>
<if COND="IsList.depAssets=true">
<then>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Dependents"/>:</td>
		<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
		<td class="form-inset">
			<if COND="depAssets.#numRows!=0">
			<then>
				<XLAT.LOOKUP KEY="dvin/UI/Showdependentassetsforthisitem" VARNAME="_XLAT_" ESCAPE="true"/>
                <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ShowDependentAssets" outstring="urlshowdepassets">
                    <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                    <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                       <satellite.argument name="AssetType" value="Variables.assettype"/>
                       <satellite.argument name="id" value="Variables.assetid"/>
                       <satellite.argument name="target" value="Variables.target"/>
                        </SATELLITE.LINK>
				<A HREF="Variables.urlshowdepassets" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.urlshowdepassets,Variables._XLAT_">
				<if COND="depAssets.#numRows=1">
				<then>
					<XLAT.STREAM KEY="dvin/UI/AssetMgt/depAssetsdependentasset"/>
				</then>
				<else>
					<XLAT.STREAM KEY="dvin/UI/AssetMgt/depAssetsdependentassets"/>
				</else>
				</if>
				</A>
			</then>
			<else>
				<!-- if asset needs approving, we do not know how many depedent -->
				<if COND="Variables.approvalAction=approve">
				<then>
					<XLAT.STREAM KEY="dvin/UI/AssetMgt/AssetnotapprovedDependtassetsnotcal"/>
				</then>
				<else>
					<XLAT.STREAM KEY="dvin/UI/AssetMgt/Nodependentassets"/>
				</else>
				</if>
			</else>
			</if>
		</td>
	</tr>
</then>
</if>
</else>
</if>
</table>
 

</FTCS> 
