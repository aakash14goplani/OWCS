<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/SetGroupParticipants
-
- INPUT
-
- OUTPUT
-
- HISTORY
 [2008-02-26 KGF]
 * XSS fix: encode HTML special chars in description
-->
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<SCRIPT LANGUAGE="JavaScript">
<![CDATA[
function CancelSetParticipants() 
{ 
var obj = document.forms[0].elements[0];
obj.form.elements['pagename'].value = "OpenMarket/Xcelerate/Actions/EditWorkflowGroupFront";
	obj.form.elements['action'].value = "update";
    obj.form.elements['subaction'].value = "cancel";
}
function selectAll(ourPage,op)
{

	var obj = document.forms[0].elements[0];

	if (typeof(obj.form.elements['allRoles']) != 'undefined' &&
			 obj.form.elements['allRoles'].value!="")
	{
		var allRoles = obj.form.elements['allRoles'].value;
		roleArray = allRoles.split(",");
		var currentSel,j,numSelected;
		for (var i=0;i<roleArray.length;i++)
		{

			numSelected=0;
			currentSel = obj.form.elements[roleArray[i]];
			for (j=0;j<currentSel.options.length;j++)
			{
				currentSel.options[j].selected=true;
				numSelected++;
			}
		}
	}
	return false;
}
function SaveParticipants() 
{ 
var obj = document.forms[0].elements[0];

	if (typeof(obj.form.elements['allRoles']) != 'undefined' &&
		 obj.form.elements['allRoles'].value!="")
	{
		var allRoles = obj.form.elements['allRoles'].value;
		roleArray = allRoles.split(",");
		var currentSel,j,numSelected;
		for (var i=0;i<roleArray.length;i++)
		{
			numSelected=0;
			currentSel = obj.form.elements[roleArray[i]];
			
			for (j=0;j<currentSel.options.length;j++)
			{
				if (currentSel.options[j].selected)
					numSelected++;
			}
			
			if (numSelected==0)
			{
                ]]>
                var replacestr=/\bVariables.role\b/ ;
                 var xlatstr='<XLAT.STREAM KEY="dvin/UI/Error/UsersOfTheRoleNotSelected" ENCODE="false" ESCAPE="true"/>';
          	     alert(xlatstr.replace(replacestr, roleArray[i]));
                <![CDATA[
				return false;
			}
		}
	}
	obj.form.elements['pagename'].value = "OpenMarket/Xcelerate/Actions/EditWorkflowGroupFront";
	obj.form.elements['subaction'].value = "setparticipants";
}

]]>
</SCRIPT>

<table class="width-outer-70" cellspacing="0" cellpadding="0" border="0">
	<tr><td>
		<span class="title-text"><XLAT.STREAM KEY="dvin/UI/SetParticipantsforGroup"/>: <STRING.STREAM VALUE="Variables.name"/></span>
	</td></tr>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>
	<tr><td>
		<B><XLAT.STREAM KEY="dvin/UI/Pleaseselectatleastoneuserfromeachrole"/></B>
	</td></tr>
</table>
		<STRING.ENCODE VARIABLE="action" VARNAME="action"/>
		<INPUT TYPE="HIDDEN" NAME="action" VALUE="Variables.action" REPLACEALL="Variables.action"/>
		<STRING.ENCODE VARIABLE="new" VARNAME="new"/>
		<INPUT TYPE="HIDDEN" NAME="new" VALUE="Variables.new" REPLACEALL="Variables.new"/>
		<STRING.ENCODE VARIABLE="name" VARNAME="name"/>
		<INPUT TYPE="HIDDEN" NAME="name" VALUE="Variables.name" REPLACEALL="Variables.name"/>
		<SETVAR NAME="OutputQString" VALUE="Variables.empty"/>
		<STRING.ENCODE VARIABLE="description" VARNAME="OutputQString"/>
		<INPUT TYPE="HIDDEN" NAME="description" VALUE="Variables.OutputQString" REPLACEALL="Variables.OutputQString"/>
		<STRING.ENCODE VARIABLE="editroles" VARNAME="editroles"/>
		<INPUT TYPE="HIDDEN" NAME="editroles" VALUE="Variables.editroles" REPLACEALL="Variables.editroles"/>
		<STRING.ENCODE VARIABLE="removeroles" VARNAME="removeroles"/>
		<INPUT TYPE="HIDDEN" NAME="removeroles" VALUE="Variables.removeroles" REPLACEALL="Variables.removeroles"/>
		<STRING.ENCODE VARIABLE="process" VARNAME="process"/>
		<INPUT TYPE="HIDDEN" NAME="process" VALUE="Variables.process" REPLACEALL="Variables.process"/>
		<STRING.ENCODE VARIABLE="grpactions" VARNAME="grpactions"/>
		<INPUT TYPE="HIDDEN" NAME="grpactions" VALUE="Variables.grpactions" REPLACEALL="Variables.grpactions"/>
		<STRING.ENCODE VARIABLE="addremove" VARNAME="addremove"/>
		<INPUT TYPE="HIDDEN" NAME="addremove" VALUE="Variables.addremove" REPLACEALL="Variables.addremove"/>
		<STRING.ENCODE VARIABLE="editdelete" VARNAME="editdelete"/>
		<INPUT TYPE="HIDDEN" NAME="editdelete" VALUE="Variables.editdelete" REPLACEALL="Variables.editdelete"/>
		<STRING.ENCODE VARIABLE="pdeadline" VARNAME="pdeadline"/>
		<INPUT TYPE="HIDDEN" NAME="pdeadline" VALUE="Variables.pdeadline" REPLACEALL="Variables.pdeadline"/>

    <if COND="IsVariable.cancel_allRoles=true">
    <then>
		<STRING.ENCODE VARIABLE="cancel_allRoles" VARNAME="cancel_allRoles"/>
        <INPUT TYPE="HIDDEN" NAME="cancel_allRoles" VALUE="Variables.cancel_allRoles" REPLACEALL="Variables.cancel_allRoles"/>
         
        <stringlist NAME="roleslist" STR="Variables.cancel_allRoles" DELIM="," />
        <loop LIST="roleslist">          
            <ics.getvar name="roleslist.ITEM" encoding="default" OUTPUT="cancel_users" />
	     <STRING.ENCODE VARIABLE="cancel_users" VARNAME="cancel_users"/>
            <INPUT TYPE="hidden" NAME="cancel_roleslist.ITEM" VALUE="Variables.cancel_users" REPLACEALL="roleslist.ITEM,Variables.cancel_users"/>
        </loop>
         
    </then>
    </if>  
    <if COND="IsVariable.cancel_process=true">
    <then> 
		<STRING.ENCODE VARIABLE="cancel_process" VARNAME="cancel_process"/>
        <INPUT TYPE="HIDDEN" NAME="cancel_process" VALUE="Variables.cancel_process" REPLACEALL="Variables.cancel_process"/>
    </then>
    </if>
<STRING.ENCODE VARIABLE="donotsetProcessDeadline" VARNAME="donotsetProcessDeadline"/>
<INPUT TYPE="hidden" NAME="donotsetProcessDeadline" VALUE="Variables.donotsetProcessDeadline" REPLACEALL="Variables.donotsetProcessDeadline"/>
<STRING.ENCODE VARIABLE="dosetpdeadline" VARNAME="dosetpdeadline"/>
<INPUT TYPE="hidden" NAME="dosetpdeadline" VALUE="Variables.dosetpdeadline" REPLACEALL="Variables.dosetpdeadline"/>


<IF COND="IsVariable.id=true">
	<THEN>
		<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
		<INPUT TYPE="HIDDEN" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
	</THEN>
	</IF>
		<WORKFLOWENGINE.GETPROCESSID ID="Variables.process" OBJVARNAME="workflowobj"/>
		<WORKFLOWPROCESS.GETPROCESSNAME NAME="workflowobj" VARNAME="workflowname" />

        <WORKFLOWENGINE.GETPOTENTIALPARTICIPANTS OBJVARNAME="myParts" SITE="SessionVariables.pubid" PROCESS="Variables.process"/>
		<PARTICIPANTS.GETALLROLES NAME="myParts" VARNAME="roles" />
        	
        <stringlist NAME="roleslist" STR="Variables.roles" DELIM="," />
		<INPUT TYPE="HIDDEN" NAME="allRoles" VALUE="Variables.roles" REPLACEALL="Variables.roles"/>

		<REMOVEVAR NAME="roles"/>
 
<table class="width-outer-50" BORDER="0" CELLSPACING="0" CELLPADDING="0">
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" VALIGN="TOP" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/Common/GroupName"/>:
				</td>
				<td class="form-inset" VALIGN="TOP">
					<STRING.STREAM VALUE="Variables.name"/><BR />
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" VALIGN="TOP" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/AT/Common/Description"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VARIABLE="description"/><BR />
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<tr>
				<td class="form-label-text" VALIGN="TOP" NOWRAP="NOWRAP">
					<XLAT.STREAM KEY="dvin/Common/WorkflowProcess"/>:
				</td>
				<td class="form-inset">
					<STRING.STREAM VALUE="Variables.workflowname"/><BR />
				</td>
			</tr>
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	        
            <tr>
				<td class="form-label-text" VALIGN="TOP">
					<XLAT.STREAM KEY="dvin/Common/Participants"/>:
				</td>
				<td class="form-inset" VALIGN="top" ALIGN="LEFT">
					
		<table BORDER="0" CELLSPACING="0" CELLPADDING="0" >
     <tr>
		<td></td><td class="tile-dark" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
	</tr>
	<tr>
	<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
	<td >
	<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="6" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
		<tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Role"/></DIV></td>
            <td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/Common/Users"/></DIV></td>
			<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
		</tr>
		<tr><td colspan="6" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>

                <!-- for each role, list the available participants -->
		 		<setcounter NAME="ROLECOUNT" VALUE="0"/>
     			<setvar NAME="rowStyle" VALUE="tile-row-normal"/>
				<SETVAR NAME="separatorLine" VALUE="0"/>
				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
                <loop LIST="roleslist">
                	<IF COND="Variables.separatorLine=1">
					<THEN>
					<tr>
						<!--<td colspan="6" class="light-line-color"><img height="1" width="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>-->
					</tr>
					</THEN>
				</IF>

				<SETVAR NAME="separatorLine" VALUE="1"/>
			<tr class="Variables.rowStyle"  REPLACEALL="Variables.rowStyle">
				<td><BR /></td>
                <td><BR /></td>
                <td class="form-label-text" VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
                    <span class="alert-color">*</span><STRING.STREAM VALUE="roleslist.ITEM"/>:
                 </td>
 				<td><BR /></td>
 				<td class="form-inset" VALIGN="TOP" NOWRAP="NOWRAP" ALIGN="LEFT">
					<removevar NAME="ruser:Total"/>
				  	<PARTICIPANTS.GETPARTICIPANTSFORROLE NAME="myParts" ROLE="roleslist.ITEM" LISTVARNAME="rulist"/>
				  	<USERMANAGER.GETUSERIDS LIST="rulist" PREFIX="ruser:"/>
	              	<ics.getvar name="roleslist.ITEM" encoding="default" OUTPUT="testvar" />
				 	<STRINGLIST NAME="ulist" STR="Variables.testvar" DELIM=";"/>
				  	<HASH.CREATE NAME="hashroleslist.ITEM" LIST="ulist" COLUMN="ITEM"/>
				  	<SELECT NAME="roleslist.ITEM" MULTIPLE="yes" SIZE="4" REPLACEALL="roleslist.ITEM">
				  	<if COND="IsVariable.ruser:Total=true">
				  	<then>
						<if COND="Variables.ruser:Total!=0">
						<then>
							<setcounter NAME="USERCOUNT" VALUE="0"/>
							<loop FROM="0" COUNT="Variables.ruser:Total">
					  			<CCUSER.GETID NAME="ruser:Counters.USERCOUNT" VARNAME="uid"/>
								<CCUser.GETDISPLAYABLENAME NAME="ruser:Counters.USERCOUNT" VARNAME="uname"/>
								<HASH.CONTAINS NAME="hashroleslist.ITEM" VALUE="Variables.uid" VARNAME="hasit"/>
								<if COND="Variables.hasit=true">
								<then>
		                      			<OPTION VALUE="Variables.uid" REPLACEALL="Variables.uid" SELECTED="yes"/><STRING.STREAM VALUE="Variables.uname"/>
								</then>
								<else>
		                      			<OPTION VALUE="Variables.uid" REPLACEALL="Variables.uid"/><STRING.STREAM VALUE="Variables.uname"/>
								</else>
								</if>				
								<inccounter NAME="USERCOUNT" VALUE="1"/>
							</loop>
							</then>
							</if>
					  </then>
					  </if>
					  </SELECT>
					  <inccounter NAME="ROLECOUNT" VALUE="1"/>
			  	</td>
			  	<td><BR /></td>
			</tr>
            <IF COND="Variables.rowStyle=tile-row-normal">
            <THEN><SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
            </THEN>
            <ELSE><SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
            </ELSE>
            </IF>
            <callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
		    </loop>
	</table>
	</td>
		<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
		</tr>
			<tr>
			<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
			</tr>
			<tr>
			<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
			</tr>
			<TR><TD></TD>
				<td ALIGN="RIGHT" WIDTH="1">
					<XLAT.LOOKUP KEY="dvin/Common/SelectAll" VARNAME="_XLAT_"/>
					<A HREF="javascript:document.forms;" onClick="return selectAll();" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SelectAll"/></CALLELEMENT></A>
				</td>
			</TR>

			</table>	
				</td>
			</tr>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar" />
		<tr><td><br/></td><td>
			<INPUT TYPE="HIDDEN" NAME="subaction" VALUE=""/>
			<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
			<INPUT type="hidden" name="pagename" value="OpenMarket/Xcelerate/Actions/Variables.PostPage" REPLACEALL="Variables.PostPage"/>
			<XLAT.LOOKUP KEY="dvin/UI/CancelSetParticipantsforWorkflowGroup" VARNAME="_XLAT_" ESCAPE="true"/>
			<A HREF="javascript:void(0);" onClick="if(CancelSetParticipants()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>

			<XLAT.LOOKUP KEY="dvin/UI/SetParticipantsforWorkflowGroup" VARNAME="_XLAT_" ESCAPE="true"/>
			<A HREF="javascript:void(0);" onClick="if(SaveParticipants()!=false){document.forms['AppForm'].submit(); return false;}" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SetParticipants"/></CALLELEMENT></A>
		</td></tr>
</table>

</FTCS> 
