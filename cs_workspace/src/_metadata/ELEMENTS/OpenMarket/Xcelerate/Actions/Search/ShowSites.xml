<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Gator/FlexibleAssets/Common/ShowSites				 
--
			  fix for  the bug ----  OMIma26860  
				-- INPUT
--
-- OUTPUT
--
-->
 <!-- OpenMarket/Gator/FlexibleAssets/Common/ShowSites
--
-- INPUT
--
-- OUTPUT
--
-->
<SCRIPT LANGUAGE="JavaScript">  
		<![CDATA[
		
			function setCurrImage(obj) {
				obj.form.elements.currImage.value = obj.name;
			}
		
			function setCurrLinkset(obj) {
				obj.form.elements.currLinkset.value = obj.name;
			}
		
			function xfer(src,target,defpubid) {
				var sc, itemText, i, newIndex, listy;
  				
				for (i=0; i<src.options.length; i++) {
					if (src.options[i].selected) {
						var sc=i;
						var o=src.options[sc]
						items=new Option(o.text,o.value);
						newIndex=target.options.length;
						target.options[newIndex]=items;
 						target.options[newIndex].selected=true;
					}
				}
				i = 0;
				while (i<src.options.length) {
					if (src.options[i].selected)
						src.options[i]=null
					else
						i = i + 1;
				}
				delNul(src)
				delNul(target)
			}
		
			function delNul(lst){
				i = 0;
				while (i<lst.options.length) {
					if (lst.options[i].value==-1)
						lst.options[i]=null
					else
						i = i + 1;
				}
			}
 		 
        	function selAll(lst){
        		  if (!lst) return;
        			 for (i=0; i<lst.options.length; i++)
        						lst.options[i].selected=true
        			 delNul(lst)
        	}
        
		    function ssel_selAllAll(){
		    	var obj = document.forms[0].elements[0];
					if(!obj.form.elements['sSiteList'])
					  return;
				selAll(obj.form.elements['sSiteList']);
			}
	 
		]]>
	
	</SCRIPT>

<!-- Get the publication id -->
<SETVAR NAME="pubid" VALUE="SessionVariables.pubid"/>
<!-- Get the list of enabled asset types for this pubid-->

<setvar NAME="tablename" VALUE="AssetPublication"/>
<setvar NAME="errno" VALUE="0"/>

<!--  Get the list of the previously published sites for edit -->
<setvar NAME="errno" VALUE="0"/>
<USERMANAGER.GETLOGINUSER VARNAME="username"/>
<setvar NAME="numrows" VALUE="0"/>

<callelement NAME="OpenMarket/Xcelerate/Util/LoadProperty">
	<argument NAME="property" VALUE="xcelelem.manageuserpub"/>
	<argument NAME="ini" VALUE="futuretense_xcel.ini"/>
	<argument NAME="varname" VALUE="propmanageuserpub"/>
</callelement>
<callelement NAME="Variables.propmanageuserpub">
	<argument NAME="upcommand" VALUE="GetPublications"/>
	<argument NAME="username" VALUE="Variables.username"/>
	<argument NAME="qryprefix" VALUE="PublicationResults"/>
</callelement>

 

<!-- get the  Publication  into PublicationResults-->
 <!-- create  a  list of Publication for which this asset type is enabled -->
<listobject.create  NAME="myList" COLUMNS="pubid,pname"/>
<loop LIST="PublicationResults">
        <callelement NAME="OpenMarket/Xcelerate/Actions/AssetMgt/EnableAssetTypePub">
                                <argument NAME="upcommand" VALUE="IsAssetTypeEnabled"/>
                                <argument NAME="assettype" VALUE="Variables.AssetType"/>
                                <argument NAME="pubid" VALUE="PublicationResults.pubid"/>
        </callelement>
        <if COND="Variables.IsAuthorized!=false">
        <then>
                <if COND="PublicationResults.pubid!=SessionVariables.pubid">
                <then>
                    <listobject.addrow  NAME="myList" pubid="PublicationResults.pubid" pname="PublicationResults.name"/> 
                </then>
                </if>	
        </then>
        </if>
 </loop> 					
 <listobject.tolist  NAME="myList" LISTVARNAME="ValidSites"/>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
<tr>
    <td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/CurrentSite"/>:</td>
    <td></td>
    <td class="form-inset"><STRING.STREAM VALUE="SessionVariables.PublicationName"/></td>
</tr>
			

 
	<if COND="ValidSites.#numRows!=0">
	<then>					
 		<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
		<tr>
		<td class="form-label-text" valign="top"><br/> <XLAT.STREAM KEY="dvin/UI/Shareto"/>:</td>
		<td></td>
		<td class="form-inset">
		 
      <SETVAR NAME="dpubid" VALUE="SessionVariables.pubid"/>
 			<table border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td align="center"><span class="table-header-small-text"><XLAT.STREAM KEY="dvin/Common/Available"/></span><br/>
						<setvar NAME="tablename" VALUE="Variables.AssetType"/>
						<stringlist NAME="tmpllist" STR="color, color3, size1" DELIM=";"/>
						<SELECT name="SiteList" size="4" MULTIPLE="yes"
							onBlur="delNul(this.form.elements['SiteList'])">
							<loop LIST="ValidSites">
								<setvar NAME="errno" VALUE="0"/>
								<isinlist STR="Variables.SelectedSites" ITEM="ValidSites.pubid"/>
									<if COND="Variables.errno!=1">
									<then>
   									  <OPTION VALUE="ValidSites.pubid" REPLACEALL="ValidSites.pubid"> <STRING.STREAM VALUE="ValidSites.pname"/></OPTION>
 									</then>
									</if>
							</loop>  
						</SELECT>
						<br/>		
						<![CDATA[
							<input type="button" value="-->" name="Add1" 
							onClick="xfer(this.form.elements['SiteList'], this.form.elements['sSiteList'], 'Variables.dpubid')" REPLACEALL="Variables.dpubid"/>
						]]>
					</td>
					<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
					<td align="center"><span class="table-header-small-text"><XLAT.STREAM KEY="dvin/Common/Selected"/></span><br/>
						<select NAME="sSiteList" SIZE="4" MULTIPLE="yes">
							<loop LIST="ValidSites">
								<setvar NAME="errno"   VALUE="0"/>
								<isinlist STR="Variables.SelectedSites" ITEM="ValidSites.pubid"/>
								<if COND="Variables.errno=1">
									<then>
   										<OPTION VALUE="ValidSites.pubid" REPLACEALL="ValidSites.pubid"><STRING.STREAM VALUE="ValidSites.pname"/></OPTION>
 									</then>
								</if>
							</loop> 
 						 <option VALUE="-1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>
						</select>
						<br/>
						<![CDATA[
							<input type="button" value="<--" name="Remove1" 
							onClick="xfer(this.form.elements['sSiteList'], this.form.elements['SiteList'], 'Variables.dpubid')" REPLACEALL="Variables.dpubid"/>
						]]>
					</td>
				</tr>
			</table>
 		</td>
	</tr>
</then>
</if>
</FTCS> 
