<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateD/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/ShareAssetFront.xml $
$Revision: 22 $ 
$Modtime: 6/28/04 1:10p $ 
-->
<!-- OpenMarket/Xcelerate/PrologActions/ShareAssetFront
--
-- INPUT
--		possiblePubList	- list of pub ids that this assettype is enabled and user has access (excluding current pub)
--		PublicationResults	- list of Publication table of all pubs user has access to
--		Variables.AssetType	- asset type of loaded asset
--		Variables.myassetname	- name field of loaded asset
--		Variables.assetObjectName	- loaded asset
--		Variables.id			- id of loaded asset 
--		SessionVariables.username	- user
--		SessionVariables.PublicationName 
-- OUTPUT
--		pubidlist 	- pubs asset should be saved to
-->
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType" />
<STRING.ENCODE VARIABLE="cs_imagedir" VARNAME="cs_imagedir"/>
<STRING.ENCODE VARIABLE="doproceed" VARNAME="doproceed" />
<SCRIPT LANGUAGE="JavaScript">

<![CDATA[

function SetCancelFlag () {
	var obj = document.forms[0].elements[0];

	obj.form.elements['upcommand'].value="cancel";
	obj.form.submit();
	return false;
}

function selectAny (anyClicked) {
	var obj = document.forms[0].elements[0];
	if (anyClicked==true) {
		if ( obj.form.elements['pubidlist'][0].checked==true )
		{
			i = obj.form.elements['numPubs'].value;
			while (i > 1 ) {
				i--;
				obj.form.elements['pubidlist'][i].checked=false;
			}	
		} 
	}
	else 
	{
		if ( obj.form.elements['pubidlist'][0].value==0 )
			obj.form.elements['pubidlist'][0].checked=false;
	}
}

]]>
</SCRIPT>
<INPUT TYPE="hidden" NAME="upcommand" VALUE="submit"/>


<if COND="Variables.doproceed=true">
<then>
	<ASSET.GETASSETTYPE NAME="Variables.assetObjectName" OUTNAME="at"/>
	<ASSETTYPE.GET NAME="at" FIELD="description" OUTPUT="at:description"/>

  	<table class="width-outer-70" border="0" cellpadding="0" cellspacing="0">
 		<TR>
			<TD>
				<span class="title-text"><XLAT.STREAM KEY="dvin/Common/Share"/></span>&nbsp;<span class="title-value-text"><STRING.STREAM VARIABLE="at:description"/>: <STRING.STREAM VARIABLE="asset:name"/></span>
			</TD>
		</TR>
		<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar">
			<argument NAME="SpaceBelow" VALUE="No"/>
		</callelement>
		<TR>
			<TD>
				<table class="width-inner-100" border="0" cellpadding="0" cellspacing="0">
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
					<tr>
						<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Name"/>:</td>
						<td><img height="1" width="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
						<td class="form-inset"><STRING.STREAM VARIABLE="asset:name"/></td>
					</tr>
	
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
					<tr>
						<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Description"/>:</td>
						<td></td>
						<td class="form-inset"><STRING.STREAM VARIABLE="asset:description"/></td>
					</tr>
	
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
					<tr>
						<td class="form-label-text"><XLAT.STREAM KEY="dvin/AT/Common/ID"/>:</td>
						<td></td>
						<td class="form-inset"><STRING.STREAM VARIABLE="id"/></td>
					</tr>
					
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
					<tr>
						<td class="form-label-text"><XLAT.STREAM KEY="dvin/AT/Common/Created"/>:</td>
						<td></td>
						<td class="form-inset">
							<SETVAR NAME="createdby" VALUE="Variables.asset:createdby"/>
							<DATEFORMAT.GETDATETIME NAME="_FormatDate_" VALUE="Variables.asset:createddate" VALUETYPE="jdbcdate"  VARNAME="createddate"/>
							<XLAT.STREAM KEY="dvin/UI/createddatebycreatedby"/>
						</td>
					</tr>
			
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
					<tr>
						<td class="form-label-text"><XLAT.STREAM KEY="dvin/AT/Common/Modified"/>:</td>
						<td></td>
						<td class="form-inset">
						<SETVAR NAME="updatedby" VALUE="Variables.asset:updatedby"/>
						<DATEFORMAT.GETDATETIME NAME="_FormatDate_" VALUE="Variables.asset:updateddate" VALUETYPE="jdbcdate"  VARNAME="updateddate"/>
						<XLAT.STREAM KEY="dvin/UI/updateddatebyupdatedby"/>
						</td>
					</tr>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				   <TR>
				      	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Site"/>:</td>
		        		<td></td>
		        		<TD class="form-inset">
		            	<STRING.STREAM SSVARIABLE="PublicationName"/>
		        		</TD>
		    		</TR>
					<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
				   <TR>
		        		<td class="form-label-text"><XLAT.STREAM KEY="dvin/UI/Shareto"/>:</td>
		        		<td></td>
		        		<TD class="form-inset">
							<table class="width-outer-50" style="margin:0px" cellspacing="0" cellpadding="0" border="0">
								
								 <tr>
									<td></td><td class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
								</tr>
								<tr>
								<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
								<td >
								<table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"><tr><td colspan="1" class="tile-highlight"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
								<tr><td class="tile-a" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
									<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><BR /></DIV></td>
									<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/UI/SiteName"/></DIV></td>
									<td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="tile-b" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir"><DIV class="new-table-title"><XLAT.STREAM KEY="dvin/AT/Common/Description"/></DIV></td>
									<td class="tile-c" background="Variables.cs_imagedir/graphics/common/screen/grad.gif" REPLACEALL="Variables.cs_imagedir">&nbsp;</td>
								</tr>
								
								<tr><td colspan="10" class="tile-dark"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td></tr>
							
								<setvar NAME="rowStyle" VALUE="tile-row-normal"/>
								

								<setvar NAME="isInAnyPub" VALUE="false"/>
								<SETCOUNTER NAME="nthPub" VALUE="0"/>
								<if COND="Variables.allowAnyPub=true">
								<then>
									<INCCOUNTER NAME="nthPub" VALUE="1"/>
									<tr class="Variables.rowStyle" REPLACEALL="Variables.rowStyle">
										<td><BR /></td>
										<td><BR /></td><td><BR /></td>
										<td>
											<ASSET.SITES NAME="Variables.assetObjectName" LIST="currentPubs" PUBID="0"/>
											<if COND="IsError.Variables.errno=false">
											<then>
												<INPUT TYPE="checkbox" ID="0" NAME="pubidlist" VALUE="0" onClick="selectAny(true)" CHECKED="true" />
												<setvar NAME="isInAnyPub" VALUE="true"/>
											</then>
											<else>
												<INPUT TYPE="checkbox" ID="0" NAME="pubidlist" VALUE="0" onClick="selectAny(true)" />
											</else>
											</if>
										</td>
										<td>
											<LABEL FOR="0" STYLE="cursor:hand"><XLAT.STREAM KEY="dvin/UI/AssetMgt/AllSites"/></LABEL>
										</td>
										<td></td>
										<td><XLAT.STREAM KEY="dvin/UI/AssetMgt/AssetAccessibleInAllSites"/></td>
									</tr>
									<IF COND="Variables.rowStyle=tile-row-normal">
									<THEN>
										<SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
									</THEN>
									<ELSE>
										<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
									</ELSE>
									</IF>										
								</then>
								</if>
															
							<LOOP LIST="PublicationResults">
								<SETVAR NAME="errno" VALUE="0"/>
								<ISINLIST LIST="possiblePubList" ITEM="PublicationResults.pubid"/>
 								<if COND="Variables.errno=1">
									<then>
									<INCCOUNTER NAME="nthPub" VALUE="1"/>
									
									<tr class="Variables.rowStyle" REPLACEALL="Variables.rowStyle">
										<td><BR /></td>
										<td><BR /></td><td><BR /></td>
										<if COND="Variables.isInAnyPub=false">
										<then>
											<ASSET.SITES NAME="Variables.assetObjectName" LIST="currentPubs" PUBID="PublicationResults.pubid"/>
											<if COND="IsError.Variables.errno=false">
												<then>
													<td valign="middle" NOWRAP="NOWRAP" ALIGN="LEFT">
														<INPUT TYPE="checkbox" ID="PublicationResults.pubid" NAME="pubidlist" VALUE="PublicationResults.pubid" REPLACEALL="PublicationResults.pubid" CHECKED="true" onClick="selectAny(false)"/>
													</td>
												</then> 
												<else>
													<td valign="middle" NOWRAP="NOWRAP" ALIGN="LEFT">
														<INPUT TYPE="checkbox" ID="PublicationResults.pubid" NAME="pubidlist" VALUE="PublicationResults.pubid"  REPLACEALL="PublicationResults.pubid"  onClick="selectAny(false)"/>
													</td>
												</else>
											</if>
										</then>
										<else>
											<td>
												<INPUT TYPE="checkbox" ID="PublicationResults.pubid" NAME="pubidlist" VALUE="PublicationResults.pubid"  REPLACEALL="PublicationResults.pubid"  onClick="selectAny(false)"/>
											</td>
										</else>
										</if>
										<td>
											<LABEL FOR="PublicationResults.pubid" REPLACEALL="PublicationResults.pubid" STYLE="cursor:hand"><STRING.STREAM LIST="PublicationResults" COLUMN="name"/></LABEL>
										</td>
										<td></td>
										<td><STRING.STREAM LIST="PublicationResults" COLUMN="description"/></td>
									</tr>
									 <IF COND="Variables.rowStyle=tile-row-normal">
										<THEN>
											<SETVAR NAME="rowStyle" VALUE="tile-row-highlight"/>
										</THEN>
										<ELSE>
											<SETVAR NAME="rowStyle" VALUE="tile-row-normal"/>
										</ELSE>
									</IF>

   									</then>
                                    </if>
							</LOOP>
                            <LOOP LIST="PubsEnabledforAsset">
  								<SETVAR NAME="errno" VALUE="0"/>
                                <ISINLIST LIST="possiblePubList" ITEM="PubsEnabledforAsset.pubid"/>
 								<if COND="Variables.errno!=1">
								<then>
                                     <INPUT TYPE="HIDDEN" ID="PubsEnabledforAsset.pubid" NAME="pubidlist" VALUE="PubsEnabledforAsset.pubid" REPLACEALL="PubsEnabledforAsset.pubid"/>
                                </then>
                                </if>                                       
                            </LOOP>
								</table>
								</td>
								<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap"><BR /></td>
							</tr>
							<tr>
								<td colspan="3" class="tile-dark" VALIGN="TOP" HEIGHT="1"><IMG WIDTH="1" HEIGHT="1" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td>
							</tr>
							<tr>
								<td></td><td background="Variables.cs_imagedir/graphics/common/screen/shadow.gif" REPLACEALL="Variables.cs_imagedir"><IMG WIDTH="1" HEIGHT="5" src="Variables.cs_imagedir/graphics/common/screen/dotclear.gif" REPLACEALL="Variables.cs_imagedir"/></td><td></td>
							</tr>
						  </table>
 						  <INPUT TYPE="hidden" NAME="numPubs" VALUE="Counters.nthPub" REPLACEALL="Counters.nthPub"/>
			        	</TD>
			    	</TR>
							<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
					<TR>
					  <TD></TD><TD></TD><TD> <XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_XLAT_" ESCAPE="true"/>
					  <XLAT.LOOKUP KEY="dvin/UI/ShareToOtherSites" VARNAME="_xlat_function"/>
					  <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ContentDetailsFront" outstring="urlcontdetfront">
						  <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
						<satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
																		   <satellite.argument name="AssetType" value="Variables.AssetType"/>
																		  <satellite.argument name="id" value="Variables.id"/>
																		   </SATELLITE.LINK>
					  <A HREF="Variables.urlcontdetfront"  onclick="return SetCancelFlag()" onmouseover="window.status='Variables._XLAT_';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlcontdetfront,Variables._XLAT_"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
					  <A HREF="javascript:void(0)" onclick="javascript:document.AppForm.submit();"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/SaveChanges"/></CALLELEMENT></A>
					  </TD>
				</TR>
		</table>
	</TD>
</TR>
</table>
	<STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/>
   <INPUT TYPE="hidden" NAME="pagename" VALUE="OpenMarket/Xcelerate/Actions/Variables.PostPage" REPLACEALL="Variables.PostPage"/>
   <INPUT TYPE="hidden" NAME="AssetType" VALUE="Variables.AssetType" REPLACEALL="Variables.AssetType"/>
   <INPUT TYPE="hidden" NAME="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
	<FLUSH LIST="possiblePubList"/>
</then>
<else>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/ShowMessage">
		<argument NAME="elem" VALUE="Variables.doproceed"/>
		<argument NAME="severity" VALUE="error"/>
	</callelement>
	
	<!-- Return to the details screen -->
	<if COND="Variables.cs_environment!=ucform">
	<then>
		<callelement NAME="OpenMarket/Xcelerate/Actions/ContentDetailsFront">
			<argument NAME="AssetType" VALUE="Variables.AssetType"/>
			<argument NAME="id" VALUE="Variables.id"/>
			<argument NAME="errorAlreadyDisplayed" VALUE="true"/>
		 </callelement>   
	</then>
	</if>	     
</else>
</if>

</FTCS> 
