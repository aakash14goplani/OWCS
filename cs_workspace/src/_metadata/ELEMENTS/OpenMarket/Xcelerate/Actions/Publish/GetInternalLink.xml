<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/Actions/Publish/GetInternalLink
-
- INPUT
-
- OUTPUT
-
-->
<DEBABBLE VALUE="false"/>
<REMOVEVAR NAME="_referURL_"/>

<!-- #15315 Replaced asset:load -->
<ASSET.LIST LIST="lCurrentAsset" FIELD1="id" VALUE1="Variables._cid_" TYPE="Variables._c_"/>
<SETVAR NAME="lstatusCode" VALUE="lCurrentAsset.status"/>
<if COND="IsError.Variables.errno!=true">
<then>
     <if COND="Variables.lstatusCode!=VO">  <!--#15315 end-->
     <then>
        <if COND="IsVariable._PACKEDARGS_=true">
        <then>
		<if COND="IsVariable._frag_=true">
		<then>
		  <if COND="IsVariable._WRAPPER_=true">
		  <then>
        	   <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
			   WRAPPERPAGE="Variables._WRAPPER_"
                           cid="Variables._cid_"
                           c="Variables._c_"
						   FRAGMENT="Variables._frag_"
                           PACKEDARGS="Variables._PACKEDARGS_"
                           OUTSTR="_referURL_"/>
		  </then>
		  <else>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
                           cid="Variables._cid_"
                           c="Variables._c_"
			   FRAGMENT="Variables._frag_"
                           PACKEDARGS="Variables._PACKEDARGS_"
                           OUTSTR="_referURL_"/>
		  </else>
		  </if>
		</then>
		<else>
		  <if COND="IsVariable._WRAPPER_=true">
		  <then>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
			   WRAPPERPAGE="Variables._WRAPPER_"
                           cid="Variables._cid_"
                           c="Variables._c_"
                           PACKEDARGS="Variables._PACKEDARGS_"
                           OUTSTR="_referURL_"/>
		  </then>
		  <else>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
                           cid="Variables._cid_"
                           c="Variables._c_"
                           PACKEDARGS="Variables._PACKEDARGS_"
                           OUTSTR="_referURL_"/>
		  </else>
		  </if>
		</else>
		</if>
        </then>
        <else>
		<if COND="IsVariable._frag_=true">
		<then>
		  <if COND="IsVariable._WRAPPER_=true">
		  <then>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
			   WRAPPERPAGE="Variables._WRAPPER_"
                           cid="Variables._cid_"
                           c="Variables._c_"
			   FRAGMENT="Variables._frag_"
                           OUTSTR="_referURL_"/>
		  </then>
		  <else>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
                           cid="Variables._cid_"
                           c="Variables._c_"
			   FRAGMENT="Variables._frag_"
                           OUTSTR="_referURL_"/>
		  </else>
		  </if>
		</then>
		<else>
		  <if COND="IsVariable._WRAPPER_=true">
		  <then>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
			   WRAPPERPAGE="Variables._WRAPPER_"
                           cid="Variables._cid_"
                           c="Variables._c_"
                           OUTSTR="_referURL_"/>
		  </then>
		  <else>
        	    <RENDER.GETPAGEURL PAGENAME="Variables._PAGENAME_"
                           cid="Variables._cid_"
                           c="Variables._c_"
                           OUTSTR="_referURL_"/>
		  </else>
		  </if>
		</else>
		</if>
        </else>
        </if>
     </then>
     <else>
            <setvar NAME="_referURL_" VALUE="_NOLINK_" />
     </else>
     </if>
</then>
<else>
     <setvar NAME="_referURL_" VALUE="_NOLINK_" />
</else>
</if>
<if COND="IsVariable._PACKEDARGS_=false">
<then>
<if COND="IsVariable._ADDITIONALPARAMS_=true">
<then>
<callelement NAME="OpenMarket/Xcelerate/Actions/Publish/GetEmbededLinkExtraParams">
	  <ARGUMENT NAME="_referURL_" VALUE="Variables._referURL_"/>
	  <ARGUMENT NAME="_ADDITIONALPARAMS_" VALUE="Variables._ADDITIONALPARAMS_"/>
</callelement>
</then>
</if>
</then>
</if>
<!-- remove the parameters which may mess up with another embed link calls -->
<REMOVEVAR NAME="_PACKEDARGS_" />
<REMOVEVAR NAME="_WRAPPER_" />
<REMOVEVAR NAME="_frag_" />
<REMOVEVAR NAME="_ADDITIONALPARAMS_" />
<DEBABBLE VALUE="true"/>
</FTCS> 
