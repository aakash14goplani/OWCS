<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
	<PROPERTY.GET PARAM="xcelerate.charset" INIFILE="futuretense_xcel.ini"
		VARNAME="charset" />
	<SETVAR NAME="cs.contenttype" VALUE="text/html; charset=Variables.charset" />

	<!--
		OpenMarket/Xcelerate/Actions/AddInclusion - - INPUT Updated : March
		25, 2010 By: JAG - Reason: Get the Asset Include Custom Element Node
		Via CKEditor Ported from FCKEDITOR TO CKEditor and removed all
		FCKeditor Interface and operation(s). Reason: Droped FCKEditor and
		Migrated to CKEditor The FW Tray ToolBar to perform the Include asset
		command and functionality Use Determine for C K E D I T O R O B J E C
		T L O A D D E D Used for Include Asset and Create New Asset on a fly
		and Include in Text Area // Get the Asset Include Custom Element Node
		Via CKEditor 1) Include Asset 2 Create New Asset and Include the new
		Asset 3) Context Menu / Change Asset 4) Context Menu Edit Asset
		Properties. Two CKEDitor plugins that utilize and open this form are
		the following 1) fwincludeasset ( PLUGIN.js ) 2) fwincludenewasset May
		24, 2010 PR#22861 CKEditor: Change link asset ends up including an
		asset May 26, 2010 PR#22862 - CKEditor: It is not currently possible
		to change an included asset. Also this should work via the layer. It
		is also not possible to remove an included asset. June 01, 2010
		PR#22854 - Support for MultiValue Text using ckeditor If you have a
		multivalued attribute of type text with editor as CKEditor, if you put
		value in one field, and toggle to another, the value from the first
		field disappears. - OUTPUT -
	-->

	<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/BasicEnvironment" />
	<STRING.ENCODE VARIABLE="cs_environment" VARNAME="cs_environment"/>
	<STRING.ENCODE VARIABLE="cs_formmode" VARNAME="cs_formmode"/>
	<STRING.ENCODE VARIABLE="fielddesc" VARNAME="fielddesc"/>
	<html>
		<head>
			<TITLE>
				<XLAT.STREAM KEY="dvin/UI/AddInclusion" />
			</TITLE>
			<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/LoadDojo" />
			<link href="Variables.cs_imagedir/../js/fw/css/ui/global.css"
				rel="stylesheet" type="text/css" REPLACEALL="Variables.cs_imagedir" />
			<PROPERTY.GET PARAM="xcelerate.domain" INIFILE="futuretense_xcel.ini"
				VARNAME="docDomain" />
			<IF COND="IsVariable.docDomain=true">
				<THEN>
					<IF COND="Variables.docDomain!=Variables.empty">
						<THEN>
							<SCRIPT LANGUAGE="JavaScript">
								document.domain = '
								<STRING.STREAM VALUE="Variables.docDomain" />
								';
							</SCRIPT>
						</THEN>
					</IF>
				</THEN>
			</IF>
			<SATELLITE.LINK ASSEMBLER="query"
				pagename="OpenMarket/Xcelerate/Actions/FCKEditorRenderer" outstring="urlFCKEditorRenderer">
				<satellite.argument name="cs_environment"
					value="Variables.cs_environment" />
				<satellite.argument name="cs_formmode" value="Variables.cs_formmode" />
				<satellite.argument name="cs_imagedir" value="Variables.cs_imagedir" />
			</SATELLITE.LINK>
			<link href="CS.Property.ft.cgipath/Xcelerate/data/css/en_US/common.css"
				rel="styleSheet" type="text/css" REPLACEALL="CS.Property.ft.cgipath" />
			<callelement NAME="OpenMarket/Xcelerate/Util/LoadDefaultStyleSheet">
				<argument NAME="cssFilesToLoad" VALUE="common.css"/>
			</callelement>	
			<STRING.ENCODE VARIABLE="tn_id" VARNAME="tn_id"/>
			<STRING.ENCODE VARIABLE="tn_AssetType" VARNAME="tn_AssetType"/>
			<STRING.ENCODE VARIABLE="EditingStyle" VARNAME="EditingStyle"/>
			<STRING.ENCODE VARIABLE="IFCKEditor" VARNAME="IFCKEditor"/>
			<STRING.ENCODE VARIABLE="modeType" VARNAME="modeType"/>
			<STRING.ENCODE VARIABLE="formFieldName" VARNAME="formFieldName"/>
			<STRING.ENCODE VARIABLE="fieldname" VARNAME="fieldname"/>
			<STRING.ENCODE VARIABLE="iHeight" VARNAME="iHeight"/>
			<STRING.ENCODE VARIABLE="iWidth" VARNAME="iWidth"/>

			<replaceall list="CS.Property.ft.cgipath,Variables.urlFCKEditorRenderer">
				<script language="JavaScript">


					var contentWindow = window.opener;

					if( contentWindow == null){

					contentWindow = window.parent.opener;
					}

					var mytextrange;
					<if cond="IsVariable.name=false">
						<then>
							<setvar name="name" value="" />
						</then>
					</if>
					<!--
						Extract the asset id and asset properties if hrefOrIdString is
						populated
					-->
					<if cond="IsVariable.hrefOrIdString=true">
						<then>
							<STRINGLIST NAME="editPropertiesList" STR="Variables.hrefOrIdString"
								DELIM="%26" />
							<LOOP LIST="editPropertiesList">
								<INDEXOF STR="editPropertiesList.ITEM" WHAT="_cid_="
									OUTSTR="indexAssetId" INDEX="0" />
								<IF COND="Variables.errno=1">
									<THEN>
										<SUBSTRING STR="editPropertiesList.ITEM" OUTSTR="tn_id"
											INDEX="6" />
										<STRING.ENCODE VARIABLE="tn_id" VARNAME="tn_id"/>									
									</THEN>
								</IF>
								<SETVAR NAME="errno" VALUE="0" />
								<INDEXOF STR="editPropertiesList.ITEM" WHAT="_c_="
									OUTSTR="indexAssetType" INDEX="0" />
								<IF COND="Variables.errno=1">
									<THEN>
										<SUBSTRING STR="editPropertiesList.ITEM" OUTSTR="tn_AssetType"
											INDEX="4" />
										<STRING.ENCODE VARIABLE="tn_AssetType" VARNAME="tn_AssetType"/>	
									</THEN>
								</IF>
								<SETVAR NAME="errno" VALUE="0" />
								<INDEXOF STR="editPropertiesList.ITEM" WHAT="_PAGENAME_="
									OUTSTR="indexPageName" INDEX="0" />
								<IF COND="Variables.errno=1">
									<THEN>
										<SUBSTRING STR="editPropertiesList.ITEM" OUTSTR="_page_"
											INDEX="11" />
										<SUBSTITUTE STR="Variables._page_" OUTSTR="_pagename_"
											WHAT="%2F" WITH="/" />
										<STRING.ENCODE VARIABLE="_page_" VARNAME="_page_"/>	
										<STRING.ENCODE VARIABLE="_pagename_" VARNAME="_pagename_"/>	
									</THEN>
								</IF>
								<SETVAR NAME="errno" VALUE="0" />
								<INDEXOF STR="editPropertiesList.ITEM" WHAT="_ADDITIONALPARAMS_="
									OUTSTR="indexAdditionalParams" INDEX="0" />
								<IF COND="Variables.errno=1">
									<THEN>
										<SUBSTRING STR="editPropertiesList.ITEM" OUTSTR="_additionalparams_"
											INDEX="19" />
										<STRING.ENCODE VARIABLE="_additionalParams_" VARNAME="_additionalparams_"/>	
									</THEN>
								</IF>
							</LOOP>
						</then>
						<else>
							<SETVAR NAME="hrefOrIdString" VALUE="" />
						</else>
					</if>
					<if cond="IsVariable.iHeight=false">
						<then>
							<SETVAR NAME="iHeight" VALUE="-1" />
						</then>
					</if>
					<if cond="IsVariable.iWidth=false">
						<then>
							<SETVAR NAME="iWidth" VALUE="-1" />
						</then>
					</if>
					<if cond="IsVariable.EditingStyle=false">
						<then>
							<SETVAR NAME="EditingStyle" VALUE="single" />
						</then>
					</if>
					<if cond="IsVariable.fieldname=false">
					<then>
						<SETVAR NAME="fieldname" VALUE="Variables.formFieldName"/>
					</then>
					</if>
					<replace STR="Variables.fieldname">
						var fieldname = 'Variables.fieldname';
					</replace>
					<replace STR="Variables.modeType">
						var modeType = 'Variables.modeType';
					</replace>

					<replace STR="Variables.fielddesc">
						var fielddesc = 'Variables.fielddesc';
					</replace>

					<replace STR="Variables.tn_id">
						var tn_id = 'Variables.tn_id';
					</replace>

					<replace STR="Variables.tn_AssetType">
						var tn_AssetType = 'Variables.tn_AssetType';
					</replace>

					<replace STR="SessionVariables.PublicationName">
						var pubName =
						'SessionVariables.PublicationName';
					</replace>

					<replace STR="Variables.formFieldName">
						var formFieldName = 'Variables.formFieldName';
					</replace>


					<IF COND="IsVariable.IFCKEditor=true">
						<THEN>
							<replace STR="Variables.IFCKEditor">
								var useCKEditor = 'Variables.IFCKEditor';
							</replace>
						</THEN>
						<ELSE>
							var useCKEditor= false;
							<SETVAR NAME="IFCKEditor" VALUE="false" />
						</ELSE>
					</IF>

					<replace STR="Variables.EditingStyle">
						var editingStyle = 'Variables.EditingStyle';
					</replace>

					<![CDATA[
					var instanceName;
					if ('single' == editingStyle||'S'==editingStyle)
						instanceName = formFieldName;
					else 
						instanceName = formFieldName.substr(0,formFieldName.lastIndexOf('_'));
						
					var ckUtils = contentWindow.CKUtilities;
					
					function populateKeyValueFields(form,elm){
						for (i=0; i<elm.options.length; i++){
							if(elm.options[i].selected){
								if(elm.options[i].value && elm.options[i].value !=-1)
								var keyValArray = (elm.options[i].value).split('=');
								form.elements['paramValue'].value=keyValArray[1];
								var keyElm = form.elements['legalname'];
								for (j=0; j<keyElm.options.length; j++){
									if('fp:'+keyElm.options[j].text==keyValArray[0]){
										keyElm.options[j].selected=true;
									}
								}
							}
						}
					}
					function GotoNextStep(form,ourPage){
						selAllAll();
						var basePage = "OpenMarket/Xcelerate/Actions/";
						var	newpage = basePage + ourPage;
						form.pagename.value = newpage;
						form.submit();
						return true;
					}
					
					function selAllAll(){
						var obj = document.forms[0];
						var temphrefOrIdString='';
						var hrefOrIdElm = obj.elements['hrefOrIdString'];
						var tmpcnt=0;
						if(hrefOrIdElm){
							var hrefOrIdKeyValues = hrefOrIdElm.value.split('&');
							for(var i=0;i<hrefOrIdKeyValues.length;i++){
								if(hrefOrIdKeyValues[i].indexOf('_ADDITIONALPARAMS_')==-1 && hrefOrIdKeyValues[i].indexOf('_PAGENAME_')==-1){
									if(tmpcnt==0){
										temphrefOrIdString = hrefOrIdKeyValues[i];
									} else {
										temphrefOrIdString = temphrefOrIdString + '&' + hrefOrIdKeyValues[i];
									}
									tmpcnt++;
								}
							}
							
						}
						if(temphrefOrIdString.length > 0){
							temphrefOrIdString=temphrefOrIdString + '&_PAGENAME_=' + obj.elements['theTemplate'].value;
						}else{
							temphrefOrIdString='_PAGENAME_=' + obj.elements['theTemplate'].value;
						}
						obj.elements['hrefOrIdString'].value=temphrefOrIdString;
					}
						
					function movedefargright(srcname,target)
						{
							var items, newindex, newval, i, j,srcindex,srcval;
					
					        // find selected argument
							for (i=0;i<srcname.options.length;i++)
							{
								if (srcname.options[i].selected)
									srcindex=i;
							}
					        // find selected value
					        srcval = document.forms[0].elements['paramValue'];
							if(srcval.value == '[Value]' || srcval.value == ''){
								]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/SpecifyValue" ESCAPE="true"
											ENCODE="false" />");
								<![CDATA[
								return false;
							}
					        newval=srcval.value;
							
							items=new Option(srcname.options[srcindex].text+"="+newval,'fp:'+srcname.options[srcindex].text+"="+newval);
					
							newindex=target.options.length;
					
							// find and replace argument if already selected
							for (i=0;i<target.options.length;i++)
							{
								if (target.options[i].text.indexOf(srcname.options[srcindex].text)==0)
								{
									newindex=i;
								}
					
							}
					        target.options[newindex]=items;
							target.options[newindex].selected=false;
					
							delNul(target);
						}
					
						function removearg(target)
						{
							var i=0;
					
							while(i<target.options.length)
							{
								if(target.options[i].selected)
								{
									target.options[i]=null;
								}
								else
									i++;
							}
							delNul(target);
						}
						
						function delNul(lst){
							i = 0;
							while (i<lst.options.length)
							{
								if (lst.options[i].value==-1)
									lst.options[i]=null
								else
									i = i + 1;
							}
						}
						
						
					function getSel(txtAreaElementName) {
						var editingStyle = ']]><STRING.STREAM VARIABLE="EditingStyle" /><![CDATA[';
						if ('single' == editingStyle)
							if(navigator.userAgent.toLowerCase().indexOf('msie') != -1){
								mytextrange = contentWindow.document.selection.createRange();
								return mytextrange.text //for IE
							} else {
								return getSelForSingleValue(txtAreaElementName);
							}
						else 
							return getSelForMultiValue(txtAreaElementName);
					}
						
					function getSelForSingleValue(txtAreaElementName) {
						var txtarea = contentWindow.document.getElementsByName(txtAreaElementName).item(0);
						
						if(txtarea == null)
						    	txtarea = contentWindow.document.getElementById("contentPaneMainBodySubView:"+formFieldName);
					
						var selStart = txtarea.selectionStart;
						var selEnd = txtarea.selectionEnd;
						var begin = txtarea.value.substr(0, selStart);
						var selection =(txtarea.value).substring(selStart, selEnd);
						var end = txtarea.value.substr(selEnd);
						return selection;
					}
					
						function getSelForMultiValue(txtAreaElementName) 
						{
							var reqDijit = contentWindow.dijit.byId(txtAreaElementName);
							
							if( contentWindow.document.selection && contentWindow.document.selection.createRange )
							{ // IE support
								return contentWindow.document.selection.createRange().text;
							} else {
								return getSelectedValue(reqDijit);
							}
						}
						
						function getSelectedValue(reqDijit) {
							var reqVal = '';
							if (reqDijit.editor.containerNode) {
								var cNode = reqDijit.editor.containerNode;
								reqVal = reqDijit.editor.get('value');
								if (document.selection && document.selection.createRange)
								{ // IE support
									return contentWindow.document.selection.createRange().text;
								} else {
									return reqVal.substring(cNode.selectionStart, cNode.selectionEnd);
								}
							}
							return reqVal;
						}
						
					
					function writeLinkBack(txtAreaElementName, mytext){	
						var editingStyle = ']]><STRING.STREAM VARIABLE="EditingStyle" /><![CDATA[';
						if ('single' == editingStyle){
							if(navigator.userAgent.toLowerCase().indexOf('msie') != -1){
								var txtarea = contentWindow.document.getElementsByName(txtAreaElementName).item(0);
								// Important must do focus to insert the text for IE
								txtarea.focus();
								contentWindow.document.selection.createRange().text = mytext;//for IE
							} else {
								writeLinkBackForSingleVal(txtAreaElementName, mytext);
							}
						} else {
							return writeLinkBackForMultiVal(txtAreaElementName, mytext);
						}
					}	
						
					
					function writeLinkBackForSingleVal(txtAreaElementName, mytext){
					
						//This handles only non IE browsers
						var txtarea = contentWindow.document.getElementsByName(txtAreaElementName).item(0);
						if(txtarea == null)
						    	txtarea = contentWindow.document.getElementById("contentPaneMainBodySubView:"+formFieldName);
						var selStart = txtarea.selectionStart;
						var selEnd = txtarea.selectionEnd;
						var begin = txtarea.value.substr(0, selStart);
						var selection =(txtarea.value).substring(selStart, selEnd);
						var end = txtarea.value.substr(selEnd);
						txtarea.value =begin + mytext +end;
					
					}
					
					
					function writeLinkBackForMultiVal(txtAreaElementName, mytext){
						var reqDijit = contentWindow.dijit.byId(txtAreaElementName);
						
						var cNode = reqDijit.editor.containerNode;
						var val = reqDijit.editor.get('value');
						
						var begin, selection, end;
						
						if (dojo.isIE) {
							var textarea = reqDijit.editor.textbox;
							textarea.focus();
							//Get the actual range from the textarea
							contentWindow.document.selection.createRange().text = mytext;
							if (typeof(reqDijit._onEditorValueChange) === 'function') 
								reqDijit._onEditorValueChange();
						} else {
						    begin = val.substr(0, cNode.selectionStart);
						    end = val.substr(cNode.selectionEnd);
						    if (typeof(reqDijit.putEditorValue) === 'function')
								reqDijit.putEditorValue(begin + mytext + end);
						}
						
						reqDijit.editor.focus();
					}
					
					var selectedText = "";
					var oCKEditor=null;
					// Is CKEditor Loaded and Instane running for this attribute ?
					if( useCKEditor )
					{
					   // Get the CKEditor Instance Handle
					      oCKEditor = contentWindow.CKEDITOR.instances[instanceName];
						  if(typeof(oCKEditor) =='undefined')
							useCKEditor = false;
					}
					
					var editpro = contentWindow.document.getElementById('ewep' +fieldname);
					
					var realobject;
					
					//When we install/build Real objects into the edit screen, we set up a hidden field by the name
					// REAL_OBJECTS_INSTALLED_FOR_..fieldname that will help us identify if real objects is being
					//used for the current attribute. If that hidden element is not null, 
					//go ahead and retrieve the reference to the real object editor
					
					if(contentWindow.document.getElementById('REAL_OBJECTS_INSTALLED_FOR_'+fieldname) != null)
					{
						realobject = eval("contentWindow.eop"+fieldname);
					}
					
					//var useEditPro = (typeof(editpro) == "object");
					var useEditPro = editpro != null;
					
					var selectedHTML="";
					if (typeof realobject == "object")
					{
					    // use RealObject
					    selectedText=realobject.getSelectedHTMLData();
					
					    if (selectedText == "") {
					        ]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/Noselectionortheselectionisinvalid"
											ESCAPE="true" ENCODE="false" />"+"\n\naqwewwtwtrter
										");		
					        <![CDATA[
					        closeWindow();
					    }
					}
					else if ( useEditPro ) {
					    // use eWebEditPro
						 selectedHTML = eval("contentWindow.document.forms[0]."+fieldname+"_SelectedTextForEmbeddedLink").value;	
						if (selectedHTML == "") {
					        ]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/Noselectionortheselectionisinvalid" />");
					        <![CDATA[
					        closeWindow();
					    } else {
					        //[2007-11-12 KG] #16277
					        selectedText = selectedHTML.replace(/<\/?p( [^>]*)?>/ig, '');
					    }
					}
					else if( useCKEditor )
					{
					    // Moves the selection focus to the editing are space in the editor.
					    oCKEditor.focus() ;
					
					    // Get User's Selected Element Node
					    var mySelection = oCKEditor.getSelection();
					
					    // Note: Need to perform a different Action depending on IE vs Firefox
					    if (contentWindow.CKEDITOR.env.ie)
					    {
					         mySelection.unlock(true);
					         selectedText = mySelection.getNative().createRange().text;
					    }
					    else
					    {
					         selectedText = mySelection.getNative();
					    }
					
					} 
					
					function closeWindow()
					{
						window.close();
					}
					
					function cancelAddInclusion()
					{
						closeWindow();
					}
					
					function saveAddInclusion()
					{
					    var obj = document.forms[0].elements[0];
					    var index = obj.form.elements['theTemplate'].selectedIndex;
					    if (index == -1 || index == 0) {
					        ]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/Error/chooseatemplateforthislink" />");
					        <![CDATA[
					        return false;
					    }
						var link;
						var pname = obj.form.elements['theTemplate'].value;
						var fckParams = obj.form.elements['FCK:AdditionalParams'];
						var extraParams='';
						var cnt=0;
						if(fckParams)
						for(var i=0;i<fckParams.options.length;i++)
						{
							if(fckParams.options[i].value!='-1'){
								var keyValArray = (fckParams.options[i].value).split('=');
								if(cnt==0){
									extraParams=keyValArray[0] + '=' + encodeURIComponent(keyValArray[1]);
								} else {
									extraParams=extraParams + '&' +keyValArray[0] + '=' + encodeURIComponent(keyValArray[1]);
								}
								cnt++;
							}
							
						}
						//Put &nbsp; for IE as IE in few scenarios fails to get the selected element in FCKEditor.Put only the first time asset is included.
						if(useCKEditor && contentWindow.CKEDITOR.env.ie && modeType!='edit')
							link = '&nbsp;<span id="_CSEMBEDTYPE_=inclusion';
						else
							link = '<span id="_CSEMBEDTYPE_=inclusion';
						link = link + "&_PAGENAME_=" + encodeURIComponent(pname);
						if (extraParams != "")
							link = link + "&_ADDITIONALPARAMS_=" + encodeURIComponent(extraParams);
						
						  //link = link + "&_cid_=" + tn_id + "&_c_=" + tn_AssetType + '">';
						  link = link + "&_cid_=" + tn_id + "&_c_=" + tn_AssetType; 
					    
						  if(oCKEditor!= null && useCKEditor)
						  {
							  if( oCKEditor.config.DEPTYPE )
								  link = link + "&_deps_=" + "exists" + '">';
							  else
								  link = link  + '">';
						  }
						  else if (typeof realobject == "object" || useEditPro)
						  { 
							  link = link  + '">';
						  }
						  else
					      {  
							  if(mytextrange!= null && mytextrange.parentElement().getAttribute('DEPTYPE')== "true")
								  link = link + "&_deps_=" + "exists" + '">';
							  else
								  link = link  + '">';
						  }
					
						//Get the included asset id and the type to put inside the span
						]]>
										link = link + "
										<i>
											[
											<XLAT.STREAM KEY="dvin/UI/Common/AssetIncluded" />
											(
											<XLAT.STREAM KEY="dvin/UI/Common/Id" />
											:" + tn_id + ";
											<XLAT.STREAM KEY="dvin/UI/Common/Type" />
											:" + tn_AssetType + ")]
										</i>";
						<![CDATA[
						if(useCKEditor && contentWindow.CKEDITOR.env.ie && modeType!='edit')
						link = link + "</span>&nbsp;";
						else
						link = link + "</span>";
						if (typeof realobject == "object")
					    {
					        // use RealObject
					        realobject.insertHTMLData(link);
					        realobject.pumpEvents();
							closePopUp();
					    }
					    else if ( useEditPro) {
					        // use eWebEditPro
					        //editpro.pasteHTML(link);		
							window.opener.pasteInEwebeditPro(link , fieldname);
							closePopUp();
					    }else if( useCKEditor )
					    {
							url = 'Variables.urlFCKEditorRenderer';
							// Request to CS Renderere..
							insertRenderedData(link);
						}else {
							writeLinkBack( fieldname,link);
							closePopUp();
					    }
					}
					function swap(currentImage, newImageName)
					{
						if (document.images)
						{
							currentImage.src = newImageName;
						}
					}
					
					// Gets Called upon if we have CKEditor Object Loaded
					// Request to the renderer for enciding 
					function insertRenderedData(link) {	
					    
					        
					          // Has the User Selected Custom include asset in edit/chage mode
					          // Placed in Change and/or edit Properties or Change to Asset  Mode
					          if (modeType == 'edit') {
					
					              // Get the Asset Include Custom Element Node Via CKEditor
					              var includeNode = ckUtils.MoveToFWCustomNode(oCKEditor,"include");
					              if(!includeNode)
							{
								]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/FCKEditorSelectionChanged"
											ESCAPE="true" ENCODE="false" />");
								<![CDATA[
								return false;
							}
							
					
							//Check that selection has not changed befor submitting the popup
							var selectedNodeIdValue = document.forms[0].elements['hrefOrIdString'].value;				
							//Check for presence of _cid_ in selectedNodeIdValue because on template change hrefOrIdString will be repopulated.
							if (selectedNodeIdValue.length > 0 && (selectedNodeIdValue.indexOf('_cid_') != -1) && (selectedNodeIdValue.indexOf('_c_') != -1) && includeNode.getAttribute('_fwid') && includeNode.getAttribute('_fwid').value) {
								var passedValues = parseQueryString(selectedNodeIdValue);
								var newValues = parseQueryString(includeNode.getAttributeNode('_fwid').value);
								if((passedValues['_cid_'][0]  != newValues['_cid_'][0])  || (passedValues['_c_'][0]  != newValues['_c_'][0])){
									]]>
										alert("
										<XLAT.STREAM KEY="dvin/UI/FCKEditorSelectionChanged"
											ESCAPE="true" ENCODE="false" />");
									<![CDATA[
									return false;
								}
							}				
							var linkParent = includeNode.getParent();
							var isSafari = (navigator.userAgent.search(/Version\/[5-9][\d\.\s]+Safari/) != -1);
					
							//Fix for Safari when the included asset is included at the end and after pressing enter key
							
							if (isSafari && linkParent.getLast().nodeName == 'BR' && linkParent.getLast().getAttribute('type') == '_moz') {					
								linkParent.getLast().remove();
							}
					
					
							//Fix for Safari when the included asset is the child element
							//Here we need to handle two cases
							//1.When the included element is the first element in the node
							//2.When the included element is the second element in the node and the first element is empty '' value.			
							
							var changed = (linkParent.getChildCount() > 1 && isSafari);
							if (changed) {					
								for (var i = linkParent.getChildCount(); i--;) {				
									if (linkParent.getChild(i).type == 3 && linkParent.getChild(i).getText().replace(/^\s+|\s+$/g, '') == '') {
										linkParent.getChild(i).remove();							
									}
								}
							}				
							if (contentWindow.CKEDITOR.env.webkit) {				
								var tempNode = oCKEditor.document.createText('#_CSEMBED_#');					
								tempNode.insertAfter(includeNode);
								oCKEditor.getSelection().selectElement( tempNode );					
							}
					
							includeNode.remove();				
							oCKEditor.insertHtml(link);
							
							if (contentWindow.CKEDITOR.env.webkit) {
								for (var i = 0; i < linkParent.getChildCount(); i++) {					
									if (linkParent.getChild(i).type == 3 && linkParent.getChild(i).getText() == '#_CSEMBED_#') {
										linkParent.getChild(i).remove();
									}
								}
							}				
					          }
					          else {											
					              oCKEditor.insertHtml(link); 				
					          }
						closePopUp();        		
					}
					
					
					
					function showLoading(waitingDiv){
						$(waitingDiv).style.cursor ='wait';
					    $('ajaxLoading').style.display='block';
					}
					function hideLoading(waitingDiv){
						$(waitingDiv).style.cursor ='default'
					    $('ajaxLoading').style.display='none';
					}
					function closePopUp() {
					    contentWindow.focus();
						closeWindow();
					}
					
					//Strip any html or body or link tag in the rendered data since this would break fckeditor.
					//Remove line feeds/tab/carriage return etc.Also remove any comments from the html string.
					//Satellite server may send <!--FTCACHE-1--> with the html data so remove it as well.
					function filterRenderedData (renderedData){
						return renderedData.replace(/^\s+|\s+$/g,'').replace(/[\r\n\t]/g,"").replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,"").replace(/<head[^>]*>.*?<\/head[^>]*>/gi,"").replace(/<script[^>]*>.*?<\/script[^>]*>/gi,"").replace(/<\/?(body|html)[^>]*?>/gi,"");
					}
					
					//Method to parse the query string and create a map 
					
					function parseQueryString(queryString){
					
					  // define an object to contain the parsed query data
					  var result = {};
					
					  // if a query string wasn't specified, use the query string from the URI
					  if (queryString == undefined){
					    queryString = location.search ? location.search : '';
					  }
					
					  // remove the leading question mark from the query string if it is present
					  if (queryString.charAt(0) == '?') queryString = queryString.substring(1);
					
					  // replace plus signs in the query string with spaces
					  queryString = queryString.replace('+', ' ');
					
					  // split the query string around ampersands and semicolons
					  var queryComponents = queryString.split(/[&;]/g);
					
					  // loop over the query string components
					  for (var i = 0; i < queryComponents.length; i++){
					
					    // extract this component's key-value pair
					    var keyValuePair = queryComponents[i].split('=');
					    var key = decodeURIComponent(keyValuePair[0]);
					    var value = decodeURIComponent(keyValuePair[1]);
					
					    // update the parsed query data with this component's key-value pair
					    if (!result[key]) result[key] = [];
					    result[key].push((keyValuePair.length == 1) ? '' : value);
					
					  }
					
					  // return the parsed query data
					  return result;
					
					}
					
					
					]]>
				</script>
			</replaceall>
		</head>
		<body class="fw" topmargin="0" leftmargin="0" marginheight="0"
			marginwidth="0">
			<ASSET.LOAD NAME="treenode" TYPE="Variables.tn_AssetType"
				OBJECTID="Variables.tn_id" />
			<ASSET.GET NAME="treenode" FIELD="name" OUTPUT="tn_assetname" />
			<ASSET.GET NAME="treenode" FIELD="template" OUTPUT="tn_defTemplate" />
			<SATELLITE.FORM ASSEMBLER="query" METHOD="POST">
				<INPUT TYPE="HIDDEN" NAME="_charset_" VALUE="Variables.charset"
					REPLACEALL="Variables.charset" />
				<INPUT TYPE="hidden" NAME="cs_environment" VALUE="Variables.cs_environment"
					REPLACEALL="Variables.cs_environment" />
				<INPUT TYPE="hidden" NAME="cs_formmode" VALUE="Variables.cs_formmode"
					REPLACEALL="Variables.cs_formmode" />
				<INPUT TYPE="HIDDEN" ID="iHeight" NAME="iHeight" VALUE="Variables.iHeight"
					REPLACEALL="Variables.iHeight" />
				<INPUT TYPE="HIDDEN" ID="iWidth" NAME="iWidth" VALUE="Variables.iWidth"
					REPLACEALL="Variables.iWidth" />
				<STRING.ENCODE VARIABLE="name" VARNAME="name"/>
				<INPUT TYPE="HIDDEN" NAME="name" VALUE="Variables.name"
					REPLACEALL="Variables.name" />
				<STRING.ENCODE VARIABLE="AssetType" VARNAME="OutputQString"/>
				<INPUT TYPE="HIDDEN" NAME="AssetType" VALUE="Variables.OutputQString"
					REPLACEALL="Variables.OutputQString" />
				<INPUT TYPE="HIDDEN" NAME="fielddesc" VALUE="Variables.fielddesc"
					REPLACEALL="Variables.fielddesc" />
				<INPUT TYPE="HIDDEN" NAME="fieldname" VALUE="Variables.fieldname"
					REPLACEALL="Variables.fieldname" />
				<INPUT TYPE="HIDDEN" NAME="EditingStyle" VALUE="Variables.EditingStyle"
					REPLACEALL="Variables.EditingStyle" />
				<INPUT TYPE="HIDDEN" NAME="IFCKEditor" VALUE="Variables.IFCKEditor"
					REPLACEALL="Variables.IFCKEditor" />
				<INPUT TYPE="HIDDEN" NAME="formFieldName" VALUE="Variables.formFieldName"
					REPLACEALL="Variables.formFieldName" />
				<INPUT TYPE="HIDDEN" NAME="modeType" VALUE="Variables.modeType"
					REPLACEALL="Variables.modeType" />
				<INPUT TYPE="HIDDEN" NAME="tn_id" VALUE="Variables.tn_id"
					REPLACEALL="Variables.tn_id" />
				<INPUT TYPE="HIDDEN" NAME="tn_AssetType" VALUE="Variables.tn_AssetType"
					REPLACEALL="Variables.tn_AssetType" />
				<STRING.ENCODE VARIABLE="hrefOrIdString" VARNAME="hrefOrIdString"/>
				<INPUT TYPE="HIDDEN" NAME="hrefOrIdString" VALUE="Variables.hrefOrIdString"
					REPLACEALL="Variables.hrefOrIdString" />
				<INPUT TYPE="HIDDEN" NAME="pagename" VALUE="" />

				<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" width="100%"
					height="100%">
					<tr>
						<td></td>
						<td class="tile-dark" VALIGN="TOP" HEIGHT="1">
							<IMG WIDTH="1" HEIGHT="1"
								src="Variables.cs_imagedir/graphics/common/controlpanel/dotclear.gif"
								REPLACEALL="Variables.cs_imagedir" />
						</td>
						<td></td>
					</tr>
					<tr>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap">
							<BR />
						</td>
						<td>
							<table width="100%" cellpadding="0" cellspacing="0" border="0"
								height="100%">
								<tbody>
									<tr style="height:20px;">
										<td background="Variables.cs_imagedir/graphics/common/screen/grad.gif"
											class="tile-a" REPLACEALL="Variables.cs_imagedir">&nbsp;
										</td>
										<td background="Variables.cs_imagedir/graphics/common/screen/grad.gif"
											class="tile-b" REPLACEALL="Variables.cs_imagedir">
											<DIV class="new-table-title">
												<XLAT.STREAM KEY="dvin/UI/AddInclusion" />
											</DIV>
										</td>
										<td colspan="2"
											background="Variables.cs_imagedir/graphics/common/screen/grad.gif"
											class="tile-b" REPLACEALL="Variables.cs_imagedir">&nbsp;
										</td>
										<td background="Variables.cs_imagedir/graphics/common/screen/grad.gif"
											class="tile-c" REPLACEALL="Variables.cs_imagedir"></td>
									</tr>
									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/Name" />
											:
										</td>
										<td>
											<BR />
										</td>
										<td class="form-inset" colspan="2">
											<STRING.STREAM VARIABLE="tn_assetname" />
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/Type" />
											:
										</td>
										<td>
											<BR />
										</td>
										<td class="form-inset" colspan="2">
											<STRING.STREAM VARIABLE="tn_AssetType" />
										</td>
									</tr>

									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td nowrap="true" class="form-label-text">
											<XLAT.STREAM KEY="dvin/UI/SelectTemplate"
												ENCODE="false" />
											:
										</td>
										<td>
											<BR />
										</td>
										<TD class="form-inset" colspan="2">
											<SELECT NAME="theTemplate"
												ONCHANGE="return GotoNextStep(this.form,'AddInclusion');">
												<OPTION VALUE="None" />
												--
												<XLAT.STREAM KEY="dvin/UI/SelectTemplate" />
												--
			 
												<!--
													get a list of valid templates for the asset type and
													optionally the subtype
												-->
												<ASSET.GETSUBTYPE NAME="treenode" OUTPUT="tn_subtype" />
												<TEMPLATEMANAGER.GetTemplateIds
													LISTVARNAME="Templates" TTYPE="b" ASSETTYPE="Variables.tn_AssetType"
													SUBTYPE="Variables.tn_subtype" PUBID="SessionVariables.pubid"
													EXCLUDEVARIANTS="true" />
												<IF COND="Templates.#numRows!=0">
													<THEN>
														<loop LIST="Templates">
															<TEMPLATE.GETPAGENAME OUTNAME="pname"
																SUBTYPE="Variables.tn_AssetType" NAME="Templates.name" />
															<if cond="IsVariable._pagename_=true">
																<then>
																	<IF COND="Variables.pname=Variables._pagename_">
																		<THEN>
																			<OPTION VALUE="Variables.pname" SELECTED="SELECTED"
																				REPLACEALL="Variables.pname" />
																			<STRING.STREAM LIST="Templates" COLUMN="name" />
																			<SETVAR NAME="selectedTempId" VALUE="Templates.id" />
																		</THEN>
																		<ELSE>
																			<OPTION VALUE="Variables.pname" REPLACEALL="Variables.pname" />
																			<STRING.STREAM LIST="Templates" COLUMN="name" />
																		</ELSE>
																	</IF>
																</then>
																<else>
																	<IF COND="Templates.name=Variables.tn_defTemplate">
																		<THEN>
																			<OPTION VALUE="Variables.pname" SELECTED="SELECTED"
																				REPLACEALL="Variables.pname" />
																			<STRING.STREAM LIST="Templates" COLUMN="name" />
																			<SETVAR NAME="selectedTempId" VALUE="Templates.id" />
																			<SETVAR NAME="_pagename_" VALUE="Variables.pname" />
																		</THEN>
																		<ELSE>
																			<OPTION VALUE="Variables.pname" REPLACEALL="Variables.pname" />
																			<STRING.STREAM LIST="Templates" COLUMN="name" />
																		</ELSE>
																	</IF>
																</else>
															</if>
														</loop>
													</THEN>
												</IF>
											</SELECT>
										</TD>
									</tr>

									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr>
										<!--
											<td colspan="5" class="light-line-color"><img height="1"
											width="1"
											src="Variables.cs_imagedir/graphics/common/controlpanel/dotclear.gif"
											REPLACEALL="Variables.cs_imagedir"/></td>
										-->
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
								</tbody>
								<tbody id="_extraParamRows">
									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/ExtraParameters" />
											:
										</td>										
										<td colspan="3">
											<IF COND="IsVariable.selectedTempId=true">
												<THEN>
													<!-- Get the list of arguments from the template -->
													<ASSET.LOAD NAME="selectedTemplate" TYPE="Template"
														OBJECTID="Variables.selectedTempId" EDITABLE="true" />
													<ASSET.SCATTER NAME="selectedTemplate"
														FIELDLIST="*" PREFIX="template" />
													<SETVAR NAME="extraParams" VALUE="Variables.empty" />
													<SETCOUNTER NAME="critn" VALUE="0" />
													<SETCOUNTER NAME="paramCounter" VALUE="0" />
													<LOOP COUNT="Variables.template:pagecriteria:Total">
														<SETVAR NAME="errno" VALUE="0" />
														<SETVAR NAME="tempVar"
															VALUE="Variables.template:pagecriteria:Counters.critn" />
														<INDEXOF STR="Variables.tempVar" WHAT="fp:"
															OUTSTR="paramIndex" INDEX="0" />
														<IF COND="Variables.errno=1">
															<THEN>
																<SUBSTRING STR="Variables.tempVar" OUTSTR="validParam"
																	INDEX="3" />
																<IF COND="Counters.paramCounter=0">
																	<THEN>
																		<SETVAR NAME="extraParams" VALUE="Variables.validParam" />
																	</THEN>
																	<ELSE>
																		<SETVAR NAME="extraParams"
																			VALUE="Variables.extraParams;Variables.validParam" />
																	</ELSE>
																</IF>
																<INCCOUNTER NAME="paramCounter" VALUE="1" />
															</THEN>
														</IF>
														<INCCOUNTER NAME="critn" VALUE="1" />
													</LOOP>
													<STRINGLIST NAME="lLegalArgs" STR="Variables.extraParams"
														DELIM=";" />
													<IF COND="IsList.lLegalArgs=true">
														<THEN>
															<IF COND="lLegalArgs.#numRows!=0">
																<THEN>
																	<TABLE CELLSPACING="0" CELLPADDING="5" BORDER="0">
																		<TR>
																			<TD nowrap="nowrap" valign="top">
																				<XLAT.STREAM KEY="dvin/Common/Name" />
																				:
																				<SELECT NAME="legalname" SIZE="1" style="width:100px">
																					<LOOP LIST="lLegalArgs">
																						<OPTION>
																							<STRING.STREAM VALUE="lLegalArgs.ITEM" />
																						</OPTION>
																					</LOOP>
																				</SELECT>
																				<BR />
																				<BR />
																				<XLAT.STREAM KEY="dvin/Common/Value" />
																				:
																				<INPUT TYPE="TEXT" NAME="paramValue" VALUE="[Value]"
																					SIZE="32" ID="val" style="width:100px" />
																			</TD>
																			<TD valign="top">
																				<A HREF="javascript:void(0);"
																					ONCLICK="movedefargright(document.forms[0].elements['legalname'], document.forms[0].elements['FCK:AdditionalParams']);">
																					<CALLELEMENT
																						NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton">
																						<ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Add" />
																					</CALLELEMENT>
																				</A>
																				<BR /><BR />
																				<A HREF="javascript:void(0);"
																					ONCLICK="removearg(document.forms[0].elements['FCK:AdditionalParams'])">
																					<CALLELEMENT
																						NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton">
																						<ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Remove" />
																					</CALLELEMENT>
																					
																				</A>
																			</TD>
																			<TD valign="top">
																				<SELECT NAME="FCK:AdditionalParams" SIZE="6"
																					style="width:200px;" MULTIPLE="yes"
																					ONCHANGE="populateKeyValueFields(this.form,this)"
																					ONMOUSEOUT="window.status=' ';return true;">
																					<RENDER.GETADDITIONALPARAMSLIST
																						ADDITIONALPARAMS="Variables._additionalparams_"
																						NAME="eParamList" />
																					<IF COND="eParamList.#numRows!=0">
																						<THEN>
																							<SETCOUNTER NAME="currentArg" VALUE="0" />
																							<LOOP LIST="eParamList">
																								<SUBSTITUTE STR="eParamList.key"
																									OUTSTR="argkey" WHAT="fp:" WITH="" />
												<![CDATA[<OPTION VALUE="]]><STRING.STREAM
																								VALUE="eParamList.key=eParamList.value" /><![CDATA[">]]><STRING.STREAM
																								VALUE="Variables.argkey=eParamList.value" /><![CDATA[</OPTION>]]>
																								<INCCOUNTER NAME="currentArg" VALUE="1" />
																							</LOOP>
																						</THEN>
																					</IF>
																					<OPTION VALUE="-1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																					</OPTION>
																				</SELECT>
																			</TD>
																		</TR>
																	</TABLE>
																</THEN>
																<ELSE>
																	<XLAT.STREAM KEY="dvin/UI/ParametersNotAvailable" />
																</ELSE>
															</IF>
														</THEN>
														<ELSE>
															<XLAT.STREAM KEY="dvin/UI/ParametersNotAvailable" />
														</ELSE>
													</IF>
												</THEN>
												<ELSE>
													<XLAT.STREAM KEY="dvin/UI/ParametersNotAvailable" />
												</ELSE>
											</IF>
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
								</tbody>
								<tbody>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr style="height:10px;color:#ffffff;background-color:#555555;">
										<td>
											<BR />
										</td>
										<td>
											<div class="insite-section-title">
												<XLAT.STREAM KEY="dvin/UI/To" />
											</div>
										</td>
										<td colspan="2">
											<BR />
										</td>
										<td>
											<BR />
										</td>
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>


									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/Name" />
											:
										</td>
										<td>
											<BR />
										</td>
										<td class="form-inset" colspan="2">
											<STRING.STREAM VARIABLE="name" />
										</td>
									</tr>

									<ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType" />
									<ASSETTYPE.GET NAME="type" FIELD="description"
										OUTPUT="ATdesc" />
									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/Type" />
											:
										</td>
										<td>
											<BR />
										</td>
										<td class="form-inset" colspan="2">
											<STRING.STREAM VARIABLE="ATdesc" />
										</td>
									</tr>

									<tr class="tile-row-highlight">
										<td>
											<BR />
										</td>
										<td class="form-label-text">
											<XLAT.STREAM KEY="dvin/Common/Field" />
											:
										</td>
										<td>
											<BR />
										</td>
										<td class="form-inset" colspan="2">
											<STRING.STREAM VARIABLE="fielddesc" />
										</td>
									</tr>

									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="10" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr>
										<td colspan="4" class="tile-dark" VALIGN="TOP" HEIGHT="1">
											<IMG WIDTH="1" HEIGHT="1"
												src="Variables.cs_imagedir/graphics/common/controlpanel/dotclear.gif"
												REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr style="height:5px;">
										<td colspan="4"
											background="Variables.cs_imagedir/graphics/common/controlpanel/shadow.gif"
											REPLACEALL="Variables.cs_imagedir">
											<IMG WIDTH="1" HEIGHT="5"
												src="Variables.cs_imagedir/graphics/common/controlpanel/dotclear.gif"
												REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									</tbody>
									<tbody>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="20" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
									<tr>
									</tr>
									<tr class="tile-row-highlight">
										<XLAT.LOOKUP KEY="dvin/Common/CancelChanges" VARNAME="_XLAT_" ESCAPE="true" />
										<td><BR /></td>
										<td><BR /></td>
										<td><BR /></td>
										<td>
											<A style="text-decoration: none; color: #FFFFFF" HREF="javascript:void(0)"
												onclick="return cancelAddInclusion()" onmouseover="window.status='Variables._XLAT_';return true;"
												onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_">
												<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton">
													<ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel" />
												</CALLELEMENT>
											</A>
											<XLAT.LOOKUP KEY="dvin/Common/SaveChanges" VARNAME="_XLAT_"
												ESCAPE="true" />
											<A style="text-decoration: none; color: #FFFFFF" HREF="javascript:void(0)"
												onclick="return saveAddInclusion();" onmouseover="window.status='Variables._XLAT_';return true;"
												onmouseout="window.status='';return true;" REPLACEALL="Variables._XLAT_">
												<CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton">
													<ARGUMENT NAME="buttonkey" VALUE="dvin/UI/Common/saveAndClose" />
												</CALLELEMENT>
											</A>
										</td>										
									</tr>
									<tr class="tile-row-highlight">
										<td colspan="5">
											<img
												src="Variables.cs_imagedir/graphics/common/controlpanel/spacer.gif"
												height="20" REPLACEALL="Variables.cs_imagedir" />
										</td>
									</tr>
								</tbody>
							</table>
						</td>
						<td class="tile-dark" VALIGN="top" WIDTH="1" NOWRAP="nowrap">
							<BR />
						</td>
					</tr>
				</TABLE>

			</SATELLITE.FORM>
			<replaceall list="Variables.iHeight,Variables.iWidth">
			<![CDATA[
			<SCRIPT>
				var iWidth = 0;
				var iHeight = 0;
				]]>
							<IF COND="Variables.iWidth!=-1">
								<THEN>
					<![CDATA[
					iWidth = parseInt("Variables.iWidth");
					]]>
								</THEN>
								<ELSE>
					<![CDATA[
					iWidth = 70 + document.body.scrollWidth;
					document.getElementById('iWidth').value=iWidth; 
					]]>
								</ELSE>
							</IF>
							<IF COND="Variables.iHeight!=-1">
								<THEN>
					<![CDATA[
					iHeight = parseInt("Variables.iHeight");
					]]>
								</THEN>
								<ELSE>
					<![CDATA[
					iHeight = 70 + document.body.scrollHeight;
					document.getElementById('iHeight').value=iHeight; 
					]]>
								</ELSE>
							</IF>
				<![CDATA[
					window.resizeTo(iWidth, iHeight);
					window.focus();
			</SCRIPT>
				]]>
			</replaceall>
			<div id="ajaxLoading"
				style="width:200px;height:100px;position:absolute; top: 100px;display:none; left: 80px;"
				bgcolor="white">
				<table width="100%" height="100%" cellspacing="0" cellpadding="0"
					bgcolor="#ffffff" align="center" style="border: 1px solid rgb(204,204,204);">
					<tbody>
						<tr>
							<td valign="middle" align="center">
								<img src="Variables.cs_imagedir/graphics/common/icon/wait_ax.gif"
									REPLACEALL="Variables.cs_imagedir" />
								<br />
								<br />
								<b>
									<span id="loadingMsg">
										<XLAT.STREAM KEY="dvin/UI/Loading" />
									</span>
									<img
										src="Variables.cs_imagedir/graphics/common/icon/short_Progress.gif"
										REPLACEALL="Variables.cs_imagedir" />
								</b>
								<a id="hider2" style="cursor: pointer; text-decoration: underline;" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</body>
	</html>
</FTCS>
