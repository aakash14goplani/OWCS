<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateC/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/Actions/CommitFront.xml $ 
$Revision: 25 $ 
$Modtime: 2/27/04 2:46p $ 
-->

<!--
- Confidential and Proprietary Information of FutureTense Inc.
-					All Rights Reserved.
-
- CommitFront.xml
-
- DESCRIPTION
-	Use to commit a previously locked category record
-
- HISTORY 
-->


<!-- 
    Check to see if tracking is enabled on
    the content category. If not, then
    indicate error and get out.

    Check to see if anybody has it locked. If
    current user has it locked, then we're okay
    to commit. Else, report an error
-->
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>
<SCRIPT Language="JavaScript">
<![CDATA[

function checkValueLength(myfield)
{
	var value = myfield.value;
	if ( value.length > 255 ) 
	{
		myfield.value = value.substr( 0, 255 );
		]]>
		alert("<XLAT.STREAM KEY="dvin/Common/CommentTooLong" ENCODE="false" ESCAPE="true"/>");
		<![CDATA[
	}
}
]]>

</SCRIPT>
<STRING.ENCODE VARIABLE="AssetType" VARNAME="AssetType"/>
<STRING.ENCODE VARIABLE="id" VARNAME="id"/>

<setvar NAME="assetname" VALUE="theAsset"/>
<ASSET.LOAD TYPE="Variables.AssetType" OBJECTID="Variables.id" NAME="Variables.assetname"/>
<ASSET.GET NAME="theAsset" FIELD="name" OUTPUT="tempassetname"/>
<ASSETTYPE.LOAD NAME="type" TYPE="Variables.AssetType"/>
<ASSETTYPE.GET NAME="type" FIELD="description" OUTPUT="ATdesc"/>

<callelement NAME="OpenMarket/Xcelerate/Actions/RevisionTracking/CheckTrackingEnabled">
    <argument NAME="AssetType" VALUE="Variables.AssetType"/>
</callelement>
<if COND="Variables.trackingenabled=true">
    <then>
		 
        <history TABLE="Variables.AssetType" ASSET="Variables.id" LIST="ItsHistory"/>
        <if COND="ItsHistory.lockedby=SessionVariables.username">
            <then>
                <!-- this is when we can commit it! -->
                <TABLE CELLPADDING="0" CELLSPACING="1" BORDER="0" CLASS="width-outer-70">
				<TR>
				<TD>
				<span class="title-text"><XLAT.STREAM KEY="dvin/Common/CheckIn"/> </span> <span class="title-value-text"><STRING.STREAM VALUE="Variables.ATdesc"/>: <STRING.STREAM VALUE="Variables.tempassetname"/></span>
				</TD>
				
				</TR>
			
				
			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/TitleBar"/>  

			<!-- code begins -->
			<TR>
				<TD>
					<CALLELEMENT NAME="OpenMarket/Xcelerate/Actions/AssetMgt/ShowBriefDetails">
						<ARGUMENT NAME="assetObj" VALUE="Variables.assetname"/>
					</CALLELEMENT>
				</TD>
			</TR>
		
			<!--<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>-->
			<TR>
				<TD>
					<TABLE border="0" cellpadding="0" cellspacing="0">
					<TR>
						<TD>&nbsp;</TD>
						<TD>&nbsp;</TD>
						<TD>
                                <XLAT.STREAM KEY="dvin/UI/enteracommentrevisionCheckIndoneCheckKeepCheckedOutif"/>
                       </TD>
                </TR>

				<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
		
				<TR>
                        <TD class="form-label-text">
                                <XLAT.STREAM KEY="dvin/Common/Comments"/>:
                        </TD>
						<TD>&nbsp;</TD>
                        <TD class="form-inset">
                            <TEXTAREA NAME="commitcomment" ROWS="2" COLS="60" WRAP="VIRTUAL" onChange="checkValueLength(this);" ></TEXTAREA>
                        </TD>
                  </TR>

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			<TR>
                        <TD></TD>
						<TD>&nbsp;</TD>
                        <TD>
                            <INPUT type="checkbox" NAME="keeplocked"/>
                            <XLAT.STREAM KEY="dvin/Common/KeepCheckedOut"/>
                        </TD>
                </TR>

			<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
			


			
		</TABLE><!--end of body--></TD>
	</TR>

			<!-- code ends-->		


                	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/FooterBar"/>
                    <TR>
                        
                        <TD align="left">
                           <!-- <BR/> -->
						  <STRING.ENCODE VARIABLE="PostPage" VARNAME="PostPage"/> 
                          <INPUT type="hidden" name="pagename" value="OpenMarket/Xcelerate/Actions/Variables.PostPage" REPLACEALL="Variables.PostPage"/>
						  <INPUT type="hidden" name="AssetType" VALUE="Variables.AssetType" REPLACEALL="Variables.AssetType"/>
						  <INPUT type="hidden" name="id" VALUE="Variables.id" REPLACEALL="Variables.id"/>
				
                            <XLAT.LOOKUP KEY="dvin/UI/Cancel" VARNAME="_xlat_cancel" ESCAPE="true"/>
                            <XLAT.LOOKUP KEY="dvin/Common/CheckIn" VARNAME="_xlat_checkin"/>
                            <SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Xcelerate/Actions/ContentDetailsFront" outstring="urlcontdetfront">
                                <satellite.argument name="cs_environment" value="Variables.cs_environment"/>
                                <satellite.argument name="cs_formmode" value="Variables.cs_formmode"/>
                                                               <satellite.argument name="AssetType" value="Variables.AssetType"/>
                                                              <satellite.argument name="id" value="Variables.id"/>
                                                               </SATELLITE.LINK>
                           <table class="width-inner-100"><tr><td></td><td></td><td>
                           		<A HREF="Variables.urlcontdetfront" onmouseover="window.status='Variables._xlat_cancel';return true;" onmouseout="window.status='';return true;"  REPLACEALL="Variables.urlcontdetfront,Variables._xlat_cancel"><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/Cancel"/></CALLELEMENT></A>
								<STRING.ENCODE VARIABLE="urlsitepost" VARNAME="urlsitepost"/>
								<A HREF="javascript:void(0)" onclick="javascript:document.AppForm.submit();" REPLACEALL="Variables.urlsitepost" ><CALLELEMENT NAME="OpenMarket/Xcelerate/UIFramework/Util/TextButton"><ARGUMENT NAME="buttonkey" VALUE="UI/Forms/CheckIn"/></CALLELEMENT></A>
                           </td></tr></table>
                         </TD>
				
                    </TR>

				

                </TABLE>
            </then>
            <else>        
                <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
                    <argument NAME="error" VALUE="CommitFailed"/>
                </callelement>
				
			<br/>	
	 		<callelement NAME="OpenMarket/Xcelerate/Actions/ContentDetailsFront">
				<argument NAME="AssetType" VALUE="Variables.AssetType"/>
				<argument NAME="id"        VALUE="Variables.id"/>
	 		</callelement>
            </else>
        </if>
    </then>
    <else>
        <!-- commit is going to fail -->
        <callelement NAME="OpenMarket/Xcelerate/Actions/Util/ShowError">
            <argument NAME="error" VALUE="CommitWillFail"/>
        </callelement>
        <BR/>
        <CALLELEMENT NAME="FutureTense/Apps/AdminForms/RevisionMgt/errors"/>
    </else>
</if>

</FTCS>
